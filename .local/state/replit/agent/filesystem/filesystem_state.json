{"file_contents":{"client/src/pages/admin/HolidayManagement.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n    Form,\n    FormControl,\n    FormField,\n    FormItem,\n    FormLabel,\n    FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Plus, Calendar, Trash2 } from \"lucide-react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport type { Holiday } from \"@shared/schema\";\n\nconst holidayFormSchema = z.object({\n    name: z.string().min(1, \"Holiday name is required\"),\n    date: z.string().min(1, \"Date is required\"),\n    description: z.string().optional(),\n});\n\ntype HolidayFormData = z.infer<typeof holidayFormSchema>;\n\nexport default function HolidayManagement() {\n    const { toast } = useToast();\n    const [dialogOpen, setDialogOpen] = useState(false);\n\n    const { data: user } = useQuery<any>({\n        queryKey: [\"/api/me\"],\n    });\n\n    const { data: holidays = [], isLoading } = useQuery<Holiday[]>({\n        queryKey: [\"/api/holidays/company\", user?.companyId],\n        enabled: !!user?.companyId,\n    });\n\n    const form = useForm<HolidayFormData>({\n        resolver: zodResolver(holidayFormSchema),\n        defaultValues: {\n            name: \"\",\n            date: \"\",\n            description: \"\",\n        },\n    });\n\n    const createHolidayMutation = useMutation({\n        mutationFn: async (data: HolidayFormData) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/holidays`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/holidays/company\", user?.companyId],\n            });\n            toast({\n                title: \"Holiday added\",\n                description: \"The holiday has been added successfully.\",\n            });\n            form.reset();\n            setDialogOpen(false);\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description: \"Failed to add holiday. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const deleteHolidayMutation = useMutation({\n        mutationFn: async (holidayId: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/holidays/${holidayId}`,\n                \"DELETE\",\n                {}\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/holidays/company\", user?.companyId],\n            });\n            toast({\n                title: \"Holiday deleted\",\n                description: \"The holiday has been removed successfully.\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description: \"Failed to delete holiday. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const onSubmit = (data: HolidayFormData) => {\n        createHolidayMutation.mutate(data);\n    };\n\n    return (\n        <div className=\"container mx-auto p-6 space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n                        Holiday Management\n                    </h1>\n                    <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\n                        Manage company holidays and days off\n                    </p>\n                </div>\n                <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n                    <DialogTrigger asChild>\n                        <Button data-testid=\"button-add-holiday\">\n                            <Plus className=\"h-4 w-4 mr-2\" />\n                            Add Holiday\n                        </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>Add Holiday</DialogTitle>\n                        </DialogHeader>\n                        <Form {...form}>\n                            <form\n                                onSubmit={form.handleSubmit(onSubmit)}\n                                className=\"space-y-4\">\n                                <FormField\n                                    control={form.control}\n                                    name=\"name\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Holiday Name</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    data-testid=\"input-holiday-name\"\n                                                    placeholder=\"e.g., Christmas, New Year\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <FormField\n                                    control={form.control}\n                                    name=\"date\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Date</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    type=\"date\"\n                                                    data-testid=\"input-holiday-date\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <FormField\n                                    control={form.control}\n                                    name=\"description\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>\n                                                Description (Optional)\n                                            </FormLabel>\n                                            <FormControl>\n                                                <Textarea\n                                                    data-testid=\"input-holiday-description\"\n                                                    placeholder=\"Additional details about the holiday...\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <div className=\"flex justify-end gap-2\">\n                                    <Button\n                                        type=\"button\"\n                                        variant=\"outline\"\n                                        onClick={() => setDialogOpen(false)}\n                                        data-testid=\"button-cancel\">\n                                        Cancel\n                                    </Button>\n                                    <Button\n                                        type=\"submit\"\n                                        disabled={\n                                            createHolidayMutation.isPending\n                                        }\n                                        data-testid=\"button-submit-holiday\">\n                                        {createHolidayMutation.isPending\n                                            ? \"Adding...\"\n                                            : \"Add Holiday\"}\n                                    </Button>\n                                </div>\n                            </form>\n                        </Form>\n                    </DialogContent>\n                </Dialog>\n            </div>\n\n            <div className=\"grid gap-4\">\n                {isLoading && (\n                    <Card className=\"p-6\">\n                        <p className=\"text-center text-gray-500 dark:text-gray-400\">\n                            Loading...\n                        </p>\n                    </Card>\n                )}\n\n                {!isLoading && holidays.length === 0 && (\n                    <Card className=\"p-6\">\n                        <p\n                            className=\"text-center text-gray-500 dark:text-gray-400\"\n                            data-testid=\"text-no-holidays\">\n                            No holidays added yet. Click \"Add Holiday\" to create\n                            your first holiday.\n                        </p>\n                    </Card>\n                )}\n\n                {holidays.map((holiday) => (\n                    <Card\n                        key={holiday.id}\n                        className=\"p-6\"\n                        data-testid={`card-holiday-${holiday.id}`}>\n                        <div className=\"flex justify-between items-start\">\n                            <div className=\"space-y-2 flex-1\">\n                                <h3\n                                    className=\"font-semibold text-lg\"\n                                    data-testid={`text-holiday-name-${holiday.id}`}>\n                                    {holiday.name}\n                                </h3>\n                                <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                                    <Calendar className=\"h-4 w-4\" />\n                                    <span\n                                        data-testid={`text-holiday-date-${holiday.id}`}>\n                                        {new Date(\n                                            holiday.date\n                                        ).toLocaleDateString(\"en-US\", {\n                                            year: \"numeric\",\n                                            month: \"long\",\n                                            day: \"numeric\",\n                                        })}\n                                    </span>\n                                </div>\n                                {holiday.description && (\n                                    <p\n                                        className=\"text-sm text-gray-700 dark:text-gray-300\"\n                                        data-testid={`text-holiday-description-${holiday.id}`}>\n                                        {holiday.description}\n                                    </p>\n                                )}\n                            </div>\n                            <Button\n                                variant=\"destructive\"\n                                size=\"icon\"\n                                onClick={() =>\n                                    deleteHolidayMutation.mutate(holiday.id)\n                                }\n                                disabled={deleteHolidayMutation.isPending}\n                                data-testid={`button-delete-${holiday.id}`}>\n                                <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                        </div>\n                    </Card>\n                ))}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":12438,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/pages/admin/AdminFeedback.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { MessageSquare, User, Shield, Users, Send, CheckCircle } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { Feedback, User as UserType } from \"@shared/schema\";\n\nconst RESPONSE_OPTIONS = ['Good', 'Bad', 'Excellent', 'Satisfactory', 'Needs Improvement'] as const;\n\nexport default function AdminFeedback() {\n  const { toast } = useToast();\n  const [selectedResponses, setSelectedResponses] = useState<Record<number, string>>({});\n\n  const { data: feedbacks = [], isLoading } = useQuery<Feedback[]>({\n    queryKey: [\"/api/feedbacks\"],\n  });\n\n  const { data: users = [] } = useQuery<UserType[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const respondMutation = useMutation({\n    mutationFn: async ({ feedbackId, adminResponse }: { feedbackId: number; adminResponse: string }) => {\n      return await apiRequest(`${API_BASE_URL}/api/feedbacks/${feedbackId}/respond`, 'PATCH', { adminResponse });\n    },\n    onSuccess: (_data: unknown, variables: { feedbackId: number; adminResponse: string }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/feedbacks\"] });\n      toast({\n        title: \"Response sent\",\n        description: \"Your feedback response has been sent successfully\",\n      });\n      setSelectedResponses((prev) => {\n        const newResponses = { ...prev };\n        delete newResponses[variables.feedbackId];\n        return newResponses;\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to send response\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const getUserById = (userId: number) => {\n    return users.find((u: UserType) => u.id === userId);\n  };\n\n  const getRecipientIcon = (type: string) => {\n    if (type === \"Admin\") return <Shield className=\"h-4 w-4 text-blue-600\" />;\n    if (type === \"TeamLeader\") return <Users className=\"h-4 w-4 text-purple-600\" />;\n    return <User className=\"h-4 w-4\" />;\n  };\n\n  const handleResponseSubmit = (feedbackId: number) => {\n    const response = selectedResponses[feedbackId];\n    if (!response) {\n      toast({\n        title: \"Please select a response\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    respondMutation.mutate({ feedbackId, adminResponse: response });\n  };\n\n  const pendingFeedbacks = feedbacks.filter((f: Feedback) => !f.adminResponse);\n  const respondedFeedbacks = feedbacks.filter((f: Feedback) => f.adminResponse);\n\n  return (\n    <div className=\"space-y-4 sm:space-y-6\">\n      <div>\n        <h2 className=\"text-2xl sm:text-3xl font-bold\">User Feedback</h2>\n        <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n          View and respond to feedback submitted by users\n        </p>\n      </div>\n\n      {/* Pending Feedback */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg sm:text-xl flex items-center gap-2\">\n            <MessageSquare className=\"h-5 w-5\" />\n            Pending Feedback ({pendingFeedbacks.length})\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : pendingFeedbacks.length > 0 ? (\n            <div className=\"space-y-4\">\n              {pendingFeedbacks.map((feedback: Feedback) => {\n                const user = getUserById(feedback.submittedBy);\n                return (\n                  <div key={feedback.id} data-testid={`feedback-${feedback.id}`} className=\"p-4 space-y-4 border rounded-md\">\n                      <div className=\"flex items-start gap-3\">\n                        <Avatar className=\"h-10 w-10 mt-1\">\n                          <AvatarImage src={user?.photoURL || ''} />\n                          <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                            {user?.displayName?.charAt(0) || <User className=\"h-4 w-4\" />}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex-1 space-y-2\">\n                          <div className=\"flex items-start justify-between gap-2 flex-wrap\">\n                            <div>\n                              <div className=\"flex items-center gap-2\">\n                                <p className=\"font-semibold text-sm\">\n                                  {user?.displayName || 'Unknown User'}\n                                </p>\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  {user?.role || 'Member'}\n                                </Badge>\n                              </div>\n                              <p className=\"text-xs text-muted-foreground\">\n                                {user?.email || 'No email'}\n                              </p>\n                            </div>\n                            <span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                              {format(new Date(feedback.createdAt), 'MMM dd, yyyy • h:mm a')}\n                            </span>\n                          </div>\n\n                          <div className=\"flex items-center gap-2\">\n                            {getRecipientIcon(feedback.recipientType)}\n                            <span className=\"text-xs text-muted-foreground\">\n                              Sent to: {feedback.recipientType === \"TeamLeader\" ? \"Team Leader\" : feedback.recipientType}\n                            </span>\n                          </div>\n\n                          <p className=\"text-sm leading-relaxed bg-muted p-3 rounded-md\">\n                            {feedback.message}\n                          </p>\n\n                          <div className=\"flex gap-2 items-end flex-wrap\">\n                            <div className=\"flex-1 min-w-[200px]\">\n                              <Select \n                                value={selectedResponses[feedback.id] || \"\"} \n                                onValueChange={(value) => setSelectedResponses({ ...selectedResponses, [feedback.id]: value })}\n                              >\n                                <SelectTrigger data-testid={`select-response-${feedback.id}`}>\n                                  <SelectValue placeholder=\"Select response...\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {RESPONSE_OPTIONS.map((option) => (\n                                    <SelectItem key={option} value={option} data-testid={`option-${option.toLowerCase().replace(' ', '-')}`}>\n                                      {option}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            </div>\n                            <Button\n                              onClick={() => handleResponseSubmit(feedback.id)}\n                              disabled={respondMutation.isPending || !selectedResponses[feedback.id]}\n                              data-testid={`button-respond-${feedback.id}`}\n                            >\n                              <Send className=\"h-4 w-4 mr-2\" />\n                              {respondMutation.isPending ? \"Sending...\" : \"Send Response\"}\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <div className=\"text-center py-12 space-y-3\">\n              <div className=\"mx-auto w-16 h-16 rounded-full bg-muted flex items-center justify-center\">\n                <MessageSquare className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n              <div>\n                <p className=\"font-medium\">No pending feedback</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  All feedback has been responded to\n                </p>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Responded Feedback */}\n      {respondedFeedbacks.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg sm:text-xl flex items-center gap-2\">\n              <CheckCircle className=\"h-5 w-5 text-green-600\" />\n              Responded Feedback ({respondedFeedbacks.length})\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {respondedFeedbacks.map((feedback: Feedback) => {\n                const user = getUserById(feedback.submittedBy);\n                return (\n                  <div key={feedback.id} className=\"border-green-200 dark:border-green-900 p-4 space-y-3 border rounded-md\" data-testid={`responded-feedback-${feedback.id}`}>\n                      <div className=\"flex items-start gap-3\">\n                        <Avatar className=\"h-10 w-10 mt-1\">\n                          <AvatarImage src={user?.photoURL || ''} />\n                          <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                            {user?.displayName?.charAt(0) || <User className=\"h-4 w-4\" />}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex-1 space-y-2\">\n                          <div className=\"flex items-start justify-between gap-2 flex-wrap\">\n                            <div>\n                              <div className=\"flex items-center gap-2\">\n                                <p className=\"font-semibold text-sm\">\n                                  {user?.displayName || 'Unknown User'}\n                                </p>\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  {user?.role || 'Member'}\n                                </Badge>\n                              </div>\n                              <p className=\"text-xs text-muted-foreground\">\n                                {user?.email || 'No email'}\n                              </p>\n                            </div>\n                            <span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                              {format(new Date(feedback.createdAt), 'MMM dd, yyyy')}\n                            </span>\n                          </div>\n\n                          <div className=\"flex items-center gap-2\">\n                            {getRecipientIcon(feedback.recipientType)}\n                            <span className=\"text-xs text-muted-foreground\">\n                              To: {feedback.recipientType === \"TeamLeader\" ? \"Team Leader\" : feedback.recipientType}\n                            </span>\n                          </div>\n\n                          <p className=\"text-sm text-muted-foreground\">\n                            {feedback.message}\n                          </p>\n\n                          <div className=\"bg-green-50 dark:bg-green-950 p-3 rounded-md border border-green-200 dark:border-green-900\">\n                            <p className=\"text-xs font-medium text-green-700 dark:text-green-300 mb-1\">Your Response:</p>\n                            <p className=\"text-sm font-semibold text-green-900 dark:text-green-100\">{feedback.adminResponse}</p>\n                            {feedback.respondedAt && (\n                              <p className=\"text-xs text-green-600 dark:text-green-400 mt-1\">\n                                Responded: {format(new Date(feedback.respondedAt), 'MMM dd, yyyy • h:mm a')}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                  </div>\n                );\n              })}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":12630,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ForgotCompanyIdPage.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Building2 } from \"lucide-react\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function ForgotCompanyIdPage() {\n  const [email, setEmail] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\");\n\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/auth/forgot-company-id`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to send Company ID');\n      }\n\n      setIsSuccess(true);\n      toast({\n        title: \"Email Sent!\",\n        description: \"Check your email for your Company Server ID.\",\n        duration: 5000,\n      });\n    } catch (error: any) {\n      setError(error.message || \"Failed to send Company ID\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-background\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Building2 className=\"h-6 w-6 text-primary\" />\n            Forgot Company ID\n          </CardTitle>\n          <CardDescription>\n            Enter your registered email address and we'll send you your Company Server ID\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {!isSuccess ? (\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Company Email Address</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"admin@company.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  data-testid=\"input-email\"\n                />\n              </div>\n\n              {error && (\n                <p className=\"text-sm text-red-500\" data-testid=\"error-message\">\n                  {error}\n                </p>\n              )}\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={isLoading}\n                data-testid=\"button-send-company-id\"\n              >\n                {isLoading ? \"Sending...\" : \"Send Company ID\"}\n              </Button>\n\n              <div className=\"text-center\">\n                <Link href=\"/login/admin\" className=\"text-sm text-primary hover:underline inline-flex items-center gap-1\" data-testid=\"link-back-to-login\">\n                  <ArrowLeft className=\"h-3.5 w-3.5\" />\n                  Back to Login\n                </Link>\n              </div>\n            </form>\n          ) : (\n            <div className=\"space-y-4 text-center\">\n              <div className=\"mx-auto w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center\">\n                <Building2 className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-semibold mb-2\">Check Your Email</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  We've sent your Company Server ID to <strong>{email}</strong>\n                </p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Please check your inbox and use the Company Server ID to log in.\n                </p>\n              </div>\n              <div className=\"pt-4\">\n                <Link href=\"/login/admin\">\n                  <Button variant=\"outline\" className=\"w-full\" data-testid=\"button-back-to-login\">\n                    <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                    Back to Login\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4601,"size_tokens":null},"client/src/components/TaskCard.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, ChevronDown, ChevronUp, Play, Pause, CheckCircle, Clock } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { format } from \"date-fns\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface TaskCardProps {\n  id: string;\n  userId: number;\n  title: string;\n  description: string;\n  priority: \"Low\" | \"Medium\" | \"High\";\n  deadline?: Date;\n  status: \"Pending\" | \"In Progress\" | \"Completed\";\n  assignedDate: Date;\n  onStatusChange?: (status: \"Pending\" | \"In Progress\" | \"Completed\") => void;\n}\n\nconst priorityColors = {\n  Low: \"bg-muted text-muted-foreground\",\n  Medium: \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400\",\n  High: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n};\n\nconst statusColors = {\n  Pending: \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400\",\n  \"In Progress\": \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n  Completed: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n};\n\nexport default function TaskCard({\n  id,\n  userId,\n  title,\n  description,\n  priority,\n  deadline,\n  status,\n  assignedDate,\n  onStatusChange,\n}: TaskCardProps) {\n  const [expanded, setExpanded] = useState(false);\n  const [currentStatus, setCurrentStatus] = useState(status);\n  const [elapsedSeconds, setElapsedSeconds] = useState(0);\n  const queryClient = useQueryClient();\n  \n  const today = format(new Date(), 'yyyy-MM-dd');\n\n  const { data: timeLog, refetch: refetchTimeLog } = useQuery({\n    queryKey: [`${API_BASE_URL}/api/tasks/${id}/timer`, userId, today],\n    queryFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/tasks/${id}/timer?userId=${userId}&date=${today}`);\n      if (!res.ok) return null;\n      return res.json();\n    },\n    refetchInterval: 1000,\n  });\n\n  useEffect(() => {\n    if (timeLog?.timerStatus === 'running' && timeLog?.timerStartedAt) {\n      const startTime = new Date(timeLog.timerStartedAt).getTime();\n      const baseSeconds = timeLog.totalSeconds || 0;\n      \n      const timer = setInterval(() => {\n        const now = Date.now();\n        const additionalSeconds = Math.floor((now - startTime) / 1000);\n        setElapsedSeconds(baseSeconds + additionalSeconds);\n      }, 1000);\n      \n      return () => clearInterval(timer);\n    } else if (timeLog?.totalSeconds) {\n      setElapsedSeconds(timeLog.totalSeconds);\n    } else {\n      setElapsedSeconds(0);\n    }\n  }, [timeLog]);\n\n  const startTimerMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/tasks/${id}/timer/start`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userId, date: today }),\n      });\n      if (!res.ok) throw new Error('Failed to start timer');\n      return res.json();\n    },\n    onSuccess: () => {\n      refetchTimeLog();\n    },\n  });\n\n  const pauseTimerMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/tasks/${id}/timer/pause`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userId, date: today }),\n      });\n      if (!res.ok) throw new Error('Failed to pause timer');\n      return res.json();\n    },\n    onSuccess: () => {\n      refetchTimeLog();\n    },\n  });\n\n  const completeTimerMutation = useMutation({\n    mutationFn: async () => {\n      const timerRes = await fetch(`${API_BASE_URL}/api/tasks/${id}/timer/complete`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userId, date: today }),\n      });\n      if (!timerRes.ok) throw new Error('Failed to complete timer');\n      \n      const statusRes = await fetch(`${API_BASE_URL}/api/tasks/${id}/status`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: 'completed' }),\n      });\n      if (!statusRes.ok) throw new Error('Failed to update task status');\n      \n      return timerRes.json();\n    },\n    onSuccess: () => {\n      setCurrentStatus('Completed');\n      onStatusChange?.('Completed');\n      refetchTimeLog();\n    },\n  });\n\n  const formatTime = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const handleStatusChange = () => {\n    const statusFlow: Record<string, \"Pending\" | \"In Progress\" | \"Completed\"> = {\n      Pending: \"In Progress\",\n      \"In Progress\": \"Completed\",\n      Completed: \"Completed\",\n    };\n    const newStatus = statusFlow[currentStatus];\n    setCurrentStatus(newStatus);\n    onStatusChange?.(newStatus);\n    console.log(`Task ${id} status changed to ${newStatus}`);\n  };\n\n  return (\n    <Card\n      className={`border-l-4 ${\n        priority === \"High\"\n          ? \"border-l-red-500\"\n          : priority === \"Medium\"\n          ? \"border-l-amber-500\"\n          : \"border-l-muted-foreground\"\n      }`}\n      data-testid={`card-task-${id}`}\n    >\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <div className=\"flex-1\">\n            <CardTitle className=\"text-lg\">{title}</CardTitle>\n            <CardDescription className=\"mt-1 text-xs font-mono\">\n              Assigned {format(assignedDate, \"MMM dd, yyyy\")}\n            </CardDescription>\n          </div>\n          <div className=\"flex gap-2\">\n            <Badge className={priorityColors[priority]} data-testid={`badge-priority-${id}`}>\n              {priority}\n            </Badge>\n            <Badge className={statusColors[currentStatus]} data-testid={`badge-status-${id}`}>\n              {currentStatus}\n            </Badge>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        {deadline && (\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <Calendar className=\"h-4 w-4\" />\n            <span className=\"font-mono\">Due: {format(deadline, \"MMM dd, yyyy\")}</span>\n          </div>\n        )}\n        \n        {expanded && (\n          <p className=\"text-sm text-muted-foreground\">{description}</p>\n        )}\n\n        <div className=\"flex items-center justify-between gap-2 pt-2 border-t\">\n          <div className=\"flex items-center gap-2 text-sm font-mono\">\n            <Clock className=\"h-4 w-4\" />\n            <span>{formatTime(elapsedSeconds)}</span>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            {timeLog?.timerStatus === 'completed' ? (\n              <Badge className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\">\n                <CheckCircle className=\"h-3 w-3 mr-1\" />\n                Completed Today\n              </Badge>\n            ) : (\n              <>\n                {timeLog?.timerStatus === 'running' ? (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => pauseTimerMutation.mutate()}\n                    disabled={pauseTimerMutation.isPending}\n                  >\n                    <Pause className=\"h-4 w-4 mr-1\" />\n                    Pause\n                  </Button>\n                ) : (\n                  <Button\n                    size=\"sm\"\n                    onClick={() => startTimerMutation.mutate()}\n                    disabled={startTimerMutation.isPending}\n                  >\n                    <Play className=\"h-4 w-4 mr-1\" />\n                    Start\n                  </Button>\n                )}\n                \n                <Button\n                  size=\"sm\"\n                  variant=\"secondary\"\n                  onClick={() => completeTimerMutation.mutate()}\n                  disabled={completeTimerMutation.isPending}\n                >\n                  <CheckCircle className=\"h-4 w-4 mr-1\" />\n                  Complete\n                </Button>\n              </>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2 pt-2\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setExpanded(!expanded)}\n            data-testid={`button-expand-${id}`}\n          >\n            {expanded ? (\n              <>\n                <ChevronUp className=\"h-4 w-4 mr-1\" />\n                Less\n              </>\n            ) : (\n              <>\n                <ChevronDown className=\"h-4 w-4 mr-1\" />\n                More\n              </>\n            )}\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":9081,"size_tokens":null},"client/src/components/examples/TimeBasedForm.tsx":{"content":"import TimeBasedForm from '../TimeBasedForm'\n\nexport default function TimeBasedFormExample() {\n  return (\n    <div className=\"space-y-8 max-w-3xl mx-auto\">\n      <TimeBasedForm type=\"morning\" userName=\"Sarah\" />\n      <TimeBasedForm type=\"evening\" userName=\"John\" />\n    </div>\n  )\n}\n","path":null,"size_bytes":284,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/NotificationPermissionBanner.tsx":{"content":"import { useNotificationPermission } from '@/hooks/useNotificationPermission';\nimport { Button } from '@/components/ui/button';\nimport { Bell } from 'lucide-react';\nimport { useEffect, useState } from 'react';\n\nexport function NotificationPermissionBanner() {\n  const { isAvailable, notificationStatus, requestPermission } = useNotificationPermission();\n  const [visible, setVisible] = useState(false);\n\n  useEffect(() => {\n    if (isAvailable && Notification.permission === 'default' && notificationStatus === 'idle') {\n      setVisible(true);\n    }\n  }, [isAvailable, notificationStatus]);\n\n  if (!visible || notificationStatus !== 'idle') {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed top-4 left-4 right-4 md:bottom-4 md:right-4 md:left-auto md:top-auto bg-card border border-border rounded-lg p-4 shadow-lg max-w-sm z-40\">\n      <div className=\"flex items-start gap-3\">\n        <Bell className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"font-medium text-sm\">Enable Notifications</p>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            Get instant alerts for new messages and announcements\n          </p>\n        </div>\n      </div>\n      <div className=\"flex gap-2 mt-3\">\n        <Button\n          size=\"sm\"\n          variant=\"default\"\n          onClick={() => {\n            requestPermission();\n            setVisible(false);\n          }}\n          className=\"flex-1\"\n          data-testid=\"button-enable-notifications\"\n        >\n          Enable\n        </Button>\n        <Button\n          size=\"sm\"\n          variant=\"ghost\"\n          onClick={() => setVisible(false)}\n          data-testid=\"button-dismiss-notifications\"\n        >\n          Dismiss\n        </Button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1811,"size_tokens":null},"client/src/components/TeamLeaderSidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport {\n  LayoutDashboard,\n  Users,\n  CheckSquare,\n  MessageSquare,\n  Star,\n  MessageCircle,\n  Calendar,\n  Clock,\n  TrendingUp,\n  FileEdit,\n  UserCheck,\n  LogOut,\n  Mail,\n  Megaphone,\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport ThemeToggle from \"./ThemeToggle\";\n\ninterface NavItem {\n  path: string;\n  label: string;\n  icon: any;\n}\n\nconst teamLeaderNavItems: NavItem[] = [\n  { path: \"/team-leader/dashboard\", label: \"Dashboard\", icon: LayoutDashboard },\n  { path: \"/team-leader/team\", label: \"My Team\", icon: Users },\n  { path: \"/team-leader/tasks\", label: \"Team Tasks\", icon: CheckSquare },\n  { path: \"/team-leader/messages\", label: \"Messages\", icon: MessageSquare },\n  { path: \"/team-leader/ratings\", label: \"Team Ratings\", icon: Star },\n  { path: \"/team-leader/feedback\", label: \"Team Feedback\", icon: MessageCircle },\n  { path: \"/team-leader/leave-requests\", label: \"My Leave Requests\", icon: Calendar },\n  { path: \"/team-leader/leaves\", label: \"Leave Approval\", icon: Calendar },\n  { path: \"/team-leader/corrections\", label: \"Correction Requests\", icon: FileEdit },\n  { path: \"/team-leader/attendance\", label: \"My Attendance\", icon: UserCheck },\n  { path: \"/team-leader/attendance-monitor\", label: \"Team Attendance\", icon: Clock },\n  { path: \"/team-leader/attendance-reports\", label: \"Attendance Reports\", icon: TrendingUp },\n];\n\nexport function TeamLeaderSidebar() {\n  const [location] = useLocation();\n  const { user, signOut, loggingOut } = useAuth();\n\n  const handleLogout = async () => {\n    await signOut();\n    window.location.href = \"/worklogix/\";\n  };\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-6 border-b\">\n        <div className=\"flex items-center gap-3\">\n          <Avatar>\n            <AvatarImage src={user?.photoURL || \"\"} />\n            <AvatarFallback className=\"bg-primary text-primary-foreground\">\n              {user?.displayName?.[0] || \"T\"}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-semibold text-sm truncate\">{user?.displayName}</h3>\n            <p className=\"text-xs text-muted-foreground truncate\">{user?.email}</p>\n            <p className=\"text-xs font-medium text-primary\">Team Leader</p>\n          </div>\n        </div>\n      </SidebarHeader>\n\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>Team Management</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {teamLeaderNavItems.map((item) => {\n                const isActive = location === item.path;\n                const Icon = item.icon;\n                \n                return (\n                  <SidebarMenuItem key={item.path}>\n                    <SidebarMenuButton asChild isActive={isActive}>\n                      <Link\n                        href={item.path}\n                        data-testid={`nav-link-${item.label.toLowerCase().replace(/\\s+/g, '-')}`}\n                      >\n                        <Icon className=\"h-5 w-5\" />\n                        <span>{item.label}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                );\n              })}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4 border-t space-y-2\">\n        <ThemeToggle />\n        <Button\n          variant=\"outline\"\n          className=\"w-full justify-start\"\n          onClick={handleLogout}\n          disabled={loggingOut}\n          data-testid=\"button-logout\"\n        >\n          <LogOut className=\"h-4 w-4 mr-2\" />\n          {loggingOut ? \"Logging out...\" : \"Logout\"}\n        </Button>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/components/examples/AdminDashboard.tsx":{"content":"import AdminDashboard from '../AdminDashboard'\n\nexport default function AdminDashboardExample() {\n  return <AdminDashboard />\n}\n","path":null,"size_bytes":128,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/pages/user/AttendanceHistory.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport {\n    Calendar as CalendarIcon,\n    ChevronLeft,\n    ChevronRight,\n    Clock,\n    LogIn,\n    LogOut,\n} from \"lucide-react\";\nimport {\n    format,\n    startOfMonth,\n    endOfMonth,\n    eachDayOfInterval,\n    isSameDay,\n    parseISO,\n} from \"date-fns\";\nimport type { AttendanceRecord } from \"@shared/schema\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\nconst MONTHS = [\n    \"January\",\n    \"February\",\n    \"March\",\n    \"April\",\n    \"May\",\n    \"June\",\n    \"July\",\n    \"August\",\n    \"September\",\n    \"October\",\n    \"November\",\n    \"December\",\n];\n\ninterface Holiday {\n    id: number;\n    companyId: number;\n    name: string;\n    date: string;\n    description: string | null;\n}\n\nexport default function AttendanceHistory() {\n    const currentDate = new Date();\n    const [selectedMonth, setSelectedMonth] = useState(currentDate.getMonth());\n    const [selectedYear, setSelectedYear] = useState(currentDate.getFullYear());\n    const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n\n    const startDate = format(\n        startOfMonth(new Date(selectedYear, selectedMonth)),\n        \"yyyy-MM-dd\"\n    );\n    const endDate = format(\n        endOfMonth(new Date(selectedYear, selectedMonth)),\n        \"yyyy-MM-dd\"\n    );\n\n    const { data: user } = useQuery<{ id: number; companyId: number | null }>({\n        queryKey: [\"/api/me\"],\n    });\n\n    const { data: attendanceRecords, isLoading } = useQuery<AttendanceRecord[]>(\n        {\n            queryKey: [\"/api/attendance/history\", { startDate, endDate }],\n        }\n    );\n\n    const { data: holidays = [] } = useQuery<Holiday[]>({\n        queryKey: [`/api/holidays/company/${user?.companyId}`],\n        enabled: !!user?.companyId,\n    });\n\n    const { data: monthlySummary } = useQuery<{\n        totalDays: number;\n        present: number;\n        absent: number;\n        late: number;\n        leave: number;\n        halfDay: number;\n    }>({\n        queryKey: [\n            \"/api/attendance/monthly-summary\",\n            { month: selectedMonth + 1, year: selectedYear },\n        ],\n    });\n\n    const daysInMonth = eachDayOfInterval({\n        start: startOfMonth(new Date(selectedYear, selectedMonth)),\n        end: endOfMonth(new Date(selectedYear, selectedMonth)),\n    });\n\n    const getAttendanceForDate = (date: Date) => {\n        if (!attendanceRecords) return null;\n        const dateStr = format(date, \"yyyy-MM-dd\");\n        return attendanceRecords.find((record) => record.date === dateStr);\n    };\n\n    const getHolidayForDate = (date: Date) => {\n        const dateStr = format(date, \"yyyy-MM-dd\");\n        return holidays.find((holiday) => holiday.date === dateStr);\n    };\n\n    const filteredRecords =\n        attendanceRecords?.filter((record) => {\n            if (statusFilter === \"all\") return true;\n            return record.status === statusFilter;\n        }) || [];\n\n    const getStatusColor = (status: string, isHoliday: boolean = false) => {\n        if (isHoliday) {\n            return \"bg-orange-100 dark:bg-orange-900/20 text-orange-800 dark:text-orange-200 border-orange-300 dark:border-orange-700\";\n        }\n        const colors: Record<string, string> = {\n            present:\n                \"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 border-green-300 dark:border-green-700\",\n            absent: \"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200 border-red-300 dark:border-red-700\",\n            late: \"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 border-yellow-300 dark:border-yellow-700\",\n            leave: \"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 border-blue-300 dark:border-blue-700\",\n            \"half-day\":\n                \"bg-purple-100 dark:bg-purple-900/20 text-purple-800 dark:text-purple-200 border-purple-300 dark:border-purple-700\",\n        };\n        return colors[status] || \"bg-muted\";\n    };\n\n    const getStatusBadge = (status: string) => {\n        const variants: Record<string, { variant: any; label: string }> = {\n            present: { variant: \"default\", label: \"Present\" },\n            absent: { variant: \"destructive\", label: \"Absent\" },\n            late: { variant: \"secondary\", label: \"Late\" },\n            leave: { variant: \"outline\", label: \"Leave\" },\n            \"half-day\": { variant: \"outline\", label: \"Half Day\" },\n        };\n        const config = variants[status] || {\n            variant: \"outline\",\n            label: status,\n        };\n        return <Badge variant={config.variant}>{config.label}</Badge>;\n    };\n\n    const formatTime = (time: string | Date | null) => {\n        if (!time) return \"-\";\n        const date = typeof time === \"string\" ? new Date(time) : time;\n        return format(date, \"hh:mm a\");\n    };\n\n    const formatDuration = (minutes: number | null) => {\n        if (!minutes) return \"-\";\n        const hours = Math.floor(minutes / 60);\n        const mins = minutes % 60;\n        return `${hours}h ${mins}m`;\n    };\n\n    const handlePreviousMonth = () => {\n        if (selectedMonth === 0) {\n            setSelectedMonth(11);\n            setSelectedYear(selectedYear - 1);\n        } else {\n            setSelectedMonth(selectedMonth - 1);\n        }\n    };\n\n    const handleNextMonth = () => {\n        if (selectedMonth === 11) {\n            setSelectedMonth(0);\n            setSelectedYear(selectedYear + 1);\n        } else {\n            setSelectedMonth(selectedMonth + 1);\n        }\n    };\n\n    const years = Array.from(\n        { length: 5 },\n        (_, i) => currentDate.getFullYear() - 2 + i\n    );\n\n    return (\n        <div className=\"flex flex-col gap-6 p-6\">\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                <div>\n                    <h1 className=\"text-2xl font-semibold\">\n                        Attendance History\n                    </h1>\n                    <p className=\"text-sm text-muted-foreground\">\n                        View your complete attendance records\n                    </p>\n                </div>\n\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                    <Button\n                        size=\"icon\"\n                        variant=\"outline\"\n                        onClick={handlePreviousMonth}\n                        data-testid=\"button-previous-month\">\n                        <ChevronLeft className=\"w-4 h-4\" />\n                    </Button>\n\n                    <Select\n                        value={selectedMonth.toString()}\n                        onValueChange={(value) =>\n                            setSelectedMonth(parseInt(value))\n                        }>\n                        <SelectTrigger\n                            className=\"w-[140px]\"\n                            data-testid=\"select-month\">\n                            <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                            {MONTHS.map((month, index) => (\n                                <SelectItem\n                                    key={index}\n                                    value={index.toString()}>\n                                    {month}\n                                </SelectItem>\n                            ))}\n                        </SelectContent>\n                    </Select>\n\n                    <Select\n                        value={selectedYear.toString()}\n                        onValueChange={(value) =>\n                            setSelectedYear(parseInt(value))\n                        }>\n                        <SelectTrigger\n                            className=\"w-[100px]\"\n                            data-testid=\"select-year\">\n                            <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                            {years.map((year) => (\n                                <SelectItem key={year} value={year.toString()}>\n                                    {year}\n                                </SelectItem>\n                            ))}\n                        </SelectContent>\n                    </Select>\n\n                    <Button\n                        size=\"icon\"\n                        variant=\"outline\"\n                        onClick={handleNextMonth}\n                        data-testid=\"button-next-month\">\n                        <ChevronRight className=\"w-4 h-4\" />\n                    </Button>\n                </div>\n            </div>\n\n            {monthlySummary && (\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n                    <Card>\n                        <CardContent className=\"p-4\">\n                            <div className=\"text-sm text-muted-foreground\">\n                                Total Days\n                            </div>\n                            <div\n                                className=\"text-2xl font-semibold\"\n                                data-testid=\"text-total-days\">\n                                {monthlySummary.totalDays}\n                            </div>\n                        </CardContent>\n                    </Card>\n                    <Card>\n                        <CardContent className=\"p-4\">\n                            <div className=\"text-sm text-muted-foreground\">\n                                Present\n                            </div>\n                            <div\n                                className=\"text-2xl font-semibold text-green-600\"\n                                data-testid=\"text-present\">\n                                {monthlySummary.present}\n                            </div>\n                        </CardContent>\n                    </Card>\n                    <Card>\n                        <CardContent className=\"p-4\">\n                            <div className=\"text-sm text-muted-foreground\">\n                                Absent\n                            </div>\n                            <div\n                                className=\"text-2xl font-semibold text-red-600\"\n                                data-testid=\"text-absent\">\n                                {monthlySummary.absent}\n                            </div>\n                        </CardContent>\n                    </Card>\n                    <Card>\n                        <CardContent className=\"p-4\">\n                            <div className=\"text-sm text-muted-foreground\">\n                                Late\n                            </div>\n                            <div\n                                className=\"text-2xl font-semibold text-yellow-600\"\n                                data-testid=\"text-late\">\n                                {monthlySummary.late}\n                            </div>\n                        </CardContent>\n                    </Card>\n                    <Card>\n                        <CardContent className=\"p-4\">\n                            <div className=\"text-sm text-muted-foreground\">\n                                Leave\n                            </div>\n                            <div\n                                className=\"text-2xl font-semibold text-blue-600\"\n                                data-testid=\"text-leave\">\n                                {monthlySummary.leave}\n                            </div>\n                        </CardContent>\n                    </Card>\n                    <Card>\n                        <CardContent className=\"p-4\">\n                            <div className=\"text-sm text-muted-foreground\">\n                                Half Day\n                            </div>\n                            <div\n                                className=\"text-2xl font-semibold text-purple-600\"\n                                data-testid=\"text-halfday\">\n                                {monthlySummary.halfDay}\n                            </div>\n                        </CardContent>\n                    </Card>\n                </div>\n            )}\n\n            <div className=\"flex items-center gap-4 flex-wrap\">\n                <div className=\"text-sm font-medium\">Filter by Status:</div>\n                <div className=\"flex gap-2 flex-wrap\">\n                    <Button\n                        size=\"sm\"\n                        variant={statusFilter === \"all\" ? \"default\" : \"outline\"}\n                        onClick={() => setStatusFilter(\"all\")}\n                        data-testid=\"filter-all\">\n                        All\n                    </Button>\n                    <Button\n                        size=\"sm\"\n                        variant={\n                            statusFilter === \"present\" ? \"default\" : \"outline\"\n                        }\n                        onClick={() => setStatusFilter(\"present\")}\n                        data-testid=\"filter-present\">\n                        Present\n                    </Button>\n                    <Button\n                        size=\"sm\"\n                        variant={\n                            statusFilter === \"late\" ? \"default\" : \"outline\"\n                        }\n                        onClick={() => setStatusFilter(\"late\")}\n                        data-testid=\"filter-late\">\n                        Late\n                    </Button>\n                    <Button\n                        size=\"sm\"\n                        variant={\n                            statusFilter === \"absent\" ? \"default\" : \"outline\"\n                        }\n                        onClick={() => setStatusFilter(\"absent\")}\n                        data-testid=\"filter-absent\">\n                        Absent\n                    </Button>\n                    <Button\n                        size=\"sm\"\n                        variant={\n                            statusFilter === \"leave\" ? \"default\" : \"outline\"\n                        }\n                        onClick={() => setStatusFilter(\"leave\")}\n                        data-testid=\"filter-leave\">\n                        Leave\n                    </Button>\n                </div>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                        <CalendarIcon className=\"w-5 h-5\" />\n                        {MONTHS[selectedMonth]} {selectedYear} Calendar\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"mb-4 flex flex-wrap gap-3 text-xs\">\n                        <div className=\"flex items-center gap-2\">\n                            <div className=\"w-4 h-4 rounded bg-green-100 dark:bg-green-900/20 border border-green-300 dark:border-green-700\"></div>\n                            <span className=\"text-muted-foreground\">\n                                Present\n                            </span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                            <div className=\"w-4 h-4 rounded bg-yellow-100 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700\"></div>\n                            <span className=\"text-muted-foreground\">Late</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                            <div className=\"w-4 h-4 rounded bg-red-100 dark:bg-red-900/20 border border-red-300 dark:border-red-700\"></div>\n                            <span className=\"text-muted-foreground\">\n                                Absent\n                            </span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                            <div className=\"w-4 h-4 rounded bg-blue-100 dark:bg-blue-900/20 border border-blue-300 dark:border-blue-700\"></div>\n                            <span className=\"text-muted-foreground\">Leave</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                            <div className=\"w-4 h-4 rounded bg-orange-100 dark:bg-orange-900/20 border border-orange-300 dark:border-orange-700\"></div>\n                            <span className=\"text-muted-foreground\">\n                                Holiday\n                            </span>\n                        </div>\n                    </div>\n\n                    {isLoading ? (\n                        <div className=\"flex items-center justify-center h-64\">\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                        </div>\n                    ) : (\n                        <div className=\"grid grid-cols-7 gap-2\">\n                            {[\n                                \"Sun\",\n                                \"Mon\",\n                                \"Tue\",\n                                \"Wed\",\n                                \"Thu\",\n                                \"Fri\",\n                                \"Sat\",\n                            ].map((day) => (\n                                <div\n                                    key={day}\n                                    className=\"text-center text-sm font-semibold p-2 text-muted-foreground\">\n                                    {day}\n                                </div>\n                            ))}\n\n                            {Array.from({\n                                length: daysInMonth[0].getDay(),\n                            }).map((_, index) => (\n                                <div key={`empty-${index}`} className=\"p-2\" />\n                            ))}\n\n                            {daysInMonth.map((day) => {\n                                const attendance = getAttendanceForDate(day);\n                                const holiday = getHolidayForDate(day);\n                                const isToday = isSameDay(day, new Date());\n                                const shouldShow =\n                                    statusFilter === \"all\" ||\n                                    attendance?.status === statusFilter;\n\n                                return (\n                                    <div\n                                        key={day.toString()}\n                                        className={`\n                      p-3 rounded-md border-2 min-h-[100px] relative\n                      ${isToday ? \"border-primary\" : \"border-border\"}\n                      ${\n                          holiday\n                              ? getStatusColor(\"\", true)\n                              : attendance && shouldShow\n                              ? getStatusColor(attendance.status)\n                              : \"bg-background\"\n                      }\n                      ${\n                          !shouldShow && attendance && !holiday\n                              ? \"opacity-30\"\n                              : \"\"\n                      }\n                    `}\n                                        data-testid={`calendar-day-${format(\n                                            day,\n                                            \"yyyy-MM-dd\"\n                                        )}`}>\n                                        <div className=\"text-sm font-semibold mb-2\">\n                                            {format(day, \"d\")}\n                                        </div>\n                                        {holiday && (\n                                            <div className=\"space-y-1 text-xs\">\n                                                <div className=\"font-semibold text-orange-700 dark:text-orange-300\">\n                                                    {holiday.name}\n                                                </div>\n                                                {holiday.description && (\n                                                    <div className=\"text-orange-600 dark:text-orange-400\">\n                                                        {holiday.description}\n                                                    </div>\n                                                )}\n                                            </div>\n                                        )}\n                                        {attendance &&\n                                            shouldShow &&\n                                            !holiday && (\n                                                <div className=\"space-y-1 text-xs\">\n                                                    <div className=\"font-medium\">\n                                                        {getStatusBadge(\n                                                            attendance.status\n                                                        )}\n                                                    </div>\n                                                    {attendance.checkIn && (\n                                                        <div className=\"flex items-center gap-1\">\n                                                            <LogIn className=\"w-3 h-3\" />\n                                                            {formatTime(\n                                                                attendance.checkIn\n                                                            )}\n                                                        </div>\n                                                    )}\n                                                    {attendance.checkOut && (\n                                                        <div className=\"flex items-center gap-1\">\n                                                            <LogOut className=\"w-3 h-3\" />\n                                                            {formatTime(\n                                                                attendance.checkOut\n                                                            )}\n                                                        </div>\n                                                    )}\n                                                </div>\n                                            )}\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Detailed Records</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    {isLoading ? (\n                        <div className=\"flex items-center justify-center h-32\">\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                        </div>\n                    ) : filteredRecords.length === 0 ? (\n                        <div className=\"text-center py-8 text-muted-foreground\">\n                            No attendance records found for the selected filters\n                        </div>\n                    ) : (\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full\">\n                                <thead>\n                                    <tr className=\"border-b\">\n                                        <th className=\"text-left p-3 text-sm font-semibold\">\n                                            Date\n                                        </th>\n                                        <th className=\"text-left p-3 text-sm font-semibold\">\n                                            Status\n                                        </th>\n                                        <th className=\"text-left p-3 text-sm font-semibold\">\n                                            Check In\n                                        </th>\n                                        <th className=\"text-left p-3 text-sm font-semibold\">\n                                            Check Out\n                                        </th>\n                                        <th className=\"text-left p-3 text-sm font-semibold\">\n                                            Duration\n                                        </th>\n                                        <th className=\"text-left p-3 text-sm font-semibold\">\n                                            Remarks\n                                        </th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {filteredRecords.map((record) => (\n                                        <tr\n                                            key={record.id}\n                                            className=\"border-b hover-elevate\"\n                                            data-testid={`record-${record.id}`}>\n                                            <td className=\"p-3 text-sm\">\n                                                {format(\n                                                    parseISO(record.date),\n                                                    \"MMM dd, yyyy\"\n                                                )}\n                                            </td>\n                                            <td className=\"p-3 text-sm\">\n                                                {getStatusBadge(record.status)}\n                                            </td>\n                                            <td className=\"p-3 text-sm\">\n                                                {formatTime(record.checkIn)}\n                                            </td>\n                                            <td className=\"p-3 text-sm\">\n                                                {formatTime(record.checkOut)}\n                                            </td>\n                                            <td className=\"p-3 text-sm\">\n                                                {formatDuration(\n                                                    record.workDuration\n                                                )}\n                                            </td>\n                                            <td className=\"p-3 text-sm text-muted-foreground\">\n                                                {record.remarks || \"-\"}\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":27045,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/TeamLeaderLayout.tsx":{"content":"import { SidebarProvider, SidebarTrigger, SidebarInset } from \"@/components/ui/sidebar\";\nimport { TeamLeaderSidebar } from \"@/components/TeamLeaderSidebar\";\nimport BottomNav, { BottomNavItem } from \"./BottomNav\";\nimport { LayoutDashboard, Users, CheckSquare, MessageSquare } from \"lucide-react\";\n\nconst teamLeaderBottomNavItems: BottomNavItem[] = [\n  { path: \"/team-leader/dashboard\", label: \"Home\", icon: LayoutDashboard },\n  { path: \"/team-leader/team\", label: \"Team\", icon: Users },\n  { path: \"/team-leader/tasks\", label: \"Tasks\", icon: CheckSquare },\n  { path: \"/team-leader/messages\", label: \"Messages\", icon: MessageSquare },\n];\n\nexport default function TeamLeaderLayout({ children }: { children: React.ReactNode }) {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <TeamLeaderSidebar />\n        <SidebarInset className=\"flex flex-col flex-1\">\n          <header className=\"flex items-center justify-between p-2 border-b md:hidden\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            <h1 className=\"font-semibold text-lg\">Team Leader Portal</h1>\n            <div className=\"w-10\" />\n          </header>\n          <main className=\"flex-1 overflow-y-auto\">\n            <div className=\"container max-w-7xl mx-auto p-3 sm:p-4 md:p-6 lg:p-8 pb-20 md:pb-6\">\n              {children}\n            </div>\n          </main>\n          <BottomNav items={teamLeaderBottomNavItems} />\n        </SidebarInset>\n      </div>\n    </SidebarProvider>\n  );\n}\n","path":null,"size_bytes":1638,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/pages/user/Feedback.tsx":{"content":"import { useState } from \"react\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n    CardDescription,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { MessageSquare, User, Shield, Users } from \"lucide-react\";\nimport type { Feedback } from \"@shared/schema\";\n\nexport default function Feedback() {\n    const [message, setMessage] = useState(\"\");\n    const [recipientType, setRecipientType] = useState<\"Admin\" | \"TeamLeader\">(\n        \"Admin\"\n    );\n    const { toast } = useToast();\n    const { dbUserId } = useAuth();\n\n    const { data: submittedFeedbacks = [], isLoading: loadingFeedbacks } =\n        useQuery<Feedback[]>({\n            queryKey: [`/api/feedbacks?submittedBy=${dbUserId}`],\n            queryFn: async () => {\n                const user = localStorage.getItem(\"user\");\n                const userId = user ? JSON.parse(user).id : null;\n                const headers: Record<string, string> = {};\n                if (userId) {\n                    headers[\"x-user-id\"] = userId.toString();\n                }\n\n                const res = await fetch(\n                    `${API_BASE_URL}/api/feedbacks?submittedBy=${dbUserId}`,\n                    { headers, credentials: \"include\" }\n                );\n                if (!res.ok) throw new Error(\"Failed to fetch feedbacks\");\n                return res.json();\n            },\n            enabled: !!dbUserId,\n        });\n\n    const submitFeedbackMutation = useMutation({\n        mutationFn: async (data: {\n            message: string;\n            recipientType: string;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/feedbacks`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Success\",\n                description: `Your feedback has been submitted to ${\n                    recipientType === \"Admin\" ? \"Admin\" : \"Team Leader\"\n                }`,\n            });\n            setMessage(\"\");\n            queryClient.invalidateQueries({ queryKey: [\"/api/feedbacks\"] });\n            queryClient.invalidateQueries({\n                queryKey: [`/api/feedbacks?submittedBy=${dbUserId}`],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to submit feedback\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleSubmit = async () => {\n        if (!message.trim()) {\n            toast({\n                title: \"Error\",\n                description: \"Please enter your feedback\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n\n        submitFeedbackMutation.mutate({ message, recipientType });\n    };\n\n    const getRecipientIcon = (type: string) => {\n        if (type === \"Admin\") return <Shield className=\"h-4 w-4\" />;\n        if (type === \"TeamLeader\") return <Users className=\"h-4 w-4\" />;\n        return <User className=\"h-4 w-4\" />;\n    };\n\n    const getStatusBadge = (feedback: Feedback) => {\n        if (feedback.adminResponse) {\n            return (\n                <span className=\"text-xs px-2 py-1 rounded-full bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300\">\n                    Responded\n                </span>\n            );\n        }\n        return (\n            <span className=\"text-xs px-2 py-1 rounded-full bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300\">\n                Pending\n            </span>\n        );\n    };\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold\">Feedback</h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    Share your feedback with Admin or Team Leader\n                </p>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                        <MessageSquare className=\"h-5 w-5\" />\n                        Submit New Feedback\n                    </CardTitle>\n                    <CardDescription>\n                        Choose who will receive your feedback and share your\n                        thoughts\n                    </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                        <Label htmlFor=\"recipient-type\">Send Feedback To</Label>\n                        <Select\n                            value={recipientType}\n                            onValueChange={(value: \"Admin\" | \"TeamLeader\") =>\n                                setRecipientType(value)\n                            }>\n                            <SelectTrigger\n                                id=\"recipient-type\"\n                                data-testid=\"select-recipient-type\">\n                                <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                                <SelectItem\n                                    value=\"Admin\"\n                                    data-testid=\"option-admin\">\n                                    <div className=\"flex items-center gap-2\">\n                                        <Shield className=\"h-4 w-4\" />\n                                        Admin\n                                    </div>\n                                </SelectItem>\n                                <SelectItem\n                                    value=\"TeamLeader\"\n                                    data-testid=\"option-team-leader\">\n                                    <div className=\"flex items-center gap-2\">\n                                        <Users className=\"h-4 w-4\" />\n                                        Team Leader\n                                    </div>\n                                </SelectItem>\n                            </SelectContent>\n                        </Select>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                        <Label htmlFor=\"feedback-message\">Your Feedback</Label>\n                        <Textarea\n                            id=\"feedback-message\"\n                            placeholder=\"Enter your feedback here...\"\n                            value={message}\n                            onChange={(e) => setMessage(e.target.value)}\n                            rows={8}\n                            data-testid=\"textarea-feedback\"\n                        />\n                    </div>\n\n                    <Button\n                        onClick={handleSubmit}\n                        disabled={submitFeedbackMutation.isPending}\n                        data-testid=\"button-submit-feedback\"\n                        className=\"w-full sm:w-auto\">\n                        {submitFeedbackMutation.isPending\n                            ? \"Submitting...\"\n                            : \"Submit Feedback\"}\n                    </Button>\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                        <MessageSquare className=\"h-5 w-5\" />\n                        My Submitted Feedback ({submittedFeedbacks.length})\n                    </CardTitle>\n                    <CardDescription>\n                        Track the status and responses to your feedback\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    {loadingFeedbacks ? (\n                        <div className=\"flex items-center justify-center py-8\">\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                        </div>\n                    ) : submittedFeedbacks.length > 0 ? (\n                        <div className=\"space-y-4\">\n                            {submittedFeedbacks.map((feedback) => (\n                                <div\n                                    key={feedback.id}\n                                    data-testid={`feedback-${feedback.id}`}\n                                    className=\"p-4 space-y-3 border rounded-md\">\n                                    <div className=\"flex items-center justify-between gap-2\">\n                                        <div className=\"flex items-center gap-2\">\n                                            {getRecipientIcon(\n                                                feedback.recipientType\n                                            )}\n                                            <span className=\"text-sm font-medium\">\n                                                To:{\" \"}\n                                                {feedback.recipientType ===\n                                                \"TeamLeader\"\n                                                    ? \"Team Leader\"\n                                                    : feedback.recipientType}\n                                            </span>\n                                        </div>\n                                        {getStatusBadge(feedback)}\n                                    </div>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                        {feedback.message}\n                                    </p>\n                                    {feedback.adminResponse && (\n                                        <div className=\"mt-3 pt-3 border-t\">\n                                            <p className=\"text-xs font-medium text-muted-foreground mb-1\">\n                                                Admin Response:\n                                            </p>\n                                            <p className=\"text-sm font-semibold text-primary\">\n                                                {feedback.adminResponse}\n                                            </p>\n                                        </div>\n                                    )}\n                                    <p className=\"text-xs text-muted-foreground\">\n                                        Submitted:{\" \"}\n                                        {new Date(\n                                            feedback.createdAt\n                                        ).toLocaleDateString()}{\" \"}\n                                        at{\" \"}\n                                        {new Date(\n                                            feedback.createdAt\n                                        ).toLocaleTimeString()}\n                                    </p>\n                                </div>\n                            ))}\n                        </div>\n                    ) : (\n                        <div className=\"text-center py-8 text-muted-foreground\">\n                            <MessageSquare className=\"h-12 w-12 mx-auto mb-2 opacity-20\" />\n                            <p>No feedback submitted yet</p>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":11781,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { type Server } from \"http\";\n\nexport function log(message: string, source = \"express\") {\n    const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n        hour: \"numeric\",\n        minute: \"2-digit\",\n        second: \"2-digit\",\n        hour12: true,\n    });\n\n    console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n    if (process.env.NODE_ENV !== \"development\") {\n        throw new Error(\"setupVite should only be called in development mode\");\n    }\n\n    const { createServer: createViteServer, createLogger } = await import(\n        \"vite\"\n    );\n    const { nanoid } = await import(\"nanoid\");\n\n    const viteLogger = createLogger();\n\n    const serverOptions = {\n        middlewareMode: true,\n        hmr: { server },\n        allowedHosts: true as const,\n    };\n\n    const rootDir = path.resolve(import.meta.dirname, \"..\", \"client\");\n\n    const vite = await createViteServer({\n        configFile: path.resolve(import.meta.dirname, \"..\", \"vite.config.ts\"),\n        root: rootDir,\n        customLogger: {\n            ...viteLogger,\n            error: (msg, options) => {\n                viteLogger.error(msg, options);\n            },\n        },\n        server: serverOptions,\n        appType: \"custom\",\n    });\n\n    app.use(vite.middlewares);\n    app.use(\"*\", async (req, res, next) => {\n        const url = req.originalUrl;\n\n        try {\n            const clientTemplate = path.resolve(\n                import.meta.dirname,\n                \"..\",\n                \"client\",\n                \"index.html\"\n            );\n\n            let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n            template = template.replace(\n                `src=\"/src/main.tsx\"`,\n                `src=\"/src/main.tsx?v=${nanoid()}\"`\n            );\n            const page = await vite.transformIndexHtml(url, template);\n            res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n        } catch (e) {\n            vite.ssrFixStacktrace(e as Error);\n            next(e);\n        }\n    });\n}\n\nexport function serveStatic(app: Express) {\n    const currentDir =\n        typeof __dirname !== \"undefined\" ? __dirname : import.meta.dirname;\n    const distPath = path.resolve(currentDir, \"public\");\n\n    console.log(`[serveStatic] Serving static files from: ${distPath}`);\n\n    if (!fs.existsSync(distPath)) {\n        throw new Error(\n            `Could not find the build directory: ${distPath}, make sure to build the client first`\n        );\n    }\n\n    app.use(express.static(distPath));\n\n    // Catch-all handler for SPA routing - serve index.html for all non-API routes\n    app.get(\"*\", (req, res, next) => {\n        // Skip API routes\n        if (req.path.startsWith(\"/api\") || req.path.startsWith(\"/ws\")) {\n            return next();\n        }\n\n        const indexPath = path.resolve(distPath, \"index.html\");\n        console.log(`[serveStatic] Serving index.html for path: ${req.path}`);\n        res.sendFile(indexPath);\n    });\n}\n","path":null,"size_bytes":3123,"size_tokens":null},"client/src/pages/admin/AdminReports.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Search } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format } from \"date-fns\";\nimport type { Report, User } from \"@shared/schema\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function AdminReports() {\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    const [reportDialogOpen, setReportDialogOpen] = useState(false);\n    const [selectedReport, setSelectedReport] = useState<Report | null>(null);\n    const [dateFilter, setDateFilter] = useState({\n        startDate: \"\",\n        endDate: \"\",\n    });\n\n    const { data: users = [] } = useQuery<User[]>({\n        queryKey: [\"/api/users\"],\n    });\n\n    const { data: reports = [], isLoading: reportsLoading } = useQuery<\n        Report[]\n    >({\n        queryKey: [\"/api/reports\", dateFilter.startDate, dateFilter.endDate],\n        queryFn: async () => {\n            const user = localStorage.getItem(\"user\");\n            const userId = user ? JSON.parse(user).id : null;\n\n            let url = `${API_BASE_URL}/api/reports`;\n            const params = new URLSearchParams();\n            if (dateFilter.startDate)\n                params.append(\"startDate\", dateFilter.startDate);\n            if (dateFilter.endDate)\n                params.append(\"endDate\", dateFilter.endDate);\n            if (params.toString()) url += `?${params.toString()}`;\n\n            const headers: Record<string, string> = {};\n            if (userId) {\n                headers[\"x-user-id\"] = userId.toString();\n            }\n\n            const res = await fetch(url, { headers, credentials: \"include\" });\n            if (!res.ok) throw new Error(\"Failed to fetch reports\");\n            return res.json();\n        },\n    });\n\n    const getUserNameById = (userId: number) => {\n        const user = users.find((u) => u.id === userId);\n        return user?.displayName || \"Unknown User\";\n    };\n\n    const filteredReports = reports.filter((report) => {\n        const userName = getUserNameById(report.userId);\n        return userName.toLowerCase().includes(searchTerm.toLowerCase());\n    });\n\n    const handleViewReport = (report: Report) => {\n        setSelectedReport(report);\n        setReportDialogOpen(true);\n    };\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold\">Reports</h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    View and filter user reports\n                </p>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg sm:text-xl\">\n                        Filter Reports\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-3\">\n                        <div className=\"space-y-2\">\n                            <Label\n                                htmlFor=\"search\"\n                                className=\"text-xs sm:text-sm\">\n                                Search by name\n                            </Label>\n                            <div className=\"relative\">\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                                <Input\n                                    id=\"search\"\n                                    placeholder=\"Search reports...\"\n                                    value={searchTerm}\n                                    onChange={(e) =>\n                                        setSearchTerm(e.target.value)\n                                    }\n                                    className=\"pl-10 text-sm\"\n                                    data-testid=\"input-search-reports\"\n                                />\n                            </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label\n                                htmlFor=\"start-date\"\n                                className=\"text-xs sm:text-sm\">\n                                Start Date\n                            </Label>\n                            <Input\n                                id=\"start-date\"\n                                type=\"date\"\n                                value={dateFilter.startDate}\n                                onChange={(e) =>\n                                    setDateFilter({\n                                        ...dateFilter,\n                                        startDate: e.target.value,\n                                    })\n                                }\n                                className=\"text-sm\"\n                                data-testid=\"input-start-date\"\n                            />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label\n                                htmlFor=\"end-date\"\n                                className=\"text-xs sm:text-sm\">\n                                End Date\n                            </Label>\n                            <Input\n                                id=\"end-date\"\n                                type=\"date\"\n                                value={dateFilter.endDate}\n                                onChange={(e) =>\n                                    setDateFilter({\n                                        ...dateFilter,\n                                        endDate: e.target.value,\n                                    })\n                                }\n                                className=\"text-sm\"\n                                data-testid=\"input-end-date\"\n                            />\n                        </div>\n                    </div>\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg sm:text-xl\">\n                        All Reports ({filteredReports.length})\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    {reportsLoading ? (\n                        <div className=\"flex items-center justify-center py-8\">\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                        </div>\n                    ) : filteredReports.length > 0 ? (\n                        <div className=\"space-y-3\">\n                            {filteredReports.map((report) => (\n                                <Card\n                                    key={report.id}\n                                    className=\"hover-elevate cursor-pointer\"\n                                    onClick={() => handleViewReport(report)}\n                                    data-testid={`card-report-${report.id}`}>\n                                    <CardContent className=\"p-3 sm:p-4\">\n                                        <div className=\"flex items-center justify-between\">\n                                            <div className=\"flex-1 min-w-0\">\n                                                <h4 className=\"font-semibold text-sm sm:text-base truncate\">\n                                                    {getUserNameById(\n                                                        report.userId\n                                                    )}\n                                                </h4>\n                                                <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                                                    {format(\n                                                        new Date(\n                                                            report.createdAt\n                                                        ),\n                                                        \"MMM dd, yyyy · HH:mm\"\n                                                    )}\n                                                </p>\n                                            </div>\n                                            <Badge\n                                                variant={\n                                                    report.reportType ===\n                                                    \"morning\"\n                                                        ? \"default\"\n                                                        : \"secondary\"\n                                                }\n                                                className=\"text-xs\">\n                                                {report.reportType}\n                                            </Badge>\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            ))}\n                        </div>\n                    ) : (\n                        <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                            No reports found\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n\n            <Dialog open={reportDialogOpen} onOpenChange={setReportDialogOpen}>\n                <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n                    <DialogHeader>\n                        <DialogTitle className=\"text-lg sm:text-xl\">\n                            Report Details\n                        </DialogTitle>\n                    </DialogHeader>\n                    {selectedReport && (\n                        <div className=\"space-y-4\">\n                            <div className=\"grid grid-cols-2 gap-3 sm:gap-4\">\n                                <div>\n                                    <Label className=\"text-xs sm:text-sm\">\n                                        User\n                                    </Label>\n                                    <p className=\"text-sm sm:text-base font-semibold\">\n                                        {getUserNameById(selectedReport.userId)}\n                                    </p>\n                                </div>\n                                <div>\n                                    <Label className=\"text-xs sm:text-sm\">\n                                        Type\n                                    </Label>\n                                    <Badge\n                                        variant={\n                                            selectedReport.reportType ===\n                                            \"morning\"\n                                                ? \"default\"\n                                                : \"secondary\"\n                                        }\n                                        className=\"text-xs\">\n                                        {selectedReport.reportType}\n                                    </Badge>\n                                </div>\n                                <div className=\"col-span-2\">\n                                    <Label className=\"text-xs sm:text-sm\">\n                                        Submitted\n                                    </Label>\n                                    <p className=\"text-sm sm:text-base\">\n                                        {format(\n                                            new Date(selectedReport.createdAt),\n                                            \"PPpp\"\n                                        )}\n                                    </p>\n                                </div>\n                            </div>\n\n                            {selectedReport.plannedTasks && (\n                                <div>\n                                    <Label className=\"text-xs sm:text-sm\">\n                                        Planned Tasks\n                                    </Label>\n                                    <p className=\"text-sm sm:text-base mt-1 whitespace-pre-wrap\">\n                                        {selectedReport.plannedTasks}\n                                    </p>\n                                </div>\n                            )}\n\n                            {selectedReport.completedTasks && (\n                                <div>\n                                    <Label className=\"text-xs sm:text-sm\">\n                                        Completed Tasks\n                                    </Label>\n                                    <p className=\"text-sm sm:text-base mt-1 whitespace-pre-wrap\">\n                                        {selectedReport.completedTasks}\n                                    </p>\n                                </div>\n                            )}\n\n                            {selectedReport.pendingTasks && (\n                                <div>\n                                    <Label className=\"text-xs sm:text-sm\">\n                                        Pending Tasks\n                                    </Label>\n                                    <p className=\"text-sm sm:text-base mt-1 whitespace-pre-wrap\">\n                                        {selectedReport.pendingTasks}\n                                    </p>\n                                </div>\n                            )}\n\n                            {selectedReport.notes && (\n                                <div>\n                                    <Label className=\"text-xs sm:text-sm\">\n                                        Notes\n                                    </Label>\n                                    <p className=\"text-sm sm:text-base mt-1 whitespace-pre-wrap\">\n                                        {selectedReport.notes}\n                                    </p>\n                                </div>\n                            )}\n                        </div>\n                    )}\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":14434,"size_tokens":null},"client/src/components/TimeBasedForm.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Sunrise, Moon, Upload, Sparkles } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface TimeBasedFormProps {\n    type: \"morning\" | \"evening\";\n    userName: string;\n    userId: number | null;\n}\n\nexport default function TimeBasedForm({\n    type,\n    userName,\n    userId,\n}: TimeBasedFormProps) {\n    const { toast } = useToast();\n    const [formData, setFormData] = useState({\n        plannedTasks: \"\",\n        completedTasks: \"\",\n        pendingTasks: \"\",\n        notes: \"\",\n        screenshot: null as File | null,\n    });\n\n    const submitReportMutation = useMutation({\n        mutationFn: async (data: typeof formData) => {\n            if (!userId) throw new Error(\"User ID is required\");\n\n            const reportData = {\n                userId,\n                reportType: type,\n                plannedTasks: data.plannedTasks || null,\n                completedTasks: data.completedTasks || null,\n                pendingTasks: data.pendingTasks || null,\n                notes: data.notes || null,\n            };\n\n            return await apiRequest(`${API_BASE_URL}/api/reports`, \"POST\", reportData);\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Report submitted successfully\",\n                description: `Your ${type} report has been saved.`,\n            });\n            setFormData({\n                plannedTasks: \"\",\n                completedTasks: \"\",\n                pendingTasks: \"\",\n                notes: \"\",\n                screenshot: null,\n            });\n            queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/reports`] });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to submit report\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const isMorning = type === \"morning\";\n    const greeting = isMorning ? \"Good Morning\" : \"Good Evening\";\n    const Icon = isMorning ? Sunrise : Moon;\n    const headerBgClass = isMorning\n        ? \"bg-gradient-to-br from-amber-50 to-orange-100 dark:from-amber-950/30 dark:to-orange-950/30\"\n        : \"bg-gradient-to-br from-purple-50 to-indigo-100 dark:from-purple-950/30 dark:to-indigo-950/30\";\n    const iconColorClass = isMorning ? \"text-amber-600 dark:text-amber-400\" : \"text-indigo-600 dark:text-indigo-400\";\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        submitReportMutation.mutate(formData);\n    };\n\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (e.target.files && e.target.files[0]) {\n            setFormData({ ...formData, screenshot: e.target.files[0] });\n            console.log(\"File selected:\", e.target.files[0].name);\n        }\n    };\n\n    return (\n        <Card className=\"overflow-hidden border-0 shadow-lg\" data-testid={`form-${type}`}>\n            <div className={`${headerBgClass} p-4 sm:p-6 border-b`}>\n                <div className=\"flex items-start gap-3 sm:gap-4\">\n                    <div className=\"p-2 sm:p-3 bg-background/80 backdrop-blur rounded-xl shadow-md\">\n                        <Icon className={`h-8 w-8 sm:h-10 sm:w-10 ${iconColorClass}`} />\n                    </div>\n                    <div className=\"flex-1\">\n                        <h2 className=\"text-xl sm:text-2xl font-bold text-foreground\">\n                            {greeting} {userName}!\n                        </h2>\n                        <p className=\"text-xs sm:text-sm text-muted-foreground mt-1\">\n                            {isMorning\n                                ? \"Please enter your planned tasks for today\"\n                                : \"Please enter your completed work for today\"}\n                        </p>\n                    </div>\n                </div>\n            </div>\n            <CardContent className=\"p-4 sm:p-6\">\n                <form onSubmit={handleSubmit} className=\"space-y-3 sm:space-y-4\">\n                    {isMorning ? (\n                        <>\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"planned-tasks\">\n                                    Planned Tasks *\n                                </Label>\n                                <Textarea\n                                    id=\"planned-tasks\"\n                                    placeholder=\"List your tasks for today...\"\n                                    className=\"min-h-32 resize-none\"\n                                    value={formData.plannedTasks}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            plannedTasks: e.target.value,\n                                        })\n                                    }\n                                    data-testid=\"input-planned-tasks\"\n                                    required\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"notes\">Notes / Comments</Label>\n                                <Textarea\n                                    id=\"notes\"\n                                    placeholder=\"Any additional notes...\"\n                                    className=\"min-h-24 resize-none\"\n                                    value={formData.notes}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            notes: e.target.value,\n                                        })\n                                    }\n                                    data-testid=\"input-notes\"\n                                />\n                            </div>\n                        </>\n                    ) : (\n                        <>\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"completed-tasks\">\n                                    Completed Tasks *\n                                </Label>\n                                <Textarea\n                                    id=\"completed-tasks\"\n                                    placeholder=\"What did you complete today...\"\n                                    className=\"min-h-32 resize-none\"\n                                    value={formData.completedTasks}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            completedTasks: e.target.value,\n                                        })\n                                    }\n                                    data-testid=\"input-completed-tasks\"\n                                    required\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"pending-tasks\">\n                                    Pending Tasks\n                                </Label>\n                                <Textarea\n                                    id=\"pending-tasks\"\n                                    placeholder=\"Tasks that are still pending...\"\n                                    className=\"min-h-24 resize-none\"\n                                    value={formData.pendingTasks}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            pendingTasks: e.target.value,\n                                        })\n                                    }\n                                    data-testid=\"input-pending-tasks\"\n                                />\n                            </div>\n                        </>\n                    )}\n\n                    <div className=\"space-y-2\">\n                        <Label htmlFor=\"screenshot\" className=\"text-sm sm:text-base\">\n                            Screenshot Upload (Optional)\n                        </Label>\n                        <div className=\"border-2 border-dashed rounded-lg p-4 sm:p-6 text-center hover-elevate cursor-pointer\">\n                            <input\n                                type=\"file\"\n                                id=\"screenshot\"\n                                accept=\"image/*\"\n                                onChange={handleFileChange}\n                                className=\"hidden\"\n                                data-testid=\"input-screenshot\"\n                            />\n                            <label\n                                htmlFor=\"screenshot\"\n                                className=\"cursor-pointer flex flex-col items-center gap-2\">\n                                <Upload className=\"h-6 w-6 sm:h-8 sm:w-8 text-muted-foreground\" />\n                                <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                                    {formData.screenshot\n                                        ? formData.screenshot.name\n                                        : \"Click to upload screenshot\"}\n                                </p>\n                            </label>\n                        </div>\n                    </div>\n\n                    <Button\n                        type=\"submit\"\n                        className=\"w-full\"\n                        size=\"lg\"\n                        data-testid=\"button-submit-report\"\n                        disabled={submitReportMutation.isPending}>\n                        {submitReportMutation.isPending\n                            ? \"Submitting...\"\n                            : \"Submit Report\"}\n                    </Button>\n                </form>\n            </CardContent>\n        </Card>\n    );\n}\n","path":null,"size_bytes":10460,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/pages/team-leader/TeamMembers.tsx":{"content":"import {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Search, Mail, UserX } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useState } from \"react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface TeamMember {\n    id: number;\n    displayName: string;\n    email: string;\n    photoURL?: string;\n    uniqueUserId: string;\n    isActive: boolean;\n}\n\nexport default function TeamMembers() {\n    const { dbUserId } = useAuth();\n    const [searchTerm, setSearchTerm] = useState(\"\");\n\n    const { data: teamMembers = [], isLoading } = useQuery<TeamMember[]>({\n        queryKey: [`/api/team-assignments/${dbUserId}/members`],\n        enabled: !!dbUserId,\n    });\n\n    const filteredMembers = teamMembers.filter(\n        (member) =>\n            member.displayName\n                .toLowerCase()\n                .includes(searchTerm.toLowerCase()) ||\n            member.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n            member.uniqueUserId.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    const getInitials = (name: string) => {\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                    <div>\n                        <Skeleton className=\"h-10 w-48 mb-2\" />\n                        <Skeleton className=\"h-5 w-72\" />\n                    </div>\n                    <Skeleton className=\"h-10 w-32\" />\n                </div>\n                <Skeleton className=\"h-10 w-full max-w-md\" />\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                    {[...Array(3)].map((_, i) => (\n                        <Card key={i}>\n                            <CardHeader>\n                                <Skeleton className=\"h-16 w-16 rounded-full\" />\n                                <Skeleton className=\"h-4 w-32 mt-2\" />\n                            </CardHeader>\n                            <CardContent>\n                                <Skeleton className=\"h-4 w-full mb-2\" />\n                                <Skeleton className=\"h-4 w-3/4\" />\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h1 className=\"text-3xl font-bold\">My Team</h1>\n                <p className=\"text-muted-foreground\">\n                    Manage your assigned team members\n                </p>\n            </div>\n\n            <div className=\"flex items-center gap-4\">\n                <div className=\"relative flex-1 max-w-md\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                        placeholder=\"Search team members...\"\n                        className=\"pl-9\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                        data-testid=\"input-search-members\"\n                    />\n                </div>\n            </div>\n\n            {filteredMembers.length === 0 && !isLoading && (\n                <Card>\n                    <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                        <UserX className=\"h-16 w-16 text-muted-foreground mb-4\" />\n                        <p className=\"text-muted-foreground text-lg font-medium\">\n                            {searchTerm\n                                ? \"No matching team members found\"\n                                : \"No team members assigned yet\"}\n                        </p>\n                        <p className=\"text-sm text-muted-foreground mt-2\">\n                            {searchTerm\n                                ? \"Try a different search term\"\n                                : \"Contact your admin to assign team members\"}\n                        </p>\n                    </CardContent>\n                </Card>\n            )}\n\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                {filteredMembers.map((member) => (\n                    <Card\n                        key={member.id}\n                        data-testid={`card-member-${member.id}`}>\n                        <CardHeader>\n                            <div className=\"flex items-start justify-between gap-4\">\n                                <div className=\"flex items-center gap-3\">\n                                    <Avatar>\n                                        <AvatarImage src={member.photoURL} />\n                                        <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                                            {getInitials(member.displayName)}\n                                        </AvatarFallback>\n                                    </Avatar>\n                                    <div className=\"min-w-0\">\n                                        <CardTitle className=\"text-base truncate\">\n                                            {member.displayName}\n                                        </CardTitle>\n                                        <CardDescription className=\"text-xs truncate\">\n                                            {member.uniqueUserId}\n                                        </CardDescription>\n                                    </div>\n                                </div>\n                                <Badge\n                                    variant={\n                                        member.isActive\n                                            ? \"default\"\n                                            : \"secondary\"\n                                    }>\n                                    {member.isActive ? \"Active\" : \"Inactive\"}\n                                </Badge>\n                            </div>\n                        </CardHeader>\n                        <CardContent className=\"space-y-2\">\n                            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                                <Mail className=\"h-4 w-4 flex-shrink-0\" />\n                                <span className=\"truncate\">{member.email}</span>\n                            </div>\n                        </CardContent>\n                    </Card>\n                ))}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":7057,"size_tokens":null},"public/firebase-messaging-sw.js":{"content":"importScripts('https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js');\nimportScripts('https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js');\n\n// Initialize Firebase Messaging with config sent from main app\nself.addEventListener('message', (event) => {\n  if (event.data && event.data.type === 'FIREBASE_CONFIG') {\n    firebase.initializeApp(event.data.config);\n    \n    const messaging = firebase.messaging();\n\n    messaging.onBackgroundMessage((payload) => {\n      console.log('Received background message:', payload);\n      \n      const notificationTitle = payload.notification?.title || 'WorkLogix';\n      const notificationOptions = {\n        body: payload.notification?.body || 'You have a new message',\n        icon: '/icon.png',\n        badge: '/badge.png',\n        data: payload.data || {},\n        tag: payload.data?.messageId || 'worklogix-notification',\n        requireInteraction: true,\n      };\n\n      self.registration.showNotification(notificationTitle, notificationOptions);\n    });\n  }\n});\n\n// Handle notification clicks - deep linking\nself.addEventListener('notificationclick', (event) => {\n  console.log('Notification clicked:', event);\n  event.notification.close();\n\n  const navigationUrl = event.notification.data?.url || '/';\n  \n  event.waitUntil(\n    clients.matchAll({ type: 'window', includeUncontrolled: true }).then((clientList) => {\n      // Try to focus existing window\n      for (const client of clientList) {\n        const clientPath = new URL(client.url).pathname;\n        const targetPath = new URL(navigationUrl, self.location.origin).pathname;\n        \n        if (clientPath === targetPath || clientPath.startsWith('/')) {\n          return client.focus();\n        }\n      }\n      \n      // If no matching window, open new one\n      if (clients.openWindow) {\n        return clients.openWindow(navigationUrl);\n      }\n    })\n  );\n});\n","path":null,"size_bytes":1898,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"server/email.ts":{"content":"import { Resend } from \"resend\";\n\nlet connectionSettings: any;\n\nasync function getCredentials(): Promise<{\n    apiKey: string;\n    fromEmail: string;\n}> {\n    // Check if we have a direct RESEND_API_KEY (for local dev or Render deployment)\n    if (process.env.RESEND_API_KEY) {\n        console.log(\"[EMAIL] Using direct RESEND_API_KEY from environment\");\n        return {\n            apiKey: process.env.RESEND_API_KEY,\n            fromEmail: process.env.RESEND_FROM_EMAIL || \"noreply@worklogix.com\",\n        };\n    }\n\n    // Try Replit connector (for Replit environment)\n    const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n    const xReplitToken = process.env.REPL_IDENTITY\n        ? \"repl \" + process.env.REPL_IDENTITY\n        : process.env.WEB_REPL_RENEWAL\n        ? \"depl \" + process.env.WEB_REPL_RENEWAL\n        : null;\n\n    if (hostname && xReplitToken) {\n        try {\n            connectionSettings = await fetch(\n                \"https://\" +\n                    hostname +\n                    \"/api/v2/connection?include_secrets=true&connector_names=resend\",\n                {\n                    headers: {\n                        Accept: \"application/json\",\n                        X_REPLIT_TOKEN: xReplitToken,\n                    },\n                }\n            )\n                .then((res) => res.json())\n                .then((data) => data.items?.[0]);\n\n            if (connectionSettings?.settings?.api_key) {\n                console.log(\"[EMAIL] Using Replit connector for Resend\");\n                return {\n                    apiKey: connectionSettings.settings.api_key,\n                    fromEmail:\n                        connectionSettings.settings.from_email ||\n                        \"noreply@worklogix.com\",\n                };\n            }\n        } catch (error) {\n            console.warn(\n                \"[EMAIL] Failed to get Replit connector credentials:\",\n                error\n            );\n        }\n    }\n\n    // No credentials available\n    throw new Error(\n        \"Resend not configured. Set RESEND_API_KEY environment variable or configure Replit connector.\"\n    );\n}\n\nasync function getResendClient() {\n    const { apiKey, fromEmail } = await getCredentials();\n    return {\n        client: new Resend(apiKey),\n        fromEmail: fromEmail,\n    };\n}\n\nexport async function sendCompanyServerIdEmail(companyData: {\n    companyName: string;\n    companyEmail: string;\n    serverId: string;\n}) {\n    try {\n        const { client, fromEmail } = await getResendClient();\n\n        const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;\">\n        <div style=\"background-color: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n          <div style=\"text-align: center; margin-bottom: 30px;\">\n            <h1 style=\"color: #4F46E5; margin: 0;\">Company Registration Successful!</h1>\n          </div>\n          \n          <p style=\"font-size: 16px; color: #333;\">Hello <strong>${companyData.companyName}</strong>,</p>\n          <p style=\"font-size: 14px; color: #666; line-height: 1.6;\">Your company registration was successful! Welcome to WorkLogix - your centralized system for managing teams, slots, and activities.</p>\n          \n          <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 20px; margin: 25px 0; text-align: center;\">\n            <p style=\"color: white; font-size: 14px; margin: 0 0 10px 0; opacity: 0.9;\">Your Company Server ID:</p>\n            <p style=\"font-size: 32px; font-weight: bold; color: white; margin: 0; letter-spacing: 2px;\">${companyData.serverId}</p>\n          </div>\n          \n          <div style=\"background-color: #FEF3C7; border-left: 4px solid #F59E0B; padding: 15px; margin: 20px 0; border-radius: 4px;\">\n            <p style=\"color: #92400E; font-size: 14px; margin: 0;\">\n              <strong>Important Security Notice:</strong><br/>\n              Please save your Company Server ID securely. You will need it to log in to your admin portal along with your email and password.\n            </p>\n          </div>\n          \n          <div style=\"background-color: #F3F4F6; padding: 20px; border-radius: 8px; margin: 25px 0;\">\n            <h3 style=\"color: #333; margin-top: 0; font-size: 16px;\">How to Access Your Dashboard:</h3>\n            <ol style=\"color: #666; font-size: 14px; line-height: 1.8; margin: 10px 0;\">\n              <li>Go to the WorkLogix login page</li>\n              <li>Select <strong>\"Company Admin\"</strong> tab</li>\n              <li>Enter your company name, email, server ID, and password</li>\n              <li>Start managing your team!</li>\n            </ol>\n          </div>\n          \n          <div style=\"background-color: #E0E7FF; padding: 15px; border-radius: 8px; margin: 20px 0;\">\n            <p style=\"color: #3730A3; font-size: 13px; margin: 0;\">\n              <strong>Free Plan Includes:</strong> Manage up to 10 users at no cost. Additional user slots can be purchased from your dashboard as your team grows.\n            </p>\n          </div>\n          \n          <hr style=\"border: none; border-top: 1px solid #E5E7EB; margin: 30px 0;\" />\n          \n          <p style=\"font-size: 14px; color: #666;\">Best regards,<br/><strong>The WorkLogix Team</strong></p>\n          <p style=\"font-size: 12px; color: #9CA3AF; margin-top: 20px;\">This is an automated message. Please do not reply to this email.</p>\n        </div>\n      </div>\n    `;\n\n        const { data, error } = await client.emails.send({\n            from: `WorkLogix <${fromEmail}>`,\n            to: [companyData.companyEmail],\n            subject: `Company Registration Successful! - Company ID: ${companyData.serverId}`,\n            html: htmlContent,\n        });\n\n        if (error) {\n            console.error(\n                \"[EMAIL] Error sending company server ID email:\",\n                error\n            );\n            return false;\n        }\n\n        console.log(\n            `[EMAIL] Company Server ID email sent to ${companyData.companyEmail}, ID: ${data?.id}`\n        );\n        return true;\n    } catch (error) {\n        console.error(\"[EMAIL] Error sending company server ID email:\", error);\n        return false;\n    }\n}\n\nexport async function sendUserIdEmail(userData: {\n    userName: string;\n    userEmail: string;\n    uniqueUserId: string;\n    role: string;\n}) {\n    try {\n        const { client, fromEmail } = await getResendClient();\n\n        const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n        <h2 style=\"color: #333;\">Welcome to WorkLogix!</h2>\n        <p>Dear ${userData.userName},</p>\n        <p>Your account has been successfully created.</p>\n        \n        <div style=\"background-color: #f5f5f5; border-left: 4px solid #2196F3; padding: 15px; margin: 20px 0;\">\n          <h3 style=\"color: #333; margin-top: 0;\">Your Unique User ID:</h3>\n          <p style=\"font-size: 24px; font-weight: bold; color: #2196F3; margin: 10px 0;\">${\n              userData.uniqueUserId\n          }</p>\n          <p style=\"color: #666; font-size: 14px; margin: 5px 0;\">Please save this ID for your records. It is unique to your account.</p>\n        </div>\n        \n        <p><strong>Your Role:</strong> ${\n            userData.role === \"company_admin\"\n                ? \"Company Administrator\"\n                : \"Company Member\"\n        }</p>\n        \n        ${\n            userData.role === \"company_admin\"\n                ? `\n          <p>As a company administrator, you can:</p>\n          <ul>\n            <li>Manage users within your company</li>\n            <li>Monitor user activity</li>\n            <li>View company slot usage</li>\n            <li>Purchase additional user slots when needed</li>\n          </ul>\n        `\n                : \"\"\n        }\n        \n        <p>Best regards,<br/>The WorkLogix Team</p>\n      </div>\n    `;\n\n        const { data, error } = await client.emails.send({\n            from: `WorkLogix <${fromEmail}>`,\n            to: [userData.userEmail],\n            subject: `WorkLogix - Your User ID: ${userData.uniqueUserId}`,\n            html: htmlContent,\n        });\n\n        if (error) {\n            console.error(\"[EMAIL] Error sending user ID email:\", error);\n            return false;\n        }\n\n        console.log(\n            `[EMAIL] User ID email sent to ${userData.userEmail}, ID: ${data?.id}`\n        );\n        return true;\n    } catch (error) {\n        console.error(\"[EMAIL] Error sending user ID email:\", error);\n        return false;\n    }\n}\n\nexport async function sendPasswordResetEmail(data: {\n    email: string;\n    resetToken: string;\n    userName?: string;\n    baseUrl?: string;\n}) {\n    try {\n        const { client, fromEmail } = await getResendClient();\n\n        // Determine the correct frontend URL for password reset\n        let frontendUrl: string;\n\n        if (data.baseUrl) {\n            frontendUrl = data.baseUrl;\n        } else if (process.env.REPLIT_DEV_DOMAIN) {\n            frontendUrl = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n        } else if (process.env.REPLIT_DOMAINS) {\n            const domains = process.env.REPLIT_DOMAINS.split(\",\");\n            frontendUrl = `https://${domains[0].trim()}`;\n        } else if (process.env.FRONTEND_URL) {\n            frontendUrl = process.env.FRONTEND_URL;\n        } else if (process.env.VITE_API_URL) {\n            frontendUrl = process.env.VITE_API_URL;\n        } else {\n            frontendUrl = \"http://localhost:5000\";\n        }\n\n        // Get the base path for frontend routes (e.g., /worklogix)\n        const basePath = process.env.FRONTEND_BASE_PATH || \"\";\n        const resetUrl = `${frontendUrl}${basePath}/reset-password?token=${data.resetToken}`;\n        console.log(`[EMAIL] Password reset URL: ${resetUrl}`);\n\n        const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;\">\n        <div style=\"background-color: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n          <div style=\"text-align: center; margin-bottom: 30px;\">\n            <h1 style=\"color: #DC2626; margin: 0;\">Reset Your WorkLogix Password</h1>\n          </div>\n          \n          <p style=\"font-size: 16px; color: #333;\">Hello <strong>${\n              data.userName || \"User\"\n          }</strong>,</p>\n          <p style=\"font-size: 14px; color: #666; line-height: 1.6;\">You requested a password reset for your WorkLogix account.</p>\n          \n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${resetUrl}\" style=\"display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px 40px; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n              Reset Your Password\n            </a>\n          </div>\n          \n          <div style=\"background-color: #F3F4F6; padding: 15px; border-radius: 6px; margin: 20px 0;\">\n            <p style=\"color: #6B7280; font-size: 12px; margin: 0; word-break: break-all;\">\n              <strong>Or copy this secure link:</strong><br/>\n              ${resetUrl}\n            </p>\n          </div>\n          \n          <div style=\"background-color: #FEE2E2; border-left: 4px solid #DC2626; padding: 15px; margin: 25px 0; border-radius: 4px;\">\n            <p style=\"color: #991B1B; font-size: 14px; margin: 0;\">\n              <strong>Security Notice:</strong><br/>\n              This link expires in <strong>15 minutes</strong> for your security. If you didn't request this password reset, please ignore this email and your password will remain unchanged.\n            </p>\n          </div>\n          \n          <div style=\"background-color: #E0F2FE; padding: 15px; border-radius: 6px; margin: 20px 0;\">\n            <p style=\"color: #075985; font-size: 13px; margin: 0;\">\n              <strong>Password Requirements:</strong><br/>\n              Your new password must contain at least 8 characters, including uppercase, lowercase, numbers, and special characters (@$!%*?&).\n            </p>\n          </div>\n          \n          <hr style=\"border: none; border-top: 1px solid #E5E7EB; margin: 30px 0;\" />\n          \n          <p style=\"font-size: 14px; color: #666;\">Best regards,<br/><strong>The WorkLogix Team</strong></p>\n          <p style=\"font-size: 12px; color: #9CA3AF; margin-top: 20px;\">This is an automated security message. Please do not reply to this email.</p>\n        </div>\n      </div>\n    `;\n\n        const { data: emailData, error } = await client.emails.send({\n            from: `WorkLogix <${fromEmail}>`,\n            to: [data.email],\n            subject: \"Reset Your WorkLogix Password\",\n            html: htmlContent,\n        });\n\n        if (error) {\n            console.error(\"[EMAIL] Error sending password reset email:\", error);\n            return false;\n        }\n\n        console.log(\n            `[EMAIL] Password reset email sent to ${data.email}, ID: ${emailData?.id}`\n        );\n        return true;\n    } catch (error) {\n        console.error(\"[EMAIL] Error sending password reset email:\", error);\n        return false;\n    }\n}\n\nexport async function sendPaymentConfirmationEmail(paymentData: {\n    companyName: string;\n    companyEmail: string;\n    receiptNumber: string;\n    amount: number;\n    currency: string;\n    slotType: string;\n    slotQuantity: number;\n    transactionId: string;\n    paymentDate: Date;\n}) {\n    try {\n        const { client, fromEmail } = await getResendClient();\n\n        const currencySymbol = paymentData.currency === \"INR\" ? \"Rs.\" : \"$\";\n        const slotTypeLabel =\n            paymentData.slotType === \"admin\" ? \"Admin\" : \"Member\";\n\n        const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9f9f9;\">\n        <div style=\"background-color: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n          <div style=\"text-align: center; margin-bottom: 30px;\">\n            <div style=\"background-color: #4CAF50; color: white; width: 60px; height: 60px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 30px;\">\n              <span style=\"line-height: 60px;\">&#10003;</span>\n            </div>\n            <h1 style=\"color: #333; margin: 15px 0 5px 0;\">Payment Successful!</h1>\n            <p style=\"color: #666; margin: 0;\">Thank you for your purchase</p>\n          </div>\n          \n          <div style=\"background-color: #f5f5f5; border-left: 4px solid #4CAF50; padding: 20px; margin: 25px 0; border-radius: 4px;\">\n            <h2 style=\"color: #333; margin: 0 0 15px 0; font-size: 18px;\">Payment Details</h2>\n            <table style=\"width: 100%; border-collapse: collapse;\">\n              <tr>\n                <td style=\"padding: 8px 0; color: #666; width: 40%;\">Receipt Number:</td>\n                <td style=\"padding: 8px 0; color: #333; font-weight: bold;\">${\n                    paymentData.receiptNumber\n                }</td>\n              </tr>\n              <tr>\n                <td style=\"padding: 8px 0; color: #666;\">Company:</td>\n                <td style=\"padding: 8px 0; color: #333; font-weight: bold;\">${\n                    paymentData.companyName\n                }</td>\n              </tr>\n              <tr>\n                <td style=\"padding: 8px 0; color: #666;\">Date:</td>\n                <td style=\"padding: 8px 0; color: #333;\">${paymentData.paymentDate.toLocaleString(\n                    \"en-IN\",\n                    { dateStyle: \"long\", timeStyle: \"short\" }\n                )}</td>\n              </tr>\n              <tr>\n                <td style=\"padding: 8px 0; color: #666;\">Transaction ID:</td>\n                <td style=\"padding: 8px 0; color: #333; font-size: 12px; word-break: break-all;\">${\n                    paymentData.transactionId\n                }</td>\n              </tr>\n            </table>\n          </div>\n          \n          <div style=\"background-color: #f5f5f5; padding: 20px; margin: 25px 0; border-radius: 4px;\">\n            <h2 style=\"color: #333; margin: 0 0 15px 0; font-size: 18px;\">Order Summary</h2>\n            <table style=\"width: 100%; border-collapse: collapse;\">\n              <tr>\n                <td style=\"padding: 8px 0; color: #666;\">Item:</td>\n                <td style=\"padding: 8px 0; color: #333; text-align: right;\">${slotTypeLabel} Slots (${\n            paymentData.slotQuantity\n        })</td>\n              </tr>\n              <tr style=\"border-top: 1px solid #ddd;\">\n                <td style=\"padding: 12px 0; color: #333; font-weight: bold; font-size: 16px;\">Total Amount:</td>\n                <td style=\"padding: 12px 0; color: #4CAF50; font-weight: bold; font-size: 18px; text-align: right;\">${currencySymbol}${paymentData.amount.toLocaleString()}</td>\n              </tr>\n            </table>\n          </div>\n          \n          <div style=\"background-color: #E8F5E9; border: 1px solid #4CAF50; border-radius: 4px; padding: 15px; margin: 25px 0;\">\n            <p style=\"margin: 0; color: #2E7D32; font-size: 14px;\">\n              Your ${slotTypeLabel.toLowerCase()} slots have been added to your company account and are ready to use.\n            </p>\n          </div>\n          \n          <div style=\"text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;\">\n            <p style=\"color: #666; font-size: 14px; margin: 5px 0;\">Questions about your payment?</p>\n            <p style=\"color: #666; font-size: 14px; margin: 5px 0;\">Contact us at support@worklogix.com</p>\n          </div>\n          \n          <div style=\"text-align: center; margin-top: 25px;\">\n            <p style=\"color: #999; font-size: 12px; margin: 5px 0;\">This is an automated email. Please do not reply.</p>\n            <p style=\"color: #999; font-size: 12px; margin: 5px 0;\">${new Date().getFullYear()} WorkLogix. All rights reserved.</p>\n          </div>\n        </div>\n      </div>\n    `;\n\n        const { data, error } = await client.emails.send({\n            from: `WorkLogix <${fromEmail}>`,\n            to: [paymentData.companyEmail],\n            subject: `Payment Receipt - ${paymentData.receiptNumber} | WorkLogix`,\n            html: htmlContent,\n        });\n\n        if (error) {\n            console.error(\n                \"[EMAIL] Error sending payment confirmation email:\",\n                error\n            );\n            return false;\n        }\n\n        console.log(\n            `[EMAIL] Payment confirmation email sent to ${paymentData.companyEmail} with receipt ${paymentData.receiptNumber}, ID: ${data?.id}`\n        );\n        return true;\n    } catch (error) {\n        console.error(\n            \"[EMAIL] Error sending payment confirmation email:\",\n            error\n        );\n        return false;\n    }\n}\n\nexport async function sendCompanyVerificationEmail(data: {\n    companyName: string;\n    email: string;\n    serverId: string;\n    verificationToken: string;\n    baseUrl?: string;\n}) {\n    try {\n        const { client, fromEmail } = await getResendClient();\n\n        console.log(\n            `[EMAIL] Attempting to send verification email to: ${data.email}`\n        );\n        console.log(`[EMAIL] From: ${fromEmail}`);\n\n        // Determine the correct frontend URL for verification\n        let frontendUrl: string;\n\n        if (data.baseUrl) {\n            frontendUrl = data.baseUrl;\n        } else if (process.env.REPLIT_DEV_DOMAIN) {\n            frontendUrl = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n        } else if (process.env.REPLIT_DOMAINS) {\n            const domains = process.env.REPLIT_DOMAINS.split(\",\");\n            frontendUrl = `https://${domains[0].trim()}`;\n        } else if (process.env.FRONTEND_URL) {\n            frontendUrl = process.env.FRONTEND_URL;\n        } else if (process.env.VITE_API_URL) {\n            frontendUrl = process.env.VITE_API_URL;\n        } else {\n            frontendUrl = \"http://localhost:5000\";\n        }\n\n        // Get the base path for frontend routes (e.g., /worklogix)\n        const basePath = process.env.FRONTEND_BASE_PATH || \"\";\n        const verificationUrl = `${frontendUrl}${basePath}/verify?token=${data.verificationToken}`;\n        console.log(`[EMAIL] Verification URL: ${verificationUrl}`);\n\n        const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;\">\n        <div style=\"background-color: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n          <div style=\"text-align: center; margin-bottom: 30px;\">\n            <h1 style=\"color: #4F46E5; margin: 0;\">Company Registration Successful!</h1>\n          </div>\n          \n          <p style=\"font-size: 16px; color: #333;\">Hello <strong>${data.companyName}</strong>,</p>\n          <p style=\"font-size: 14px; color: #666; line-height: 1.6;\">Your company registration was successful! Welcome to WorkLogix.</p>\n          \n          <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 20px; margin: 25px 0; text-align: center;\">\n            <p style=\"color: white; font-size: 14px; margin: 0 0 10px 0; opacity: 0.9;\">Your Company Server ID:</p>\n            <p style=\"font-size: 32px; font-weight: bold; color: white; margin: 0; letter-spacing: 2px;\">${data.serverId}</p>\n          </div>\n          \n          <div style=\"background-color: #FEF3C7; border-left: 4px solid #F59E0B; padding: 15px; margin: 20px 0; border-radius: 4px;\">\n            <p style=\"color: #92400E; font-size: 14px; margin: 0;\">\n              <strong>Important:</strong> Please save your Company Server ID securely. You will need it to log in.\n            </p>\n          </div>\n          \n          <div style=\"text-align: center; margin: 30px 0;\">\n            <p style=\"font-size: 14px; color: #333; margin-bottom: 15px;\">Please confirm your registration by clicking the button below:</p>\n            <a href=\"${verificationUrl}\" style=\"display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px 40px; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n              Verify Your Email\n            </a>\n          </div>\n          \n          <div style=\"background-color: #F3F4F6; padding: 15px; border-radius: 6px; margin: 20px 0;\">\n            <p style=\"color: #6B7280; font-size: 12px; margin: 0; word-break: break-all;\">\n              <strong>Or copy this link:</strong><br/>\n              ${verificationUrl}\n            </p>\n          </div>\n          \n          <div style=\"background-color: #FEE2E2; border-left: 4px solid #DC2626; padding: 15px; margin: 25px 0; border-radius: 4px;\">\n            <p style=\"color: #991B1B; font-size: 14px; margin: 0;\">\n              <strong>Important:</strong> This verification link expires in <strong>24 hours</strong>. After confirmation, you can log in to your company dashboard.\n            </p>\n          </div>\n          \n          <hr style=\"border: none; border-top: 1px solid #E5E7EB; margin: 30px 0;\" />\n          \n          <p style=\"font-size: 14px; color: #666;\">Best regards,<br/><strong>The WorkLogix Team</strong></p>\n          <p style=\"font-size: 12px; color: #9CA3AF; margin-top: 20px;\">This is an automated message. Please do not reply to this email.</p>\n        </div>\n      </div>\n    `;\n\n        const { data: emailData, error } = await client.emails.send({\n            from: `WorkLogix <${fromEmail}>`,\n            to: [data.email],\n            subject: `Verify Your WorkLogix Registration - Company ID: ${data.serverId}`,\n            html: htmlContent,\n        });\n\n        if (error) {\n            console.error(\"[EMAIL] Error sending verification email:\", error);\n            return false;\n        }\n\n        console.log(\n            `[EMAIL] Verification email sent successfully to ${data.email}, ID: ${emailData?.id}`\n        );\n        return true;\n    } catch (error) {\n        console.error(\"[EMAIL] Error sending verification email:\", error);\n        if (error instanceof Error) {\n            console.error(\"[EMAIL] Error message:\", error.message);\n            console.error(\"[EMAIL] Error stack:\", error.stack);\n        }\n        return false;\n    }\n}\n\nexport async function sendReportNotification(reportData: {\n    adminEmail: string;\n    userName: string;\n    reportType: string;\n    plannedTasks?: string | null;\n    completedTasks?: string | null;\n    pendingTasks?: string | null;\n    notes?: string | null;\n    createdAt: Date;\n}) {\n    try {\n        const { client, fromEmail } = await getResendClient();\n\n        const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #333;\">New ${\n            reportData.reportType.charAt(0).toUpperCase() +\n            reportData.reportType.slice(1)\n        } Report Submitted</h2>\n        <p><strong>User:</strong> ${reportData.userName}</p>\n        <p><strong>Report Type:</strong> ${\n            reportData.reportType.charAt(0).toUpperCase() +\n            reportData.reportType.slice(1)\n        }</p>\n        <p><strong>Submitted At:</strong> ${reportData.createdAt.toLocaleString()}</p>\n        \n        ${\n            reportData.plannedTasks\n                ? `\n          <div style=\"margin: 20px 0;\">\n            <h3 style=\"color: #555;\">Planned Tasks:</h3>\n            <p style=\"white-space: pre-wrap;\">${reportData.plannedTasks}</p>\n          </div>\n        `\n                : \"\"\n        }\n        \n        ${\n            reportData.completedTasks\n                ? `\n          <div style=\"margin: 20px 0;\">\n            <h3 style=\"color: #555;\">Completed Tasks:</h3>\n            <p style=\"white-space: pre-wrap;\">${reportData.completedTasks}</p>\n          </div>\n        `\n                : \"\"\n        }\n        \n        ${\n            reportData.pendingTasks\n                ? `\n          <div style=\"margin: 20px 0;\">\n            <h3 style=\"color: #555;\">Pending Tasks:</h3>\n            <p style=\"white-space: pre-wrap;\">${reportData.pendingTasks}</p>\n          </div>\n        `\n                : \"\"\n        }\n        \n        ${\n            reportData.notes\n                ? `\n          <div style=\"margin: 20px 0;\">\n            <h3 style=\"color: #555;\">Notes:</h3>\n            <p style=\"white-space: pre-wrap;\">${reportData.notes}</p>\n          </div>\n        `\n                : \"\"\n        }\n      </div>\n    `;\n\n        const { data, error } = await client.emails.send({\n            from: `WorkLogix <${fromEmail}>`,\n            to: [reportData.adminEmail],\n            subject: `New ${\n                reportData.reportType.charAt(0).toUpperCase() +\n                reportData.reportType.slice(1)\n            } Report - ${reportData.userName}`,\n            html: htmlContent,\n        });\n\n        if (error) {\n            console.error(\"[EMAIL] Error sending report notification:\", error);\n            return false;\n        }\n\n        console.log(\n            `[EMAIL] Report notification sent for ${reportData.reportType} report by ${reportData.userName} to ${reportData.adminEmail}, ID: ${data?.id}`\n        );\n        return true;\n    } catch (error) {\n        console.error(\"[EMAIL] Error sending report notification:\", error);\n        return false;\n    }\n}\n\nexport async function sendMonthlyAchievementEmail(achievementData: {\n    userName: string;\n    userEmail: string;\n    badges: string[];\n    totalPoints: number;\n    presentDays: number;\n    perfectMonths: number;\n    currentStreak: number;\n}) {\n    try {\n        const { client, fromEmail } = await getResendClient();\n\n        const badgesList = achievementData.badges\n            .map(\n                (badge) => `\n      <li style=\"padding: 5px 0; color: #333; font-size: 14px;\">Badge: ${badge}</li>\n    `\n            )\n            .join(\"\");\n\n        const htmlContent = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;\">\n        <div style=\"background-color: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n          <div style=\"text-align: center; margin-bottom: 30px;\">\n            <h1 style=\"color: #4F46E5; margin: 0;\">Monthly Achievement Report!</h1>\n          </div>\n          \n          <p style=\"font-size: 16px; color: #333;\">Hello <strong>${\n              achievementData.userName\n          }</strong>,</p>\n          <p style=\"font-size: 14px; color: #666; line-height: 1.6;\">Congratulations on completing another month! Here's a summary of your achievements:</p>\n          \n          <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 20px; margin: 25px 0; text-align: center;\">\n            <p style=\"color: white; font-size: 14px; margin: 0 0 10px 0; opacity: 0.9;\">Total Points This Month:</p>\n            <p style=\"font-size: 48px; font-weight: bold; color: white; margin: 0;\">${\n                achievementData.totalPoints\n            }</p>\n          </div>\n          \n          <div style=\"background-color: #F3F4F6; padding: 20px; border-radius: 8px; margin: 25px 0;\">\n            <h3 style=\"color: #333; margin-top: 0; font-size: 16px;\">Monthly Stats:</h3>\n            <table style=\"width: 100%; border-collapse: collapse;\">\n              <tr>\n                <td style=\"padding: 10px; color: #666; font-size: 14px;\">Present Days:</td>\n                <td style=\"padding: 10px; color: #10B981; font-size: 16px; font-weight: bold; text-align: right;\">${\n                    achievementData.presentDays\n                } days</td>\n              </tr>\n              <tr>\n                <td style=\"padding: 10px; color: #666; font-size: 14px;\">Current Streak:</td>\n                <td style=\"padding: 10px; color: #F59E0B; font-size: 16px; font-weight: bold; text-align: right;\">${\n                    achievementData.currentStreak\n                } days</td>\n              </tr>\n              <tr>\n                <td style=\"padding: 10px; color: #666; font-size: 14px;\">Perfect Months:</td>\n                <td style=\"padding: 10px; color: #4F46E5; font-size: 16px; font-weight: bold; text-align: right;\">${\n                    achievementData.perfectMonths\n                }</td>\n              </tr>\n            </table>\n          </div>\n          \n          ${\n              achievementData.badges.length > 0\n                  ? `\n            <div style=\"background-color: #FEF3C7; border-left: 4px solid #F59E0B; padding: 20px; margin: 20px 0; border-radius: 4px;\">\n              <h3 style=\"color: #92400E; margin-top: 0; font-size: 16px;\">New Badges Earned:</h3>\n              <ul style=\"margin: 10px 0; padding-left: 20px;\">\n                ${badgesList}\n              </ul>\n            </div>\n          `\n                  : \"\"\n          }\n          \n          <div style=\"background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 8px; padding: 20px; margin: 25px 0; text-align: center;\">\n            <p style=\"color: white; font-size: 16px; margin: 0;\">Keep up your dedication!</p>\n            <p style=\"color: white; font-size: 14px; margin: 10px 0; opacity: 0.9;\">Your consistency is paying off. Let's make next month even better!</p>\n          </div>\n          \n          <hr style=\"border: none; border-top: 1px solid #E5E7EB; margin: 30px 0;\" />\n          \n          <p style=\"font-size: 14px; color: #666;\">Best regards,<br/><strong>The WorkLogix Team</strong></p>\n          <p style=\"font-size: 12px; color: #9CA3AF; margin-top: 20px;\">This is an automated message. Please do not reply to this email.</p>\n        </div>\n      </div>\n    `;\n\n        const { data, error } = await client.emails.send({\n            from: `WorkLogix Achievements <${fromEmail}>`,\n            to: [achievementData.userEmail],\n            subject: `Your Monthly Achievement Report!`,\n            html: htmlContent,\n        });\n\n        if (error) {\n            console.error(\n                \"[EMAIL] Error sending monthly achievement email:\",\n                error\n            );\n            return false;\n        }\n\n        console.log(\n            `[EMAIL] Monthly achievement email sent to ${achievementData.userEmail}, ID: ${data?.id}`\n        );\n        return true;\n    } catch (error) {\n        console.error(\n            \"[EMAIL] Error sending monthly achievement email:\",\n            error\n        );\n        return false;\n    }\n}\n","path":null,"size_bytes":32728,"size_tokens":null},"client/src/components/examples/TaskCard.tsx":{"content":"import TaskCard from '../TaskCard'\n\nexport default function TaskCardExample() {\n  return (\n    <div className=\"space-y-4 max-w-2xl\">\n      <TaskCard\n        id=\"1\"\n        title=\"Complete Q4 Sales Report\"\n        description=\"Prepare comprehensive sales analysis for Q4 including regional breakdowns, customer segments, and revenue projections.\"\n        priority=\"High\"\n        deadline={new Date(Date.now() + 2 * 24 * 60 * 60 * 1000)}\n        status=\"In Progress\"\n        assignedDate={new Date(Date.now() - 3 * 24 * 60 * 60 * 1000)}\n      />\n      <TaskCard\n        id=\"2\"\n        title=\"Review Team Performance\"\n        description=\"Conduct individual performance reviews for team members and prepare feedback.\"\n        priority=\"Medium\"\n        deadline={new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)}\n        status=\"Pending\"\n        assignedDate={new Date()}\n      />\n    </div>\n  )\n}\n","path":null,"size_bytes":892,"size_tokens":null},"client/src/components/ResetPasswordPage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { PasswordStrengthMeter } from \"@/components/ui/password-strength-meter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link, useLocation } from \"wouter\";\nimport { KeyRound, CheckCircle2 } from \"lucide-react\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function ResetPasswordPage() {\n  const [, setLocation] = useLocation();\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [token, setToken] = useState(\"\");\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const tokenParam = params.get('token');\n    if (tokenParam) {\n      setToken(tokenParam);\n    } else {\n      setError(\"Invalid or missing reset token\");\n    }\n  }, []);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n\n    if (password.length < 8) {\n      setError(\"Password must be at least 8 characters\");\n      return;\n    }\n\n    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/;\n    if (!passwordRegex.test(password)) {\n      setError(\"Password must contain uppercase, lowercase, number, and special character\");\n      return;\n    }\n\n    if (password !== confirmPassword) {\n      setError(\"Passwords do not match\");\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/auth/reset-password`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ token, newPassword: password }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to reset password');\n      }\n\n      setIsSuccess(true);\n      toast({\n        title: \"Success!\",\n        description: \"Your password has been reset successfully.\",\n        duration: 5000,\n      });\n\n      setTimeout(() => {\n        setLocation(\"/login/admin\");\n      }, 2000);\n    } catch (error: any) {\n      setError(error.message || \"Failed to reset password\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (!token && !error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4 bg-background\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">Loading...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-background\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <KeyRound className=\"h-6 w-6 text-primary\" />\n            Reset Password\n          </CardTitle>\n          <CardDescription>\n            Create a new password for your account\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {!isSuccess ? (\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">New Password</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"Create a strong password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  data-testid=\"input-password\"\n                />\n                <PasswordStrengthMeter password={password} />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirmPassword\">Confirm New Password</Label>\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  placeholder=\"Re-enter your password\"\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  required\n                  data-testid=\"input-confirm-password\"\n                />\n              </div>\n\n              {error && (\n                <p className=\"text-sm text-red-500\" data-testid=\"error-message\">\n                  {error}\n                </p>\n              )}\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={isLoading || !token}\n                data-testid=\"button-reset-password\"\n              >\n                {isLoading ? \"Resetting...\" : \"Reset Password\"}\n              </Button>\n\n              <div className=\"text-center\">\n                <Link href=\"/login/admin\" className=\"text-sm text-primary hover:underline\" data-testid=\"link-back-to-login\">\n                  Back to Login\n                </Link>\n              </div>\n            </form>\n          ) : (\n            <div className=\"space-y-4 text-center\">\n              <div className=\"mx-auto w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-semibold mb-2\">Password Reset Successfully!</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Your password has been updated successfully.\n                </p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  You can now log in with your new password.\n                </p>\n              </div>\n              <div className=\"pt-4\">\n                <Link href=\"/login/admin\">\n                  <Button className=\"w-full\" data-testid=\"button-go-to-login\">\n                    Go to Login\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6387,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/pages/team-leader/TeamLeaderAttendance.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Clock, Calendar, LogIn, LogOut, Users, Flame, Star, Award, Target, Zap, CheckCircle, XCircle, AlertCircle } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { format } from \"date-fns\";\nimport type { AttendanceBadge, AttendancePolicy } from \"@shared/schema\";\n\ninterface AttendanceRecord {\n    id: number;\n    userId: number;\n    date: string;\n    checkIn: string | null;\n    checkOut: string | null;\n    workDuration: number | null;\n    status: string;\n}\n\ninterface TeamMemberAttendance {\n    userId: number;\n    fullName: string;\n    email: string;\n    checkIn: string | null;\n    checkOut: string | null;\n    status: string;\n    workDuration: number | null;\n}\n\ninterface StreakData {\n    currentStreak: number;\n    longestStreak: number;\n    earlyBirdCount: number;\n    onTimeCount: number;\n    lateCount: number;\n    absentCount: number;\n    totalWorkingDays: number;\n}\n\nexport default function TeamLeaderAttendance() {\n    const { dbUserId } = useAuth();\n    const { toast } = useToast();\n\n    const { data: todayRecord, isLoading: loadingToday } =\n        useQuery<AttendanceRecord>({\n            queryKey: [\"/api/attendance/today\"],\n            enabled: !!dbUserId,\n            refetchInterval: 30000, // Refresh every 30 seconds\n        });\n\n    const { data: recentAttendance = [], isLoading: loadingHistory } = useQuery<\n        AttendanceRecord[]\n    >({\n        queryKey: [\"/api/attendance/history\"],\n        enabled: !!dbUserId,\n    });\n\n    const { data: badges } = useQuery<AttendanceBadge[]>({\n        queryKey: [\"/api/attendance/badges\"],\n        enabled: !!dbUserId,\n    });\n\n    const { data: streak } = useQuery<StreakData>({\n        queryKey: [\"/api/attendance/streak\"],\n        enabled: !!dbUserId,\n    });\n\n    const { data: policyData } = useQuery<{\n        policy: AttendancePolicy;\n        shift: { startTime: string; endTime: string } | null;\n    }>({\n        queryKey: [\"/api/attendance/policy\"],\n        enabled: !!dbUserId,\n    });\n\n    const { data: teamAttendance = [] } = useQuery<TeamMemberAttendance[]>({\n        queryKey: [\"/api/team-leader/team-attendance/today\"],\n        enabled: !!dbUserId,\n        refetchInterval: 60000,\n    });\n\n    const checkInMutation = useMutation({\n        mutationFn: async () => {\n            return apiRequest(\n                `${API_BASE_URL}/api/attendance/check-in`,\n                \"POST\",\n                {}\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/today\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/history\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/streak\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/badges\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/team-leader/team-attendance/today\"],\n            });\n            toast({ title: \"Success\", description: \"Checked in successfully\" });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to check in\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const checkOutMutation = useMutation({\n        mutationFn: async () => {\n            return apiRequest(\n                `${API_BASE_URL}/api/attendance/check-out`,\n                \"POST\",\n                {}\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/today\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/history\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/streak\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/badges\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/team-leader/team-attendance/today\"],\n            });\n            toast({\n                title: \"Success\",\n                description: \"Checked out successfully\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to check out\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const formatTime = (timeStr: string | null) => {\n        if (!timeStr) return \"Not recorded\";\n        return format(new Date(timeStr), \"hh:mm a\");\n    };\n\n    const formatDuration = (minutes: number | null) => {\n        if (!minutes) return \"0h 0m\";\n        const hours = Math.floor(minutes / 60);\n        const mins = minutes % 60;\n        return `${hours}h ${mins}m`;\n    };\n\n    const getStatusBadge = (status: string) => {\n        switch (status) {\n            case \"present\":\n                return <Badge variant=\"default\">Present</Badge>;\n            case \"late\":\n                return <Badge variant=\"secondary\">Late</Badge>;\n            case \"absent\":\n                return <Badge variant=\"destructive\">Absent</Badge>;\n            case \"on_leave\":\n                return <Badge variant=\"outline\">On Leave</Badge>;\n            default:\n                return <Badge variant=\"secondary\">{status}</Badge>;\n        }\n    };\n\n    if (loadingToday || loadingHistory) {\n        return (\n            <div className=\"space-y-6\">\n                <div>\n                    <Skeleton className=\"h-10 w-48 mb-2\" />\n                    <Skeleton className=\"h-5 w-72\" />\n                </div>\n                <Skeleton className=\"h-64 w-full\" />\n                <Skeleton className=\"h-48 w-full\" />\n            </div>\n        );\n    }\n\n    const presentCount = teamAttendance.filter(m => m.status === 'present' || m.status === 'late').length;\n    const lateTeamCount = teamAttendance.filter(m => m.status === 'late').length;\n    const onLeaveCount = teamAttendance.filter(m => m.status === 'leave' || m.status === 'on_leave').length;\n    const absentTeamCount = teamAttendance.filter(m => m.status === 'absent' || (!m.checkIn && !m.status)).length;\n    const totalTeamMembers = teamAttendance.length;\n\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h1 className=\"text-3xl font-bold\">My Attendance</h1>\n                <p className=\"text-muted-foreground\">\n                    Track your attendance and manage your team\n                </p>\n            </div>\n\n            {totalTeamMembers > 0 && (\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Users className=\"h-5 w-5\" />\n                            Team Attendance Today\n                        </CardTitle>\n                        <CardDescription>Overview of your team's attendance status</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"grid gap-4 md:grid-cols-5\">\n                            <div className=\"text-center p-4 border rounded-md\">\n                                <div className=\"flex items-center justify-center gap-1\">\n                                    <Users className=\"h-4 w-4 text-muted-foreground\" />\n                                    <p className=\"text-2xl font-bold\" data-testid=\"text-total-team\">\n                                        {totalTeamMembers}\n                                    </p>\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">Total</p>\n                            </div>\n                            <div className=\"text-center p-4 border rounded-md bg-gradient-to-br from-green-500/5 to-green-500/10\">\n                                <div className=\"flex items-center justify-center gap-1\">\n                                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                                    <p className=\"text-2xl font-bold text-green-600\" data-testid=\"text-present-count\">\n                                        {presentCount}\n                                    </p>\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">Present</p>\n                            </div>\n                            <div className=\"text-center p-4 border rounded-md bg-gradient-to-br from-yellow-500/5 to-yellow-500/10\">\n                                <div className=\"flex items-center justify-center gap-1\">\n                                    <AlertCircle className=\"h-4 w-4 text-yellow-600\" />\n                                    <p className=\"text-2xl font-bold text-yellow-600\" data-testid=\"text-late-team\">\n                                        {lateTeamCount}\n                                    </p>\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">Late</p>\n                            </div>\n                            <div className=\"text-center p-4 border rounded-md bg-gradient-to-br from-blue-500/5 to-blue-500/10\">\n                                <div className=\"flex items-center justify-center gap-1\">\n                                    <Calendar className=\"h-4 w-4 text-blue-600\" />\n                                    <p className=\"text-2xl font-bold text-blue-600\" data-testid=\"text-leave-team\">\n                                        {onLeaveCount}\n                                    </p>\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">On Leave</p>\n                            </div>\n                            <div className=\"text-center p-4 border rounded-md bg-gradient-to-br from-red-500/5 to-red-500/10\">\n                                <div className=\"flex items-center justify-center gap-1\">\n                                    <XCircle className=\"h-4 w-4 text-red-600\" />\n                                    <p className=\"text-2xl font-bold text-red-600\" data-testid=\"text-absent-team\">\n                                        {absentTeamCount}\n                                    </p>\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">Absent</p>\n                            </div>\n                        </div>\n                        {teamAttendance.length > 0 && (\n                            <div className=\"mt-4 space-y-2\">\n                                <p className=\"text-sm font-medium\">Team Members</p>\n                                <div className=\"max-h-48 overflow-y-auto space-y-2\">\n                                    {teamAttendance.map((member) => (\n                                        <div\n                                            key={member.userId}\n                                            className=\"flex flex-wrap items-center justify-between gap-2 p-2 border rounded-md\"\n                                            data-testid={`team-member-${member.userId}`}\n                                        >\n                                            <span className=\"text-sm font-medium\">{member.fullName}</span>\n                                            <div className=\"flex items-center gap-2\">\n                                                <span className=\"text-xs text-muted-foreground\">\n                                                    {formatTime(member.checkIn)}\n                                                </span>\n                                                {getStatusBadge(member.status || 'absent')}\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n                    </CardContent>\n                </Card>\n            )}\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Today's Attendance</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <div className=\"grid gap-4 md:grid-cols-2\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-3 bg-green-100 dark:bg-green-900/20 rounded-md\">\n                                <LogIn className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Clock In\n                                </p>\n                                <p\n                                    className=\"text-lg font-semibold\"\n                                    data-testid=\"text-clock-in\">\n                                    {formatTime(todayRecord?.checkIn || null)}\n                                </p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-3 bg-blue-100 dark:bg-blue-900/20 rounded-md\">\n                                <LogOut className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Clock Out\n                                </p>\n                                <p\n                                    className=\"text-lg font-semibold\"\n                                    data-testid=\"text-clock-out\">\n                                    {formatTime(todayRecord?.checkOut || null)}\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"flex items-center justify-between pt-4 border-t\">\n                        <div className=\"flex items-center gap-2\">\n                            <Clock className=\"h-5 w-5 text-muted-foreground\" />\n                            <span className=\"text-sm text-muted-foreground\">\n                                Total Hours Today:\n                            </span>\n                            <span\n                                className=\"font-semibold\"\n                                data-testid=\"text-total-hours\">\n                                {formatDuration(\n                                    todayRecord?.workDuration || null\n                                )}\n                            </span>\n                        </div>\n                        {todayRecord?.status &&\n                            getStatusBadge(todayRecord.status)}\n                    </div>\n                    <div className=\"flex gap-2\">\n                        {!todayRecord?.checkIn && (\n                            <Button\n                                onClick={() => checkInMutation.mutate()}\n                                disabled={checkInMutation.isPending}\n                                data-testid=\"button-clock-in\">\n                                <LogIn className=\"h-4 w-4 mr-2\" />\n                                {checkInMutation.isPending\n                                    ? \"Checking In...\"\n                                    : \"Clock In\"}\n                            </Button>\n                        )}\n                        {todayRecord?.checkIn && !todayRecord?.checkOut && (\n                            <Button\n                                onClick={() => checkOutMutation.mutate()}\n                                disabled={checkOutMutation.isPending}\n                                data-testid=\"button-clock-out\">\n                                <LogOut className=\"h-4 w-4 mr-2\" />\n                                {checkOutMutation.isPending\n                                    ? \"Checking Out...\"\n                                    : \"Clock Out\"}\n                            </Button>\n                        )}\n                    </div>\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Recent Attendance</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    {recentAttendance.length === 0 ? (\n                        <div className=\"flex flex-col items-center justify-center py-12\">\n                            <p className=\"text-muted-foreground\">\n                                No attendance history found\n                            </p>\n                        </div>\n                    ) : (\n                        <div className=\"space-y-3\">\n                            {recentAttendance.slice(0, 10).map((record) => (\n                                <div\n                                    key={record.id}\n                                    className=\"flex flex-wrap items-center justify-between gap-4 pb-3 border-b last:border-0\"\n                                    data-testid={`attendance-record-${record.id}`}>\n                                    <div className=\"flex items-center gap-3\">\n                                        <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                                        <span className=\"font-medium\">\n                                            {format(\n                                                new Date(record.date),\n                                                \"MMM dd, yyyy\"\n                                            )}\n                                        </span>\n                                    </div>\n                                    <div className=\"flex items-center gap-4\">\n                                        <span className=\"text-sm text-muted-foreground\">\n                                            {formatTime(record.checkIn)} -{\" \"}\n                                            {formatTime(record.checkOut)}\n                                        </span>\n                                        <span className=\"font-medium\">\n                                            {formatDuration(\n                                                record.workDuration\n                                            )}\n                                        </span>\n                                        {getStatusBadge(record.status)}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Flame className=\"h-5 w-5\" />\n                            My Streak\n                        </CardTitle>\n                        <CardDescription>Your attendance performance</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"grid grid-cols-2 gap-3\">\n                            <div className=\"text-center p-3 border rounded-md bg-gradient-to-br from-orange-500/5 to-orange-500/10\">\n                                <div className=\"flex items-center justify-center gap-1\">\n                                    <Flame className=\"h-4 w-4 text-orange-500\" />\n                                    <p className=\"text-xl font-bold text-orange-500\" data-testid=\"text-current-streak\">\n                                        {streak?.currentStreak || 0}\n                                    </p>\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">Current</p>\n                            </div>\n                            <div className=\"text-center p-3 border rounded-md bg-gradient-to-br from-yellow-500/5 to-yellow-500/10\">\n                                <div className=\"flex items-center justify-center gap-1\">\n                                    <Star className=\"h-4 w-4 text-yellow-500\" />\n                                    <p className=\"text-xl font-bold text-yellow-500\" data-testid=\"text-longest-streak\">\n                                        {streak?.longestStreak || 0}\n                                    </p>\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">Best</p>\n                            </div>\n                        </div>\n                        <div className=\"grid grid-cols-3 gap-2 mt-3 text-center\">\n                            <div className=\"p-2 border rounded-md\">\n                                <p className=\"text-sm font-semibold text-green-600\">{streak?.earlyBirdCount || 0}</p>\n                                <p className=\"text-xs text-muted-foreground\">Early</p>\n                            </div>\n                            <div className=\"p-2 border rounded-md\">\n                                <p className=\"text-sm font-semibold text-blue-600\">{streak?.onTimeCount || 0}</p>\n                                <p className=\"text-xs text-muted-foreground\">On Time</p>\n                            </div>\n                            <div className=\"p-2 border rounded-md\">\n                                <p className=\"text-sm font-semibold text-red-600\">{streak?.lateCount || 0}</p>\n                                <p className=\"text-xs text-muted-foreground\">Late</p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Award className=\"h-5 w-5\" />\n                            My Badges\n                        </CardTitle>\n                        <CardDescription>Your attendance achievements</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                        {badges && badges.length > 0 ? (\n                            <div className=\"flex flex-wrap gap-2\">\n                                {badges.map((badge) => (\n                                    <div\n                                        key={badge.id}\n                                        className=\"flex items-center gap-2 p-2 border rounded-md bg-gradient-to-r from-primary/5 to-primary/10\"\n                                        data-testid={`badge-${badge.id}`}\n                                    >\n                                        {badge.badgeType === 'early_bird' && <Zap className=\"h-4 w-4 text-yellow-500\" />}\n                                        {badge.badgeType === 'streak' && <Flame className=\"h-4 w-4 text-orange-500\" />}\n                                        {badge.badgeType === 'perfect_month' && <Target className=\"h-4 w-4 text-green-500\" />}\n                                        <div>\n                                            <p className=\"text-sm font-medium\">{badge.badgeName}</p>\n                                            <p className=\"text-xs text-muted-foreground\">{badge.description}</p>\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        ) : (\n                            <div className=\"text-center p-6 text-muted-foreground\">\n                                <Award className=\"h-8 w-8 mx-auto mb-2 opacity-20\" />\n                                <p className=\"text-sm\">No badges yet</p>\n                            </div>\n                        )}\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Clock className=\"h-5 w-5\" />\n                            Policy Rules\n                        </CardTitle>\n                        <CardDescription>Company attendance rules</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"space-y-2\">\n                            {policyData?.shift && (\n                                <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                                    <span className=\"text-sm text-muted-foreground\">Shift</span>\n                                    <span className=\"text-sm font-medium\">\n                                        {policyData.shift.startTime} - {policyData.shift.endTime}\n                                    </span>\n                                </div>\n                            )}\n                            <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                                <span className=\"text-sm text-muted-foreground\">Late After</span>\n                                <Badge variant=\"outline\">\n                                    {policyData?.policy?.lateMarkThreshold || 3} min\n                                </Badge>\n                            </div>\n                            <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                                <span className=\"text-sm text-muted-foreground\">Half Day</span>\n                                <Badge variant=\"outline\">\n                                    {policyData?.policy?.halfDayHours || 4} hrs\n                                </Badge>\n                            </div>\n                            <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                                <span className=\"text-sm text-muted-foreground\">Full Day</span>\n                                <Badge variant=\"outline\">\n                                    {policyData?.policy?.fullDayHours || 8} hrs\n                                </Badge>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":26876,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/pages/LandingPage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { \n  Building2, \n  Users, \n  Shield, \n  TrendingUp, \n  CreditCard, \n  Bell,\n  ChevronDown,\n  Menu,\n  X,\n  Mail,\n  Phone,\n  ArrowRight,\n  CheckCircle2,\n  AlertCircle\n} from \"lucide-react\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function LandingPage() {\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [showSuccessDialog, setShowSuccessDialog] = useState(false);\n  const [successInfo, setSuccessInfo] = useState<{ serverId: string; email: string } | null>(null);\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const success = params.get('success');\n    const error = params.get('error');\n    const serverId = params.get('serverId');\n    const email = params.get('email');\n\n    if (success === 'true' && serverId && email) {\n      setSuccessInfo({ serverId, email });\n      setShowSuccessDialog(true);\n      window.history.replaceState({}, '', '/');\n    } else if (error) {\n      let errorMessage = 'An error occurred during registration';\n      \n      if (error === 'google_oauth_not_configured') {\n        errorMessage = 'Google Sign-In is not available at the moment. Please use the registration form instead.';\n      } else if (error === 'google_auth_failed') {\n        errorMessage = 'Google authentication failed. Please try again.';\n      } else if (error === 'no_email') {\n        errorMessage = 'No email found in Google account. Please use an account with an email.';\n      } else if (error === 'company_exists') {\n        errorMessage = 'A company with this email already exists. Please login instead.';\n      } else if (error === 'registration_failed') {\n        errorMessage = 'Company registration failed. Please try again.';\n      }\n\n      toast({\n        title: \"Registration Error\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n      window.history.replaceState({}, '', '/');\n    }\n  }, [toast]);\n\n  const features = [\n    {\n      icon: Shield,\n      title: \"Super Admin Control\",\n      description: \"Monitor all companies, users, and slot usage in real-time.\"\n    },\n    {\n      icon: Building2,\n      title: \"Company Registration\",\n      description: \"Auto-generates unique company IDs with email verification.\"\n    },\n    {\n      icon: TrendingUp,\n      title: \"Admin Dashboard\",\n      description: \"Manage users, slots, and internal reports.\"\n    },\n    {\n      icon: Users,\n      title: \"User Portal\",\n      description: \"Simple, secure login for company employees.\"\n    },\n    {\n      icon: CreditCard,\n      title: \"Slot-Based System\",\n      description: \"Buy and manage additional user slots easily.\"\n    },\n    {\n      icon: Bell,\n      title: \"Real-Time Notifications\",\n      description: \"Get instant alerts for updates and activities.\"\n    }\n  ];\n\n  const stats = [\n    { number: \"100+\", label: \"Companies Registered\" },\n    { number: \"500+\", label: \"Active Users\" },\n    { number: \"99.9%\", label: \"System Uptime\" }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Navbar */}\n      <nav className=\"sticky top-0 z-50 bg-white dark:bg-gray-900 border-b shadow-sm\" data-testid=\"navbar\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            {/* Logo */}\n            <Link href=\"/\">\n              <div className=\"flex items-center space-x-2 cursor-pointer\" data-testid=\"link-home\">\n                <Building2 className=\"h-8 w-8 text-indigo-600\" />\n                <span className=\"text-2xl font-bold text-gray-900 dark:text-white\">WorkLogix</span>\n              </div>\n            </Link>\n\n            {/* Desktop Navigation */}\n            <div className=\"hidden md:flex items-center space-x-8\">\n              <a href=\"#home\" className=\"text-gray-700 dark:text-gray-300 hover:text-indigo-600 transition\" data-testid=\"link-home-nav\">Home</a>\n              <a href=\"#features\" className=\"text-gray-700 dark:text-gray-300 hover:text-indigo-600 transition\" data-testid=\"link-features\">Features</a>\n              <a href=\"#access\" className=\"text-gray-700 dark:text-gray-300 hover:text-indigo-600 transition\" data-testid=\"link-access\">Access</a>\n              <a href=\"#about\" className=\"text-gray-700 dark:text-gray-300 hover:text-indigo-600 transition\" data-testid=\"link-about\">About</a>\n              <a href=\"#contact\" className=\"text-gray-700 dark:text-gray-300 hover:text-indigo-600 transition\" data-testid=\"link-contact\">Contact</a>\n            </div>\n\n            {/* Desktop Auth Buttons */}\n            <div className=\"hidden md:flex items-center space-x-4\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-login-dropdown\">\n                    Login <ChevronDown className=\"h-4 w-4\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\">\n                  <Link href=\"/login/admin\">\n                    <DropdownMenuItem className=\"cursor-pointer\" data-testid=\"link-company-login\">\n                      Company Admin\n                    </DropdownMenuItem>\n                  </Link>\n                  <Link href=\"/login/user\">\n                    <DropdownMenuItem className=\"cursor-pointer\" data-testid=\"link-user-login\">\n                      Company User\n                    </DropdownMenuItem>\n                  </Link>\n                </DropdownMenuContent>\n              </DropdownMenu>\n              <Button asChild className=\"bg-indigo-600 hover:bg-indigo-700\" data-testid=\"button-register\">\n                <Link href=\"/register\">\n                  Register Company\n                </Link>\n              </Button>\n            </div>\n\n            {/* Mobile Menu Button */}\n            <button\n              className=\"md:hidden p-2\"\n              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n              data-testid=\"button-mobile-menu\"\n            >\n              {mobileMenuOpen ? <X className=\"h-6 w-6\" /> : <Menu className=\"h-6 w-6\" />}\n            </button>\n          </div>\n\n          {/* Mobile Menu */}\n          {mobileMenuOpen && (\n            <div className=\"md:hidden py-4 space-y-4\" data-testid=\"mobile-menu\">\n              <a href=\"#home\" onClick={() => setMobileMenuOpen(false)} className=\"block text-gray-700 dark:text-gray-300 hover:text-indigo-600\" data-testid=\"link-mobile-home\">Home</a>\n              <a href=\"#features\" onClick={() => setMobileMenuOpen(false)} className=\"block text-gray-700 dark:text-gray-300 hover:text-indigo-600\" data-testid=\"link-mobile-features\">Features</a>\n              <a href=\"#access\" onClick={() => setMobileMenuOpen(false)} className=\"block text-gray-700 dark:text-gray-300 hover:text-indigo-600\" data-testid=\"link-mobile-access\">Access</a>\n              <a href=\"#about\" onClick={() => setMobileMenuOpen(false)} className=\"block text-gray-700 dark:text-gray-300 hover:text-indigo-600\" data-testid=\"link-mobile-about\">About</a>\n              <a href=\"#contact\" onClick={() => setMobileMenuOpen(false)} className=\"block text-gray-700 dark:text-gray-300 hover:text-indigo-600\" data-testid=\"link-mobile-contact\">Contact</a>\n              <div className=\"flex flex-col space-y-2 pt-4 border-t\">\n                <Button asChild variant=\"outline\" className=\"w-full\" data-testid=\"button-mobile-company-login\">\n                  <Link href=\"/login/admin\">Company Admin Login</Link>\n                </Button>\n                <Button asChild variant=\"outline\" className=\"w-full\" data-testid=\"button-mobile-user-login\">\n                  <Link href=\"/login/user\">Company User Login</Link>\n                </Button>\n                <Button asChild className=\"w-full bg-indigo-600 hover:bg-indigo-700\" data-testid=\"button-mobile-register\">\n                  <Link href=\"/register\">Register Company</Link>\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section id=\"home\" className=\"relative overflow-hidden bg-gradient-to-br from-indigo-600 via-indigo-700 to-cyan-500 text-white\" data-testid=\"section-hero\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24 md:py-32\">\n          <div className=\"grid md:grid-cols-2 gap-12 items-center\">\n            {/* Left Side */}\n            <div className=\"space-y-8\" data-testid=\"hero-content\">\n              <h1 className=\"text-4xl md:text-6xl font-bold leading-tight\" data-testid=\"text-hero-title\">\n                Manage Multiple Companies with One Central System\n              </h1>\n              <p className=\"text-xl md:text-2xl text-indigo-100\" data-testid=\"text-hero-subtitle\">\n                WorkLogix helps businesses manage teams, slots, and activities in a secure, unified dashboard.\n              </p>\n              <div className=\"flex flex-col sm:flex-row gap-4\">\n                <Button asChild size=\"lg\" className=\"bg-white text-indigo-600 hover:bg-gray-100 text-lg px-8\" data-testid=\"button-hero-register\">\n                  <Link href=\"/register\">\n                    🚀 Register Your Company\n                  </Link>\n                </Button>\n                <Button asChild size=\"lg\" variant=\"outline\" className=\"border-white text-white hover:bg-white/10 text-lg px-8\" data-testid=\"button-hero-login\">\n                  <Link href=\"/login/admin\">\n                    🔐 Company Login\n                  </Link>\n                </Button>\n              </div>\n            </div>\n\n            {/* Right Side - Dashboard Preview */}\n            <div className=\"hidden md:block\" data-testid=\"hero-image\">\n              <div className=\"bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl border border-white/20\">\n                <div className=\"space-y-4\">\n                  <div className=\"h-8 bg-white/20 rounded w-3/4\"></div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"h-24 bg-white/20 rounded\"></div>\n                    <div className=\"h-24 bg-white/20 rounded\"></div>\n                  </div>\n                  <div className=\"h-32 bg-white/20 rounded\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Wave Divider */}\n        <div className=\"absolute bottom-0 left-0 right-0\">\n          <svg viewBox=\"0 0 1440 120\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M0 120L60 110C120 100 240 80 360 70C480 60 600 60 720 65C840 70 960 80 1080 85C1200 90 1320 90 1380 90L1440 90V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z\" fill=\"currentColor\" className=\"text-background\"/>\n          </svg>\n        </div>\n      </section>\n\n      {/* About Section */}\n      <section id=\"about\" className=\"py-20 bg-background\" data-testid=\"section-about\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center max-w-3xl mx-auto space-y-6\">\n            <h2 className=\"text-4xl font-bold text-gray-900 dark:text-white\" data-testid=\"text-about-title\">\n              What is WorkLogix?\n            </h2>\n            <p className=\"text-xl text-gray-600 dark:text-gray-300 leading-relaxed\" data-testid=\"text-about-description\">\n              WorkLogix is a powerful multi-company management platform designed to centralize control for Super Admins, \n              streamline operations for Company Admins, and simplify access for Company Users.\n            </p>\n          </div>\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section id=\"features\" className=\"py-20 bg-gray-50 dark:bg-gray-900\" data-testid=\"section-features\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-4xl font-bold text-gray-900 dark:text-white mb-4\" data-testid=\"text-features-title\">\n              Key Features\n            </h2>\n            <p className=\"text-xl text-gray-600 dark:text-gray-300\" data-testid=\"text-features-subtitle\">\n              Everything you need to manage your business efficiently\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {features.map((feature, index) => (\n              <Card key={index} className=\"hover:shadow-lg transition-shadow\" data-testid={`card-feature-${index}`}>\n                <CardHeader>\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"p-3 bg-indigo-100 dark:bg-indigo-900 rounded-lg\">\n                      <feature.icon className=\"h-6 w-6 text-indigo-600 dark:text-indigo-400\" />\n                    </div>\n                    <CardTitle className=\"text-xl\" data-testid={`text-feature-title-${index}`}>{feature.title}</CardTitle>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <CardDescription className=\"text-base\" data-testid={`text-feature-description-${index}`}>\n                    {feature.description}\n                  </CardDescription>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Access Hierarchy Section */}\n      <section id=\"access\" className=\"py-20 bg-background\" data-testid=\"section-access-hierarchy\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-4xl font-bold text-gray-900 dark:text-white mb-4\" data-testid=\"text-access-title\">\n              System Access Structure\n            </h2>\n            <p className=\"text-xl text-gray-600 dark:text-gray-300\" data-testid=\"text-access-subtitle\">\n              Clear hierarchy for organized management\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            <Card className=\"text-center hover:shadow-lg transition-shadow border-2 border-indigo-200 dark:border-indigo-800\" data-testid=\"card-access-super-admin\">\n              <CardHeader>\n                <div className=\"mx-auto p-4 bg-indigo-100 dark:bg-indigo-900 rounded-full w-20 h-20 flex items-center justify-center mb-4\">\n                  <Shield className=\"h-10 w-10 text-indigo-600 dark:text-indigo-400\" />\n                </div>\n                <CardTitle className=\"text-2xl\" data-testid=\"text-access-super-admin-title\">Super Admin</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-gray-600 dark:text-gray-300\" data-testid=\"text-access-super-admin-description\">\n                  Full platform control and oversight of all companies\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"text-center hover:shadow-lg transition-shadow border-2 border-cyan-200 dark:border-cyan-800\" data-testid=\"card-access-company-admin\">\n              <CardHeader>\n                <div className=\"mx-auto p-4 bg-cyan-100 dark:bg-cyan-900 rounded-full w-20 h-20 flex items-center justify-center mb-4\">\n                  <Building2 className=\"h-10 w-10 text-cyan-600 dark:text-cyan-400\" />\n                </div>\n                <CardTitle className=\"text-2xl\" data-testid=\"text-access-company-admin-title\">Company Admin</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-gray-600 dark:text-gray-300\" data-testid=\"text-access-company-admin-description\">\n                  Manages own company and users\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"text-center hover:shadow-lg transition-shadow border-2 border-emerald-200 dark:border-emerald-800\" data-testid=\"card-access-company-user\">\n              <CardHeader>\n                <div className=\"mx-auto p-4 bg-emerald-100 dark:bg-emerald-900 rounded-full w-20 h-20 flex items-center justify-center mb-4\">\n                  <Users className=\"h-10 w-10 text-emerald-600 dark:text-emerald-400\" />\n                </div>\n                <CardTitle className=\"text-2xl\" data-testid=\"text-access-company-user-title\">Company User</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-gray-600 dark:text-gray-300\" data-testid=\"text-access-company-user-description\">\n                  Access own profile and reports\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Quick Access Section */}\n      <section className=\"py-20 bg-gray-50 dark:bg-gray-900\" data-testid=\"section-quick-access\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-4xl font-bold text-gray-900 dark:text-white mb-4\" data-testid=\"text-quick-access-title\">\n              Quick Access Portals\n            </h2>\n            <p className=\"text-xl text-gray-600 dark:text-gray-300\" data-testid=\"text-quick-access-subtitle\">\n              Choose your portal to get started\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            <Link href=\"/superadmin\">\n              <Card className=\"cursor-pointer hover:shadow-xl transition-all hover:-translate-y-1 group\" data-testid=\"card-quick-access-super-admin\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-3\">\n                      <Shield className=\"h-8 w-8 text-indigo-600\" />\n                      <CardTitle className=\"text-xl\" data-testid=\"text-quick-access-super-admin\">Super Admin</CardTitle>\n                    </div>\n                    <ArrowRight className=\"h-5 w-5 text-gray-400 group-hover:text-indigo-600 group-hover:translate-x-1 transition-all\" />\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-gray-600 dark:text-gray-300\" data-testid=\"text-quick-access-super-admin-desc\">\n                    Platform-wide management and control\n                  </p>\n                </CardContent>\n              </Card>\n            </Link>\n\n            <Link href=\"/login/admin\">\n              <Card className=\"cursor-pointer hover:shadow-xl transition-all hover:-translate-y-1 group\" data-testid=\"card-quick-access-company-admin\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-3\">\n                      <Building2 className=\"h-8 w-8 text-cyan-600\" />\n                      <CardTitle className=\"text-xl\" data-testid=\"text-quick-access-company-admin\">Company Admin</CardTitle>\n                    </div>\n                    <ArrowRight className=\"h-5 w-5 text-gray-400 group-hover:text-cyan-600 group-hover:translate-x-1 transition-all\" />\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-gray-600 dark:text-gray-300\" data-testid=\"text-quick-access-company-admin-desc\">\n                    Manage your company and team members\n                  </p>\n                </CardContent>\n              </Card>\n            </Link>\n\n            <Link href=\"/login/user\">\n              <Card className=\"cursor-pointer hover:shadow-xl transition-all hover:-translate-y-1 group\" data-testid=\"card-quick-access-company-user\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-3\">\n                      <Users className=\"h-8 w-8 text-emerald-600\" />\n                      <CardTitle className=\"text-xl\" data-testid=\"text-quick-access-company-user\">Company User</CardTitle>\n                    </div>\n                    <ArrowRight className=\"h-5 w-5 text-gray-400 group-hover:text-emerald-600 group-hover:translate-x-1 transition-all\" />\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-gray-600 dark:text-gray-300\" data-testid=\"text-quick-access-company-user-desc\">\n                    Access your personal dashboard\n                  </p>\n                </CardContent>\n              </Card>\n            </Link>\n          </div>\n        </div>\n      </section>\n\n      {/* Stats Section */}\n      <section className=\"py-20 bg-indigo-600 text-white\" data-testid=\"section-stats\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid md:grid-cols-3 gap-12 text-center\">\n            {stats.map((stat, index) => (\n              <div key={index} className=\"space-y-2\" data-testid={`stat-${index}`}>\n                <div className=\"text-5xl md:text-6xl font-bold\" data-testid={`stat-number-${index}`}>{stat.number}</div>\n                <div className=\"text-xl text-indigo-100\" data-testid={`stat-label-${index}`}>{stat.label}</div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Contact Section */}\n      <section id=\"contact\" className=\"py-20 bg-background\" data-testid=\"section-contact\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-4xl font-bold text-gray-900 dark:text-white mb-4\" data-testid=\"text-contact-title\">\n              Get in Touch\n            </h2>\n            <p className=\"text-xl text-gray-600 dark:text-gray-300\" data-testid=\"text-contact-subtitle\">\n              Have questions? We're here to help!\n            </p>\n          </div>\n\n          <div className=\"max-w-2xl mx-auto space-y-6\">\n            <Card data-testid=\"card-contact-email\">\n              <CardContent className=\"flex items-center space-x-4 p-6\">\n                <div className=\"p-3 bg-indigo-100 dark:bg-indigo-900 rounded-lg\">\n                  <Mail className=\"h-6 w-6 text-indigo-600 dark:text-indigo-400\" />\n                </div>\n                <div>\n                  <p className=\"font-semibold text-gray-900 dark:text-white\">Email</p>\n                  <a href=\"mailto:support@worklogix.com\" className=\"text-indigo-600 hover:underline\" data-testid=\"link-email\">\n                    support@worklogix.com\n                  </a>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-contact-phone\">\n              <CardContent className=\"flex items-center space-x-4 p-6\">\n                <div className=\"p-3 bg-cyan-100 dark:bg-cyan-900 rounded-lg\">\n                  <Phone className=\"h-6 w-6 text-cyan-600 dark:text-cyan-400\" />\n                </div>\n                <div>\n                  <p className=\"font-semibold text-gray-900 dark:text-white\">Phone</p>\n                  <a href=\"tel:+918825620014\" className=\"text-cyan-600 hover:underline\" data-testid=\"link-phone\">\n                    +91 88256 20014\n                  </a>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"bg-gray-900 text-white py-12\" data-testid=\"footer\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid md:grid-cols-4 gap-8 mb-8\">\n            <div>\n              <div className=\"flex items-center space-x-2 mb-4\">\n                <Building2 className=\"h-6 w-6 text-indigo-400\" />\n                <span className=\"text-xl font-bold\">WorkLogix</span>\n              </div>\n              <p className=\"text-gray-400\" data-testid=\"text-footer-tagline\">\n                Multi-company management made simple\n              </p>\n            </div>\n\n            <div>\n              <h3 className=\"font-semibold mb-4\" data-testid=\"text-footer-quick-links\">Quick Links</h3>\n              <ul className=\"space-y-2\">\n                <li><a href=\"#home\" className=\"text-gray-400 hover:text-white transition\" data-testid=\"link-footer-home\">Home</a></li>\n                <li><a href=\"#about\" className=\"text-gray-400 hover:text-white transition\" data-testid=\"link-footer-about\">About</a></li>\n                <li><a href=\"#features\" className=\"text-gray-400 hover:text-white transition\" data-testid=\"link-footer-features\">Features</a></li>\n                <li><a href=\"#contact\" className=\"text-gray-400 hover:text-white transition\" data-testid=\"link-footer-contact\">Contact</a></li>\n              </ul>\n            </div>\n\n            <div>\n              <h3 className=\"font-semibold mb-4\" data-testid=\"text-footer-access\">Access</h3>\n              <ul className=\"space-y-2\">\n                <li><Link href=\"/login/admin\" className=\"text-gray-400 hover:text-white transition\" data-testid=\"link-footer-company-login\">Company Login</Link></li>\n                <li><Link href=\"/login/user\" className=\"text-gray-400 hover:text-white transition\" data-testid=\"link-footer-user-login\">User Login</Link></li>\n                <li><Link href=\"/register\" className=\"text-gray-400 hover:text-white transition\" data-testid=\"link-footer-register\">Register</Link></li>\n              </ul>\n            </div>\n\n            <div>\n              <h3 className=\"font-semibold mb-4\" data-testid=\"text-footer-contact\">Contact</h3>\n              <ul className=\"space-y-2 text-gray-400\">\n                <li data-testid=\"text-footer-email\">support@worklogix.com</li>\n                <li data-testid=\"text-footer-phone\">+91 88256 20014</li>\n              </ul>\n            </div>\n          </div>\n\n          <div className=\"border-t border-gray-800 pt-8 text-center text-gray-400\">\n            <p data-testid=\"text-footer-copyright\">&copy; 2025 WorkLogix. All rights reserved.</p>\n          </div>\n        </div>\n      </footer>\n\n      <Dialog open={showSuccessDialog} onOpenChange={setShowSuccessDialog}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <div className=\"mx-auto w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mb-4\">\n              <CheckCircle2 className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n            </div>\n            <DialogTitle className=\"text-center text-2xl\">Registration Successful!</DialogTitle>\n            <DialogDescription className=\"text-center\">\n              Your company has been registered successfully with Google\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg p-6 text-center\">\n              <p className=\"text-white text-sm mb-2 opacity-90\">Your Company Server ID</p>\n              <p className=\"text-white text-3xl font-bold tracking-wider\" data-testid=\"text-server-id\">\n                {successInfo?.serverId}\n              </p>\n            </div>\n            \n            <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 p-4 rounded\">\n              <div className=\"flex items-start gap-2\">\n                <AlertCircle className=\"h-5 w-5 text-yellow-600 dark:text-yellow-500 flex-shrink-0 mt-0.5\" />\n                <div className=\"text-sm\">\n                  <p className=\"font-semibold text-yellow-800 dark:text-yellow-500 mb-1\">Important!</p>\n                  <p className=\"text-yellow-700 dark:text-yellow-400\">\n                    Please save your Company Server ID. You will need it to log in along with your email.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 p-4 rounded\">\n              <div className=\"flex items-start gap-2\">\n                <Mail className=\"h-5 w-5 text-blue-600 dark:text-blue-500 flex-shrink-0 mt-0.5\" />\n                <div className=\"text-sm\">\n                  <p className=\"font-semibold text-blue-800 dark:text-blue-500 mb-1\">Check Your Email</p>\n                  <p className=\"text-blue-700 dark:text-blue-400\">\n                    We've sent your Server ID to <strong>{successInfo?.email}</strong> for your records.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <Button \n              onClick={() => {\n                setShowSuccessDialog(false);\n                setLocation(\"/login/admin\");\n              }}\n              className=\"w-full bg-indigo-600 hover:bg-indigo-700\"\n              data-testid=\"button-go-to-login\"\n            >\n              Go to Login\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":29319,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/pages/team-leader/TeamLeaderLeaveRequests.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n    Form,\n    FormControl,\n    FormField,\n    FormItem,\n    FormLabel,\n    FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Plus, Calendar, Clock } from \"lucide-react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport type { Leave } from \"@shared/schema\";\n\nconst leaveFormSchema = z.object({\n    startDate: z.string().min(1, \"Start date is required\"),\n    endDate: z.string().min(1, \"End date is required\"),\n    leaveType: z.string().min(1, \"Leave type is required\"),\n    reason: z.string().min(10, \"Reason must be at least 10 characters\"),\n});\n\ntype LeaveFormData = z.infer<typeof leaveFormSchema>;\n\nexport default function TeamLeaderLeaveRequests() {\n    const { toast } = useToast();\n    const [dialogOpen, setDialogOpen] = useState(false);\n\n    const { data: leaves = [], isLoading } = useQuery<Leave[]>({\n        queryKey: [\"/api/leaves/me\"],\n    });\n\n    const form = useForm<LeaveFormData>({\n        resolver: zodResolver(leaveFormSchema),\n        defaultValues: {\n            startDate: \"\",\n            endDate: \"\",\n            leaveType: \"casual\",\n            reason: \"\",\n        },\n    });\n\n    const createLeaveMutation = useMutation({\n        mutationFn: async (data: LeaveFormData) => {\n            return await apiRequest(`${API_BASE_URL}/api/leaves`, \"POST\", data);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/leaves/me\"],\n            });\n            toast({\n                title: \"Leave request submitted\",\n                description:\n                    \"Your leave request has been submitted for approval.\",\n            });\n            form.reset();\n            setDialogOpen(false);\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description:\n                    \"Failed to submit leave request. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const onSubmit = (data: LeaveFormData) => {\n        if (new Date(data.endDate) < new Date(data.startDate)) {\n            toast({\n                title: \"Invalid dates\",\n                description: \"End date cannot be before start date.\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n        createLeaveMutation.mutate(data);\n    };\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case \"approved\":\n                return \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\";\n            case \"rejected\":\n                return \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\";\n            default:\n                return \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\";\n        }\n    };\n\n    return (\n        <div className=\"container mx-auto p-6 space-y-6\">\n            <div className=\"flex flex-wrap justify-between items-center gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\">My Leave Requests</h1>\n                    <p className=\"text-muted-foreground mt-1\">\n                        Request and manage your leaves\n                    </p>\n                </div>\n                <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n                    <DialogTrigger asChild>\n                        <Button data-testid=\"button-request-leave\">\n                            <Plus className=\"h-4 w-4 mr-2\" />\n                            Request Leave\n                        </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>Request Leave</DialogTitle>\n                        </DialogHeader>\n                        <Form {...form}>\n                            <form\n                                onSubmit={form.handleSubmit(onSubmit)}\n                                className=\"space-y-4\">\n                                <FormField\n                                    control={form.control}\n                                    name=\"startDate\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Start Date</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    type=\"date\"\n                                                    data-testid=\"input-start-date\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <FormField\n                                    control={form.control}\n                                    name=\"endDate\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>End Date</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    type=\"date\"\n                                                    data-testid=\"input-end-date\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <FormField\n                                    control={form.control}\n                                    name=\"leaveType\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Leave Type</FormLabel>\n                                            <Select\n                                                onValueChange={field.onChange}\n                                                defaultValue={field.value}>\n                                                <FormControl>\n                                                    <SelectTrigger data-testid=\"select-leave-type\">\n                                                        <SelectValue placeholder=\"Select leave type\" />\n                                                    </SelectTrigger>\n                                                </FormControl>\n                                                <SelectContent>\n                                                    <SelectItem value=\"casual\">\n                                                        Casual Leave\n                                                    </SelectItem>\n                                                    <SelectItem value=\"sick\">\n                                                        Sick Leave\n                                                    </SelectItem>\n                                                    <SelectItem value=\"annual\">\n                                                        Annual Leave\n                                                    </SelectItem>\n                                                    <SelectItem value=\"emergency\">\n                                                        Emergency Leave\n                                                    </SelectItem>\n                                                </SelectContent>\n                                            </Select>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <FormField\n                                    control={form.control}\n                                    name=\"reason\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Reason</FormLabel>\n                                            <FormControl>\n                                                <Textarea\n                                                    data-testid=\"input-reason\"\n                                                    placeholder=\"Please provide a reason for your leave request...\"\n                                                    className=\"min-h-[100px]\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <div className=\"flex flex-wrap justify-end gap-2\">\n                                    <Button\n                                        type=\"button\"\n                                        variant=\"outline\"\n                                        onClick={() => setDialogOpen(false)}\n                                        data-testid=\"button-cancel\">\n                                        Cancel\n                                    </Button>\n                                    <Button\n                                        type=\"submit\"\n                                        disabled={createLeaveMutation.isPending}\n                                        data-testid=\"button-submit-leave\">\n                                        {createLeaveMutation.isPending\n                                            ? \"Submitting...\"\n                                            : \"Submit Request\"}\n                                    </Button>\n                                </div>\n                            </form>\n                        </Form>\n                    </DialogContent>\n                </Dialog>\n            </div>\n\n            <div className=\"grid gap-4\">\n                {isLoading && (\n                    <Card className=\"p-6\">\n                        <p className=\"text-center text-muted-foreground\">\n                            Loading...\n                        </p>\n                    </Card>\n                )}\n\n                {!isLoading && leaves.length === 0 && (\n                    <Card className=\"p-6\">\n                        <p\n                            className=\"text-center text-muted-foreground\"\n                            data-testid=\"text-no-leaves\">\n                            No leave requests yet. Click \"Request Leave\" to\n                            submit your first request.\n                        </p>\n                    </Card>\n                )}\n\n                {leaves.map((leave: any) => (\n                    <Card\n                        key={leave.id}\n                        className=\"p-6\"\n                        data-testid={`card-leave-${leave.id}`}>\n                        <div className=\"flex flex-wrap justify-between items-start gap-4\">\n                            <div className=\"space-y-2 flex-1\">\n                                <div className=\"flex flex-wrap items-center gap-3\">\n                                    <h3\n                                        className=\"font-semibold text-lg capitalize\"\n                                        data-testid={`text-leave-type-${leave.id}`}>\n                                        {leave.leaveType} Leave\n                                    </h3>\n                                    <span\n                                        className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(\n                                            leave.status\n                                        )}`}\n                                        data-testid={`status-leave-${leave.id}`}>\n                                        {leave.status.toUpperCase()}\n                                    </span>\n                                </div>\n                                <div className=\"flex flex-wrap items-center gap-4 text-sm text-muted-foreground\">\n                                    <div className=\"flex items-center gap-1\">\n                                        <Calendar className=\"h-4 w-4\" />\n                                        <span\n                                            data-testid={`text-dates-${leave.id}`}>\n                                            {new Date(\n                                                leave.startDate\n                                            ).toLocaleDateString()}{\" \"}\n                                            -{\" \"}\n                                            {new Date(\n                                                leave.endDate\n                                            ).toLocaleDateString()}\n                                        </span>\n                                    </div>\n                                    <div className=\"flex items-center gap-1\">\n                                        <Clock className=\"h-4 w-4\" />\n                                        <span\n                                            data-testid={`text-applied-${leave.id}`}>\n                                            Applied:{\" \"}\n                                            {new Date(\n                                                leave.appliedDate\n                                            ).toLocaleDateString()}\n                                        </span>\n                                    </div>\n                                </div>\n                                <p\n                                    className=\"text-sm\"\n                                    data-testid={`text-reason-${leave.id}`}>\n                                    <span className=\"font-medium\">Reason:</span>{\" \"}\n                                    {leave.reason}\n                                </p>\n                            </div>\n                        </div>\n                    </Card>\n                ))}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":15139,"size_tokens":null},"client/src/components/ui/password-strength-meter.tsx":{"content":"import { calculatePasswordStrength } from \"@/lib/passwordUtils\";\n\ninterface PasswordStrengthMeterProps {\n  password: string;\n}\n\nexport function PasswordStrengthMeter({ password }: PasswordStrengthMeterProps) {\n  if (!password) return null;\n\n  const { strength, score, color, feedback } = calculatePasswordStrength(password);\n\n  return (\n    <div className=\"mt-2 space-y-2\" data-testid=\"password-strength-meter\">\n      <div className=\"flex items-center gap-2\">\n        <div className=\"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n          <div\n            className={`h-full transition-all duration-300 ${color}`}\n            style={{ width: `${score}%` }}\n            data-testid=\"password-strength-bar\"\n          />\n        </div>\n        <span\n          className={`text-xs font-medium capitalize ${\n            strength === 'weak'\n              ? 'text-red-500'\n              : strength === 'medium'\n              ? 'text-orange-500'\n              : 'text-green-500'\n          }`}\n          data-testid=\"password-strength-label\"\n        >\n          {strength}\n        </span>\n      </div>\n      <p className=\"text-xs text-muted-foreground\" data-testid=\"password-feedback\">\n        {feedback}\n      </p>\n    </div>\n  );\n}\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/pages/team-leader/TeamLeaveApproval.tsx":{"content":"import {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Check, X, Calendar, User } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useState, useCallback } from \"react\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\n\ninterface Leave {\n    id: number;\n    userId: number;\n    leaveType: string;\n    startDate: string;\n    endDate: string;\n    reason: string;\n    status: string;\n    companyId: number;\n    displayName?: string;\n}\n\ninterface TeamMember {\n    id: number;\n    displayName: string;\n}\n\nexport default function TeamLeaveApproval() {\n    const { dbUserId, companyId } = useAuth();\n    const { toast } = useToast();\n    const [statusFilter, setStatusFilter] = useState<string>(\"pending\");\n\n    const handleWebSocketMessage = useCallback(\n        (data: any) => {\n            if (\n                data.type === \"LEAVE_STATUS_UPDATE\" &&\n                data.data.companyId === companyId\n            ) {\n                queryClient.invalidateQueries({\n                    queryKey: [`/api/leaves/company/${companyId}`],\n                });\n                const actionBy =\n                    data.data.changedBy ||\n                    data.data.approvedBy ||\n                    data.data.rejectedBy;\n                toast({\n                    title: \"Leave Status Updated\",\n                    description: `${data.data.userName}'s leave status changed to ${data.data.status} by ${actionBy}`,\n                });\n            }\n        },\n        [toast, companyId]\n    );\n\n    useWebSocket(handleWebSocketMessage);\n\n    const { data: teamMembers = [] } = useQuery<TeamMember[]>({\n        queryKey: [`/api/team-assignments/${dbUserId}/members`],\n        enabled: !!dbUserId,\n    });\n\n    const { data: allLeaves = [], isLoading } = useQuery<Leave[]>({\n        queryKey: [`/api/leaves/company/${companyId}`],\n        enabled: !!companyId,\n    });\n\n    const teamMemberIds = teamMembers.map((m) => m.id);\n    const teamLeaves = allLeaves.filter((leave) =>\n        teamMemberIds.includes(leave.userId)\n    );\n    const filteredLeaves =\n        statusFilter === \"all\"\n            ? teamLeaves\n            : teamLeaves.filter((leave) => leave.status === statusFilter);\n\n    const approveLeave = useMutation({\n        mutationFn: async (leaveId: number) => {\n            return apiRequest(\n                `${API_BASE_URL}/api/leaves/${leaveId}/approve`,\n                \"PATCH\"\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [`/api/leaves/company/${companyId}`],\n            });\n            toast({ title: \"Success\", description: \"Leave request approved\" });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to approve leave\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const rejectLeave = useMutation({\n        mutationFn: async (leaveId: number) => {\n            return apiRequest(\n                `${API_BASE_URL}/api/leaves/${leaveId}/reject`,\n                \"PATCH\"\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [`/api/leaves/company/${companyId}`],\n            });\n            toast({ title: \"Success\", description: \"Leave request rejected\" });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to reject leave\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const calculateDays = (startDate: string, endDate: string) => {\n        const start = new Date(startDate);\n        const end = new Date(endDate);\n        const diffTime = Math.abs(end.getTime() - start.getTime());\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;\n        return diffDays;\n    };\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case \"approved\":\n                return \"default\";\n            case \"rejected\":\n                return \"destructive\";\n            case \"pending\":\n                return \"secondary\";\n            default:\n                return \"secondary\";\n        }\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                    <div>\n                        <Skeleton className=\"h-10 w-48 mb-2\" />\n                        <Skeleton className=\"h-5 w-72\" />\n                    </div>\n                </div>\n                <div className=\"space-y-4\">\n                    {[...Array(2)].map((_, i) => (\n                        <Skeleton key={i} className=\"h-48 w-full\" />\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\">Leave Approval</h1>\n                    <p className=\"text-muted-foreground\">\n                        Review and approve team leave requests\n                    </p>\n                </div>\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                    <SelectTrigger\n                        className=\"w-40\"\n                        data-testid=\"select-status-filter\">\n                        <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"all\">All</SelectItem>\n                        <SelectItem value=\"pending\">Pending</SelectItem>\n                        <SelectItem value=\"approved\">Approved</SelectItem>\n                        <SelectItem value=\"rejected\">Rejected</SelectItem>\n                    </SelectContent>\n                </Select>\n            </div>\n\n            <div className=\"grid gap-4\">\n                {filteredLeaves.map((request) => {\n                    const member = teamMembers.find(\n                        (m) => m.id === request.userId\n                    );\n                    const days = calculateDays(\n                        request.startDate,\n                        request.endDate\n                    );\n\n                    return (\n                        <Card\n                            key={request.id}\n                            data-testid={`card-leave-${request.id}`}>\n                            <CardHeader>\n                                <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                                    <div className=\"flex-1 min-w-0\">\n                                        <CardTitle className=\"text-lg flex items-center gap-2\">\n                                            <User className=\"h-5 w-5\" />\n                                            {member?.displayName ||\n                                                \"Unknown Employee\"}\n                                        </CardTitle>\n                                        <CardDescription className=\"mt-2\">\n                                            <div className=\"space-y-1\">\n                                                <div className=\"flex items-center gap-2\">\n                                                    <Calendar className=\"h-4 w-4\" />\n                                                    <span>\n                                                        {new Date(\n                                                            request.startDate\n                                                        ).toLocaleDateString()}{\" \"}\n                                                        -{\" \"}\n                                                        {new Date(\n                                                            request.endDate\n                                                        ).toLocaleDateString()}\n                                                    </span>\n                                                    <span className=\"text-muted-foreground\">\n                                                        ({days} days)\n                                                    </span>\n                                                </div>\n                                                <div>\n                                                    <span className=\"font-medium\">\n                                                        Type:\n                                                    </span>{\" \"}\n                                                    {request.leaveType}\n                                                </div>\n                                            </div>\n                                        </CardDescription>\n                                    </div>\n                                    <Badge\n                                        variant={getStatusColor(\n                                            request.status\n                                        )}>\n                                        {request.status}\n                                    </Badge>\n                                </div>\n                            </CardHeader>\n                            <CardContent className=\"space-y-4\">\n                                <div>\n                                    <p className=\"text-sm font-medium mb-1\">\n                                        Reason:\n                                    </p>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                        {request.reason}\n                                    </p>\n                                </div>\n                                {request.status === \"pending\" && (\n                                    <div className=\"flex gap-2\">\n                                        <Button\n                                            variant=\"default\"\n                                            size=\"sm\"\n                                            onClick={() =>\n                                                approveLeave.mutate(request.id)\n                                            }\n                                            disabled={\n                                                approveLeave.isPending ||\n                                                rejectLeave.isPending\n                                            }\n                                            data-testid={`button-approve-${request.id}`}>\n                                            <Check className=\"h-4 w-4 mr-2\" />\n                                            Approve\n                                        </Button>\n                                        <Button\n                                            variant=\"destructive\"\n                                            size=\"sm\"\n                                            onClick={() =>\n                                                rejectLeave.mutate(request.id)\n                                            }\n                                            disabled={\n                                                approveLeave.isPending ||\n                                                rejectLeave.isPending\n                                            }\n                                            data-testid={`button-reject-${request.id}`}>\n                                            <X className=\"h-4 w-4 mr-2\" />\n                                            Reject\n                                        </Button>\n                                    </div>\n                                )}\n                            </CardContent>\n                        </Card>\n                    );\n                })}\n            </div>\n\n            {filteredLeaves.length === 0 && (\n                <Card>\n                    <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                        <p className=\"text-muted-foreground\">\n                            No {statusFilter !== \"all\" && statusFilter} leave\n                            requests found\n                        </p>\n                    </CardContent>\n                </Card>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":12865,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n// API base URL - uses environment variable for external server, otherwise relative path\n\nexport const API_BASE_URL =\n    import.meta.env.VITE_API_URL?.replace(/\\/$/, \"\") || \"\";\n\nexport function getApiUrl(path: string): string {\n    if (path.startsWith(\"http\")) return path;\n    return `${API_BASE_URL}${path}`;\n}\n\nasync function throwIfResNotOk(res: Response) {\n    if (!res.ok) {\n        const text = (await res.text()) || res.statusText;\n\n        if (res.status === 401) {\n            try {\n                const errorData = JSON.parse(text);\n                if (errorData.code === \"USER_INACTIVE\") {\n                    localStorage.clear();\n                    window.location.href = \"/worklogix/\";\n                    throw new Error(\n                        \"Your account has been disabled. You have been logged out.\"\n                    );\n                }\n            } catch (parseError) {}\n        }\n\n        throw new Error(`${res.status}: ${text}`);\n    }\n}\n\nexport async function apiRequest(\n    url: string,\n    method: string,\n    data?: unknown | undefined\n): Promise<Response> {\n    const user = localStorage.getItem(\"user\");\n    const userId = user ? JSON.parse(user).id : null;\n\n    const headers: Record<string, string> = {};\n    if (data) {\n        headers[\"Content-Type\"] = \"application/json\";\n    }\n    if (userId) {\n        headers[\"x-user-id\"] = userId.toString();\n    }\n\n    const res = await fetch(getApiUrl(url), {\n        method,\n        headers,\n        body: data ? JSON.stringify(data) : undefined,\n        credentials: \"include\",\n    });\n\n    await throwIfResNotOk(res);\n    return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n    on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n    ({ on401: unauthorizedBehavior }) =>\n    async ({ queryKey }) => {\n        const user = localStorage.getItem(\"user\");\n        const userId = user ? JSON.parse(user).id : null;\n\n        const headers: Record<string, string> = {};\n        if (userId) {\n            headers[\"x-user-id\"] = userId.toString();\n        }\n\n        const url = getApiUrl(queryKey.join(\"/\") as string);\n        const res = await fetch(url, {\n            credentials: \"include\",\n            headers,\n        });\n\n        if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n            return null;\n        }\n\n        await throwIfResNotOk(res);\n        return await res.json();\n    };\n\nexport const queryClient = new QueryClient({\n    defaultOptions: {\n        queries: {\n            queryFn: getQueryFn({ on401: \"throw\" }),\n            refetchInterval: false,\n            refetchOnWindowFocus: false,\n            staleTime: Infinity,\n            retry: false,\n        },\n        mutations: {\n            retry: false,\n        },\n    },\n});\n","path":null,"size_bytes":2877,"size_tokens":null},"server/lib/firebase-admin.ts":{"content":"import * as admin from 'firebase-admin';\n\nconst serviceAccountKey = process.env.FIREBASE_SERVICE_ACCOUNT_KEY;\n\nif (!serviceAccountKey) {\n  console.warn('Firebase Admin SDK not initialized: FIREBASE_SERVICE_ACCOUNT_KEY environment variable not set');\n}\n\nlet firebaseApp: admin.app.App | null = null;\n\nfunction initializeFirebaseAdmin() {\n  if (firebaseApp) {\n    return firebaseApp;\n  }\n\n  if (!serviceAccountKey) {\n    return null;\n  }\n\n  try {\n    const serviceAccount = JSON.parse(serviceAccountKey);\n    firebaseApp = admin.initializeApp({\n      credential: admin.credential.cert(serviceAccount),\n    }) as admin.app.App;\n    console.log('Firebase Admin SDK initialized');\n    return firebaseApp;\n  } catch (error) {\n    console.error('Failed to initialize Firebase Admin SDK:', error);\n    return null;\n  }\n}\n\nexport async function sendPushNotification(\n  deviceTokens: string[],\n  title: string,\n  body: string,\n  data?: Record<string, string>\n): Promise<{ successCount: number; failureCount: number }> {\n  const app = initializeFirebaseAdmin();\n  if (!app) {\n    console.warn('Cannot send push notification: Firebase Admin SDK not initialized');\n    return { successCount: 0, failureCount: deviceTokens.length };\n  }\n\n  if (deviceTokens.length === 0) {\n    return { successCount: 0, failureCount: 0 };\n  }\n\n  try {\n    const messaging = admin.messaging(app);\n    \n    const message: admin.messaging.MulticastMessage = {\n      notification: {\n        title,\n        body,\n      },\n      data: data || {},\n      tokens: deviceTokens,\n    };\n\n    const response = await messaging.sendMulticast(message);\n\n    console.log(`Push notification sent: ${response.successCount} succeeded, ${response.failureCount} failed`);\n    \n    return {\n      successCount: response.successCount,\n      failureCount: response.failureCount,\n    };\n  } catch (error) {\n    console.error('Error sending push notification:', error);\n    return { successCount: 0, failureCount: deviceTokens.length };\n  }\n}\n\nexport async function sendPushNotificationToUser(\n  userId: number,\n  title: string,\n  body: string,\n  data?: Record<string, string>,\n  storage?: any\n): Promise<{ successCount: number; failureCount: number }> {\n  if (!storage) {\n    return { successCount: 0, failureCount: 0 };\n  }\n\n  try {\n    const deviceTokens = await storage.getDeviceTokensByUserId(userId);\n    if (deviceTokens.length === 0) {\n      return { successCount: 0, failureCount: 0 };\n    }\n\n    const tokens = deviceTokens.map(dt => dt.token);\n    return await sendPushNotification(tokens, title, body, data);\n  } catch (error) {\n    console.error('Error sending push notification to user:', error);\n    return { successCount: 0, failureCount: 0 };\n  }\n}\n","path":null,"size_bytes":2709,"size_tokens":null},"client/src/pages/user/ReportView.tsx":{"content":"import { useAuth } from \"@/contexts/AuthContext\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { format } from \"date-fns\";\nimport type { Report } from \"@shared/schema\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function ReportView() {\n    const { dbUserId } = useAuth();\n\n    const { data: reports = [], isLoading } = useQuery<Report[]>({\n        queryKey: [\"/api/reports\", dbUserId],\n        queryFn: async () => {\n            const user = localStorage.getItem(\"user\");\n            const userId = user ? JSON.parse(user).id : null;\n            const headers: Record<string, string> = {};\n            if (userId) {\n                headers[\"x-user-id\"] = userId.toString();\n            }\n\n            const res = await fetch(\n                `${API_BASE_URL}/api/reports?userId=${dbUserId}`,\n                { headers, credentials: \"include\" }\n            );\n            if (!res.ok) throw new Error(\"Failed to fetch reports\");\n            return res.json();\n        },\n        enabled: !!dbUserId,\n    });\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold\">View Reports</h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    All submitted reports\n                </p>\n            </div>\n\n            {reports.length > 0 ? (\n                <div className=\"space-y-4\">\n                    {reports.map((report) => (\n                        <Card\n                            key={report.id}\n                            data-testid={`card-report-${report.id}`}>\n                            <CardHeader>\n                                <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2\">\n                                    <CardTitle className=\"text-lg\">\n                                        {report.reportType === \"morning\"\n                                            ? \"Morning\"\n                                            : \"Evening\"}{\" \"}\n                                        Report\n                                    </CardTitle>\n                                    <Badge\n                                        variant=\"outline\"\n                                        className=\"font-mono text-xs w-fit\">\n                                        {format(\n                                            new Date(report.createdAt),\n                                            \"MMM dd, yyyy HH:mm\"\n                                        )}\n                                    </Badge>\n                                </div>\n                            </CardHeader>\n                            <CardContent className=\"space-y-4\">\n                                {report.plannedTasks && (\n                                    <div>\n                                        <h4 className=\"font-semibold text-sm text-muted-foreground mb-2\">\n                                            Planned Tasks:\n                                        </h4>\n                                        <p\n                                            className=\"text-sm whitespace-pre-wrap\"\n                                            data-testid={`text-planned-${report.id}`}>\n                                            {report.plannedTasks}\n                                        </p>\n                                    </div>\n                                )}\n                                {report.completedTasks && (\n                                    <div>\n                                        <h4 className=\"font-semibold text-sm text-muted-foreground mb-2\">\n                                            Completed Tasks:\n                                        </h4>\n                                        <p\n                                            className=\"text-sm whitespace-pre-wrap\"\n                                            data-testid={`text-completed-${report.id}`}>\n                                            {report.completedTasks}\n                                        </p>\n                                    </div>\n                                )}\n                                {report.pendingTasks && (\n                                    <div>\n                                        <h4 className=\"font-semibold text-sm text-muted-foreground mb-2\">\n                                            Pending Tasks:\n                                        </h4>\n                                        <p\n                                            className=\"text-sm whitespace-pre-wrap\"\n                                            data-testid={`text-pending-${report.id}`}>\n                                            {report.pendingTasks}\n                                        </p>\n                                    </div>\n                                )}\n                                {report.notes && (\n                                    <div>\n                                        <h4 className=\"font-semibold text-sm text-muted-foreground mb-2\">\n                                            Notes:\n                                        </h4>\n                                        <p\n                                            className=\"text-sm whitespace-pre-wrap\"\n                                            data-testid={`text-notes-${report.id}`}>\n                                            {report.notes}\n                                        </p>\n                                    </div>\n                                )}\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            ) : (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                    No reports submitted yet\n                </div>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":6283,"size_tokens":null},"client/src/components/examples/UserDashboard.tsx":{"content":"import UserDashboard from '../UserDashboard'\n\nexport default function UserDashboardExample() {\n  return <UserDashboard />\n}\n","path":null,"size_bytes":124,"size_tokens":null},"client/src/components/UserDashboard.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { LogOut, Eye } from \"lucide-react\";\nimport TaskCard from \"./TaskCard\";\nimport MessageCard from \"./MessageCard\";\nimport RatingBadge from \"./RatingBadge\";\nimport TimeBasedForm from \"./TimeBasedForm\";\nimport ThemeToggle from \"./ThemeToggle\";\nimport heroImage from \"@assets/stock_images/professional_team_co_b1c47478.jpg\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\nimport { useCallback, useState } from \"react\";\nimport type { Task, Message, Rating, GroupMessage, Report } from \"@shared/schema\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { format } from \"date-fns\";\n\nexport default function UserDashboard() {\n  const { user, signOut, dbUserId } = useAuth();\n  const [, setLocation] = useLocation();\n  const [viewReportsOpen, setViewReportsOpen] = useState(false);\n  const currentHour = new Date().getHours();\n  const formType = currentHour >= 9 && currentHour < 12 ? \"morning\" : currentHour >= 18 && currentHour < 24 ? \"evening\" : null;\n\n  const handleWebSocketMessage = useCallback((data: any) => {\n    if (data.type === 'USER_DELETED' && data.userId === dbUserId) {\n      signOut();\n      setLocation(\"/\");\n    }\n  }, [dbUserId, signOut, setLocation]);\n\n  useWebSocket(handleWebSocketMessage);\n\n  const { data: tasks = [], isLoading: tasksLoading } = useQuery<Task[]>({\n    queryKey: [`${API_BASE_URL}/api/tasks`, dbUserId],\n    queryFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/tasks?userId=${dbUserId}`);\n      if (!res.ok) throw new Error('Failed to fetch tasks');\n      return res.json();\n    },\n    enabled: !!dbUserId,\n  });\n\n  const { data: messages = [], isLoading: messagesLoading } = useQuery<Message[]>({\n    queryKey: [`${API_BASE_URL}/api/messages`, dbUserId],\n    queryFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/messages?receiverId=${dbUserId}`);\n      if (!res.ok) throw new Error('Failed to fetch messages');\n      return res.json();\n    },\n    enabled: !!dbUserId,\n  });\n\n  const { data: latestRating, isLoading: ratingLoading } = useQuery<Rating | null>({\n    queryKey: [`${API_BASE_URL}/api/ratings`, dbUserId, 'latest'],\n    queryFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/ratings?userId=${dbUserId}&latest=true`);\n      if (!res.ok) throw new Error('Failed to fetch rating');\n      return res.json();\n    },\n    enabled: !!dbUserId,\n  });\n\n  const { data: allRatings = [] } = useQuery<Rating[]>({\n    queryKey: [`${API_BASE_URL}/api/ratings`, dbUserId, 'all'],\n    queryFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/ratings?userId=${dbUserId}`);\n      if (!res.ok) throw new Error('Failed to fetch ratings');\n      return res.json();\n    },\n    enabled: !!dbUserId,\n  });\n\n  const { data: groupMessages = [] } = useQuery<GroupMessage[]>({\n    queryKey: [`${API_BASE_URL}/api/group-messages`],\n    queryFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/group-messages?limit=10`);\n      if (!res.ok) throw new Error('Failed to fetch announcements');\n      return res.json();\n    },\n  });\n\n  const { data: userReports = [], isLoading: reportsLoading } = useQuery<Report[]>({\n    queryKey: [`${API_BASE_URL}/api/reports`, dbUserId],\n    queryFn: async () => {\n      const res = await fetch(`${API_BASE_URL}/api/reports?userId=${dbUserId}`);\n      if (!res.ok) throw new Error('Failed to fetch reports');\n      return res.json();\n    },\n    enabled: !!dbUserId,\n  });\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (messageId: number) => {\n      return await apiRequest(`${API_BASE_URL}/api/messages/${messageId}/read`, 'PATCH', {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/messages`, dbUserId] });\n    },\n  });\n\n  const updateTaskStatusMutation = useMutation({\n    mutationFn: async ({ taskId, status }: { taskId: number; status: string }) => {\n      return await apiRequest(`${API_BASE_URL}/api/tasks/${taskId}/status`, 'PATCH', { status });\n    },\n    onSuccess: async () => {\n      await queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/tasks`, dbUserId] });\n      await queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/tasks`] });\n      await queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/dashboard/stats`] });\n      await queryClient.refetchQueries({ queryKey: [`${API_BASE_URL}/api/dashboard/stats`] });\n    },\n  });\n\n  const handleLogout = async () => {\n    try {\n      await signOut();\n      setLocation(\"/\");\n    } catch (error) {\n      console.error(\"Logout failed:\", error);\n    }\n  };\n\n  const markMessageAsRead = (id: number) => {\n    markAsReadMutation.mutate(id);\n  };\n\n  const userName = user?.displayName || \"User\";\n  const userEmail = user?.email || \"\";\n  const userAvatar = user?.photoURL || \"\";\n  const userInitials = userName.split(' ').map(n => n[0]).join('').toUpperCase();\n\n  const unreadCount = messages.filter(m => !m.readStatus).length;\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"sticky top-0 z-50 bg-card border-b border-card-border shadow-sm\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <h1 className=\"text-2xl font-bold text-foreground\">WorkLogix</h1>\n            <div className=\"flex items-center gap-3\">\n              <ThemeToggle />\n              <div className=\"flex items-center gap-3 pl-3 border-l\">\n                <div className=\"text-right hidden sm:block\">\n                  <p className=\"text-sm font-medium\">{userName}</p>\n                  <p className=\"text-xs text-muted-foreground\">{userEmail}</p>\n                </div>\n                <Avatar data-testid=\"avatar-user\">\n                  <AvatarImage src={userAvatar} />\n                  <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                    {userInitials}\n                  </AvatarFallback>\n                </Avatar>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={handleLogout}\n                  data-testid=\"button-logout\"\n                >\n                  <LogOut className=\"h-5 w-5\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <div className=\"relative h-64 overflow-hidden\">\n        <img\n          src={heroImage}\n          alt=\"Workspace\"\n          className=\"w-full h-full object-cover\"\n        />\n        <div className=\"absolute inset-0 bg-gradient-to-r from-primary/60 to-primary/40 flex items-center justify-center\">\n          <div className=\"text-center text-white\">\n            <h2 className=\"text-4xl font-bold mb-2\">\n              {formType === \"morning\" ? \"Good Morning\" : formType === \"evening\" ? \"Good Evening\" : \"Welcome\"} {userName.split(' ')[0]}!\n            </h2>\n            <p className=\"text-lg opacity-90\">\n              {formType === \"morning\"\n                ? \"Ready to plan your day?\"\n                : formType === \"evening\"\n                ? \"Time to log your progress\"\n                : \"Let's get to work\"}\n            </p>\n            <div className=\"flex items-center justify-center gap-3 mt-4\">\n              <div className=\"bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full flex items-center gap-2\">\n                <span className=\"text-sm font-medium\" data-testid=\"text-ratings-count\">\n                  ⭐ {allRatings.length} {allRatings.length === 1 ? 'Rating' : 'Ratings'} Received\n                </span>\n              </div>\n              {latestRating && (\n                <div className=\"bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full\" data-testid=\"badge-latest-rating\">\n                  <span className=\"text-sm font-medium\">\n                    Latest: {latestRating.rating}\n                  </span>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Left Column - Tasks and Form */}\n          <div className=\"lg:col-span-2 space-y-8\">\n            {/* Time-based Form */}\n            {formType && (\n              <div>\n                <h3 className=\"text-xl font-semibold mb-4\">Daily Report</h3>\n                <TimeBasedForm type={formType} userName={userName.split(' ')[0]} userId={dbUserId} />\n              </div>\n            )}\n\n            {/* View Reports Section */}\n            <div>\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-xl font-semibold\">My Submitted Reports</h3>\n                <Dialog open={viewReportsOpen} onOpenChange={setViewReportsOpen}>\n                  <DialogTrigger asChild>\n                    <Button variant=\"outline\" data-testid=\"button-view-reports\">\n                      <Eye className=\"h-4 w-4 mr-2\" />\n                      View All Reports ({userReports.length})\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n                    <DialogHeader>\n                      <DialogTitle>My Submitted Reports</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4 mt-4\">\n                      {reportsLoading ? (\n                        <div className=\"flex items-center justify-center py-8\">\n                          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                        </div>\n                      ) : userReports.length > 0 ? (\n                        userReports.map((report) => (\n                          <Card key={report.id} data-testid={`card-report-${report.id}`}>\n                            <CardHeader>\n                              <div className=\"flex items-center justify-between\">\n                                <CardTitle className=\"text-lg\">\n                                  {report.reportType.charAt(0).toUpperCase() + report.reportType.slice(1)} Report\n                                </CardTitle>\n                                <Badge variant=\"outline\" data-testid={`badge-report-type-${report.id}`}>\n                                  {format(new Date(report.createdAt), \"PPpp\")}\n                                </Badge>\n                              </div>\n                            </CardHeader>\n                            <CardContent className=\"space-y-4\">\n                              {report.plannedTasks && (\n                                <div>\n                                  <h4 className=\"font-semibold text-sm text-muted-foreground mb-2\">Planned Tasks:</h4>\n                                  <p className=\"text-sm whitespace-pre-wrap\" data-testid={`text-planned-${report.id}`}>{report.plannedTasks}</p>\n                                </div>\n                              )}\n                              {report.completedTasks && (\n                                <div>\n                                  <h4 className=\"font-semibold text-sm text-muted-foreground mb-2\">Completed Tasks:</h4>\n                                  <p className=\"text-sm whitespace-pre-wrap\" data-testid={`text-completed-${report.id}`}>{report.completedTasks}</p>\n                                </div>\n                              )}\n                              {report.pendingTasks && (\n                                <div>\n                                  <h4 className=\"font-semibold text-sm text-muted-foreground mb-2\">Pending Tasks:</h4>\n                                  <p className=\"text-sm whitespace-pre-wrap\" data-testid={`text-pending-${report.id}`}>{report.pendingTasks}</p>\n                                </div>\n                              )}\n                              {report.notes && (\n                                <div>\n                                  <h4 className=\"font-semibold text-sm text-muted-foreground mb-2\">Notes:</h4>\n                                  <p className=\"text-sm whitespace-pre-wrap\" data-testid={`text-notes-${report.id}`}>{report.notes}</p>\n                                </div>\n                              )}\n                            </CardContent>\n                          </Card>\n                        ))\n                      ) : (\n                        <div className=\"text-center py-8 text-muted-foreground\">\n                          No reports submitted yet\n                        </div>\n                      )}\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </div>\n            </div>\n\n            {/* Assigned Tasks */}\n            <div>\n              <h3 className=\"text-xl font-semibold mb-4\">\n                Assigned Tasks ({tasksLoading ? \"...\" : tasks.length})\n              </h3>\n              {tasksLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : tasks.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {tasks.map(task => {\n                    const statusMap: Record<string, \"Pending\" | \"In Progress\" | \"Completed\"> = {\n                      'pending': 'Pending',\n                      'in progress': 'In Progress',\n                      'completed': 'Completed'\n                    };\n                    const priorityMap: Record<string, \"Low\" | \"Medium\" | \"High\"> = {\n                      'low': 'Low',\n                      'medium': 'Medium',\n                      'high': 'High'\n                    };\n                    return (\n                      <TaskCard\n                        key={task.id}\n                        id={String(task.id)}\n                        userId={dbUserId!}\n                        title={task.title}\n                        description={task.description || \"\"}\n                        priority={priorityMap[task.priority.toLowerCase()] || 'Medium'}\n                        deadline={task.deadline ? new Date(task.deadline) : undefined}\n                        status={statusMap[task.status.toLowerCase()] || 'Pending'}\n                        assignedDate={new Date(task.createdAt)}\n                        onStatusChange={(status) => {\n                          const dbStatus = status.toLowerCase();\n                          updateTaskStatusMutation.mutate({ taskId: task.id, status: dbStatus });\n                        }}\n                      />\n                    );\n                  })}\n                </div>\n              ) : (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  No tasks assigned yet\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Right Column - Messages and Ratings */}\n          <div className=\"space-y-8\">\n            {/* Messages */}\n            <div>\n              <h3 className=\"text-xl font-semibold mb-4\">\n                Messages ({messagesLoading ? \"...\" : `${unreadCount} unread`})\n              </h3>\n              {messagesLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : messages.length > 0 ? (\n                <div className=\"space-y-3\">\n                  {messages.map(msg => (\n                    <MessageCard\n                      key={msg.id}\n                      id={String(msg.id)}\n                      message={msg.message}\n                      timestamp={new Date(msg.createdAt)}\n                      isRead={msg.readStatus}\n                      relatedTask={msg.relatedTaskId ? `Task #${msg.relatedTaskId}` : undefined}\n                      onMarkRead={() => markMessageAsRead(msg.id)}\n                    />\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  No messages\n                </div>\n              )}\n            </div>\n\n            {/* Ratings & Feedback */}\n            <div>\n              <h3 className=\"text-xl font-semibold mb-4\">Performance Feedback</h3>\n              {ratingLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : latestRating ? (\n                <div className=\"space-y-4\">\n                  <RatingBadge\n                    rating={latestRating.rating as \"Excellent\" | \"Good\" | \"Needs Improvement\"}\n                    feedback={latestRating.feedback || \"\"}\n                    timestamp={new Date(latestRating.createdAt)}\n                    period={latestRating.period}\n                  />\n                </div>\n              ) : (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  No ratings yet\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":17899,"size_tokens":null},"client/src/components/UserLayout.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { \n  LayoutDashboard, \n  FileText, \n  MessageSquare, \n  MessageCircle, \n  Megaphone, \n  ListTodo, \n  Eye, \n  Star,\n  LogOut,\n  Menu,\n  Calendar,\n  Clock,\n  History,\n  FileEdit\n} from \"lucide-react\";\nimport ThemeToggle from \"./ThemeToggle\";\nimport BottomNav, { BottomNavItem } from \"./BottomNav\";\nimport { useState } from \"react\";\n\ninterface NavItem {\n  path: string;\n  label: string;\n  icon: any;\n}\n\nconst navItems: NavItem[] = [\n  { path: \"/user/overview\", label: \"Overview\", icon: LayoutDashboard },\n  { path: \"/user/reports\", label: \"Reports\", icon: FileText },\n  { path: \"/user/messages\", label: \"Messages\", icon: MessageSquare },\n  { path: \"/user/feedback\", label: \"Feedback\", icon: MessageCircle },\n  { path: \"/user/tasks\", label: \"Assigned Tasks\", icon: ListTodo },\n  { path: \"/user/report-view\", label: \"View Reports\", icon: Eye },\n  { path: \"/user/ratings\", label: \"Ratings\", icon: Star },\n  { path: \"/user/leaves\", label: \"Leave Management\", icon: Calendar },\n  { path: \"/user/attendance\", label: \"Attendance\", icon: Clock },\n  { path: \"/user/attendance-history\", label: \"Attendance History\", icon: History },\n  { path: \"/user/correction-requests\", label: \"Correction Requests\", icon: FileEdit },\n];\n\nconst bottomNavItems: BottomNavItem[] = [\n  { path: \"/user/overview\", label: \"Home\", icon: LayoutDashboard },\n  { path: \"/user/tasks\", label: \"Tasks\", icon: ListTodo },\n  { path: \"/user/reports\", label: \"Reports\", icon: FileText },\n  { path: \"/user/messages\", label: \"Messages\", icon: MessageSquare },\n];\n\nexport default function UserLayout({ children }: { children: React.ReactNode }) {\n  const [location] = useLocation();\n  const { user, signOut, loggingOut } = useAuth();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n\n  const handleLogout = async () => {\n    await signOut();\n    window.location.href = \"/worklogix/\";\n  };\n\n  const SidebarContent = () => (\n    <div className=\"flex flex-col h-full\">\n      {/* User Info */}\n      <div className=\"p-6 border-b\">\n        <div className=\"flex items-center gap-3\">\n          <Avatar>\n            <AvatarImage src={user?.photoURL || \"\"} />\n            <AvatarFallback>{user?.displayName?.[0] || \"U\"}</AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-semibold text-sm truncate\">{user?.displayName}</h3>\n            <p className=\"text-xs text-muted-foreground truncate\">{user?.email}</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <nav className=\"flex-1 p-4 overflow-y-auto\">\n        <ul className=\"space-y-1\">\n          {navItems.map((item) => {\n            const isActive = location === item.path;\n            const Icon = item.icon;\n            \n            return (\n              <li key={item.path}>\n                <Link \n                  href={item.path}\n                  onClick={() => setMobileMenuOpen(false)}\n                  className={`flex items-center gap-3 px-3 py-2 rounded-md transition-colors ${\n                    isActive\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"hover:bg-accent hover:text-accent-foreground\"\n                  }`}\n                  data-testid={`nav-link-${item.label.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  <Icon className=\"h-5 w-5\" />\n                  <span className=\"text-sm font-medium\">{item.label}</span>\n                </Link>\n              </li>\n            );\n          })}\n        </ul>\n      </nav>\n\n      {/* Footer Actions */}\n      <div className=\"p-4 border-t space-y-2\">\n        <ThemeToggle />\n        <Button\n          variant=\"outline\"\n          className=\"w-full justify-start\"\n          onClick={handleLogout}\n          disabled={loggingOut}\n          data-testid=\"button-logout\"\n        >\n          <LogOut className=\"h-4 w-4 mr-2\" />\n          {loggingOut ? \"Logging out...\" : \"Logout\"}\n        </Button>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"flex h-screen bg-background\">\n      {/* Desktop Sidebar */}\n      <aside className=\"hidden md:flex md:w-64 border-r bg-card flex-col\">\n        <SidebarContent />\n      </aside>\n\n      {/* Main Content */}\n      <main className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* Mobile Header */}\n        <div className=\"md:hidden flex items-center justify-between p-4 border-b bg-card\">\n          <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>\n            <SheetTrigger asChild>\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-mobile-menu\">\n                <Menu className=\"h-6 w-6\" />\n              </Button>\n            </SheetTrigger>\n            <SheetContent side=\"left\" className=\"w-64 p-0\">\n              <SidebarContent />\n            </SheetContent>\n          </Sheet>\n          <h1 className=\"font-semibold text-lg\">WorkLogix</h1>\n          <div className=\"w-10\" /> {/* Spacer for balance */}\n        </div>\n\n        {/* Content Area */}\n        <div className=\"flex-1 overflow-y-auto\">\n          <div className=\"container max-w-7xl mx-auto p-3 sm:p-4 md:p-6 lg:p-8 pb-20 md:pb-6\">\n            {children}\n          </div>\n        </div>\n\n        {/* Bottom Navigation for Mobile */}\n        <BottomNav items={bottomNavItems} />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":5596,"size_tokens":null},"client/src/components/ExcelTable.tsx":{"content":"import { useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Plus, Trash2, Eye } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\n\ninterface Column {\n  key: string;\n  label: string;\n  width?: string;\n  type?: \"text\" | \"number\" | \"date\";\n  editable?: boolean;\n}\n\ninterface ExcelTableProps<T extends Record<string, any>> {\n  columns: Column[];\n  data: T[];\n  onAdd: (newRow: Partial<T>) => void;\n  onUpdate: (id: number, field: string, value: any) => void;\n  onDelete: (id: number) => void;\n  loading?: boolean;\n  emptyMessage?: string;\n}\n\nexport function ExcelTable<T extends Record<string, any>>({\n  columns,\n  data,\n  onAdd,\n  onUpdate,\n  onDelete,\n  loading = false,\n  emptyMessage = \"No data yet. Click + Add Row to start.\",\n}: ExcelTableProps<T>) {\n  const [editingCell, setEditingCell] = useState<{ rowId: number; field: string } | null>(null);\n  const [editValue, setEditValue] = useState<string>(\"\");\n  const [viewDialogOpen, setViewDialogOpen] = useState(false);\n  const [selectedRow, setSelectedRow] = useState<T | null>(null);\n  const [draftRows, setDraftRows] = useState<Map<number, Partial<T>>>(new Map());\n  const [nextDraftId, setNextDraftId] = useState(-1);\n\n  const handleCellClick = (e: React.MouseEvent, rowId: number, field: string, currentValue: any) => {\n    e.stopPropagation();\n    const column = columns.find(col => col.key === field);\n    if (column?.editable === false) return;\n    \n    setEditingCell({ rowId, field });\n    setEditValue(currentValue?.toString() || \"\");\n  };\n\n  const handleCellBlur = () => {\n    if (editingCell) {\n      const column = columns.find(col => col.key === editingCell.field);\n      let finalValue: any = editValue;\n      \n      if (column?.type === \"number\") {\n        finalValue = editValue ? parseFloat(editValue) : null;\n      }\n      \n      // Check if this is a draft row\n      if (editingCell.rowId < 0 && draftRows.has(editingCell.rowId)) {\n        const draftRow = draftRows.get(editingCell.rowId) || {};\n        const updatedDraft = { ...draftRow, [editingCell.field]: finalValue };\n        \n        // Update draft row\n        setDraftRows(new Map(draftRows.set(editingCell.rowId, updatedDraft)));\n        \n        // Try to save the draft row if it's valid (has required fields)\n        // For now, we'll just update it locally and user can save manually\n      } else {\n        // Update existing row\n        onUpdate(editingCell.rowId, editingCell.field, finalValue);\n      }\n      \n      setEditingCell(null);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      handleCellBlur();\n    } else if (e.key === \"Escape\") {\n      setEditingCell(null);\n    }\n  };\n\n  const handleAddRow = () => {\n    const newRow: any = { id: nextDraftId };\n    columns.forEach(col => {\n      if (col.key !== \"id\" && col.key !== \"createdAt\" && col.key !== \"updatedAt\") {\n        newRow[col.key] = null;\n      }\n    });\n    \n    // Add as draft row instead of saving immediately\n    setDraftRows(new Map(draftRows.set(nextDraftId, newRow)));\n    setNextDraftId(nextDraftId - 1);\n  };\n  \n  const handleSaveDraft = (draftId: number) => {\n    const draftRow = draftRows.get(draftId);\n    if (draftRow) {\n      // Remove id from draft before saving\n      const { id, ...rowData } = draftRow;\n      onAdd(rowData as Partial<T>);\n      \n      // Remove from drafts\n      const newDrafts = new Map(draftRows);\n      newDrafts.delete(draftId);\n      setDraftRows(newDrafts);\n    }\n  };\n  \n  const handleDeleteDraft = (draftId: number) => {\n    const newDrafts = new Map(draftRows);\n    newDrafts.delete(draftId);\n    setDraftRows(newDrafts);\n  };\n\n  const handleViewRow = (row: T) => {\n    setSelectedRow(row);\n    setViewDialogOpen(true);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-between items-center gap-2\">\n        <Button\n          onClick={handleAddRow}\n          size=\"sm\"\n          data-testid=\"button-add-row\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Row\n        </Button>\n      </div>\n\n      <Card className=\"overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full border-collapse\">\n            <thead>\n              <tr className=\"bg-muted\">\n                <th\n                  className=\"border-b border-border p-2 text-left text-sm font-medium sticky top-0 bg-muted z-10\"\n                  style={{ width: \"60px\", minWidth: \"60px\" }}\n                >\n                  S.No\n                </th>\n                {columns.map((column) => (\n                  <th\n                    key={column.key}\n                    className=\"border-b border-border p-2 text-left text-sm font-medium sticky top-0 bg-muted z-10\"\n                    style={{ width: column.width || \"auto\", minWidth: \"120px\" }}\n                  >\n                    {column.label}\n                  </th>\n                ))}\n                <th className=\"border-b border-border p-2 w-16 sticky top-0 bg-muted z-10\">\n                  Actions\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              {loading ? (\n                <tr>\n                  <td colSpan={columns.length + 2} className=\"p-8 text-center text-muted-foreground\">\n                    Loading...\n                  </td>\n                </tr>\n              ) : data.length === 0 && draftRows.size === 0 ? (\n                <tr>\n                  <td colSpan={columns.length + 2} className=\"p-8 text-center text-muted-foreground\">\n                    {emptyMessage}\n                  </td>\n                </tr>\n              ) : (\n                <>\n                  {/* Render draft rows first */}\n                  {Array.from(draftRows.entries()).map(([draftId, draftRow], draftIndex) => (\n                    <tr \n                      key={draftId} \n                      className=\"bg-yellow-50 dark:bg-yellow-950/20\"\n                      data-testid={`draft-row-${draftId}`}\n                    >\n                      <td className=\"border-b border-border p-0 bg-muted/50\">\n                        <div className=\"px-3 py-2 min-h-[40px] flex items-center justify-center text-sm font-medium\">\n                          <span className=\"text-yellow-600 dark:text-yellow-400\">New</span>\n                        </div>\n                      </td>\n                      {columns.map((column) => {\n                        const isEditing =\n                          editingCell?.rowId === draftId &&\n                          editingCell?.field === column.key;\n                        const cellValue = draftRow[column.key];\n\n                        return (\n                          <td\n                            key={`${draftId}-${column.key}`}\n                            className=\"border-b border-border p-0 cursor-pointer\"\n                            onClick={(e) => handleCellClick(e, draftId, column.key, cellValue)}\n                            data-testid={`cell-${column.key}-${draftId}`}\n                          >\n                            {isEditing ? (\n                              <Input\n                                type={column.type === \"number\" ? \"number\" : column.type === \"date\" ? \"date\" : \"text\"}\n                                value={editValue}\n                                onChange={(e) => setEditValue(e.target.value)}\n                                onBlur={handleCellBlur}\n                                onKeyDown={handleKeyDown}\n                                autoFocus\n                                className=\"border-0 h-full min-h-[40px] rounded-none focus-visible:ring-2 focus-visible:ring-ring\"\n                                data-testid={`input-${column.key}-${draftId}`}\n                              />\n                            ) : (\n                              <div className=\"px-3 py-2 min-h-[40px] flex items-center text-sm\">\n                                {cellValue || (\n                                  <span className=\"text-muted-foreground italic\">\n                                    Click to edit\n                                  </span>\n                                )}\n                              </div>\n                            )}\n                          </td>\n                        );\n                      })}\n                      <td className=\"border-b border-border p-2\">\n                        <div className=\"flex items-center justify-center gap-1\">\n                          <Button\n                            variant=\"default\"\n                            size=\"sm\"\n                            onClick={() => handleSaveDraft(draftId)}\n                            data-testid={`button-save-${draftId}`}\n                          >\n                            Save\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteDraft(draftId)}\n                            data-testid={`button-cancel-${draftId}`}\n                          >\n                            Cancel\n                          </Button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                  {/* Render saved rows */}\n                  {data.map((row, index) => (\n                  <tr \n                    key={row.id} \n                    className=\"hover-elevate cursor-pointer\"\n                    onClick={() => handleViewRow(row)}\n                    data-testid={`row-${row.id}`}\n                  >\n                    <td className=\"border-b border-border p-0 bg-muted/50\">\n                      <div className=\"px-3 py-2 min-h-[40px] flex items-center justify-center text-sm font-medium\">\n                        {index + 1}\n                      </div>\n                    </td>\n                    {columns.map((column) => {\n                      const isEditing =\n                        editingCell?.rowId === row.id &&\n                        editingCell?.field === column.key;\n                      const cellValue = row[column.key];\n\n                      return (\n                        <td\n                          key={`${row.id}-${column.key}`}\n                          className={cn(\n                            \"border-b border-border p-0 cursor-pointer\",\n                            column.editable === false && \"bg-muted/50 cursor-default\"\n                          )}\n                          onClick={(e) => handleCellClick(e, row.id, column.key, cellValue)}\n                          data-testid={`cell-${column.key}-${row.id}`}\n                        >\n                          {isEditing ? (\n                            <Input\n                              type={column.type === \"number\" ? \"number\" : column.type === \"date\" ? \"date\" : \"text\"}\n                              value={editValue}\n                              onChange={(e) => setEditValue(e.target.value)}\n                              onBlur={handleCellBlur}\n                              onKeyDown={handleKeyDown}\n                              autoFocus\n                              className=\"border-0 h-full min-h-[40px] rounded-none focus-visible:ring-2 focus-visible:ring-ring\"\n                              data-testid={`input-${column.key}-${row.id}`}\n                            />\n                          ) : (\n                            <div className=\"px-3 py-2 min-h-[40px] flex items-center text-sm\">\n                              {cellValue || (\n                                <span className=\"text-muted-foreground italic\">\n                                  {column.editable === false ? \"-\" : \"Click to edit\"}\n                                </span>\n                              )}\n                            </div>\n                          )}\n                        </td>\n                      );\n                    })}\n                    <td className=\"border-b border-border p-2\">\n                      <div className=\"flex items-center justify-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleViewRow(row);\n                          }}\n                          data-testid={`button-view-${row.id}`}\n                        >\n                          <Eye className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onDelete(row.id);\n                          }}\n                          data-testid={`button-delete-${row.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n                </>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </Card>\n\n      <Dialog open={viewDialogOpen} onOpenChange={setViewDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh]\">\n          <DialogHeader>\n            <DialogTitle>View Details</DialogTitle>\n            <DialogDescription>\n              Complete information for this entry\n            </DialogDescription>\n          </DialogHeader>\n          <ScrollArea className=\"max-h-[60vh]\">\n            {selectedRow && (\n              <div className=\"space-y-4 pr-4\">\n                {columns.map((column) => (\n                  <div key={column.key} className=\"grid grid-cols-3 gap-4 py-2 border-b\">\n                    <div className=\"font-medium text-sm text-muted-foreground\">\n                      {column.label}\n                    </div>\n                    <div className=\"col-span-2 text-sm\" data-testid={`view-${column.key}`}>\n                      {selectedRow[column.key] || (\n                        <span className=\"text-muted-foreground italic\">Not set</span>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </ScrollArea>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":14711,"size_tokens":null},"client/src/components/CompanyDetailsSetupDialog.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n    Form,\n    FormControl,\n    FormField,\n    FormItem,\n    FormLabel,\n    FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport {\n    Building2,\n    MapPin,\n    Briefcase,\n    CheckCircle2,\n    Loader2,\n} from \"lucide-react\";\n\nconst step1Schema = z.object({\n    companyType: z.string().min(1, \"Please select a company type\"),\n    designation: z.string().min(1, \"Please select a designation\"),\n    logo: z.string().optional(),\n});\n\nconst step2Schema = z.object({\n    address: z.string().min(5, \"Please enter a complete address\"),\n    pincode: z\n        .string()\n        .regex(/^\\d{6}$/, \"Please enter a valid 6-digit pincode\"),\n    city: z.string().min(2, \"City is required\"),\n    state: z.string().min(2, \"State is required\"),\n    country: z.string().min(2, \"Country is required\").default(\"India\"),\n});\n\nconst step3Schema = z.object({\n    employees: z.string().min(1, \"Number of employees is required\"),\n    annualTurnover: z.string().min(1, \"Please select annual turnover range\"),\n    yearEstablished: z.string().regex(/^\\d{4}$/, \"Please enter a valid year\"),\n});\n\ntype Step1Data = z.infer<typeof step1Schema>;\ntype Step2Data = z.infer<typeof step2Schema>;\ntype Step3Data = z.infer<typeof step3Schema>;\n\ninterface CompanyDetailsSetupDialogProps {\n    open: boolean;\n    companyId: number;\n    companyName: string;\n    onComplete: () => void;\n    onClose?: () => void;\n}\n\nexport default function CompanyDetailsSetupDialog({\n    open,\n    companyId,\n    companyName,\n    onComplete,\n    onClose,\n}: CompanyDetailsSetupDialogProps) {\n    const [currentStep, setCurrentStep] = useState(1);\n    const [isSubmitting, setIsSubmitting] = useState(false);\n    const { toast } = useToast();\n\n    const form1 = useForm<Step1Data>({\n        resolver: zodResolver(step1Schema),\n        defaultValues: {\n            companyType: \"\",\n            designation: \"\",\n            logo: \"\",\n        },\n    });\n\n    const form2 = useForm<Step2Data>({\n        resolver: zodResolver(step2Schema),\n        defaultValues: {\n            address: \"\",\n            pincode: \"\",\n            city: \"\",\n            state: \"\",\n            country: \"India\",\n        },\n    });\n\n    const form3 = useForm<Step3Data>({\n        resolver: zodResolver(step3Schema),\n        defaultValues: {\n            employees: \"\",\n            annualTurnover: \"\",\n            yearEstablished: \"\",\n        },\n    });\n\n    const handleStep1Submit = async (data: Step1Data) => {\n        try {\n            setIsSubmitting(true);\n            await apiRequest(`${API_BASE_URL}/api/companies/${companyId}`, \"PATCH\", data);\n            setCurrentStep(2);\n        } catch (error: any) {\n            toast({\n                title: \"Error\",\n                description:\n                    error.message || \"Failed to save company information\",\n                variant: \"destructive\",\n            });\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    const handleStep2Submit = async (data: Step2Data) => {\n        try {\n            setIsSubmitting(true);\n            await apiRequest(`${API_BASE_URL}/api/companies/${companyId}`, \"PATCH\", data);\n            setCurrentStep(3);\n        } catch (error: any) {\n            toast({\n                title: \"Error\",\n                description:\n                    error.message || \"Failed to save address information\",\n                variant: \"destructive\",\n            });\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    const handleStep3Submit = async (data: Step3Data) => {\n        try {\n            setIsSubmitting(true);\n            const payload = {\n                ...data,\n                employees: parseInt(data.employees),\n                yearEstablished: parseInt(data.yearEstablished),\n            };\n\n            await apiRequest(`${API_BASE_URL}/api/companies/${companyId}`, \"PATCH\", payload);\n\n            await queryClient.invalidateQueries({\n                queryKey: [`${API_BASE_URL}/api/companies`, companyId],\n            });\n\n            toast({\n                title: \"Success!\",\n                description: \"Company profile completed successfully\",\n            });\n\n            onComplete();\n        } catch (error: any) {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to save business details\",\n                variant: \"destructive\",\n            });\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    return (\n        <Dialog\n            open={open}\n            onOpenChange={(isOpen) => {\n                if (!isOpen && onClose) {\n                    onClose();\n                }\n            }}>\n            <DialogContent\n                className=\"sm:max-w-[550px]\"\n                onInteractOutside={(e) => e.preventDefault()}>\n                <DialogHeader>\n                    <DialogTitle className=\"flex items-center gap-2\">\n                        {currentStep === 1 && (\n                            <>\n                                <Building2 className=\"h-5 w-5 text-indigo-600\" />{\" \"}\n                                Basic Company Information\n                            </>\n                        )}\n                        {currentStep === 2 && (\n                            <>\n                                <MapPin className=\"h-5 w-5 text-indigo-600\" />{\" \"}\n                                Address & Location\n                            </>\n                        )}\n                        {currentStep === 3 && (\n                            <>\n                                <Briefcase className=\"h-5 w-5 text-indigo-600\" />{\" \"}\n                                Business Details\n                            </>\n                        )}\n                    </DialogTitle>\n                    <DialogDescription>\n                        {currentStep === 1 &&\n                            \"Step 1 of 3: Enter your company basic information\"}\n                        {currentStep === 2 &&\n                            \"Step 2 of 3: Provide your business address\"}\n                        {currentStep === 3 &&\n                            \"Step 3 of 3: Complete your business profile\"}\n                    </DialogDescription>\n                </DialogHeader>\n\n                <div className=\"flex items-center justify-center gap-2 py-4\">\n                    {[1, 2, 3].map((step) => (\n                        <div key={step} className=\"flex items-center\">\n                            <div\n                                className={`h-2 w-2 rounded-full transition-colors ${\n                                    step === currentStep\n                                        ? \"bg-indigo-600 h-3 w-3\"\n                                        : step < currentStep\n                                        ? \"bg-green-500\"\n                                        : \"bg-gray-300\"\n                                }`}\n                            />\n                            {step < 3 && (\n                                <div\n                                    className={`h-0.5 w-12 ${\n                                        step < currentStep\n                                            ? \"bg-green-500\"\n                                            : \"bg-gray-300\"\n                                    }`}\n                                />\n                            )}\n                        </div>\n                    ))}\n                </div>\n\n                {currentStep === 1 && (\n                    <Form {...form1}>\n                        <form\n                            onSubmit={form1.handleSubmit(handleStep1Submit)}\n                            className=\"space-y-4\">\n                            <FormField\n                                control={form1.control}\n                                name=\"companyType\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>Company Type</FormLabel>\n                                        <Select\n                                            onValueChange={field.onChange}\n                                            value={field.value}>\n                                            <FormControl>\n                                                <SelectTrigger data-testid=\"select-company-type\">\n                                                    <SelectValue placeholder=\"Select company type\" />\n                                                </SelectTrigger>\n                                            </FormControl>\n                                            <SelectContent>\n                                                <SelectItem value=\"Contractor\">\n                                                    Contractor\n                                                </SelectItem>\n                                                <SelectItem value=\"Builder\">\n                                                    Builder\n                                                </SelectItem>\n                                                <SelectItem value=\"Developer\">\n                                                    Developer\n                                                </SelectItem>\n                                                <SelectItem value=\"Supplier\">\n                                                    Supplier\n                                                </SelectItem>\n                                            </SelectContent>\n                                        </Select>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <FormField\n                                control={form1.control}\n                                name=\"designation\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>Your Designation</FormLabel>\n                                        <Select\n                                            onValueChange={field.onChange}\n                                            value={field.value}>\n                                            <FormControl>\n                                                <SelectTrigger data-testid=\"select-designation\">\n                                                    <SelectValue placeholder=\"Select your designation\" />\n                                                </SelectTrigger>\n                                            </FormControl>\n                                            <SelectContent>\n                                                <SelectItem value=\"Owner\">\n                                                    Owner\n                                                </SelectItem>\n                                                <SelectItem value=\"Manager\">\n                                                    Manager\n                                                </SelectItem>\n                                                <SelectItem value=\"Engineer\">\n                                                    Engineer\n                                                </SelectItem>\n                                            </SelectContent>\n                                        </Select>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <FormField\n                                control={form1.control}\n                                name=\"logo\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>\n                                            Company Logo (Optional)\n                                        </FormLabel>\n                                        <FormControl>\n                                            <Input\n                                                type=\"url\"\n                                                placeholder=\"https://example.com/logo.png\"\n                                                {...field}\n                                                data-testid=\"input-logo\"\n                                            />\n                                        </FormControl>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <div className=\"flex justify-end gap-2 pt-4\">\n                                <Button\n                                    type=\"submit\"\n                                    disabled={isSubmitting}\n                                    className=\"bg-indigo-600 hover:bg-indigo-700\"\n                                    data-testid=\"button-next-step1\">\n                                    {isSubmitting ? (\n                                        <>\n                                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />{\" \"}\n                                            Saving...\n                                        </>\n                                    ) : (\n                                        \"Next\"\n                                    )}\n                                </Button>\n                            </div>\n                        </form>\n                    </Form>\n                )}\n\n                {currentStep === 2 && (\n                    <Form {...form2}>\n                        <form\n                            onSubmit={form2.handleSubmit(handleStep2Submit)}\n                            className=\"space-y-4\">\n                            <FormField\n                                control={form2.control}\n                                name=\"address\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>Address</FormLabel>\n                                        <FormControl>\n                                            <Input\n                                                placeholder=\"Enter complete address\"\n                                                {...field}\n                                                data-testid=\"input-address\"\n                                            />\n                                        </FormControl>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <FormField\n                                    control={form2.control}\n                                    name=\"pincode\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Pincode</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    placeholder=\"123456\"\n                                                    {...field}\n                                                    data-testid=\"input-pincode\"\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n\n                                <FormField\n                                    control={form2.control}\n                                    name=\"city\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>City</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    placeholder=\"City name\"\n                                                    {...field}\n                                                    data-testid=\"input-city\"\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <FormField\n                                    control={form2.control}\n                                    name=\"state\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>State</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    placeholder=\"State name\"\n                                                    {...field}\n                                                    data-testid=\"input-state\"\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n\n                                <FormField\n                                    control={form2.control}\n                                    name=\"country\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Country</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    placeholder=\"Country name\"\n                                                    {...field}\n                                                    data-testid=\"input-country\"\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                            </div>\n\n                            <div className=\"flex justify-between gap-2 pt-4\">\n                                <Button\n                                    type=\"button\"\n                                    variant=\"outline\"\n                                    onClick={() => setCurrentStep(1)}\n                                    data-testid=\"button-back-step2\">\n                                    Back\n                                </Button>\n                                <Button\n                                    type=\"submit\"\n                                    disabled={isSubmitting}\n                                    className=\"bg-indigo-600 hover:bg-indigo-700\"\n                                    data-testid=\"button-next-step2\">\n                                    {isSubmitting ? (\n                                        <>\n                                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />{\" \"}\n                                            Saving...\n                                        </>\n                                    ) : (\n                                        \"Next\"\n                                    )}\n                                </Button>\n                            </div>\n                        </form>\n                    </Form>\n                )}\n\n                {currentStep === 3 && (\n                    <Form {...form3}>\n                        <form\n                            onSubmit={form3.handleSubmit(handleStep3Submit)}\n                            className=\"space-y-4\">\n                            <FormField\n                                control={form3.control}\n                                name=\"employees\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>\n                                            Number of Employees\n                                        </FormLabel>\n                                        <FormControl>\n                                            <Input\n                                                type=\"number\"\n                                                placeholder=\"Enter number of employees\"\n                                                {...field}\n                                                data-testid=\"input-employees\"\n                                            />\n                                        </FormControl>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <FormField\n                                control={form3.control}\n                                name=\"annualTurnover\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>\n                                            Average Annual Turnover\n                                        </FormLabel>\n                                        <Select\n                                            onValueChange={field.onChange}\n                                            value={field.value}>\n                                            <FormControl>\n                                                <SelectTrigger data-testid=\"select-turnover\">\n                                                    <SelectValue placeholder=\"Select turnover range\" />\n                                                </SelectTrigger>\n                                            </FormControl>\n                                            <SelectContent>\n                                                <SelectItem value=\"Less than 1 Lakh\">\n                                                    Less than 1 Lakh\n                                                </SelectItem>\n                                                <SelectItem value=\"1-5 Lakhs\">\n                                                    1-5 Lakhs\n                                                </SelectItem>\n                                                <SelectItem value=\"5-10 Lakhs\">\n                                                    5-10 Lakhs\n                                                </SelectItem>\n                                                <SelectItem value=\"10-50 Lakhs\">\n                                                    10-50 Lakhs\n                                                </SelectItem>\n                                                <SelectItem value=\"50 Lakhs - 1 Crore\">\n                                                    50 Lakhs - 1 Crore\n                                                </SelectItem>\n                                                <SelectItem value=\"1-5 Crores\">\n                                                    1-5 Crores\n                                                </SelectItem>\n                                                <SelectItem value=\"More than 5 Crores\">\n                                                    More than 5 Crores\n                                                </SelectItem>\n                                            </SelectContent>\n                                        </Select>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <FormField\n                                control={form3.control}\n                                name=\"yearEstablished\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>Year Established</FormLabel>\n                                        <FormControl>\n                                            <Input\n                                                placeholder=\"2020\"\n                                                {...field}\n                                                data-testid=\"input-year-established\"\n                                            />\n                                        </FormControl>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <div className=\"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500 p-4 rounded\">\n                                <div className=\"flex items-start gap-2\">\n                                    <CheckCircle2 className=\"h-5 w-5 text-green-600 dark:text-green-500 flex-shrink-0 mt-0.5\" />\n                                    <div className=\"text-sm\">\n                                        <p className=\"font-semibold text-green-800 dark:text-green-500\">\n                                            Almost Done!\n                                        </p>\n                                        <p className=\"text-green-700 dark:text-green-400\">\n                                            After completing this step, you'll\n                                            have full access to your dashboard.\n                                        </p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div className=\"flex justify-between gap-2 pt-4\">\n                                <Button\n                                    type=\"button\"\n                                    variant=\"outline\"\n                                    onClick={() => setCurrentStep(2)}\n                                    data-testid=\"button-back-step3\">\n                                    Back\n                                </Button>\n                                <Button\n                                    type=\"submit\"\n                                    disabled={isSubmitting}\n                                    className=\"bg-indigo-600 hover:bg-indigo-700\"\n                                    data-testid=\"button-complete\">\n                                    {isSubmitting ? (\n                                        <>\n                                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />{\" \"}\n                                            Completing...\n                                        </>\n                                    ) : (\n                                        <>\n                                            <CheckCircle2 className=\"mr-2 h-4 w-4\" />{\" \"}\n                                            Complete Setup\n                                        </>\n                                    )}\n                                </Button>\n                            </div>\n                        </form>\n                    </Form>\n                )}\n            </DialogContent>\n        </Dialog>\n    );\n}\n","path":null,"size_bytes":28391,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/pages/admin/CRM.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest, API_BASE_URL } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n    ChevronLeft,\n    ChevronRight,\n    Plus,\n    Edit,\n    Trash2,\n    TrendingUp,\n    TrendingDown,\n    Calendar,\n    UserPlus,\n    CheckCircle2,\n    XCircle,\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { Enquiry, Followup } from \"@shared/schema\";\nimport FollowupCalendar from \"@/components/FollowupCalendar\";\n\nconst STATUS_OPTIONS = [\n    { value: \"new\", label: \"New\" },\n    { value: \"followup\", label: \"Followup\" },\n    { value: \"negotiation\", label: \"Negotiation\" },\n    { value: \"sales_closed\", label: \"Sales Closed\" },\n    { value: \"dropped\", label: \"Dropped\" },\n];\n\nconst PAYMENT_METHODS = [\n    { value: \"cash\", label: \"Cash\" },\n    { value: \"card\", label: \"Card\" },\n    { value: \"upi\", label: \"UPI\" },\n    { value: \"bank_transfer\", label: \"Bank Transfer\" },\n    { value: \"cheque\", label: \"Cheque\" },\n];\n\nconst LEAD_SOURCES = [\n    { value: \"website\", label: \"Website\" },\n    { value: \"social_media\", label: \"Social Media\" },\n    { value: \"referral\", label: \"Referral\" },\n    { value: \"walk_in\", label: \"Walk-in\" },\n    { value: \"phone\", label: \"Phone\" },\n    { value: \"email\", label: \"Email\" },\n    { value: \"other\", label: \"Other\" },\n];\n\ninterface CRMStats {\n    totalEnquiries: number;\n    monthEnquiries: number;\n    totalSales: number;\n    monthSales: number;\n    todayFollowups: number;\n    totalDrops: number;\n    monthDrops: number;\n}\n\nexport default function CRM() {\n    const [currentSection, setCurrentSection] = useState(0);\n    const [selectedEnquiry, setSelectedEnquiry] = useState<Enquiry | null>(\n        null\n    );\n    const [selectedEnquiryForFollowup, setSelectedEnquiryForFollowup] =\n        useState<number | null>(null);\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    const [enquiryFormKey, setEnquiryFormKey] = useState(0);\n    const [followupFormKey, setFollowupFormKey] = useState(0);\n    const { toast } = useToast();\n\n    const { data: stats } = useQuery<CRMStats>({\n        queryKey: [\"/api/crm/stats\"],\n    });\n\n    const { data: enquiries = [] } = useQuery<Enquiry[]>({\n        queryKey: [\"/api/crm/enquiries\"],\n    });\n\n    const { data: followups = [] } = useQuery<Followup[]>({\n        queryKey: [\"/api/crm/followups\"],\n    });\n\n    const createEnquiryMutation = useMutation({\n        mutationFn: async (data: any) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/crm/enquiries`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/enquiries\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/stats\"],\n            });\n            toast({ title: \"Enquiry created successfully\" });\n            setSelectedEnquiry(null);\n            setEnquiryFormKey((prev) => prev + 1);\n            setCurrentSection(1);\n        },\n    });\n\n    const updateEnquiryMutation = useMutation({\n        mutationFn: async ({ id, ...data }: any) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/crm/enquiries/${id}`,\n                \"PATCH\",\n                data\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/enquiries\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/stats\"],\n            });\n            toast({ title: \"Enquiry updated successfully\" });\n            setSelectedEnquiry(null);\n            setCurrentSection(1);\n        },\n    });\n\n    const deleteEnquiryMutation = useMutation({\n        mutationFn: async (id: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/crm/enquiries/${id}`,\n                \"DELETE\"\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/enquiries\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/stats\"],\n            });\n            toast({ title: \"Enquiry deleted successfully\" });\n        },\n    });\n\n    const markAsWonMutation = useMutation({\n        mutationFn: async (id: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/crm/enquiries/${id}`,\n                \"PATCH\",\n                { status: \"sales_closed\" }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/enquiries\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/stats\"],\n            });\n            toast({\n                title: \"Enquiry marked as Won!\",\n                description: \"Sales closed successfully\",\n            });\n        },\n    });\n\n    const markAsLostMutation = useMutation({\n        mutationFn: async (id: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/crm/enquiries/${id}`,\n                \"PATCH\",\n                { status: \"dropped\" }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/enquiries\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/stats\"],\n            });\n            toast({\n                title: \"Enquiry marked as Lost\",\n                description: \"Moved to dropped status\",\n            });\n        },\n    });\n\n    const createFollowupMutation = useMutation({\n        mutationFn: async (data: any) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/crm/followups`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/followups\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/enquiries\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/crm/stats\"],\n            });\n            toast({ title: \"Followup created successfully\" });\n            setSelectedEnquiryForFollowup(null);\n            setFollowupFormKey((prev) => prev + 1);\n            setCurrentSection(3);\n        },\n    });\n\n    const handleEnquirySubmit = (e: React.FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        const formData = new FormData(e.currentTarget);\n        const data = Object.fromEntries(formData.entries());\n\n        if (selectedEnquiry) {\n            updateEnquiryMutation.mutate({ id: selectedEnquiry.id, ...data });\n        } else {\n            createEnquiryMutation.mutate(data);\n        }\n    };\n\n    const handleFollowupSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        const formData = new FormData(e.currentTarget);\n        const data = Object.fromEntries(formData.entries());\n        createFollowupMutation.mutate(data);\n        e.currentTarget.reset();\n    };\n\n    const filteredEnquiries = enquiries.filter(\n        (enq) =>\n            enq.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n            enq.mobileNo.includes(searchTerm) ||\n            (enq.productName?.toLowerCase() || \"\").includes(\n                searchTerm.toLowerCase()\n            )\n    );\n\n    const sections = [\n        // Section 0: Dashboard Overview\n        <div key=\"dashboard\" className=\"min-w-full flex-shrink-0 p-6 space-y-6\">\n            <h2\n                className=\"text-2xl font-bold\"\n                data-testid=\"text-crm-dashboard-title\">\n                CRM Dashboard\n            </h2>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <Card data-testid=\"card-total-enquiries\">\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Total Enquiries\n                        </CardTitle>\n                        <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-2xl font-bold\">\n                            {stats?.totalEnquiries || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            {stats?.monthEnquiries || 0} this month\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card\n                    data-testid=\"card-won-enquiries\"\n                    className=\"border-green-200 dark:border-green-900\">\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Won Enquiries\n                        </CardTitle>\n                        <CheckCircle2 className=\"h-4 w-4 text-green-600 dark:text-green-500\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-2xl font-bold text-green-600 dark:text-green-500\">\n                            {stats?.totalSales || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            {stats?.monthSales || 0} this month\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card\n                    data-testid=\"card-lost-enquiries\"\n                    className=\"border-red-200 dark:border-red-900\">\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Lost Enquiries\n                        </CardTitle>\n                        <XCircle className=\"h-4 w-4 text-red-600 dark:text-red-500\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-2xl font-bold text-red-600 dark:text-red-500\">\n                            {stats?.totalDrops || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            {stats?.monthDrops || 0} this month\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-today-followups\">\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Today's Follow-ups\n                        </CardTitle>\n                        <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-2xl font-bold\">\n                            {stats?.todayFollowups || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            Scheduled for today\n                        </p>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <div className=\"mt-6\">\n                <FollowupCalendar followups={followups} enquiries={enquiries} />\n            </div>\n        </div>,\n\n        // Section 1: Enquiry List\n        <div\n            key=\"enquiry-list\"\n            className=\"min-w-full flex-shrink-0 p-6 space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                <h2\n                    className=\"text-2xl font-bold\"\n                    data-testid=\"text-enquiry-list-title\">\n                    Enquiry List\n                </h2>\n                <Button\n                    onClick={() => {\n                        setSelectedEnquiry(null);\n                        setEnquiryFormKey((prev) => prev + 1);\n                        setCurrentSection(2);\n                    }}\n                    data-testid=\"button-add-enquiry\">\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Add Enquiry\n                </Button>\n            </div>\n\n            <Input\n                placeholder=\"Search by customer name, mobile, or product...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                data-testid=\"input-search-enquiries\"\n            />\n\n            <Card>\n                <CardContent className=\"p-0\">\n                    <div className=\"overflow-x-auto\">\n                        <Table>\n                            <TableHeader>\n                                <TableRow>\n                                    <TableHead>Customer Name</TableHead>\n                                    <TableHead>Mobile No</TableHead>\n                                    <TableHead>Product</TableHead>\n                                    <TableHead>Status</TableHead>\n                                    <TableHead>Enquiry Date</TableHead>\n                                    <TableHead>Actions</TableHead>\n                                </TableRow>\n                            </TableHeader>\n                            <TableBody>\n                                {filteredEnquiries.map((enq) => (\n                                    <TableRow\n                                        key={enq.id}\n                                        data-testid={`row-enquiry-${enq.id}`}>\n                                        <TableCell>\n                                            {enq.customerName}\n                                        </TableCell>\n                                        <TableCell>{enq.mobileNo}</TableCell>\n                                        <TableCell>{enq.productName}</TableCell>\n                                        <TableCell>\n                                            <span className=\"capitalize\">\n                                                {enq.status.replace(\"_\", \" \")}\n                                            </span>\n                                        </TableCell>\n                                        <TableCell>{enq.enquiryDate}</TableCell>\n                                        <TableCell>\n                                            <div className=\"flex flex-wrap gap-2\">\n                                                {enq.status !==\n                                                    \"sales_closed\" &&\n                                                    enq.status !==\n                                                        \"dropped\" && (\n                                                        <>\n                                                            <Button\n                                                                size=\"sm\"\n                                                                variant=\"default\"\n                                                                className=\"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800\"\n                                                                onClick={() =>\n                                                                    markAsWonMutation.mutate(\n                                                                        enq.id\n                                                                    )\n                                                                }\n                                                                data-testid={`button-mark-won-${enq.id}`}\n                                                                title=\"Mark as Won\">\n                                                                <CheckCircle2 className=\"h-3 w-3\" />\n                                                            </Button>\n                                                            <Button\n                                                                size=\"sm\"\n                                                                variant=\"destructive\"\n                                                                onClick={() =>\n                                                                    markAsLostMutation.mutate(\n                                                                        enq.id\n                                                                    )\n                                                                }\n                                                                data-testid={`button-mark-lost-${enq.id}`}\n                                                                title=\"Mark as Lost\">\n                                                                <XCircle className=\"h-3 w-3\" />\n                                                            </Button>\n                                                        </>\n                                                    )}\n                                                <Button\n                                                    size=\"sm\"\n                                                    variant=\"outline\"\n                                                    onClick={() => {\n                                                        setSelectedEnquiry(enq);\n                                                        setCurrentSection(2);\n                                                    }}\n                                                    data-testid={`button-edit-enquiry-${enq.id}`}>\n                                                    <Edit className=\"h-3 w-3\" />\n                                                </Button>\n                                                <Button\n                                                    size=\"sm\"\n                                                    variant=\"outline\"\n                                                    onClick={() => {\n                                                        setSelectedEnquiryForFollowup(\n                                                            enq.id\n                                                        );\n                                                        setFollowupFormKey(\n                                                            (prev) => prev + 1\n                                                        );\n                                                        setCurrentSection(4);\n                                                    }}\n                                                    data-testid={`button-add-followup-${enq.id}`}>\n                                                    <UserPlus className=\"h-3 w-3\" />\n                                                </Button>\n                                                <Button\n                                                    size=\"sm\"\n                                                    variant=\"outline\"\n                                                    onClick={() =>\n                                                        deleteEnquiryMutation.mutate(\n                                                            enq.id\n                                                        )\n                                                    }\n                                                    data-testid={`button-delete-enquiry-${enq.id}`}>\n                                                    <Trash2 className=\"h-3 w-3\" />\n                                                </Button>\n                                            </div>\n                                        </TableCell>\n                                    </TableRow>\n                                ))}\n                            </TableBody>\n                        </Table>\n                    </div>\n                </CardContent>\n            </Card>\n        </div>,\n\n        // Section 2: Add/Edit Enquiry Form\n        <div\n            key=\"enquiry-form\"\n            className=\"min-w-full flex-shrink-0 p-6 space-y-6\">\n            <h2\n                className=\"text-2xl font-bold\"\n                data-testid=\"text-enquiry-form-title\">\n                {selectedEnquiry ? \"Edit Enquiry\" : \"Add New Enquiry\"}\n            </h2>\n\n            <Card>\n                <CardContent className=\"p-6\">\n                    <form\n                        key={selectedEnquiry?.id || `new-${enquiryFormKey}`}\n                        onSubmit={handleEnquirySubmit}\n                        className=\"space-y-4\">\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"customerName\">\n                                    Customer Name *\n                                </Label>\n                                <Input\n                                    id=\"customerName\"\n                                    name=\"customerName\"\n                                    required\n                                    defaultValue={selectedEnquiry?.customerName}\n                                    data-testid=\"input-customer-name\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"mobileNo\">Mobile No *</Label>\n                                <Input\n                                    id=\"mobileNo\"\n                                    name=\"mobileNo\"\n                                    required\n                                    defaultValue={selectedEnquiry?.mobileNo}\n                                    data-testid=\"input-mobile-no\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"productName\">\n                                    Product Name\n                                </Label>\n                                <Input\n                                    id=\"productName\"\n                                    name=\"productName\"\n                                    defaultValue={\n                                        selectedEnquiry?.productName || \"\"\n                                    }\n                                    data-testid=\"input-product-name\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"productVariant\">\n                                    Product Variant\n                                </Label>\n                                <Input\n                                    id=\"productVariant\"\n                                    name=\"productVariant\"\n                                    defaultValue={\n                                        selectedEnquiry?.productVariant || \"\"\n                                    }\n                                    data-testid=\"input-product-variant\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"color\">Color</Label>\n                                <Input\n                                    id=\"color\"\n                                    name=\"color\"\n                                    defaultValue={selectedEnquiry?.color || \"\"}\n                                    data-testid=\"input-color\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"paymentMethod\">\n                                    Payment Method\n                                </Label>\n                                <Select\n                                    key={`payment-${\n                                        selectedEnquiry?.id || enquiryFormKey\n                                    }`}\n                                    name=\"paymentMethod\"\n                                    defaultValue={\n                                        selectedEnquiry?.paymentMethod || \"\"\n                                    }>\n                                    <SelectTrigger data-testid=\"select-payment-method\">\n                                        <SelectValue placeholder=\"Select payment method\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {PAYMENT_METHODS.map((method) => (\n                                            <SelectItem\n                                                key={method.value}\n                                                value={method.value}>\n                                                {method.label}\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"enquiryDate\">\n                                    Enquiry Date *\n                                </Label>\n                                <Input\n                                    id=\"enquiryDate\"\n                                    name=\"enquiryDate\"\n                                    type=\"date\"\n                                    required\n                                    defaultValue={\n                                        selectedEnquiry?.enquiryDate ||\n                                        format(new Date(), \"yyyy-MM-dd\")\n                                    }\n                                    data-testid=\"input-enquiry-date\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"leadSource\">Lead Source</Label>\n                                <Select\n                                    key={`source-${\n                                        selectedEnquiry?.id || enquiryFormKey\n                                    }`}\n                                    name=\"leadSource\"\n                                    defaultValue={\n                                        selectedEnquiry?.leadSource || \"\"\n                                    }>\n                                    <SelectTrigger data-testid=\"select-lead-source\">\n                                        <SelectValue placeholder=\"Select lead source\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {LEAD_SOURCES.map((source) => (\n                                            <SelectItem\n                                                key={source.value}\n                                                value={source.value}>\n                                                {source.label}\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"status\">Status *</Label>\n                                <Select\n                                    key={`status-${\n                                        selectedEnquiry?.id || enquiryFormKey\n                                    }`}\n                                    name=\"status\"\n                                    defaultValue={\n                                        selectedEnquiry?.status || \"new\"\n                                    }>\n                                    <SelectTrigger data-testid=\"select-status\">\n                                        <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {STATUS_OPTIONS.map((status) => (\n                                            <SelectItem\n                                                key={status.value}\n                                                value={status.value}>\n                                                {status.label}\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n\n                            <div className=\"col-span-full space-y-2\">\n                                <Label htmlFor=\"address\">Address</Label>\n                                <Textarea\n                                    id=\"address\"\n                                    name=\"address\"\n                                    defaultValue={\n                                        selectedEnquiry?.address || \"\"\n                                    }\n                                    data-testid=\"textarea-address\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"flex flex-wrap gap-2\">\n                            <Button\n                                type=\"submit\"\n                                data-testid=\"button-submit-enquiry\">\n                                {selectedEnquiry\n                                    ? \"Update Enquiry\"\n                                    : \"Create Enquiry\"}\n                            </Button>\n                            <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                onClick={() => {\n                                    setSelectedEnquiry(null);\n                                    setCurrentSection(1);\n                                }}\n                                data-testid=\"button-cancel-enquiry\">\n                                Cancel\n                            </Button>\n                        </div>\n                    </form>\n                </CardContent>\n            </Card>\n        </div>,\n\n        // Section 3: Followup List\n        <div\n            key=\"followup-list\"\n            className=\"min-w-full flex-shrink-0 p-6 space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                <h2\n                    className=\"text-2xl font-bold\"\n                    data-testid=\"text-followup-list-title\">\n                    Followup List\n                </h2>\n                <Button\n                    onClick={() => {\n                        setSelectedEnquiryForFollowup(null);\n                        setFollowupFormKey((prev) => prev + 1);\n                        setCurrentSection(4);\n                    }}\n                    data-testid=\"button-add-followup\">\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Add Followup\n                </Button>\n            </div>\n\n            <Card>\n                <CardContent className=\"p-0\">\n                    <div className=\"overflow-x-auto\">\n                        <Table>\n                            <TableHeader>\n                                <TableRow>\n                                    <TableHead>Enquiry ID</TableHead>\n                                    <TableHead>Followup Date</TableHead>\n                                    <TableHead>Status</TableHead>\n                                    <TableHead>Next Followup</TableHead>\n                                    <TableHead>Remark</TableHead>\n                                </TableRow>\n                            </TableHeader>\n                            <TableBody>\n                                {followups\n                                    .filter((followup) => {\n                                        const enquiry = enquiries.find(\n                                            (e) => e.id === followup.enquiryId\n                                        );\n                                        return enquiry?.status !== \"dropped\";\n                                    })\n                                    .map((followup) => (\n                                        <TableRow\n                                            key={followup.id}\n                                            data-testid={`row-followup-${followup.id}`}>\n                                            <TableCell>\n                                                {followup.enquiryId}\n                                            </TableCell>\n                                            <TableCell>\n                                                {followup.followupDate}\n                                            </TableCell>\n                                            <TableCell>\n                                                <span className=\"capitalize\">\n                                                    {followup.enquiryStatus.replace(\n                                                        \"_\",\n                                                        \" \"\n                                                    )}\n                                                </span>\n                                            </TableCell>\n                                            <TableCell>\n                                                {followup.nextFollowupDate ||\n                                                    \"N/A\"}\n                                            </TableCell>\n                                            <TableCell className=\"max-w-xs truncate\">\n                                                {followup.remark}\n                                            </TableCell>\n                                        </TableRow>\n                                    ))}\n                            </TableBody>\n                        </Table>\n                    </div>\n                </CardContent>\n            </Card>\n        </div>,\n\n        // Section 4: Add Followup Form\n        <div\n            key=\"followup-form\"\n            className=\"min-w-full flex-shrink-0 p-6 space-y-6\">\n            <h2\n                className=\"text-2xl font-bold\"\n                data-testid=\"text-followup-form-title\">\n                Add New Followup\n            </h2>\n\n            <Card>\n                <CardContent className=\"p-6\">\n                    <form\n                        key={followupFormKey}\n                        onSubmit={handleFollowupSubmit}\n                        className=\"space-y-4\">\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"enquiryId\">\n                                    Select Enquiry *\n                                </Label>\n                                <Select\n                                    key={`enquiry-${followupFormKey}`}\n                                    name=\"enquiryId\"\n                                    required\n                                    defaultValue={\n                                        selectedEnquiryForFollowup\n                                            ? String(selectedEnquiryForFollowup)\n                                            : undefined\n                                    }>\n                                    <SelectTrigger data-testid=\"select-enquiry-id\">\n                                        <SelectValue placeholder=\"Select an enquiry\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {enquiries.map((enq) => (\n                                            <SelectItem\n                                                key={enq.id}\n                                                value={String(enq.id)}>\n                                                {enq.customerName} -{\" \"}\n                                                {enq.mobileNo}\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"followupDate\">\n                                    Followup Date *\n                                </Label>\n                                <Input\n                                    id=\"followupDate\"\n                                    name=\"followupDate\"\n                                    type=\"date\"\n                                    required\n                                    defaultValue={format(\n                                        new Date(),\n                                        \"yyyy-MM-dd\"\n                                    )}\n                                    data-testid=\"input-followup-date\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"enquiryStatus\">\n                                    Enquiry Status *\n                                </Label>\n                                <Select\n                                    key={`enquiry-status-${followupFormKey}`}\n                                    name=\"enquiryStatus\"\n                                    required>\n                                    <SelectTrigger data-testid=\"select-enquiry-status\">\n                                        <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {STATUS_OPTIONS.map((status) => (\n                                            <SelectItem\n                                                key={status.value}\n                                                value={status.value}>\n                                                {status.label}\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"nextFollowupDate\">\n                                    Next Followup Date\n                                </Label>\n                                <Input\n                                    id=\"nextFollowupDate\"\n                                    name=\"nextFollowupDate\"\n                                    type=\"date\"\n                                    data-testid=\"input-next-followup-date\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"payment\">Payment</Label>\n                                <Input\n                                    id=\"payment\"\n                                    name=\"payment\"\n                                    data-testid=\"input-payment\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"expectedDeliveryDate\">\n                                    Expected Delivery Date\n                                </Label>\n                                <Input\n                                    id=\"expectedDeliveryDate\"\n                                    name=\"expectedDeliveryDate\"\n                                    type=\"date\"\n                                    data-testid=\"input-expected-delivery-date\"\n                                />\n                            </div>\n\n                            <div className=\"col-span-full space-y-2\">\n                                <Label htmlFor=\"remark\">Remark *</Label>\n                                <Textarea\n                                    id=\"remark\"\n                                    name=\"remark\"\n                                    required\n                                    data-testid=\"textarea-remark\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"flex flex-wrap gap-2\">\n                            <Button\n                                type=\"submit\"\n                                data-testid=\"button-submit-followup\">\n                                Create Followup\n                            </Button>\n                            <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                onClick={() => setCurrentSection(3)}\n                                data-testid=\"button-cancel-followup\">\n                                Cancel\n                            </Button>\n                        </div>\n                    </form>\n                </CardContent>\n            </Card>\n        </div>,\n\n        // Section 5: Reports (placeholder)\n        <div key=\"reports\" className=\"min-w-full flex-shrink-0 p-6 space-y-6\">\n            <h2 className=\"text-2xl font-bold\" data-testid=\"text-reports-title\">\n                CRM Reports\n            </h2>\n            <Card>\n                <CardContent className=\"p-6\">\n                    <div className=\"text-center text-muted-foreground\">\n                        <p>Reports section coming soon...</p>\n                        <p className=\"text-sm mt-2\">\n                            Track sales performance, conversion rates, and lead\n                            analysis.\n                        </p>\n                    </div>\n                </CardContent>\n            </Card>\n        </div>,\n    ];\n\n    return (\n        <div className=\"h-full flex flex-col\">\n            <div className=\"flex-none flex flex-wrap items-center justify-between gap-2 p-4 border-b\">\n                <h1 className=\"text-3xl font-bold\">CRM System</h1>\n                <div className=\"flex flex-wrap gap-2\">\n                    <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() =>\n                            setCurrentSection(Math.max(0, currentSection - 1))\n                        }\n                        disabled={currentSection === 0}\n                        data-testid=\"button-prev-section\">\n                        <ChevronLeft className=\"h-4 w-4\" />\n                    </Button>\n                    <span className=\"text-sm text-muted-foreground flex items-center\">\n                        {currentSection + 1} / {sections.length}\n                    </span>\n                    <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() =>\n                            setCurrentSection(\n                                Math.min(\n                                    sections.length - 1,\n                                    currentSection + 1\n                                )\n                            )\n                        }\n                        disabled={currentSection === sections.length - 1}\n                        data-testid=\"button-next-section\">\n                        <ChevronRight className=\"h-4 w-4\" />\n                    </Button>\n                </div>\n            </div>\n\n            <div className=\"flex-1 overflow-hidden\">\n                <div\n                    className=\"h-full flex transition-transform duration-300 ease-in-out\"\n                    style={{\n                        transform: `translateX(-${currentSection * 100}%)`,\n                    }}>\n                    {sections}\n                </div>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":44808,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/pages/EmailVerification.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { CheckCircle2, XCircle, Loader2 } from \"lucide-react\";\nimport { apiRequest , queryClient, API_BASE_URL} from \"@/lib/queryClient\";\n\nexport default function EmailVerification() {\n    const [, setLocation] = useLocation();\n    const [status, setStatus] = useState<\"loading\" | \"success\" | \"error\">(\n        \"loading\"\n    );\n    const [message, setMessage] = useState(\"\");\n    const [companyId, setCompanyId] = useState(\"\");\n\n    useEffect(() => {\n        const verifyEmail = async () => {\n            const params = new URLSearchParams(window.location.search);\n            const token = params.get(\"token\");\n\n            if (!token) {\n                setStatus(\"error\");\n                setMessage(\"Verification token is missing\");\n                return;\n            }\n\n            try {\n                const res = await apiRequest(\n                    `${API_BASE_URL}/api/auth/verify-company?token=${token}`,\n                    \"GET\"\n                );\n                const response = await res.json();\n                setStatus(\"success\");\n                setMessage(response.message);\n                setCompanyId(response.company.serverId);\n            } catch (error: any) {\n                setStatus(\"error\");\n                setMessage(\n                    error.message ||\n                        \"Verification failed. The token may be invalid or expired.\"\n                );\n            }\n        };\n\n        verifyEmail();\n    }, []);\n\n    return (\n        <div className=\"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4\">\n            <Card className=\"w-full max-w-md\">\n                <CardHeader className=\"text-center\">\n                    <div className=\"mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4\">\n                        {status === \"loading\" && (\n                            <div className=\"bg-blue-100 dark:bg-blue-900 w-full h-full rounded-full flex items-center justify-center\">\n                                <Loader2 className=\"h-8 w-8 text-blue-600 dark:text-blue-400 animate-spin\" />\n                            </div>\n                        )}\n                        {status === \"success\" && (\n                            <div className=\"bg-green-100 dark:bg-green-900 w-full h-full rounded-full flex items-center justify-center\">\n                                <CheckCircle2 className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n                            </div>\n                        )}\n                        {status === \"error\" && (\n                            <div className=\"bg-red-100 dark:bg-red-900 w-full h-full rounded-full flex items-center justify-center\">\n                                <XCircle className=\"h-8 w-8 text-red-600 dark:text-red-400\" />\n                            </div>\n                        )}\n                    </div>\n\n                    <CardTitle className=\"text-2xl\">\n                        {status === \"loading\" && \"Verifying Your Email...\"}\n                        {status === \"success\" && \"Email Verified!\"}\n                        {status === \"error\" && \"Verification Failed\"}\n                    </CardTitle>\n\n                    <CardDescription>\n                        {status === \"loading\" &&\n                            \"Please wait while we verify your email address\"}\n                        {status === \"success\" &&\n                            \"Your email has been successfully verified\"}\n                        {status === \"error\" &&\n                            \"We couldn't verify your email address\"}\n                    </CardDescription>\n                </CardHeader>\n\n                <CardContent className=\"space-y-4\">\n                    {status === \"success\" && (\n                        <>\n                            <div className=\"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500 p-4 rounded\">\n                                <p className=\"text-sm text-green-700 dark:text-green-400\">\n                                    {message}\n                                </p>\n                                {companyId && (\n                                    <p className=\"text-sm text-green-700 dark:text-green-400 mt-2\">\n                                        <strong>Your Company ID:</strong>{\" \"}\n                                        {companyId}\n                                    </p>\n                                )}\n                            </div>\n\n                            <Button\n                                onClick={() => setLocation(\"/login/admin\")}\n                                className=\"w-full bg-indigo-600 hover:bg-indigo-700\"\n                                data-testid=\"button-go-to-login\">\n                                Go to Login\n                            </Button>\n                        </>\n                    )}\n\n                    {status === \"error\" && (\n                        <>\n                            <div className=\"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 p-4 rounded\">\n                                <p className=\"text-sm text-red-700 dark:text-red-400\">\n                                    {message}\n                                </p>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Button\n                                    onClick={() => setLocation(\"/register\")}\n                                    className=\"w-full bg-indigo-600 hover:bg-indigo-700\"\n                                    data-testid=\"button-register-again\">\n                                    Try Registering Again\n                                </Button>\n                                <Button\n                                    onClick={() => setLocation(\"/\")}\n                                    variant=\"outline\"\n                                    className=\"w-full\"\n                                    data-testid=\"button-go-home\">\n                                    Go to Home\n                                </Button>\n                            </div>\n                        </>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":6532,"size_tokens":null},"client/src/components/FileUploadZone.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Upload, FileText, X } from \"lucide-react\";\nimport { useState } from \"react\";\n\ninterface FileUploadZoneProps {\n  accept?: string;\n  multiple?: boolean;\n  onFilesChange?: (files: File[]) => void;\n}\n\nexport default function FileUploadZone({ accept = \"*\", multiple = false, onFilesChange }: FileUploadZoneProps) {\n  const [files, setFiles] = useState<File[]>([]);\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) {\n      const newFiles = Array.from(e.target.files);\n      setFiles(multiple ? [...files, ...newFiles] : newFiles);\n      onFilesChange?.(multiple ? [...files, ...newFiles] : newFiles);\n      console.log(\"Files selected:\", newFiles.map(f => f.name));\n    }\n  };\n\n  const removeFile = (index: number) => {\n    const newFiles = files.filter((_, i) => i !== index);\n    setFiles(newFiles);\n    onFilesChange?.(newFiles);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <Card className=\"border-2 border-dashed hover-elevate cursor-pointer\" data-testid=\"zone-file-upload\">\n        <CardContent className=\"p-8\">\n          <input\n            type=\"file\"\n            id=\"file-upload\"\n            accept={accept}\n            multiple={multiple}\n            onChange={handleFileChange}\n            className=\"hidden\"\n            data-testid=\"input-file\"\n          />\n          <label htmlFor=\"file-upload\" className=\"cursor-pointer flex flex-col items-center gap-3\">\n            <Upload className=\"h-12 w-12 text-muted-foreground\" />\n            <div className=\"text-center\">\n              <p className=\"text-sm font-medium\">Click to upload or drag and drop</p>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                {accept === \"application/pdf\" ? \"PDF files only\" : accept === \"image/*\" ? \"Images only\" : \"Any file type\"}\n              </p>\n            </div>\n            <Button type=\"button\" variant=\"secondary\" size=\"sm\">\n              Browse Files\n            </Button>\n          </label>\n        </CardContent>\n      </Card>\n\n      {files.length > 0 && (\n        <div className=\"space-y-2\">\n          {files.map((file, index) => (\n            <Card key={index} data-testid={`card-file-${index}`}>\n              <CardContent className=\"p-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <FileText className=\"h-5 w-5 text-primary\" />\n                    <div>\n                      <p className=\"text-sm font-medium\">{file.name}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {(file.size / 1024).toFixed(1)} KB\n                      </p>\n                    </div>\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => removeFile(index)}\n                    data-testid={`button-remove-file-${index}`}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":3278,"size_tokens":null},"client/src/pages/user/Messages.tsx":{"content":"import { useAuth } from \"@/contexts/AuthContext\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest, API_BASE_URL } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Input } from \"@/components/ui/input\";\nimport { Send, MessageSquare, Mail, Search, ArrowLeft } from \"lucide-react\";\nimport { useState, useMemo, useRef, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\nimport { format } from \"date-fns\";\n\ninterface Message {\n    id: number;\n    senderId: number;\n    receiverId: number;\n    message: string;\n    messageType: string;\n    readStatus: boolean;\n    createdAt: string;\n}\n\ninterface TeamLeader {\n    id: number;\n    displayName: string;\n    email: string;\n    photoURL?: string;\n}\n\ninterface Conversation {\n    id: string;\n    type: \"admin\" | \"team_leader\";\n    userId?: number;\n    userName: string;\n    userRole?: string;\n    userPhoto?: string;\n    lastMessage: string;\n    lastMessageTime?: Date;\n}\n\nexport default function Messages() {\n    const { dbUserId } = useAuth();\n    const { toast } = useToast();\n    const messagesEndRef = useRef<HTMLDivElement>(null);\n    const [messageText, setMessageText] = useState(\"\");\n    const [searchText, setSearchText] = useState(\"\");\n    const [selectedConversation, setSelectedConversation] =\n        useState<Conversation | null>(null);\n    const [showConversationList, setShowConversationList] = useState(true);\n\n    const { data: allMessages = [], isLoading: loadingMessages } = useQuery<\n        Message[]\n    >({\n        queryKey: [\"/api/messages\"],\n        enabled: !!dbUserId,\n    });\n\n    const { data: teamLeaderInfo, isLoading: loadingLeader } =\n        useQuery<TeamLeader | null>({\n            queryKey: [\"/api/team-leader/me\"],\n            queryFn: async () => {\n                const res = await fetch(`${API_BASE_URL}/api/team-leader/me`, {\n                    credentials: \"include\",\n                    headers: {\n                        \"x-user-id\": dbUserId?.toString() || \"\",\n                    },\n                });\n\n                if (res.status === 404) {\n                    const body = await res.json().catch(() => ({}));\n                    if (body.message === \"NOT_ASSIGNED\") {\n                        return null;\n                    }\n                    throw new Error(\"User not found\");\n                }\n\n                if (!res.ok) {\n                    throw new Error(\"Failed to fetch team leader\");\n                }\n\n                return res.json();\n            },\n            enabled: !!dbUserId,\n            retry: false,\n        });\n\n    useWebSocket((data) => {\n        if (data.type === \"NEW_MESSAGE\") {\n            const messageData = data.data;\n\n            if (\n                messageData.senderId === dbUserId ||\n                messageData.receiverId === dbUserId\n            ) {\n                queryClient.invalidateQueries({ queryKey: [\"/api/messages\"] });\n\n                if (messageData.receiverId === dbUserId) {\n                    toast({\n                        title: \"New Message\",\n                        description: `${\n                            messageData.senderName\n                        }: ${messageData.message.substring(0, 50)}${\n                            messageData.message.length > 50 ? \"...\" : \"\"\n                        }`,\n                    });\n                }\n            }\n        }\n    });\n\n    const sendMessageMutation = useMutation({\n        mutationFn: async (data: { receiverId: number; message: string }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/messages`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/messages\"] });\n            setMessageText(\"\");\n            toast({\n                title: \"Success\",\n                description: \"Message sent successfully\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to send message\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const adminMessages = useMemo(() => {\n        return allMessages\n            .filter(\n                (msg) =>\n                    msg.messageType === \"admin_to_employee\" &&\n                    msg.receiverId === dbUserId\n            )\n            .sort(\n                (a, b) =>\n                    new Date(b.createdAt).getTime() -\n                    new Date(a.createdAt).getTime()\n            );\n    }, [allMessages, dbUserId]);\n\n    const teamLeaderMessages = useMemo(() => {\n        if (!teamLeaderInfo) return [];\n        return allMessages\n            .filter(\n                (msg) =>\n                    ((msg.senderId === teamLeaderInfo.id &&\n                        msg.receiverId === dbUserId) ||\n                        (msg.senderId === dbUserId &&\n                            msg.receiverId === teamLeaderInfo.id)) &&\n                    (msg.messageType === \"team_leader_to_employee\" ||\n                        msg.messageType === \"employee_to_team_leader\")\n            )\n            .sort(\n                (a, b) =>\n                    new Date(a.createdAt).getTime() -\n                    new Date(b.createdAt).getTime()\n            );\n    }, [teamLeaderInfo, allMessages, dbUserId]);\n\n    const conversations: Conversation[] = useMemo(() => {\n        const convs: Conversation[] = [];\n\n        if (adminMessages.length > 0) {\n            const lastAdmin = adminMessages[0];\n            convs.push({\n                id: \"admin-all\",\n                type: \"admin\",\n                userName: \"Admin Messages\",\n                lastMessage: lastAdmin.message,\n                lastMessageTime: new Date(lastAdmin.createdAt),\n            });\n        }\n\n        if (teamLeaderInfo) {\n            const lastTeamLeader =\n                teamLeaderMessages[teamLeaderMessages.length - 1];\n            convs.push({\n                id: `team-leader-${teamLeaderInfo.id}`,\n                type: \"team_leader\",\n                userId: teamLeaderInfo.id,\n                userName: teamLeaderInfo.displayName,\n                userRole: \"Team Leader\",\n                userPhoto: teamLeaderInfo.photoURL,\n                lastMessage: lastTeamLeader?.message || \"Start a conversation\",\n                lastMessageTime: lastTeamLeader\n                    ? new Date(lastTeamLeader.createdAt)\n                    : new Date(),\n            });\n        }\n\n        return convs;\n    }, [adminMessages, teamLeaderMessages, teamLeaderInfo]);\n\n    const filteredConversations = conversations.filter((conv) =>\n        conv.userName.toLowerCase().includes(searchText.toLowerCase())\n    );\n\n    const getConversationMessages = () => {\n        if (!selectedConversation) return [];\n        if (selectedConversation.type === \"admin\") return adminMessages;\n        return teamLeaderMessages;\n    };\n\n    const handleSendMessage = () => {\n        if (!messageText.trim() || !selectedConversation) return;\n\n        if (selectedConversation.type === \"team_leader\" && teamLeaderInfo) {\n            sendMessageMutation.mutate({\n                receiverId: teamLeaderInfo.id,\n                message: messageText.trim(),\n            });\n        }\n    };\n\n    const getInitials = (name: string) => {\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    const conversationMessages = getConversationMessages();\n\n    useEffect(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [conversationMessages]);\n\n    if (loadingMessages || loadingLeader) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"h-[80vh] md:h-[90vh] w-full flex flex-col overflow-hidden\">\n            <div className=\"flex-1 flex flex-col md:flex-row gap-0 bg-background overflow-hidden min-w-0\">\n                {/* LEFT SIDEBAR - Conversations List */}\n                <div\n                    className={`${\n                        showConversationList ? \"flex\" : \"hidden\"\n                    } md:flex w-full md:w-72 border-b md:border-b-0 md:border-r border-border flex-col min-h-0`}>\n                    <div className=\"flex-shrink-0 p-3 sm:p-4 border-b border-border space-y-3\">\n                        <h3 className=\"font-semibold text-sm\">Messages</h3>\n                        <div className=\"relative\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                            <Input\n                                placeholder=\"Search conversations...\"\n                                className=\"pl-9 h-9 text-sm\"\n                                value={searchText}\n                                onChange={(e) => setSearchText(e.target.value)}\n                                data-testid=\"input-search-messages\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto space-y-1 p-2 hide-scrollbar\">\n                        {filteredConversations.length === 0 ? (\n                            <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                                <p className=\"text-sm\">No conversations</p>\n                            </div>\n                        ) : (\n                            filteredConversations.map((conv) => (\n                                <button\n                                    key={conv.id}\n                                    onClick={() => {\n                                        setSelectedConversation(conv);\n                                        setShowConversationList(false);\n                                    }}\n                                    className={`w-full p-2 sm:p-3 rounded-lg text-left transition-colors ${\n                                        selectedConversation?.id === conv.id\n                                            ? \"bg-primary/10 border border-primary\"\n                                            : \"hover:bg-accent\"\n                                    }`}\n                                    data-testid={`button-conversation-${conv.id}`}>\n                                    <div className=\"flex items-start gap-2\">\n                                        <Avatar className=\"h-10 w-10 shrink-0\">\n                                            <AvatarImage src={conv.userPhoto} />\n                                            <AvatarFallback className=\"text-xs\">\n                                                {getInitials(conv.userName)}\n                                            </AvatarFallback>\n                                        </Avatar>\n                                        <div className=\"flex-1 min-w-0\">\n                                            <p className=\"font-medium text-sm truncate\">\n                                                {conv.userName}\n                                            </p>\n                                            {conv.userRole && (\n                                                <p className=\"text-xs text-muted-foreground\">\n                                                    {conv.userRole}\n                                                </p>\n                                            )}\n                                            <p className=\"text-xs text-muted-foreground truncate mt-1\">\n                                                {conv.lastMessage}\n                                            </p>\n                                            {conv.lastMessageTime && (\n                                                <p className=\"text-xs text-muted-foreground mt-1\">\n                                                    {format(\n                                                        conv.lastMessageTime,\n                                                        \"MMM dd, HH:mm\"\n                                                    )}\n                                                </p>\n                                            )}\n                                        </div>\n                                    </div>\n                                </button>\n                            ))\n                        )}\n                    </div>\n                </div>\n\n                {/* RIGHT SIDE - Chat Area - Full Height */}\n                <div className=\"flex-1 flex flex-col min-w-0 min-h-0 overflow-hidden\">\n                    {selectedConversation ? (\n                        <div className=\"flex flex-col h-full min-h-0 overflow-hidden\">\n                            {/* Header - Fixed */}\n                            <div className=\"flex-shrink-0 sticky top-0 z-50 px-3 sm:px-4 lg:px-5 py-2 sm:py-2 border-b border-border flex items-center gap-3 bg-background shadow-sm\">\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    className=\"md:hidden h-8 w-8\"\n                                    onClick={() => {\n                                        setShowConversationList(true);\n                                        setSelectedConversation(null);\n                                    }}\n                                    data-testid=\"button-back-conversations\">\n                                    <ArrowLeft className=\"h-3 w-3\" />\n                                </Button>\n                                <Avatar className=\"h-8 w-8 shrink-0\">\n                                    <AvatarImage\n                                        src={selectedConversation.userPhoto}\n                                    />\n                                    <AvatarFallback className=\"text-xs\">\n                                        {getInitials(\n                                            selectedConversation.userName\n                                        )}\n                                    </AvatarFallback>\n                                </Avatar>\n                                <div className=\"flex-1 min-w-0\">\n                                    <h3 className=\"font-semibold text-xs sm:text-sm truncate\">\n                                        {selectedConversation.userName}\n                                    </h3>\n                                    {selectedConversation.userRole && (\n                                        <p className=\"text-xs text-muted-foreground leading-tight\">\n                                            {selectedConversation.userRole}\n                                        </p>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Messages - Scrollable */}\n                            <div className=\"flex-1 overflow-y-auto min-h-0 px-3 sm:px-4 lg:px-5 py-1 sm:py-2 space-y-1 sm:space-y-2 hide-scrollbar\">\n                                {conversationMessages.length === 0 ? (\n                                    <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                                        <p className=\"text-sm\">\n                                            No messages yet\n                                        </p>\n                                    </div>\n                                ) : (\n                                    conversationMessages.map((msg) => {\n                                        const isOwn = msg.senderId === dbUserId;\n                                        return (\n                                            <div\n                                                key={msg.id}\n                                                className={`flex ${\n                                                    isOwn\n                                                        ? \"justify-end\"\n                                                        : \"justify-start\"\n                                                }`}\n                                                data-testid={`message-${msg.id}`}>\n                                                <div\n                                                    className={`rounded-lg p-2 sm:p-3 max-w-xs sm:max-w-md lg:max-w-lg text-sm break-words ${\n                                                        isOwn\n                                                            ? \"bg-primary text-primary-foreground\"\n                                                            : \"bg-muted\"\n                                                    }`}>\n                                                    <p className=\"break-words whitespace-pre-wrap\">\n                                                        {msg.message}\n                                                    </p>\n                                                    <p\n                                                        className={`text-xs mt-2 ${\n                                                            isOwn\n                                                                ? \"text-primary-foreground/70\"\n                                                                : \"text-muted-foreground\"\n                                                        }`}>\n                                                        {format(\n                                                            new Date(\n                                                                msg.createdAt\n                                                            ),\n                                                            \"HH:mm\"\n                                                        )}\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        );\n                                    })\n                                )}\n                                <div ref={messagesEndRef} />\n                            </div>\n\n                            {selectedConversation.type === \"team_leader\" && (\n                                <div className=\"flex-shrink-0 px-3 sm:px-4 lg:px-5 pt-2 sm:pt-3 pb-0 border-t border-border flex gap-2 items-center bg-background flex-nowrap\">\n                                    <div className=\"flex-1 flex items-center gap-2 bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-3xl px-3 py-2 shadow-sm\">\n                                        <Textarea\n                                            placeholder=\"Type a message\"\n                                            className=\"resize-none text-xs sm:text-sm flex-1 bg-transparent border-0 focus-visible:ring-0 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus-visible:outline-none min-h-4\"\n                                            rows={1}\n                                            value={messageText}\n                                            onChange={(e) =>\n                                                setMessageText(e.target.value)\n                                            }\n                                            onKeyDown={(e) => {\n                                                if (\n                                                    e.key === \"Enter\" &&\n                                                    !e.shiftKey\n                                                ) {\n                                                    e.preventDefault();\n                                                    handleSendMessage();\n                                                }\n                                            }}\n                                            data-testid=\"input-message\"\n                                        />\n                                    </div>\n                                    <Button\n                                        size=\"icon\"\n                                        onClick={handleSendMessage}\n                                        disabled={\n                                            !messageText.trim() ||\n                                            sendMessageMutation.isPending\n                                        }\n                                        data-testid=\"button-send-message\"\n                                        className=\"flex-shrink-0 h-8 w-8 sm:h-9 sm:w-9 rounded-full shadow-sm hover:shadow-md transition-shadow\">\n                                        <Send className=\"h-4 w-4\" />\n                                    </Button>\n                                </div>\n                            )}\n\n                            {/* Input - Fixed */}\n                            {selectedConversation.type === \"admin\" && (\n                                <div className=\"flex-shrink-0 px-3 sm:px-4 pt-2 pb-0 border-t border-border bg-muted/50 text-center\">\n                                    <p className=\"text-xs text-muted-foreground\">\n                                        Admin messages are read-only\n                                    </p>\n                                </div>\n                            )}\n                        </div>\n                    ) : (\n                        <div className=\"flex-1 flex items-center justify-center\">\n                            <div className=\"text-center\">\n                                <MessageSquare className=\"h-12 w-12 text-muted-foreground mx-auto mb-3\" />\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Select a conversation to start\n                                </p>\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":22437,"size_tokens":null},"client/src/components/RatingBadge.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { format } from \"date-fns\";\n\ninterface RatingBadgeProps {\n  rating: \"Excellent\" | \"Good\" | \"Needs Improvement\";\n  feedback?: string;\n  timestamp: Date;\n  period: string;\n}\n\nconst ratingColors = {\n  Excellent: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n  Good: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n  \"Needs Improvement\": \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400\",\n};\n\nexport default function RatingBadge({ rating, feedback, timestamp, period }: RatingBadgeProps) {\n  return (\n    <Card data-testid={`card-rating-${period.toLowerCase().replace(/\\s+/g, '-')}`}>\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center gap-3\">\n          <Avatar className=\"h-10 w-10\">\n            <AvatarFallback className=\"bg-primary text-primary-foreground\">A</AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1\">\n            <p className=\"text-sm font-semibold\">Admin Feedback</p>\n            <p className=\"text-xs text-muted-foreground font-mono\">\n              {format(timestamp, \"MMM dd, yyyy\")} • {period}\n            </p>\n          </div>\n          <Badge className={ratingColors[rating]} data-testid={`badge-rating-${period}`}>\n            {rating}\n          </Badge>\n        </div>\n      </CardHeader>\n      {feedback && (\n        <CardContent className=\"pt-0\">\n          <p className=\"text-sm text-muted-foreground\">{feedback}</p>\n        </CardContent>\n      )}\n    </Card>\n  );\n}\n","path":null,"size_bytes":1692,"size_tokens":null},"client/src/hooks/useTaskUpdates.ts":{"content":"import { useEffect } from 'react';\nimport { queryClient, API_BASE_URL } from '@/lib/queryClient';\n\nexport function useTaskUpdates() {\n  useEffect(() => {\n    const ws = new WebSocket(`${window.location.protocol === 'https:' ? 'wss:' : 'ws:'}//${window.location.host}/ws`);\n\n    ws.onopen = () => {\n      console.log('[WebSocket] Connected for task updates');\n    };\n\n    ws.onmessage = (event) => {\n      try {\n        const message = JSON.parse(event.data);\n        \n        if (message.type === 'task_updated' || message.type === 'task_deleted') {\n          console.log('[WebSocket] Task update received:', message.type);\n          // Invalidate tasks query to force refetch\n          queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/tasks`] });\n          queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/dashboard/stats`] });\n        }\n      } catch (error) {\n        console.error('[WebSocket] Error parsing message:', error);\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error('[WebSocket] Error:', error);\n    };\n\n    return () => {\n      ws.close();\n    };\n  }, []);\n}\n","path":null,"size_bytes":1121,"size_tokens":null},"client/src/pages/team-leader/TeamCorrectionRequests.tsx":{"content":"import {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Check, X, Clock, User } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useState } from \"react\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\n\ninterface CorrectionRequest {\n    id: number;\n    userId: number;\n    requestedDate: string;\n    originalClockIn?: string;\n    originalClockOut?: string;\n    correctedClockIn?: string;\n    correctedClockOut?: string;\n    reason: string;\n    status: string;\n    companyId: number;\n    displayName?: string;\n}\n\ninterface TeamMember {\n    id: number;\n    displayName: string;\n}\n\nexport default function TeamCorrectionRequests() {\n    const { dbUserId, companyId } = useAuth();\n    const { toast } = useToast();\n    const [statusFilter, setStatusFilter] = useState<string>(\"pending\");\n\n    const { data: teamMembers = [] } = useQuery<TeamMember[]>({\n        queryKey: [`/api/team-assignments/${dbUserId}/members`],\n        enabled: !!dbUserId,\n    });\n\n    const { data: teamCorrections = [], isLoading } = useQuery<\n        CorrectionRequest[]\n    >({\n        queryKey: [`/api/corrections/team/${dbUserId}`],\n        enabled: !!dbUserId,\n    });\n\n    const filteredCorrections =\n        statusFilter === \"all\"\n            ? teamCorrections\n            : teamCorrections.filter((corr) => corr.status === statusFilter);\n\n    const approveCorrection = useMutation({\n        mutationFn: async (correctionId: number) => {\n            return apiRequest(\n                `${API_BASE_URL}/api/corrections/${correctionId}/approve`,\n                \"PATCH\"\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [`/api/corrections/team/${dbUserId}`],\n            });\n            toast({\n                title: \"Success\",\n                description: \"Correction request approved\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to approve correction\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const rejectCorrection = useMutation({\n        mutationFn: async (correctionId: number) => {\n            return apiRequest(\n                `${API_BASE_URL}/api/corrections/${correctionId}/reject`,\n                \"PATCH\"\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [`/api/corrections/team/${dbUserId}`],\n            });\n            toast({\n                title: \"Success\",\n                description: \"Correction request rejected\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to reject correction\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const formatTime = (timeStr?: string) => {\n        if (!timeStr) return \"N/A\";\n        return new Date(timeStr).toLocaleTimeString(\"en-US\", {\n            hour: \"2-digit\",\n            minute: \"2-digit\",\n        });\n    };\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case \"approved\":\n                return \"default\";\n            case \"rejected\":\n                return \"destructive\";\n            case \"pending\":\n                return \"secondary\";\n            default:\n                return \"secondary\";\n        }\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                    <div>\n                        <Skeleton className=\"h-10 w-48 mb-2\" />\n                        <Skeleton className=\"h-5 w-72\" />\n                    </div>\n                </div>\n                <div className=\"space-y-4\">\n                    {[...Array(2)].map((_, i) => (\n                        <Skeleton key={i} className=\"h-48 w-full\" />\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\">Correction Requests</h1>\n                    <p className=\"text-muted-foreground\">\n                        Review and approve attendance correction requests\n                    </p>\n                </div>\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                    <SelectTrigger\n                        className=\"w-40\"\n                        data-testid=\"select-status-filter\">\n                        <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"all\">All</SelectItem>\n                        <SelectItem value=\"pending\">Pending</SelectItem>\n                        <SelectItem value=\"approved\">Approved</SelectItem>\n                        <SelectItem value=\"rejected\">Rejected</SelectItem>\n                    </SelectContent>\n                </Select>\n            </div>\n\n            <div className=\"grid gap-4\">\n                {filteredCorrections.map((request) => {\n                    const member = teamMembers.find(\n                        (m) => m.id === request.userId\n                    );\n\n                    return (\n                        <Card\n                            key={request.id}\n                            data-testid={`card-correction-${request.id}`}>\n                            <CardHeader>\n                                <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                                    <div className=\"flex-1 min-w-0\">\n                                        <CardTitle className=\"text-lg flex items-center gap-2\">\n                                            <User className=\"h-5 w-5\" />\n                                            {member?.displayName ||\n                                                \"Unknown Employee\"}\n                                        </CardTitle>\n                                        <CardDescription className=\"mt-2\">\n                                            <div className=\"space-y-1\">\n                                                <div className=\"flex items-center gap-2\">\n                                                    <Clock className=\"h-4 w-4\" />\n                                                    <span>\n                                                        {new Date(\n                                                            request.requestedDate\n                                                        ).toLocaleDateString()}\n                                                    </span>\n                                                </div>\n                                                {(request.originalClockIn ||\n                                                    request.correctedClockIn) && (\n                                                    <div className=\"flex items-center gap-2 text-sm\">\n                                                        <span className=\"font-medium\">\n                                                            Clock In:\n                                                        </span>\n                                                        <span className=\"text-destructive line-through\">\n                                                            {formatTime(\n                                                                request.originalClockIn\n                                                            )}\n                                                        </span>\n                                                        <span>→</span>\n                                                        <span className=\"text-green-600 font-medium\">\n                                                            {formatTime(\n                                                                request.correctedClockIn\n                                                            )}\n                                                        </span>\n                                                    </div>\n                                                )}\n                                                {(request.originalClockOut ||\n                                                    request.correctedClockOut) && (\n                                                    <div className=\"flex items-center gap-2 text-sm\">\n                                                        <span className=\"font-medium\">\n                                                            Clock Out:\n                                                        </span>\n                                                        <span className=\"text-destructive line-through\">\n                                                            {formatTime(\n                                                                request.originalClockOut\n                                                            )}\n                                                        </span>\n                                                        <span>→</span>\n                                                        <span className=\"text-green-600 font-medium\">\n                                                            {formatTime(\n                                                                request.correctedClockOut\n                                                            )}\n                                                        </span>\n                                                    </div>\n                                                )}\n                                            </div>\n                                        </CardDescription>\n                                    </div>\n                                    <Badge\n                                        variant={getStatusColor(\n                                            request.status\n                                        )}>\n                                        {request.status}\n                                    </Badge>\n                                </div>\n                            </CardHeader>\n                            <CardContent className=\"space-y-4\">\n                                <div>\n                                    <p className=\"text-sm font-medium mb-1\">\n                                        Reason:\n                                    </p>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                        {request.reason}\n                                    </p>\n                                </div>\n                                {request.status === \"pending\" && (\n                                    <div className=\"flex gap-2\">\n                                        <Button\n                                            variant=\"default\"\n                                            size=\"sm\"\n                                            onClick={() =>\n                                                approveCorrection.mutate(\n                                                    request.id\n                                                )\n                                            }\n                                            disabled={\n                                                approveCorrection.isPending ||\n                                                rejectCorrection.isPending\n                                            }\n                                            data-testid={`button-approve-correction-${request.id}`}>\n                                            <Check className=\"h-4 w-4 mr-2\" />\n                                            Approve\n                                        </Button>\n                                        <Button\n                                            variant=\"destructive\"\n                                            size=\"sm\"\n                                            onClick={() =>\n                                                rejectCorrection.mutate(\n                                                    request.id\n                                                )\n                                            }\n                                            disabled={\n                                                approveCorrection.isPending ||\n                                                rejectCorrection.isPending\n                                            }\n                                            data-testid={`button-reject-correction-${request.id}`}>\n                                            <X className=\"h-4 w-4 mr-2\" />\n                                            Reject\n                                        </Button>\n                                    </div>\n                                )}\n                            </CardContent>\n                        </Card>\n                    );\n                })}\n            </div>\n\n            {filteredCorrections.length === 0 && (\n                <Card>\n                    <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                        <p className=\"text-muted-foreground\">\n                            No {statusFilter !== \"all\" && statusFilter}{\" \"}\n                            correction requests found\n                        </p>\n                    </CardContent>\n                </Card>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":14147,"size_tokens":null},"client/src/components/CompanyDetailsModal.tsx":{"content":"import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Building2, Mail, Phone, MapPin, Users, TrendingUp, Calendar, DollarSign, Ban, CheckCircle, Trash2 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useState } from \"react\";\n\ninterface CompanyDetailsModalProps {\n  company: {\n    id: number;\n    serverId: string;\n    name: string;\n    email: string;\n    phone: string | null;\n    website: string | null;\n    location: string | null;\n    description: string | null;\n    companyType: string | null;\n    contactPerson: string | null;\n    designation: string | null;\n    mobile: string | null;\n    address: string | null;\n    pincode: string | null;\n    city: string | null;\n    state: string | null;\n    country: string | null;\n    employees: number | null;\n    annualTurnover: string | null;\n    yearEstablished: number | null;\n    logo: string | null;\n    isActive: boolean;\n    maxAdmins: number;\n    maxMembers: number;\n    createdBy: string | null;\n    updatedBy: string | null;\n    createdAt: string;\n    updatedAt: string;\n    currentAdmins?: number;\n    currentMembers?: number;\n  } | null;\n  open: boolean;\n  onClose: () => void;\n  onSuspend?: (companyId: number) => void;\n  onReactivate?: (companyId: number) => void;\n  onDelete?: (companyId: number) => void;\n}\n\nexport default function CompanyDetailsModal({\n  company,\n  open,\n  onClose,\n  onSuspend,\n  onReactivate,\n  onDelete,\n}: CompanyDetailsModalProps) {\n  const [suspendDialogOpen, setSuspendDialogOpen] = useState(false);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n\n  if (!company) return null;\n\n  const handleSuspend = () => {\n    if (onSuspend) {\n      onSuspend(company.id);\n      setSuspendDialogOpen(false);\n      onClose();\n    }\n  };\n\n  const handleReactivate = () => {\n    if (onReactivate) {\n      onReactivate(company.id);\n      onClose();\n    }\n  };\n\n  const handleDelete = () => {\n    if (onDelete) {\n      onDelete(company.id);\n      setDeleteDialogOpen(false);\n      onClose();\n    }\n  };\n\n  return (\n    <>\n      <Dialog open={open} onOpenChange={onClose}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-company-details\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-3\">\n              {company.logo ? (\n                <img \n                  src={company.logo} \n                  alt=\"Company Logo\" \n                  className=\"h-12 w-12 rounded-lg object-cover border\"\n                  data-testid=\"img-company-logo\"\n                />\n              ) : (\n                <div className=\"h-12 w-12 rounded-lg bg-muted flex items-center justify-center\">\n                  <Building2 className=\"h-6 w-6 text-muted-foreground\" />\n                </div>\n              )}\n              <div>\n                <h2 className=\"text-2xl font-bold\" data-testid=\"text-company-name\">{company.name}</h2>\n                <p className=\"text-sm text-muted-foreground\" data-testid=\"text-server-id\">{company.serverId}</p>\n              </div>\n            </DialogTitle>\n            <DialogDescription>\n              Complete company information and management actions\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-6 mt-4\">\n            {/* Status Badge */}\n            <div className=\"flex items-center justify-between\">\n              <Badge \n                variant={company.isActive ? \"default\" : \"destructive\"} \n                className=\"text-sm\"\n                data-testid=\"badge-company-status\"\n              >\n                {company.isActive ? \"🟢 Active\" : \"🔴 Suspended\"}\n              </Badge>\n              <div className=\"flex gap-2\">\n                {company.isActive ? (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setSuspendDialogOpen(true)}\n                    className=\"text-destructive\"\n                    data-testid=\"button-suspend\"\n                  >\n                    <Ban className=\"mr-2 h-4 w-4\" />\n                    Suspend Company\n                  </Button>\n                ) : (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleReactivate}\n                    className=\"text-green-600\"\n                    data-testid=\"button-reactivate\"\n                  >\n                    <CheckCircle className=\"mr-2 h-4 w-4\" />\n                    Reactivate Company\n                  </Button>\n                )}\n                <Button\n                  variant=\"destructive\"\n                  size=\"sm\"\n                  onClick={() => setDeleteDialogOpen(true)}\n                  data-testid=\"button-delete\"\n                >\n                  <Trash2 className=\"mr-2 h-4 w-4\" />\n                  Delete\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"grid gap-6 md:grid-cols-2\">\n              {/* Basic Information */}\n              <Card data-testid=\"card-basic-info\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <Building2 className=\"h-4 w-4\" />\n                    Basic Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Company Type</p>\n                    <p className=\"font-medium\" data-testid=\"text-company-type\">{company.companyType || \"Not specified\"}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Description</p>\n                    <p className=\"text-sm\" data-testid=\"text-description\">{company.description || \"No description provided\"}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Location</p>\n                    <p className=\"font-medium\" data-testid=\"text-location\">{company.location || \"Not specified\"}</p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Contact Information */}\n              <Card data-testid=\"card-contact-info\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <Mail className=\"h-4 w-4\" />\n                    Contact Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Contact Person</p>\n                    <p className=\"font-medium\" data-testid=\"text-contact-person\">{company.contactPerson || \"Not specified\"}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Designation</p>\n                    <p className=\"font-medium\" data-testid=\"text-designation\">{company.designation || \"Not specified\"}</p>\n                  </div>\n                  <Separator />\n                  <div>\n                    <p className=\"text-muted-foreground\">Email</p>\n                    <p className=\"font-medium\" data-testid=\"text-email\">{company.email}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Mobile</p>\n                    <p className=\"font-medium\" data-testid=\"text-mobile\">{company.mobile || \"Not specified\"}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Phone</p>\n                    <p className=\"font-medium\" data-testid=\"text-phone\">{company.phone || \"Not specified\"}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Website</p>\n                    <p className=\"font-medium text-xs break-all\" data-testid=\"text-website\">{company.website || \"Not specified\"}</p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Address Information */}\n              <Card data-testid=\"card-address-info\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <MapPin className=\"h-4 w-4\" />\n                    Address Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Address</p>\n                    <p className=\"text-sm\" data-testid=\"text-address\">{company.address || \"Not specified\"}</p>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div>\n                      <p className=\"text-muted-foreground\">City</p>\n                      <p className=\"font-medium\" data-testid=\"text-city\">{company.city || \"N/A\"}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Pincode</p>\n                      <p className=\"font-medium\" data-testid=\"text-pincode\">{company.pincode || \"N/A\"}</p>\n                    </div>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <div>\n                      <p className=\"text-muted-foreground\">State</p>\n                      <p className=\"font-medium\" data-testid=\"text-state\">{company.state || \"N/A\"}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Country</p>\n                      <p className=\"font-medium\" data-testid=\"text-country\">{company.country || \"N/A\"}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Business Information */}\n              <Card data-testid=\"card-business-info\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <TrendingUp className=\"h-4 w-4\" />\n                    Business Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Number of Employees</p>\n                    <p className=\"font-medium flex items-center gap-2\" data-testid=\"text-employees\">\n                      <Users className=\"h-4 w-4\" />\n                      {company.employees || \"Not specified\"}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Average Annual Turnover</p>\n                    <p className=\"font-medium\" data-testid=\"text-turnover\">{company.annualTurnover || \"Not specified\"}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Year Established</p>\n                    <p className=\"font-medium flex items-center gap-2\" data-testid=\"text-year-established\">\n                      <Calendar className=\"h-4 w-4\" />\n                      {company.yearEstablished || \"Not specified\"}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Slot Information */}\n              <Card data-testid=\"card-slot-info\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <DollarSign className=\"h-4 w-4\" />\n                    Slot Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Admin Slots</p>\n                    <p className=\"font-medium\" data-testid=\"text-admin-slots\">\n                      {company.currentAdmins !== undefined ? `${company.currentAdmins} / ${company.maxAdmins}` : company.maxAdmins}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Member Slots</p>\n                    <p className=\"font-medium\" data-testid=\"text-member-slots\">\n                      {company.currentMembers !== undefined ? `${company.currentMembers} / ${company.maxMembers}` : company.maxMembers}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Audit Information */}\n              <Card data-testid=\"card-audit-info\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <Calendar className=\"h-4 w-4\" />\n                    Audit Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">Created By</p>\n                    <p className=\"font-medium\" data-testid=\"text-created-by\">{company.createdBy || \"System\"}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Created Date</p>\n                    <p className=\"font-medium\" data-testid=\"text-created-date\">\n                      {format(new Date(company.createdAt), 'PPP p')}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Updated By</p>\n                    <p className=\"font-medium\" data-testid=\"text-updated-by\">{company.updatedBy || \"Not updated\"}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">Updated Date</p>\n                    <p className=\"font-medium\" data-testid=\"text-updated-date\">\n                      {format(new Date(company.updatedAt), 'PPP p')}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Suspend Confirmation Dialog */}\n      <AlertDialog open={suspendDialogOpen} onOpenChange={setSuspendDialogOpen}>\n        <AlertDialogContent data-testid=\"dialog-suspend-confirm\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Suspend Company?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to suspend <strong>{company.name}</strong>? \n              This will prevent all users from this company from accessing the system.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-suspend\">Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={handleSuspend}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-suspend\"\n            >\n              Suspend Company\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent data-testid=\"dialog-delete-confirm\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Company?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to permanently delete <strong>{company.name}</strong>? \n              This action cannot be undone and will remove all associated data including users, tasks, and reports.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={handleDelete}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              Delete Permanently\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","path":null,"size_bytes":16796,"size_tokens":null},"client/src/components/examples/FileUploadZone.tsx":{"content":"import FileUploadZone from '../FileUploadZone'\n\nexport default function FileUploadZoneExample() {\n  return (\n    <div className=\"max-w-2xl\">\n      <FileUploadZone accept=\"application/pdf\" multiple={true} />\n    </div>\n  )\n}\n","path":null,"size_bytes":224,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/hooks/useNotificationPermission.ts":{"content":"import { useEffect, useState } from 'react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { isFCMConfigured, requestNotificationPermission } from '@/lib/firebase';\nimport { apiRequest, queryClient, API_BASE_URL } from '@/lib/queryClient';\n\nexport function useNotificationPermission() {\n  const { user } = useAuth();\n  const [notificationStatus, setNotificationStatus] = useState<'idle' | 'requesting' | 'granted' | 'denied'>('idle');\n  const [error, setError] = useState<string | null>(null);\n\n  const requestPermission = async () => {\n    if (!isFCMConfigured) {\n      console.warn('Firebase Cloud Messaging is not configured');\n      return;\n    }\n\n    setNotificationStatus('requesting');\n    setError(null);\n\n    try {\n      const token = await requestNotificationPermission();\n      \n      if (token) {\n        await apiRequest(`${API_BASE_URL}/api/device-tokens`, 'POST', {\n          token,\n          deviceType: 'web',\n        });\n        setNotificationStatus('granted');\n      } else {\n        setNotificationStatus('denied');\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to request notification permission';\n      setError(errorMessage);\n      setNotificationStatus('denied');\n    }\n  };\n\n  useEffect(() => {\n    if (!user || !isFCMConfigured) return;\n\n    const hasRequestedBefore = localStorage.getItem('notification-permission-requested');\n    if (!hasRequestedBefore && Notification.permission === 'default') {\n      localStorage.setItem('notification-permission-requested', 'true');\n      requestPermission();\n    }\n  }, [user]);\n\n  return {\n    notificationStatus,\n    error,\n    requestPermission,\n    isAvailable: isFCMConfigured && 'Notification' in window,\n  };\n}\n","path":null,"size_bytes":1751,"size_tokens":null},"client/src/components/LoginPage.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useLocation, Link } from \"wouter\";\nimport { useEffect, useState } from \"react\";\nimport loginHeroImage from \"@assets/stock_images/workspace_desk_lapto_4a3916c9.jpg\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ShieldCheck } from \"lucide-react\";\nimport MultiStepRegistrationForm from \"@/components/MultiStepRegistrationForm\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function LoginPage() {\n  const { user, userRole, setUser, setUserRole, setDbUserId, setCompanyId } = useAuth();\n  const [location, setLocation] = useLocation();\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n  \n  const cleanPath = location.split('?')[0].replace(/\\/$/, '');\n  const formType = cleanPath === '/register' ? 'register' : cleanPath === '/login/admin' ? 'admin' : 'user';\n  \n  const [companyRegData, setCompanyRegData] = useState({ \n    name: \"\", \n    email: \"\", \n    password: \"\", \n    phone: \"\", \n    website: \"\", \n    location: \"\", \n    description: \"\", \n    acceptTerms: false \n  });\n  const [companyAdminData, setCompanyAdminData] = useState({ companyName: \"\", email: \"\", serverId: \"\", password: \"\" });\n  const [companyUserData, setCompanyUserData] = useState({ username: \"\", userId: \"\", password: \"\" });\n\n  useEffect(() => {\n    if (user && userRole) {\n      const isAdmin = userRole === \"super_admin\" || userRole === \"company_admin\";\n      const isUser = userRole === \"company_member\";\n      const isTeamLeader = userRole === \"team_leader\";\n      if (isAdmin) {\n        setLocation(\"/admin\");\n      } else if (isTeamLeader) {\n        setLocation(\"/team-leader\");\n      } else if (isUser) {\n        setLocation(\"/user\");\n      }\n    }\n  }, [user, userRole, setLocation]);\n\n  useEffect(() => {\n    setError(\"\");\n    setIsLoading(false);\n  }, [location]);\n\n  const handleCompanyRegistration = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\");\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/auth/register-company`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(companyRegData),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Registration failed');\n      }\n      \n      const data = await response.json();\n      toast({\n        title: \"Success!\",\n        description: data.message,\n        duration: 10000,\n      });\n      setCompanyRegData({ \n        name: \"\", \n        email: \"\", \n        password: \"\", \n        phone: \"\", \n        website: \"\", \n        location: \"\", \n        description: \"\", \n        acceptTerms: false \n      });\n      setIsLoading(false);\n    } catch (error: any) {\n      setError(error.message || \"Registration failed\");\n      setIsLoading(false);\n    }\n  };\n\n  const handleCompanyAdminLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\");\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/auth/company-admin-login`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(companyAdminData),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Login failed');\n      }\n      \n      const userData = await response.json();\n      if (userData.message) {\n        toast({\n          title: \"Welcome!\",\n          description: userData.message,\n          duration: 10000,\n        });\n      }\n      setUser(userData);\n      setUserRole(userData.role);\n      setDbUserId(userData.id);\n      setCompanyId(userData.companyId || null);\n      localStorage.setItem('user', JSON.stringify(userData));\n    } catch (error: any) {\n      setError(error.message || \"Login failed\");\n      setIsLoading(false);\n    }\n  };\n\n  const handleCompanyUserLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\");\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/auth/company-user-login`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(companyUserData),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Login failed');\n      }\n      \n      const userData = await response.json();\n      setUser(userData);\n      setUserRole(userData.role);\n      setDbUserId(userData.id);\n      setCompanyId(userData.companyId || null);\n      localStorage.setItem('user', JSON.stringify(userData));\n    } catch (error: any) {\n      setError(error.message || \"Login failed\");\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex\">\n      <div className=\"hidden lg:flex lg:w-1/2 relative overflow-hidden\">\n        <img\n          src={loginHeroImage}\n          alt=\"Professional workspace\"\n          className=\"object-cover w-full h-full\"\n        />\n        <div className=\"absolute inset-0 bg-gradient-to-r from-primary/20 to-primary/40\"></div>\n      </div>\n\n      <div className=\"flex-1 flex items-center justify-center p-4 sm:p-6 md:p-8 bg-background\">\n        <div className=\"w-full max-w-md space-y-6 sm:space-y-8\">\n          <div className=\"text-center\">\n            <h1 className=\"text-3xl sm:text-4xl font-bold text-foreground mb-2\">WorkLogix</h1>\n            <p className=\"text-sm sm:text-base text-muted-foreground\">Employee Work Tracking & Task Management</p>\n          </div>\n\n{formType === 'register' && <MultiStepRegistrationForm />}\n\n          {formType === 'admin' && (\n            <Card>\n              <CardHeader>\n                <CardTitle>Company Admin Login</CardTitle>\n                <CardDescription>Access your company dashboard</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <form onSubmit={handleCompanyAdminLogin} className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"admin-company-name\">Company Name</Label>\n                    <Input\n                      id=\"admin-company-name\"\n                      type=\"text\"\n                      placeholder=\"Acme Inc\"\n                      value={companyAdminData.companyName}\n                      onChange={(e) => setCompanyAdminData({ ...companyAdminData, companyName: e.target.value })}\n                      required\n                      data-testid=\"input-admin-company-name\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"admin-email\">Company Email</Label>\n                    <Input\n                      id=\"admin-email\"\n                      type=\"email\"\n                      placeholder=\"admin@company.com\"\n                      value={companyAdminData.email}\n                      onChange={(e) => setCompanyAdminData({ ...companyAdminData, email: e.target.value })}\n                      required\n                      data-testid=\"input-admin-email\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"admin-server-id\">Company Server ID</Label>\n                      <Link href=\"/forgot-company-id\" className=\"text-xs text-primary hover:underline\" data-testid=\"link-forgot-company-id\">\n                        Forgot Company ID?\n                      </Link>\n                    </div>\n                    <Input\n                      id=\"admin-server-id\"\n                      type=\"text\"\n                      placeholder=\"CMP-XYZ123\"\n                      value={companyAdminData.serverId}\n                      onChange={(e) => setCompanyAdminData({ ...companyAdminData, serverId: e.target.value })}\n                      required\n                      data-testid=\"input-admin-server-id\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"admin-password\">Password</Label>\n                      <Link href=\"/forgot-password\" className=\"text-xs text-primary hover:underline\" data-testid=\"link-forgot-password\">\n                        Forgot Password?\n                      </Link>\n                    </div>\n                    <Input\n                      id=\"admin-password\"\n                      type=\"password\"\n                      value={companyAdminData.password}\n                      onChange={(e) => setCompanyAdminData({ ...companyAdminData, password: e.target.value })}\n                      required\n                      data-testid=\"input-admin-password\"\n                    />\n                  </div>\n                  {error && <p className=\"text-sm text-red-500\" data-testid=\"error-message\">{error}</p>}\n                  <Button type=\"submit\" className=\"w-full\" disabled={isLoading} data-testid=\"button-admin-login\">\n                    {isLoading ? \"Signing in...\" : \"Sign In\"}\n                  </Button>\n                  <div className=\"text-center text-sm text-muted-foreground\">\n                    Don't have an account?{\" \"}\n                    <Link href=\"/register\" className=\"text-primary hover:underline\" data-testid=\"link-to-register\">\n                      Register Company\n                    </Link>\n                  </div>\n                </form>\n              </CardContent>\n            </Card>\n          )}\n\n          {formType === 'user' && (\n            <Card>\n              <CardHeader>\n                <CardTitle>Company User Login</CardTitle>\n                <CardDescription>Access your workspace</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <form onSubmit={handleCompanyUserLogin} className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"user-username\">Username</Label>\n                    <Input\n                      id=\"user-username\"\n                      type=\"text\"\n                      placeholder=\"John Doe\"\n                      value={companyUserData.username}\n                      onChange={(e) => setCompanyUserData({ ...companyUserData, username: e.target.value })}\n                      required\n                      data-testid=\"input-user-username\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"user-id\">User ID</Label>\n                    <Input\n                      id=\"user-id\"\n                      type=\"text\"\n                      placeholder=\"USER-ABC123\"\n                      value={companyUserData.userId}\n                      onChange={(e) => setCompanyUserData({ ...companyUserData, userId: e.target.value })}\n                      required\n                      data-testid=\"input-user-id\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"user-password\">Password</Label>\n                      <Link href=\"/forgot-password\" className=\"text-xs text-primary hover:underline\" data-testid=\"link-forgot-password-user\">\n                        Forgot Password?\n                      </Link>\n                    </div>\n                    <Input\n                      id=\"user-password\"\n                      type=\"password\"\n                      value={companyUserData.password}\n                      onChange={(e) => setCompanyUserData({ ...companyUserData, password: e.target.value })}\n                      required\n                      data-testid=\"input-user-password\"\n                    />\n                  </div>\n                  {error && <p className=\"text-sm text-red-500\" data-testid=\"error-message\">{error}</p>}\n                  <Button type=\"submit\" className=\"w-full\" disabled={isLoading} data-testid=\"button-user-login\">\n                    {isLoading ? \"Signing in...\" : \"Sign In\"}\n                  </Button>\n                  <div className=\"text-center text-sm text-muted-foreground\">\n                    Company admin?{\" \"}\n                    <Link href=\"/login/admin\" className=\"text-primary hover:underline\" data-testid=\"link-to-admin-login-from-user\">\n                      Admin Login\n                    </Link>\n                  </div>\n                </form>\n              </CardContent>\n            </Card>\n          )}\n\n          <div className=\"text-center\">\n            <Link href=\"/superadmin\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"text-xs text-muted-foreground hover:text-foreground\" data-testid=\"link-super-admin\">\n                <ShieldCheck className=\"mr-1.5 h-3.5 w-3.5\" />\n                Super Admin Access\n              </Button>\n            </Link>\n          </div>\n          \n          <p className=\"text-xs text-center text-muted-foreground\">\n            By continuing, you agree to our Terms of Service and Privacy Policy\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13670,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/pages/user/Overview.tsx":{"content":"import { useAuth } from \"@/contexts/AuthContext\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n    FileText,\n    CheckCircle2,\n    ListTodo,\n    Star,\n    Building2,\n} from \"lucide-react\";\nimport { useTaskUpdates } from \"@/hooks/useTaskUpdates\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface CompanyData {\n    id: number;\n    name: string;\n    maxAdmins: number;\n    maxMembers: number;\n    currentAdmins: number;\n    currentMembers: number;\n    isActive: boolean;\n}\n\nexport default function Overview() {\n    useTaskUpdates();\n    const { dbUserId, companyId } = useAuth();\n\n    const { data: stats, isLoading } = useQuery({\n        queryKey: [\"/api/dashboard/stats\"],\n        queryFn: async () => {\n            const user = localStorage.getItem(\"user\");\n            const userId = user ? JSON.parse(user).id : null;\n            const headers: Record<string, string> = {};\n            if (userId) {\n                headers[\"x-user-id\"] = userId.toString();\n            }\n\n            const tasks = await fetch(\n                `${API_BASE_URL}/api/tasks?userId=${dbUserId}`,\n                { headers, credentials: \"include\" }\n            ).then((r) => r.json());\n            const reports = await fetch(\n                `${API_BASE_URL}/api/reports?userId=${dbUserId}`,\n                { headers, credentials: \"include\" }\n            ).then((r) => r.json());\n            const ratings = await fetch(\n                `${API_BASE_URL}/api/ratings?userId=${dbUserId}`,\n                { headers, credentials: \"include\" }\n            ).then((r) => r.json());\n\n            return {\n                totalTasks: tasks.length,\n                completedTasks: tasks.filter(\n                    (t: any) => t.status === \"completed\"\n                ).length,\n                totalReports: reports.length,\n                averageRating: ratings.length > 0 ? ratings[0].rating : \"N/A\",\n            };\n        },\n        enabled: !!dbUserId,\n    });\n\n    const { data: company } = useQuery<CompanyData>({\n        queryKey: [\"/api/my-company\"],\n        enabled: !!companyId && !!dbUserId,\n    });\n\n    const statCards = [\n        {\n            title: \"Total Tasks\",\n            value: stats?.totalTasks || 0,\n            icon: ListTodo,\n            color: \"text-blue-600\",\n        },\n        {\n            title: \"Completed Tasks\",\n            value: stats?.completedTasks || 0,\n            icon: CheckCircle2,\n            color: \"text-green-600\",\n        },\n        {\n            title: \"Reports Submitted\",\n            value: stats?.totalReports || 0,\n            icon: FileText,\n            color: \"text-purple-600\",\n        },\n        {\n            title: \"Latest Rating\",\n            value: stats?.averageRating || \"N/A\",\n            icon: Star,\n            color: \"text-yellow-600\",\n        },\n    ];\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold\">Overview</h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    Your work summary and statistics\n                </p>\n            </div>\n\n            {/* Company Info */}\n            {company && (\n                <Card data-testid=\"card-company-info\">\n                    <CardContent className=\"p-4 sm:p-6\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-2 bg-primary/10 rounded-lg\">\n                                <Building2 className=\"h-5 w-5 text-primary\" />\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Company\n                                </p>\n                                <p\n                                    className=\"font-semibold\"\n                                    data-testid=\"text-user-company-name\">\n                                    {company.name}\n                                </p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n\n            <div className=\"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n                {statCards.map((stat) => (\n                    <Card\n                        key={stat.title}\n                        data-testid={`card-stat-${stat.title\n                            .toLowerCase()\n                            .replace(\" \", \"-\")}`}>\n                        <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                                {stat.title}\n                            </CardTitle>\n                            <stat.icon className={`h-5 w-5 ${stat.color}`} />\n                        </CardHeader>\n                        <CardContent>\n                            <div className=\"text-2xl font-bold\">\n                                {stat.value}\n                            </div>\n                        </CardContent>\n                    </Card>\n                ))}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":5563,"size_tokens":null},"client/src/pages/user/Attendance.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Clock, LogIn, LogOut, Calendar, Award, FileText, Flame, Target, Zap, Star } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport type { AttendanceRecord, Reward, AttendanceBadge, AttendanceStreak, AttendancePolicy } from \"@shared/schema\";\n\nexport default function Attendance() {\n  const { toast } = useToast();\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const [leaveDialogOpen, setLeaveDialogOpen] = useState(false);\n  const [leaveReason, setLeaveReason] = useState(\"\");\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  const { data: todayAttendance, isLoading } = useQuery<AttendanceRecord | null>({\n    queryKey: [\"/api/attendance/today\"],\n  });\n\n  const { data: rewards } = useQuery<Reward[]>({\n    queryKey: [\"/api/attendance/my-rewards\"],\n  });\n\n  const { data: badges } = useQuery<AttendanceBadge[]>({\n    queryKey: [\"/api/attendance/badges\"],\n  });\n\n  const { data: streak } = useQuery<{\n    currentStreak: number;\n    longestStreak: number;\n    earlyBirdCount: number;\n    onTimeCount: number;\n    lateCount: number;\n    absentCount: number;\n    totalWorkingDays: number;\n  }>({\n    queryKey: [\"/api/attendance/streak\"],\n  });\n\n  const { data: policyData } = useQuery<{\n    policy: AttendancePolicy;\n    shift: { startTime: string; endTime: string } | null;\n  }>({\n    queryKey: [\"/api/attendance/policy\"],\n  });\n\n  const checkInMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(`${API_BASE_URL}/api/attendance/check-in`, \"POST\", {\n        gpsLocation: null,\n        deviceId: navigator.userAgent,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance/today\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance/streak\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance/badges\"] });\n      toast({\n        title: \"Checked In Successfully\",\n        description: \"Your attendance has been marked for today.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Check-in Failed\",\n        description: error.message || \"Unable to check in. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const checkOutMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(`${API_BASE_URL}/api/attendance/check-out`, \"POST\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance/today\"] });\n      toast({\n        title: \"Checked Out Successfully\",\n        description: \"Your checkout time has been recorded.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Check-out Failed\",\n        description: error.message || \"Unable to check out. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const markLeaveMutation = useMutation({\n    mutationFn: async (reason: string) => {\n      return await apiRequest(`${API_BASE_URL}/api/attendance/mark-leave`, \"POST\", { reason });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/attendance/today\"] });\n      setLeaveDialogOpen(false);\n      setLeaveReason(\"\");\n      toast({\n        title: \"Leave Marked Successfully\",\n        description: \"Your attendance has been marked as leave for today.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Mark Leave\",\n        description: error.message || \"Unable to mark leave. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleMarkLeave = () => {\n    if (leaveReason.trim().length < 10) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Reason must be at least 10 characters long.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    markLeaveMutation.mutate(leaveReason);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { variant: any; label: string }> = {\n      present: { variant: \"default\", label: \"Present\" },\n      absent: { variant: \"destructive\", label: \"Absent\" },\n      late: { variant: \"secondary\", label: \"Late\" },\n      leave: { variant: \"outline\", label: \"On Leave\" },\n    };\n    const config = variants[status] || variants.absent;\n    return <Badge variant={config.variant} data-testid={`badge-status-${status}`}>{config.label}</Badge>;\n  };\n\n  const formatDuration = (minutes: number | null) => {\n    if (!minutes) return \"0h 0m\";\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return `${hours}h ${mins}m`;\n  };\n\n  const totalRewardPoints = rewards?.reduce((sum, r) => sum + r.points, 0) || 0;\n\n  return (\n    <div className=\"flex flex-col gap-6 p-6\">\n      <div>\n        <h1 className=\"text-2xl font-semibold\">Attendance</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          Track your daily attendance and view your records\n        </p>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n        <Card className=\"md:col-span-2\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Calendar className=\"w-5 h-5\" />\n              Today's Attendance\n            </CardTitle>\n            <CardDescription>\n              {format(currentTime, \"EEEE, MMMM d, yyyy\")}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"w-5 h-5 text-muted-foreground\" />\n                <span className=\"text-2xl font-mono\">{format(currentTime, \"HH:mm:ss\")}</span>\n              </div>\n              {todayAttendance && getStatusBadge(todayAttendance.status)}\n            </div>\n\n            {todayAttendance && (\n              <div className=\"grid grid-cols-2 gap-4 pt-4 border-t\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Check-In</p>\n                  <p className=\"text-lg font-medium\" data-testid=\"text-checkin-time\">\n                    {todayAttendance.checkIn\n                      ? format(new Date(todayAttendance.checkIn), \"hh:mm a\")\n                      : \"Not checked in\"}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Check-Out</p>\n                  <p className=\"text-lg font-medium\" data-testid=\"text-checkout-time\">\n                    {todayAttendance.checkOut\n                      ? format(new Date(todayAttendance.checkOut), \"hh:mm a\")\n                      : \"Not checked out\"}\n                  </p>\n                </div>\n                <div className=\"col-span-2\">\n                  <p className=\"text-sm text-muted-foreground\">Duration</p>\n                  <p className=\"text-lg font-medium\" data-testid=\"text-duration\">\n                    {formatDuration(todayAttendance.workDuration)}\n                  </p>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex gap-2 pt-4\">\n              {!todayAttendance?.checkIn && !todayAttendance?.status && (\n                <>\n                  <Button\n                    onClick={() => checkInMutation.mutate()}\n                    disabled={checkInMutation.isPending}\n                    className=\"flex-1\"\n                    data-testid=\"button-checkin\"\n                  >\n                    <LogIn className=\"w-4 h-4 mr-2\" />\n                    Check In\n                  </Button>\n                  <Button\n                    onClick={() => setLeaveDialogOpen(true)}\n                    disabled={markLeaveMutation.isPending}\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    data-testid=\"button-mark-leave\"\n                  >\n                    <FileText className=\"w-4 h-4 mr-2\" />\n                    Mark as Leave\n                  </Button>\n                </>\n              )}\n              {todayAttendance?.checkIn && !todayAttendance?.checkOut && (\n                <Button\n                  onClick={() => checkOutMutation.mutate()}\n                  disabled={checkOutMutation.isPending}\n                  variant=\"secondary\"\n                  className=\"flex-1\"\n                  data-testid=\"button-checkout\"\n                >\n                  <LogOut className=\"w-4 h-4 mr-2\" />\n                  Check Out\n                </Button>\n              )}\n              {todayAttendance?.checkOut && (\n                <div className=\"flex-1 p-3 text-center border rounded-md bg-muted\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    You have completed your attendance for today\n                  </p>\n                </div>\n              )}\n              {todayAttendance?.status === 'leave' && (\n                <div className=\"flex-1 p-3 text-center border rounded-md bg-muted\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    You are marked as on leave for today\n                  </p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Flame className=\"w-5 h-5\" />\n              Attendance Streak\n            </CardTitle>\n            <CardDescription>Your attendance performance</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"text-center p-4 border rounded-md bg-gradient-to-br from-orange-500/5 to-orange-500/10\">\n                  <div className=\"flex items-center justify-center gap-1\">\n                    <Flame className=\"w-4 h-4 text-orange-500\" />\n                    <p className=\"text-2xl font-bold text-orange-500\" data-testid=\"text-current-streak\">\n                      {streak?.currentStreak || 0}\n                    </p>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">Current Streak</p>\n                </div>\n                <div className=\"text-center p-4 border rounded-md bg-gradient-to-br from-yellow-500/5 to-yellow-500/10\">\n                  <div className=\"flex items-center justify-center gap-1\">\n                    <Star className=\"w-4 h-4 text-yellow-500\" />\n                    <p className=\"text-2xl font-bold text-yellow-500\" data-testid=\"text-longest-streak\">\n                      {streak?.longestStreak || 0}\n                    </p>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">Best Streak</p>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-3 gap-2 text-center\">\n                <div className=\"p-2 border rounded-md\">\n                  <p className=\"text-lg font-semibold text-green-600\" data-testid=\"text-early-bird\">\n                    {streak?.earlyBirdCount || 0}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground\">Early</p>\n                </div>\n                <div className=\"p-2 border rounded-md\">\n                  <p className=\"text-lg font-semibold text-blue-600\" data-testid=\"text-on-time\">\n                    {streak?.onTimeCount || 0}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground\">On Time</p>\n                </div>\n                <div className=\"p-2 border rounded-md\">\n                  <p className=\"text-lg font-semibold text-red-600\" data-testid=\"text-late-count\">\n                    {streak?.lateCount || 0}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground\">Late</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Award className=\"w-5 h-5\" />\n              Badges Earned\n            </CardTitle>\n            <CardDescription>Your attendance achievements</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {badges && badges.length > 0 ? (\n              <div className=\"flex flex-wrap gap-2\">\n                {badges.map((badge) => (\n                  <div\n                    key={badge.id}\n                    className=\"flex items-center gap-2 p-2 border rounded-md bg-gradient-to-r from-primary/5 to-primary/10\"\n                    data-testid={`badge-${badge.id}`}\n                  >\n                    {badge.badgeType === 'early_bird' && <Zap className=\"w-4 h-4 text-yellow-500\" />}\n                    {badge.badgeType === 'streak' && <Flame className=\"w-4 h-4 text-orange-500\" />}\n                    {badge.badgeType === 'perfect_month' && <Target className=\"w-4 h-4 text-green-500\" />}\n                    <div>\n                      <p className=\"text-sm font-medium\">{badge.badgeName}</p>\n                      <p className=\"text-xs text-muted-foreground\">{badge.description}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center p-6 text-muted-foreground\">\n                <Award className=\"w-10 h-10 mx-auto mb-2 opacity-20\" />\n                <p className=\"text-sm\">No badges earned yet</p>\n                <p className=\"text-xs\">Keep checking in on time to earn badges!</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Clock className=\"w-5 h-5\" />\n              Policy Rules\n            </CardTitle>\n            <CardDescription>Your company attendance rules</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {policyData?.shift && (\n                <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                  <span className=\"text-sm text-muted-foreground\">Shift Timing</span>\n                  <span className=\"text-sm font-medium\">\n                    {policyData.shift.startTime} - {policyData.shift.endTime}\n                  </span>\n                </div>\n              )}\n              <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Late After</span>\n                <Badge variant=\"outline\">\n                  {policyData?.policy?.lateMarkThreshold || 3} min\n                </Badge>\n              </div>\n              <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Half Day</span>\n                <Badge variant=\"outline\">\n                  {policyData?.policy?.halfDayHours || 4} hours\n                </Badge>\n              </div>\n              <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Full Day</span>\n                <Badge variant=\"outline\">\n                  {policyData?.policy?.fullDayHours || 8} hours\n                </Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={leaveDialogOpen} onOpenChange={setLeaveDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Mark as Leave</DialogTitle>\n            <DialogDescription>\n              Please provide a reason for marking today as leave. This will be visible to your admin.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <Textarea\n              placeholder=\"Enter your reason for leave (minimum 10 characters)...\"\n              value={leaveReason}\n              onChange={(e) => setLeaveReason(e.target.value)}\n              className=\"min-h-[100px]\"\n              data-testid=\"textarea-leave-reason\"\n            />\n            <p className=\"text-sm text-muted-foreground\">\n              {leaveReason.length}/10 characters minimum\n            </p>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setLeaveDialogOpen(false);\n                setLeaveReason(\"\");\n              }}\n              data-testid=\"button-cancel-leave\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleMarkLeave}\n              disabled={markLeaveMutation.isPending || leaveReason.trim().length < 10}\n              data-testid=\"button-submit-leave\"\n            >\n              {markLeaveMutation.isPending ? \"Submitting...\" : \"Submit Leave\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":17747,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/pages/user/Ratings.tsx":{"content":"import { useAuth } from \"@/contexts/AuthContext\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport RatingBadge from \"@/components/RatingBadge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { format } from \"date-fns\";\nimport type { Rating } from \"@shared/schema\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function Ratings() {\n    const { dbUserId } = useAuth();\n\n    const { data: ratings = [], isLoading } = useQuery<Rating[]>({\n        queryKey: [\"/api/ratings\", dbUserId],\n        queryFn: async () => {\n            const user = localStorage.getItem(\"user\");\n            const userId = user ? JSON.parse(user).id : null;\n            const headers: Record<string, string> = {};\n            if (userId) {\n                headers[\"x-user-id\"] = userId.toString();\n            }\n\n            const res = await fetch(\n                `${API_BASE_URL}/api/ratings?userId=${dbUserId}`,\n                { headers, credentials: \"include\" }\n            );\n            if (!res.ok) throw new Error(\"Failed to fetch ratings\");\n            return res.json();\n        },\n        enabled: !!dbUserId,\n    });\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold\">\n                    Performance Ratings\n                </h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    Your performance feedback\n                </p>\n            </div>\n\n            {ratings.length > 0 ? (\n                <div className=\"space-y-4\">\n                    {ratings.map((rating) => (\n                        <Card\n                            key={rating.id}\n                            data-testid={`card-rating-${rating.id}`}>\n                            <CardHeader>\n                                <div className=\"flex items-center justify-between\">\n                                    <CardTitle className=\"text-lg\">\n                                        <RatingBadge\n                                            rating={rating.rating as any}\n                                            timestamp={\n                                                new Date(rating.createdAt)\n                                            }\n                                            period={rating.period}\n                                        />\n                                    </CardTitle>\n                                </div>\n                            </CardHeader>\n                            {rating.feedback && (\n                                <CardContent>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                        {rating.feedback}\n                                    </p>\n                                </CardContent>\n                            )}\n                        </Card>\n                    ))}\n                </div>\n            ) : (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                    No ratings yet\n                </div>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":3423,"size_tokens":null},"client/src/components/FollowupCalendar.tsx":{"content":"import { useState } from \"react\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { format, isSameDay, parseISO, isAfter, isBefore, startOfDay } from \"date-fns\";\nimport { CalendarIcon, User, Phone, Mail } from \"lucide-react\";\nimport type { Followup, Enquiry } from \"@shared/schema\";\n\ninterface FollowupCalendarProps {\n  followups: Followup[];\n  enquiries: Enquiry[];\n}\n\ninterface FollowupWithEnquiry extends Followup {\n  enquiryDetails?: Enquiry;\n}\n\nexport default function FollowupCalendar({ followups, enquiries }: FollowupCalendarProps) {\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  const today = startOfDay(new Date());\n\n  // Get followups for a specific date\n  const getFollowupsForDate = (date: Date): FollowupWithEnquiry[] => {\n    return followups\n      .filter(f => {\n        if (!f.nextFollowupDate) return false;\n        const followupDate = parseISO(f.nextFollowupDate);\n        return isSameDay(followupDate, date);\n      })\n      .map(f => ({\n        ...f,\n        enquiryDetails: enquiries.find(e => e.id === f.enquiryId),\n      }))\n      .filter(f => f.enquiryDetails?.status !== 'dropped'); // Hide dropped enquiries\n  };\n\n  // Check if date has followups\n  const hasFollowups = (date: Date): { count: number; type: 'today' | 'overdue' | 'upcoming' } | null => {\n    const followupsOnDate = getFollowupsForDate(date);\n    if (followupsOnDate.length === 0) return null;\n\n    const dateStart = startOfDay(date);\n    \n    if (isSameDay(dateStart, today)) {\n      return { count: followupsOnDate.length, type: 'today' };\n    } else if (isBefore(dateStart, today)) {\n      return { count: followupsOnDate.length, type: 'overdue' };\n    } else {\n      return { count: followupsOnDate.length, type: 'upcoming' };\n    }\n  };\n\n  const handleDateClick = (date: Date | undefined) => {\n    if (!date) return;\n    const followupsOnDate = getFollowupsForDate(date);\n    if (followupsOnDate.length > 0) {\n      setSelectedDate(date);\n      setDialogOpen(true);\n    }\n  };\n\n  const getBadgeVariant = (type: 'today' | 'overdue' | 'upcoming') => {\n    switch (type) {\n      case 'today':\n        return 'destructive';\n      case 'overdue':\n        return 'secondary';\n      case 'upcoming':\n        return 'default';\n    }\n  };\n\n  const getBadgeLabel = (type: 'today' | 'overdue' | 'upcoming') => {\n    switch (type) {\n      case 'today':\n        return 'Today';\n      case 'overdue':\n        return 'Overdue';\n      case 'upcoming':\n        return 'Upcoming';\n    }\n  };\n\n  return (\n    <>\n      <Card data-testid=\"card-followup-calendar\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <CalendarIcon className=\"h-5 w-5\" />\n            Follow-up Calendar\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate || undefined}\n            onSelect={handleDateClick}\n            className=\"rounded-md border\"\n            modifiers={{\n              hasFollowups: (date) => hasFollowups(date) !== null,\n            }}\n            modifiersStyles={{\n              hasFollowups: {\n                fontWeight: 'bold',\n                position: 'relative',\n              },\n            }}\n            components={{\n              Day: ({ date, displayMonth }) => {\n                const followupInfo = hasFollowups(date);\n                const isToday = isSameDay(date, today);\n                \n                return (\n                  <div className=\"relative w-full h-full flex items-center justify-center\">\n                    <button\n                      type=\"button\"\n                      onClick={() => handleDateClick(date)}\n                      className={`\n                        h-9 w-9 p-0 font-normal aria-selected:opacity-100\n                        ${isToday ? 'bg-accent text-accent-foreground rounded-md' : ''}\n                        ${followupInfo ? 'font-bold' : ''}\n                        hover:bg-accent hover:text-accent-foreground rounded-md\n                      `}\n                      data-testid={`calendar-day-${format(date, 'yyyy-MM-dd')}`}\n                    >\n                      {format(date, 'd')}\n                      {followupInfo && (\n                        <span\n                          className={`\n                            absolute -top-1 -right-1 h-5 w-5 rounded-full text-[10px] flex items-center justify-center\n                            ${followupInfo.type === 'today' ? 'bg-destructive text-destructive-foreground' : ''}\n                            ${followupInfo.type === 'overdue' ? 'bg-orange-500 text-white dark:bg-orange-600' : ''}\n                            ${followupInfo.type === 'upcoming' ? 'bg-primary text-primary-foreground' : ''}\n                          `}\n                          data-testid={`calendar-badge-${format(date, 'yyyy-MM-dd')}`}\n                        >\n                          {followupInfo.count}\n                        </span>\n                      )}\n                    </button>\n                  </div>\n                );\n              },\n            }}\n          />\n          \n          <div className=\"mt-4 space-y-2\">\n            <div className=\"text-sm font-medium\">Legend:</div>\n            <div className=\"flex flex-wrap gap-2\">\n              <Badge variant=\"destructive\" data-testid=\"badge-legend-today\">\n                Today\n              </Badge>\n              <Badge variant=\"secondary\" className=\"bg-orange-500 text-white dark:bg-orange-600\" data-testid=\"badge-legend-overdue\">\n                Overdue\n              </Badge>\n              <Badge variant=\"default\" data-testid=\"badge-legend-upcoming\">\n                Upcoming\n              </Badge>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\" data-testid=\"dialog-followup-details\">\n          <DialogHeader>\n            <DialogTitle>\n              Follow-ups for {selectedDate && format(selectedDate, 'MMMM dd, yyyy')}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {selectedDate && getFollowupsForDate(selectedDate).map((followup) => (\n              <Card key={followup.id} data-testid={`followup-card-${followup.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1\">\n                      <CardTitle className=\"text-lg flex items-center gap-2\">\n                        <User className=\"h-4 w-4\" />\n                        {followup.enquiryDetails?.customerName || 'Unknown Customer'}\n                      </CardTitle>\n                      <Badge \n                        variant={getBadgeVariant(hasFollowups(selectedDate)?.type || 'upcoming')}\n                        className=\"mt-2\"\n                        data-testid={`followup-badge-${followup.id}`}\n                      >\n                        {getBadgeLabel(hasFollowups(selectedDate)?.type || 'upcoming')}\n                      </Badge>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {followup.enquiryDetails?.mobileNo && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        <span data-testid={`followup-phone-${followup.id}`}>\n                          {followup.enquiryDetails.mobileNo}\n                        </span>\n                      </div>\n                    )}\n                    {followup.enquiryDetails?.address && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"truncate\" data-testid={`followup-address-${followup.id}`}>\n                          {followup.enquiryDetails.address}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                  \n                  {followup.enquiryDetails?.productName && (\n                    <div className=\"text-sm\">\n                      <span className=\"font-medium\">Product: </span>\n                      <span className=\"text-muted-foreground\" data-testid={`followup-product-${followup.id}`}>\n                        {followup.enquiryDetails.productName}\n                        {followup.enquiryDetails.productVariant && ` - ${followup.enquiryDetails.productVariant}`}\n                      </span>\n                    </div>\n                  )}\n                  \n                  {followup.remark && (\n                    <div className=\"text-sm\">\n                      <span className=\"font-medium\">Follow-up Notes: </span>\n                      <p className=\"text-muted-foreground mt-1\" data-testid={`followup-notes-${followup.id}`}>\n                        {followup.remark}\n                      </p>\n                    </div>\n                  )}\n                  \n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <span className=\"font-medium\">Status: </span>\n                    <Badge variant=\"outline\" data-testid={`followup-status-${followup.id}`}>\n                      {followup.enquiryStatus.replace('_', ' ').toUpperCase()}\n                    </Badge>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","path":null,"size_bytes":10049,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/lib/passwordUtils.ts":{"content":"export const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/;\n\nexport function calculatePasswordStrength(password: string): {\n  strength: 'weak' | 'medium' | 'strong';\n  score: number;\n  color: string;\n  feedback: string;\n} {\n  let score = 0;\n  const feedback: string[] = [];\n\n  if (password.length < 8) {\n    return {\n      strength: 'weak',\n      score: 0,\n      color: 'bg-red-500',\n      feedback: 'Password must be at least 8 characters',\n    };\n  }\n\n  if (password.length >= 8) score += 25;\n  if (password.length >= 12) score += 15;\n\n  if (/[a-z]/.test(password)) {\n    score += 15;\n  } else {\n    feedback.push('Add lowercase letters');\n  }\n\n  if (/[A-Z]/.test(password)) {\n    score += 15;\n  } else {\n    feedback.push('Add uppercase letters');\n  }\n\n  if (/\\d/.test(password)) {\n    score += 15;\n  } else {\n    feedback.push('Add numbers');\n  }\n\n  if (/[@$!%*?&]/.test(password)) {\n    score += 15;\n  } else {\n    feedback.push('Add special characters (@$!%*?&)');\n  }\n\n  const hasNoSpaces = !/\\s/.test(password);\n  if (!hasNoSpaces) {\n    score -= 20;\n    feedback.push('Remove spaces');\n  }\n\n  let strength: 'weak' | 'medium' | 'strong';\n  let color: string;\n\n  if (score < 60) {\n    strength = 'weak';\n    color = 'bg-red-500';\n  } else if (score < 90) {\n    strength = 'medium';\n    color = 'bg-orange-500';\n  } else {\n    strength = 'strong';\n    color = 'bg-green-500';\n  }\n\n  return {\n    strength,\n    score: Math.min(100, score),\n    color,\n    feedback: feedback.join(', ') || 'Strong password!',\n  };\n}\n\nexport function validatePassword(password: string): {\n  isValid: boolean;\n  errors: string[];\n} {\n  const errors: string[] = [];\n\n  if (password.length < 8) {\n    errors.push('Password must be at least 8 characters');\n  }\n\n  if (!/[a-z]/.test(password)) {\n    errors.push('Must contain at least one lowercase letter');\n  }\n\n  if (!/[A-Z]/.test(password)) {\n    errors.push('Must contain at least one uppercase letter');\n  }\n\n  if (!/\\d/.test(password)) {\n    errors.push('Must contain at least one number');\n  }\n\n  if (!/[@$!%*?&]/.test(password)) {\n    errors.push('Must contain at least one special character (@$!%*?&)');\n  }\n\n  if (/\\s/.test(password)) {\n    errors.push('Password cannot contain spaces');\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors,\n  };\n}\n","path":null,"size_bytes":2346,"size_tokens":null},"client/src/components/ForgotPasswordPage.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Mail } from \"lucide-react\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function ForgotPasswordPage() {\n  const [email, setEmail] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\");\n\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/auth/forgot-password`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to send reset email');\n      }\n\n      setIsSuccess(true);\n      toast({\n        title: \"Email Sent!\",\n        description: \"Check your email for the password reset link.\",\n        duration: 5000,\n      });\n    } catch (error: any) {\n      setError(error.message || \"Failed to send reset email\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-background\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Mail className=\"h-6 w-6 text-primary\" />\n            Forgot Password\n          </CardTitle>\n          <CardDescription>\n            Enter your email address and we'll send you a link to reset your password\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {!isSuccess ? (\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email Address</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"admin@company.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  data-testid=\"input-email\"\n                />\n              </div>\n\n              {error && (\n                <p className=\"text-sm text-red-500\" data-testid=\"error-message\">\n                  {error}\n                </p>\n              )}\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={isLoading}\n                data-testid=\"button-send-reset-link\"\n              >\n                {isLoading ? \"Sending...\" : \"Send Reset Link\"}\n              </Button>\n\n              <div className=\"text-center\">\n                <Link href=\"/login/admin\" className=\"text-sm text-primary hover:underline inline-flex items-center gap-1\" data-testid=\"link-back-to-login\">\n                  <ArrowLeft className=\"h-3.5 w-3.5\" />\n                  Back to Login\n                </Link>\n              </div>\n            </form>\n          ) : (\n            <div className=\"space-y-4 text-center\">\n              <div className=\"mx-auto w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center\">\n                <Mail className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-semibold mb-2\">Check Your Email</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  We've sent a password reset link to <strong>{email}</strong>\n                </p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  This link will expire in 15 minutes for your security.\n                </p>\n              </div>\n              <div className=\"pt-4\">\n                <Link href=\"/login/admin\">\n                  <Button variant=\"outline\" className=\"w-full\" data-testid=\"button-back-to-login\">\n                    <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                    Back to Login\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4561,"size_tokens":null},"client/src/components/examples/MetricCard.tsx":{"content":"import MetricCard from '../MetricCard'\nimport { Users, FileText, CheckCircle, FolderOpen } from 'lucide-react'\n\nexport default function MetricCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n      <MetricCard title=\"Total Users\" value=\"24\" icon={Users} trend=\"+3 this month\" />\n      <MetricCard title=\"Today's Reports\" value=\"18\" icon={FileText} trend=\"75% submitted\" />\n      <MetricCard title=\"Pending Tasks\" value=\"12\" icon={CheckCircle} trend=\"3 due today\" />\n      <MetricCard title=\"Uploaded Files\" value=\"156\" icon={FolderOpen} trend=\"+8 today\" />\n    </div>\n  )\n}\n","path":null,"size_bytes":626,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/pages/admin/AdminRatings.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Star, Users as UsersIcon } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format } from \"date-fns\";\nimport { useState } from \"react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport type { Rating, User } from \"@shared/schema\";\nimport RatingDialog from \"@/components/RatingDialog\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function AdminRatings() {\n    const { data: users = [] } = useQuery<User[]>({\n        queryKey: [\"/api/users\"],\n    });\n\n    const { data: allRatings = [] } = useQuery<Rating[]>({\n        queryKey: [\"/api/ratings\"],\n    });\n\n    const employees = users.filter(\n        (u) => u.role === \"team_leader\" || u.role === \"company_member\"\n    );\n\n    const getUserNameById = (userId: number) => {\n        const user = users.find((u) => u.id === userId);\n        return user?.displayName || \"Unknown User\";\n    };\n\n    const getInitials = (name: string) => {\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    const getRatingStars = (rating: string) => {\n        const starCount: Record<string, number> = {\n            excellent: 5,\n            very_good: 4,\n            good: 3,\n            average: 2,\n            poor: 1,\n        };\n        return starCount[rating.toLowerCase()] || 3;\n    };\n\n    const getRatingLabel = (ratingStr: string): string => {\n        return ratingStr\n            .split(\"_\")\n            .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n            .join(\" \");\n    };\n\n    const renderStars = (rating: number) => {\n        return (\n            <div className=\"flex gap-1\">\n                {[1, 2, 3, 4, 5].map((star) => (\n                    <Star\n                        key={star}\n                        className={`h-4 w-4 ${\n                            star <= rating\n                                ? \"fill-yellow-400 text-yellow-400\"\n                                : \"text-muted-foreground\"\n                        }`}\n                    />\n                ))}\n            </div>\n        );\n    };\n\n    const getLeaderLatestRating = (leaderId: number) => {\n        const leaderRatings = allRatings.filter((r) => r.userId === leaderId);\n        return leaderRatings.sort(\n            (a, b) =>\n                new Date(b.createdAt).getTime() -\n                new Date(a.createdAt).getTime()\n        )[0];\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h2 className=\"text-3xl font-bold flex items-center gap-2\">\n                    <Star className=\"h-8 w-8\" />\n                    Performance Ratings\n                </h2>\n                <p className=\"text-muted-foreground mt-1\">\n                    Rate employees and view all ratings\n                </p>\n            </div>\n\n            <Tabs defaultValue=\"all-employees\" className=\"space-y-4\">\n                <TabsList>\n                    <TabsTrigger\n                        value=\"all-employees\"\n                        data-testid=\"tab-all-employees\">\n                        <UsersIcon className=\"h-4 w-4 mr-2\" />\n                        All Employees ({employees.length})\n                    </TabsTrigger>\n                    <TabsTrigger\n                        value=\"all-ratings\"\n                        data-testid=\"tab-all-ratings\">\n                        All Ratings ({allRatings.length})\n                    </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"all-employees\" className=\"space-y-4\">\n                    {employees.length > 0 ? (\n                        <div className=\"grid gap-4\">\n                            {employees.map((employee) => {\n                                const latestRating = getLeaderLatestRating(\n                                    employee.id\n                                );\n                                return (\n                                    <Card\n                                        key={employee.id}\n                                        data-testid={`card-employee-${employee.id}`}>\n                                        <CardHeader>\n                                            <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                                                <div className=\"flex items-center gap-3\">\n                                                    <Avatar className=\"h-12 w-12\">\n                                                        <AvatarImage\n                                                            src={\n                                                                employee.photoURL ||\n                                                                undefined\n                                                            }\n                                                        />\n                                                        <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                                                            {getInitials(\n                                                                employee.displayName\n                                                            )}\n                                                        </AvatarFallback>\n                                                    </Avatar>\n                                                    <div>\n                                                        <div className=\"flex items-center gap-2\">\n                                                            <CardTitle className=\"text-lg\">\n                                                                {\n                                                                    employee.displayName\n                                                                }\n                                                            </CardTitle>\n                                                            <Badge\n                                                                variant=\"secondary\"\n                                                                className=\"text-xs\">\n                                                                {employee.role ===\n                                                                \"team_leader\"\n                                                                    ? \"Team Leader\"\n                                                                    : \"Member\"}\n                                                            </Badge>\n                                                        </div>\n                                                        <p className=\"text-sm text-muted-foreground\">\n                                                            {employee.email}\n                                                        </p>\n                                                        {latestRating ? (\n                                                            <div className=\"flex items-center gap-2 mt-1\">\n                                                                {renderStars(\n                                                                    getRatingStars(\n                                                                        latestRating.rating\n                                                                    )\n                                                                )}\n                                                                <span className=\"text-sm font-semibold\">\n                                                                    {getRatingLabel(\n                                                                        latestRating.rating\n                                                                    )}\n                                                                </span>\n                                                            </div>\n                                                        ) : (\n                                                            <p className=\"text-sm text-muted-foreground mt-1\">\n                                                                No ratings yet\n                                                            </p>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                                <RatingDialog\n                                                    userId={employee.id}\n                                                    userName={\n                                                        employee.displayName\n                                                    }\n                                                    trigger={\n                                                        <Button\n                                                            variant=\"outline\"\n                                                            size=\"sm\"\n                                                            data-testid={`button-rate-${employee.id}`}>\n                                                            <Star className=\"h-4 w-4 mr-2\" />\n                                                            Rate Employee\n                                                        </Button>\n                                                    }\n                                                />\n                                            </div>\n                                        </CardHeader>\n                                        {latestRating && (\n                                            <CardContent>\n                                                <div className=\"space-y-3\">\n                                                    <div className=\"space-y-1\">\n                                                        <p className=\"text-sm text-muted-foreground\">\n                                                            Rating Period\n                                                        </p>\n                                                        <p className=\"text-sm font-medium\">\n                                                            {getRatingLabel(\n                                                                latestRating.period\n                                                            )}\n                                                        </p>\n                                                    </div>\n                                                    {latestRating.feedback && (\n                                                        <div className=\"space-y-1\">\n                                                            <p className=\"text-sm text-muted-foreground\">\n                                                                Feedback\n                                                            </p>\n                                                            <p className=\"text-sm\">\n                                                                {\n                                                                    latestRating.feedback\n                                                                }\n                                                            </p>\n                                                        </div>\n                                                    )}\n                                                    <div className=\"space-y-1\">\n                                                        <p className=\"text-sm text-muted-foreground\">\n                                                            Rated On\n                                                        </p>\n                                                        <p className=\"text-sm\">\n                                                            {format(\n                                                                new Date(\n                                                                    latestRating.createdAt\n                                                                ),\n                                                                \"MMMM dd, yyyy\"\n                                                            )}\n                                                        </p>\n                                                    </div>\n                                                </div>\n                                            </CardContent>\n                                        )}\n                                    </Card>\n                                );\n                            })}\n                        </div>\n                    ) : (\n                        <Card>\n                            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                                <UsersIcon className=\"h-12 w-12 text-muted-foreground mb-3\" />\n                                <p className=\"text-sm text-muted-foreground\">\n                                    No employees found\n                                </p>\n                            </CardContent>\n                        </Card>\n                    )}\n                </TabsContent>\n\n                <TabsContent value=\"all-ratings\">\n                    <Card>\n                        <CardHeader>\n                            <CardTitle>\n                                All Ratings ({allRatings.length})\n                            </CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                            {allRatings.length > 0 ? (\n                                <div className=\"grid gap-4 grid-cols-1 md:grid-cols-2\">\n                                    {allRatings.map((rating) => (\n                                        <Card\n                                            key={rating.id}\n                                            data-testid={`rating-${rating.id}`}>\n                                            <CardContent className=\"p-4\">\n                                                <div className=\"flex items-start justify-between mb-3\">\n                                                    <div className=\"flex-1 min-w-0\">\n                                                        <h4 className=\"font-semibold text-base truncate\">\n                                                            {getUserNameById(\n                                                                rating.userId\n                                                            )}\n                                                        </h4>\n                                                        <p className=\"text-sm text-muted-foreground\">\n                                                            {format(\n                                                                new Date(\n                                                                    rating.createdAt\n                                                                ),\n                                                                \"MMM dd, yyyy\"\n                                                            )}\n                                                        </p>\n                                                    </div>\n                                                    <Badge variant=\"outline\">\n                                                        {getRatingLabel(\n                                                            rating.period\n                                                        )}\n                                                    </Badge>\n                                                </div>\n                                                <div className=\"space-y-2\">\n                                                    <div className=\"flex items-center gap-2\">\n                                                        {renderStars(\n                                                            getRatingStars(\n                                                                rating.rating\n                                                            )\n                                                        )}\n                                                        <span className=\"text-sm font-medium\">\n                                                            {getRatingLabel(\n                                                                rating.rating\n                                                            )}\n                                                        </span>\n                                                    </div>\n                                                    {rating.feedback && (\n                                                        <p className=\"text-sm text-muted-foreground bg-muted/50 p-2 rounded\">\n                                                            {rating.feedback}\n                                                        </p>\n                                                    )}\n                                                </div>\n                                            </CardContent>\n                                        </Card>\n                                    ))}\n                                </div>\n                            ) : (\n                                <div className=\"text-center py-8 text-muted-foreground\">\n                                    No ratings yet\n                                </div>\n                            )}\n                        </CardContent>\n                    </Card>\n                </TabsContent>\n            </Tabs>\n        </div>\n    );\n}\n","path":null,"size_bytes":17923,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/pages/admin/AttendanceReports.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n    CardDescription,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n    Download,\n    Calendar,\n    TrendingUp,\n    Users,\n    Clock,\n    BarChart3,\n} from \"lucide-react\";\nimport { format, subDays, startOfMonth, endOfMonth } from \"date-fns\";\nimport {\n    LineChart,\n    Line,\n    BarChart,\n    Bar,\n    PieChart,\n    Pie,\n    Cell,\n    XAxis,\n    YAxis,\n    CartesianGrid,\n    Tooltip,\n    Legend,\n    ResponsiveContainer,\n} from \"recharts\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function AttendanceReports() {\n    const [dateRange, setDateRange] = useState(\"7\");\n    const [customStartDate, setCustomStartDate] = useState(\"\");\n    const [customEndDate, setCustomEndDate] = useState(\"\");\n\n    const getDateRange = () => {\n        const now = new Date();\n        let startDate = \"\";\n        let endDate = format(now, \"yyyy-MM-dd\");\n\n        switch (dateRange) {\n            case \"7\":\n                startDate = format(subDays(now, 7), \"yyyy-MM-dd\");\n                break;\n            case \"30\":\n                startDate = format(subDays(now, 30), \"yyyy-MM-dd\");\n                break;\n            case \"90\":\n                startDate = format(subDays(now, 90), \"yyyy-MM-dd\");\n                break;\n            case \"month\":\n                startDate = format(startOfMonth(now), \"yyyy-MM-dd\");\n                endDate = format(endOfMonth(now), \"yyyy-MM-dd\");\n                break;\n            case \"custom\":\n                startDate = customStartDate;\n                endDate = customEndDate;\n                break;\n            default:\n                startDate = format(subDays(now, 7), \"yyyy-MM-dd\");\n        }\n\n        return { startDate, endDate };\n    };\n\n    const { startDate, endDate } = getDateRange();\n\n    const { data: reportData, isLoading } = useQuery<{\n        summary: {\n            totalEmployees: number;\n            totalPresent: number;\n            totalAbsent: number;\n            totalLate: number;\n            totalLeave: number;\n            avgAttendanceRate: number;\n        };\n        dailyTrends: Array<{\n            date: string;\n            present: number;\n            absent: number;\n            late: number;\n            leave: number;\n        }>;\n        departmentStats?: Array<{\n            department: string;\n            present: number;\n            absent: number;\n            late: number;\n        }>;\n        employeeStats: Array<{\n            userId: number;\n            userName: string;\n            present: number;\n            absent: number;\n            late: number;\n            attendanceRate: number;\n        }>;\n    }>({\n        queryKey: [\n            \"/api/admin/attendance/reports\",\n            { startDate, endDate, type: \"summary\" },\n        ],\n        enabled:\n            !!startDate &&\n            !!endDate &&\n            (dateRange !== \"custom\" || (!!customStartDate && !!customEndDate)),\n    });\n\n    const handleExportCSV = () => {\n        if (!reportData) return;\n\n        const csvContent = [\n            [\"Attendance Report\", `${startDate} to ${endDate}`],\n            [],\n            [\"Summary Statistics\"],\n            [\"Total Employees\", reportData.summary.totalEmployees],\n            [\"Total Present\", reportData.summary.totalPresent],\n            [\"Total Absent\", reportData.summary.totalAbsent],\n            [\"Total Late\", reportData.summary.totalLate],\n            [\"Total Leave\", reportData.summary.totalLeave],\n            [\n                \"Average Attendance Rate\",\n                `${reportData.summary.avgAttendanceRate.toFixed(2)}%`,\n            ],\n            [],\n            [\"Employee Statistics\"],\n            [\"Name\", \"Present\", \"Absent\", \"Late\", \"Attendance Rate\"],\n            ...reportData.employeeStats.map((emp) => [\n                emp.userName,\n                emp.present,\n                emp.absent,\n                emp.late,\n                `${emp.attendanceRate.toFixed(2)}%`,\n            ]),\n        ]\n            .map((row) => row.join(\",\"))\n            .join(\"\\n\");\n\n        const blob = new Blob([csvContent], { type: \"text/csv\" });\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = `attendance-report-${startDate}-to-${endDate}.csv`;\n        a.click();\n        window.URL.revokeObjectURL(url);\n    };\n\n    const COLORS = {\n        present: \"#22c55e\",\n        absent: \"#ef4444\",\n        late: \"#f59e0b\",\n        leave: \"#3b82f6\",\n    };\n\n    const pieData = reportData\n        ? [\n              {\n                  name: \"Present\",\n                  value: reportData.summary.totalPresent,\n                  color: COLORS.present,\n              },\n              {\n                  name: \"Absent\",\n                  value: reportData.summary.totalAbsent,\n                  color: COLORS.absent,\n              },\n              {\n                  name: \"Late\",\n                  value: reportData.summary.totalLate,\n                  color: COLORS.late,\n              },\n              {\n                  name: \"Leave\",\n                  value: reportData.summary.totalLeave,\n                  color: COLORS.leave,\n              },\n          ]\n        : [];\n\n    return (\n        <div className=\"flex flex-col gap-6 p-6\">\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                <div>\n                    <h1 className=\"text-2xl font-semibold\">\n                        Attendance Reports & Analytics\n                    </h1>\n                    <p className=\"text-sm text-muted-foreground\">\n                        View comprehensive attendance statistics and trends\n                    </p>\n                </div>\n\n                <Button\n                    onClick={handleExportCSV}\n                    disabled={!reportData}\n                    data-testid=\"button-export-csv\">\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Export CSV\n                </Button>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                        <Calendar className=\"w-5 h-5\" />\n                        Date Range\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"flex gap-4 flex-wrap items-end\">\n                        <div className=\"flex-1 min-w-[200px]\">\n                            <Label>Select Period</Label>\n                            <Select\n                                value={dateRange}\n                                onValueChange={setDateRange}>\n                                <SelectTrigger data-testid=\"select-date-range\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"7\">\n                                        Last 7 Days\n                                    </SelectItem>\n                                    <SelectItem value=\"30\">\n                                        Last 30 Days\n                                    </SelectItem>\n                                    <SelectItem value=\"90\">\n                                        Last 90 Days\n                                    </SelectItem>\n                                    <SelectItem value=\"month\">\n                                        This Month\n                                    </SelectItem>\n                                    <SelectItem value=\"custom\">\n                                        Custom Range\n                                    </SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n\n                        {dateRange === \"custom\" && (\n                            <>\n                                <div className=\"flex-1 min-w-[150px]\">\n                                    <Label>Start Date</Label>\n                                    <Input\n                                        type=\"date\"\n                                        value={customStartDate}\n                                        onChange={(e) =>\n                                            setCustomStartDate(e.target.value)\n                                        }\n                                        data-testid=\"input-start-date\"\n                                    />\n                                </div>\n                                <div className=\"flex-1 min-w-[150px]\">\n                                    <Label>End Date</Label>\n                                    <Input\n                                        type=\"date\"\n                                        value={customEndDate}\n                                        onChange={(e) =>\n                                            setCustomEndDate(e.target.value)\n                                        }\n                                        data-testid=\"input-end-date\"\n                                    />\n                                </div>\n                            </>\n                        )}\n                    </div>\n\n                    {startDate && endDate && (\n                        <div className=\"mt-4 text-sm text-muted-foreground\">\n                            Showing data from{\" \"}\n                            <span className=\"font-medium\">\n                                {format(new Date(startDate), \"MMM dd, yyyy\")}\n                            </span>{\" \"}\n                            to{\" \"}\n                            <span className=\"font-medium\">\n                                {format(new Date(endDate), \"MMM dd, yyyy\")}\n                            </span>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n\n            {isLoading ? (\n                <div className=\"flex items-center justify-center h-64\">\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n                </div>\n            ) : reportData ? (\n                <>\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4\">\n                        <Card>\n                            <CardContent className=\"p-6\">\n                                <div className=\"flex items-center justify-between\">\n                                    <div>\n                                        <div className=\"text-sm text-muted-foreground\">\n                                            Total Employees\n                                        </div>\n                                        <div\n                                            className=\"text-2xl font-semibold\"\n                                            data-testid=\"text-total-employees\">\n                                            {reportData.summary.totalEmployees}\n                                        </div>\n                                    </div>\n                                    <Users className=\"w-8 h-8 text-muted-foreground\" />\n                                </div>\n                            </CardContent>\n                        </Card>\n\n                        <Card>\n                            <CardContent className=\"p-6\">\n                                <div className=\"flex items-center justify-between\">\n                                    <div>\n                                        <div className=\"text-sm text-muted-foreground\">\n                                            Present\n                                        </div>\n                                        <div\n                                            className=\"text-2xl font-semibold text-green-600\"\n                                            data-testid=\"text-total-present\">\n                                            {reportData.summary.totalPresent}\n                                        </div>\n                                    </div>\n                                    <div\n                                        className=\"w-8 h-8 rounded-full\"\n                                        style={{\n                                            backgroundColor: COLORS.present,\n                                        }}></div>\n                                </div>\n                            </CardContent>\n                        </Card>\n\n                        <Card>\n                            <CardContent className=\"p-6\">\n                                <div className=\"flex items-center justify-between\">\n                                    <div>\n                                        <div className=\"text-sm text-muted-foreground\">\n                                            Absent\n                                        </div>\n                                        <div\n                                            className=\"text-2xl font-semibold text-red-600\"\n                                            data-testid=\"text-total-absent\">\n                                            {reportData.summary.totalAbsent}\n                                        </div>\n                                    </div>\n                                    <div\n                                        className=\"w-8 h-8 rounded-full\"\n                                        style={{\n                                            backgroundColor: COLORS.absent,\n                                        }}></div>\n                                </div>\n                            </CardContent>\n                        </Card>\n\n                        <Card>\n                            <CardContent className=\"p-6\">\n                                <div className=\"flex items-center justify-between\">\n                                    <div>\n                                        <div className=\"text-sm text-muted-foreground\">\n                                            Late\n                                        </div>\n                                        <div\n                                            className=\"text-2xl font-semibold text-yellow-600\"\n                                            data-testid=\"text-total-late\">\n                                            {reportData.summary.totalLate}\n                                        </div>\n                                    </div>\n                                    <Clock className=\"w-8 h-8 text-yellow-600\" />\n                                </div>\n                            </CardContent>\n                        </Card>\n\n                        <Card>\n                            <CardContent className=\"p-6\">\n                                <div className=\"flex items-center justify-between\">\n                                    <div>\n                                        <div className=\"text-sm text-muted-foreground\">\n                                            Attendance Rate\n                                        </div>\n                                        <div\n                                            className=\"text-2xl font-semibold text-blue-600\"\n                                            data-testid=\"text-attendance-rate\">\n                                            {reportData.summary.avgAttendanceRate.toFixed(\n                                                1\n                                            )}\n                                            %\n                                        </div>\n                                    </div>\n                                    <TrendingUp className=\"w-8 h-8 text-blue-600\" />\n                                </div>\n                            </CardContent>\n                        </Card>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                        <Card>\n                            <CardHeader>\n                                <CardTitle className=\"flex items-center gap-2\">\n                                    <BarChart3 className=\"w-5 h-5\" />\n                                    Daily Attendance Trends\n                                </CardTitle>\n                                <CardDescription>\n                                    Attendance patterns over the selected period\n                                </CardDescription>\n                            </CardHeader>\n                            <CardContent>\n                                <ResponsiveContainer width=\"100%\" height={300}>\n                                    <LineChart data={reportData.dailyTrends}>\n                                        <CartesianGrid strokeDasharray=\"3 3\" />\n                                        <XAxis\n                                            dataKey=\"date\"\n                                            tickFormatter={(value) =>\n                                                format(\n                                                    new Date(value),\n                                                    \"MMM dd\"\n                                                )\n                                            }\n                                        />\n                                        <YAxis />\n                                        <Tooltip\n                                            labelFormatter={(value) =>\n                                                format(\n                                                    new Date(value),\n                                                    \"MMM dd, yyyy\"\n                                                )\n                                            }\n                                        />\n                                        <Legend />\n                                        <Line\n                                            type=\"monotone\"\n                                            dataKey=\"present\"\n                                            stroke={COLORS.present}\n                                            name=\"Present\"\n                                            strokeWidth={2}\n                                        />\n                                        <Line\n                                            type=\"monotone\"\n                                            dataKey=\"late\"\n                                            stroke={COLORS.late}\n                                            name=\"Late\"\n                                            strokeWidth={2}\n                                        />\n                                        <Line\n                                            type=\"monotone\"\n                                            dataKey=\"absent\"\n                                            stroke={COLORS.absent}\n                                            name=\"Absent\"\n                                            strokeWidth={2}\n                                        />\n                                        <Line\n                                            type=\"monotone\"\n                                            dataKey=\"leave\"\n                                            stroke={COLORS.leave}\n                                            name=\"Leave\"\n                                            strokeWidth={2}\n                                        />\n                                    </LineChart>\n                                </ResponsiveContainer>\n                            </CardContent>\n                        </Card>\n\n                        <Card>\n                            <CardHeader>\n                                <CardTitle>Attendance Distribution</CardTitle>\n                                <CardDescription>\n                                    Overall breakdown of attendance status\n                                </CardDescription>\n                            </CardHeader>\n                            <CardContent>\n                                <ResponsiveContainer width=\"100%\" height={300}>\n                                    <PieChart>\n                                        <Pie\n                                            data={pieData}\n                                            cx=\"50%\"\n                                            cy=\"50%\"\n                                            labelLine={false}\n                                            label={({ name, value, percent }) =>\n                                                `${name}: ${value} (${(\n                                                    percent * 100\n                                                ).toFixed(0)}%)`\n                                            }\n                                            outerRadius={80}\n                                            fill=\"#8884d8\"\n                                            dataKey=\"value\">\n                                            {pieData.map((entry, index) => (\n                                                <Cell\n                                                    key={`cell-${index}`}\n                                                    fill={entry.color}\n                                                />\n                                            ))}\n                                        </Pie>\n                                        <Tooltip />\n                                    </PieChart>\n                                </ResponsiveContainer>\n                            </CardContent>\n                        </Card>\n                    </div>\n\n                    <Card>\n                        <CardHeader>\n                            <CardTitle>\n                                Employee Attendance Statistics\n                            </CardTitle>\n                            <CardDescription>\n                                Individual employee performance over the\n                                selected period\n                            </CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                            <div className=\"overflow-x-auto\">\n                                <table className=\"w-full\">\n                                    <thead>\n                                        <tr className=\"border-b\">\n                                            <th className=\"text-left p-3 text-sm font-semibold\">\n                                                Employee\n                                            </th>\n                                            <th className=\"text-left p-3 text-sm font-semibold\">\n                                                Present\n                                            </th>\n                                            <th className=\"text-left p-3 text-sm font-semibold\">\n                                                Absent\n                                            </th>\n                                            <th className=\"text-left p-3 text-sm font-semibold\">\n                                                Late\n                                            </th>\n                                            <th className=\"text-left p-3 text-sm font-semibold\">\n                                                Attendance Rate\n                                            </th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        {reportData.employeeStats.map(\n                                            (employee) => (\n                                                <tr\n                                                    key={employee.userId}\n                                                    className=\"border-b hover-elevate\"\n                                                    data-testid={`employee-${employee.userId}`}>\n                                                    <td className=\"p-3 text-sm font-medium\">\n                                                        {employee.userName}\n                                                    </td>\n                                                    <td className=\"p-3 text-sm\">\n                                                        <Badge variant=\"default\">\n                                                            {employee.present}\n                                                        </Badge>\n                                                    </td>\n                                                    <td className=\"p-3 text-sm\">\n                                                        <Badge variant=\"destructive\">\n                                                            {employee.absent}\n                                                        </Badge>\n                                                    </td>\n                                                    <td className=\"p-3 text-sm\">\n                                                        <Badge variant=\"secondary\">\n                                                            {employee.late}\n                                                        </Badge>\n                                                    </td>\n                                                    <td className=\"p-3 text-sm\">\n                                                        <div className=\"flex items-center gap-2\">\n                                                            <div className=\"flex-1 bg-muted rounded-full h-2 max-w-[100px]\">\n                                                                <div\n                                                                    className=\"bg-primary h-2 rounded-full\"\n                                                                    style={{\n                                                                        width: `${employee.attendanceRate}%`,\n                                                                    }}\n                                                                />\n                                                            </div>\n                                                            <span className=\"font-medium\">\n                                                                {employee.attendanceRate.toFixed(\n                                                                    1\n                                                                )}\n                                                                %\n                                                            </span>\n                                                        </div>\n                                                    </td>\n                                                </tr>\n                                            )\n                                        )}\n                                    </tbody>\n                                </table>\n                            </div>\n                        </CardContent>\n                    </Card>\n                </>\n            ) : (\n                <Card>\n                    <CardContent className=\"p-12\">\n                        <div className=\"text-center text-muted-foreground\">\n                            Select a date range to view attendance reports\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":27767,"size_tokens":null},"client/src/pages/user/LeaveManagement.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n    Form,\n    FormControl,\n    FormField,\n    FormItem,\n    FormLabel,\n    FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Plus, Calendar, Clock } from \"lucide-react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport type { Leave } from \"@shared/schema\";\n\nconst leaveFormSchema = z.object({\n    startDate: z.string().min(1, \"Start date is required\"),\n    endDate: z.string().min(1, \"End date is required\"),\n    leaveType: z.string().min(1, \"Leave type is required\"),\n    reason: z.string().min(10, \"Reason must be at least 10 characters\"),\n});\n\ntype LeaveFormData = z.infer<typeof leaveFormSchema>;\n\nexport default function LeaveManagement() {\n    const { toast } = useToast();\n    const [dialogOpen, setDialogOpen] = useState(false);\n\n    const { data: leaves = [], isLoading } = useQuery<Leave[]>({\n        queryKey: [\"/api/leaves/me\"],\n    });\n\n    const form = useForm<LeaveFormData>({\n        resolver: zodResolver(leaveFormSchema),\n        defaultValues: {\n            startDate: \"\",\n            endDate: \"\",\n            leaveType: \"casual\",\n            reason: \"\",\n        },\n    });\n\n    const createLeaveMutation = useMutation({\n        mutationFn: async (data: LeaveFormData) => {\n            return await apiRequest(`${API_BASE_URL}/api/leaves`, \"POST\", data);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/leaves/me\"],\n            });\n            toast({\n                title: \"Leave request submitted\",\n                description:\n                    \"Your leave request has been submitted for approval.\",\n            });\n            form.reset();\n            setDialogOpen(false);\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description:\n                    \"Failed to submit leave request. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const onSubmit = (data: LeaveFormData) => {\n        if (new Date(data.endDate) < new Date(data.startDate)) {\n            toast({\n                title: \"Invalid dates\",\n                description: \"End date cannot be before start date.\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n        createLeaveMutation.mutate(data);\n    };\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case \"approved\":\n                return \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\";\n            case \"rejected\":\n                return \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\";\n            default:\n                return \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\";\n        }\n    };\n\n    return (\n        <div className=\"container mx-auto p-6 space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n                        Leave Management\n                    </h1>\n                    <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\n                        Request and manage your leaves\n                    </p>\n                </div>\n                <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n                    <DialogTrigger asChild>\n                        <Button data-testid=\"button-request-leave\">\n                            <Plus className=\"h-4 w-4 mr-2\" />\n                            Request Leave\n                        </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>Request Leave</DialogTitle>\n                        </DialogHeader>\n                        <Form {...form}>\n                            <form\n                                onSubmit={form.handleSubmit(onSubmit)}\n                                className=\"space-y-4\">\n                                <FormField\n                                    control={form.control}\n                                    name=\"startDate\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Start Date</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    type=\"date\"\n                                                    data-testid=\"input-start-date\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <FormField\n                                    control={form.control}\n                                    name=\"endDate\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>End Date</FormLabel>\n                                            <FormControl>\n                                                <Input\n                                                    type=\"date\"\n                                                    data-testid=\"input-end-date\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <FormField\n                                    control={form.control}\n                                    name=\"leaveType\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Leave Type</FormLabel>\n                                            <Select\n                                                onValueChange={field.onChange}\n                                                defaultValue={field.value}>\n                                                <FormControl>\n                                                    <SelectTrigger data-testid=\"select-leave-type\">\n                                                        <SelectValue placeholder=\"Select leave type\" />\n                                                    </SelectTrigger>\n                                                </FormControl>\n                                                <SelectContent>\n                                                    <SelectItem value=\"casual\">\n                                                        Casual Leave\n                                                    </SelectItem>\n                                                    <SelectItem value=\"sick\">\n                                                        Sick Leave\n                                                    </SelectItem>\n                                                    <SelectItem value=\"annual\">\n                                                        Annual Leave\n                                                    </SelectItem>\n                                                    <SelectItem value=\"emergency\">\n                                                        Emergency Leave\n                                                    </SelectItem>\n                                                </SelectContent>\n                                            </Select>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <FormField\n                                    control={form.control}\n                                    name=\"reason\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Reason</FormLabel>\n                                            <FormControl>\n                                                <Textarea\n                                                    data-testid=\"input-reason\"\n                                                    placeholder=\"Please provide a reason for your leave request...\"\n                                                    className=\"min-h-[100px]\"\n                                                    {...field}\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                                <div className=\"flex justify-end gap-2\">\n                                    <Button\n                                        type=\"button\"\n                                        variant=\"outline\"\n                                        onClick={() => setDialogOpen(false)}\n                                        data-testid=\"button-cancel\">\n                                        Cancel\n                                    </Button>\n                                    <Button\n                                        type=\"submit\"\n                                        disabled={createLeaveMutation.isPending}\n                                        data-testid=\"button-submit-leave\">\n                                        {createLeaveMutation.isPending\n                                            ? \"Submitting...\"\n                                            : \"Submit Request\"}\n                                    </Button>\n                                </div>\n                            </form>\n                        </Form>\n                    </DialogContent>\n                </Dialog>\n            </div>\n\n            <div className=\"grid gap-4\">\n                {isLoading && (\n                    <Card className=\"p-6\">\n                        <p className=\"text-center text-gray-500 dark:text-gray-400\">\n                            Loading...\n                        </p>\n                    </Card>\n                )}\n\n                {!isLoading && leaves.length === 0 && (\n                    <Card className=\"p-6\">\n                        <p\n                            className=\"text-center text-gray-500 dark:text-gray-400\"\n                            data-testid=\"text-no-leaves\">\n                            No leave requests yet. Click \"Request Leave\" to\n                            submit your first request.\n                        </p>\n                    </Card>\n                )}\n\n                {leaves.map((leave: any) => (\n                    <Card\n                        key={leave.id}\n                        className=\"p-6\"\n                        data-testid={`card-leave-${leave.id}`}>\n                        <div className=\"flex justify-between items-start\">\n                            <div className=\"space-y-2 flex-1\">\n                                <div className=\"flex items-center gap-3\">\n                                    <h3\n                                        className=\"font-semibold text-lg capitalize\"\n                                        data-testid={`text-leave-type-${leave.id}`}>\n                                        {leave.leaveType} Leave\n                                    </h3>\n                                    <span\n                                        className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(\n                                            leave.status\n                                        )}`}\n                                        data-testid={`status-leave-${leave.id}`}>\n                                        {leave.status.toUpperCase()}\n                                    </span>\n                                </div>\n                                <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400\">\n                                    <div className=\"flex items-center gap-1\">\n                                        <Calendar className=\"h-4 w-4\" />\n                                        <span\n                                            data-testid={`text-dates-${leave.id}`}>\n                                            {new Date(\n                                                leave.startDate\n                                            ).toLocaleDateString()}{\" \"}\n                                            -{\" \"}\n                                            {new Date(\n                                                leave.endDate\n                                            ).toLocaleDateString()}\n                                        </span>\n                                    </div>\n                                    <div className=\"flex items-center gap-1\">\n                                        <Clock className=\"h-4 w-4\" />\n                                        <span\n                                            data-testid={`text-applied-${leave.id}`}>\n                                            Applied:{\" \"}\n                                            {new Date(\n                                                leave.appliedDate\n                                            ).toLocaleDateString()}\n                                        </span>\n                                    </div>\n                                </div>\n                                <p\n                                    className=\"text-sm text-gray-700 dark:text-gray-300\"\n                                    data-testid={`text-reason-${leave.id}`}>\n                                    <span className=\"font-medium\">Reason:</span>{\" \"}\n                                    {leave.reason}\n                                </p>\n                            </div>\n                        </div>\n                    </Card>\n                ))}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":15221,"size_tokens":null},"client/src/components/RatingDialog.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Star } from \"lucide-react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient ,API_BASE_URL} from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface RatingDialogProps {\n  userId: number;\n  userName: string;\n  trigger: React.ReactNode;\n  onSuccess?: () => void;\n}\n\nconst RATING_OPTIONS = [\n  { value: \"excellent\", label: \"Excellent\", stars: 5 },\n  { value: \"very_good\", label: \"Very Good\", stars: 4 },\n  { value: \"good\", label: \"Good\", stars: 3 },\n  { value: \"average\", label: \"Average\", stars: 2 },\n  { value: \"poor\", label: \"Poor\", stars: 1 },\n];\n\nconst PERIOD_OPTIONS = [\n  { value: \"weekly\", label: \"Weekly\" },\n  { value: \"monthly\", label: \"Monthly\" },\n  { value: \"quarterly\", label: \"Quarterly\" },\n  { value: \"annual\", label: \"Annual\" },\n];\n\nexport default function RatingDialog({ userId, userName, trigger, onSuccess }: RatingDialogProps) {\n  const [open, setOpen] = useState(false);\n  const [rating, setRating] = useState(\"\");\n  const [period, setPeriod] = useState(\"\");\n  const [feedback, setFeedback] = useState(\"\");\n  const { toast } = useToast();\n\n  const submitRatingMutation = useMutation({\n    mutationFn: async (data: { userId: number; rating: string; period: string; feedback?: string }) => {\n      return await apiRequest(`${API_BASE_URL}/api/ratings`, 'POST', data);\n    },\n    onSuccess: () => {\n      // Invalidate all rating-related queries\n      queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/ratings`] });\n      // Invalidate team assignment queries (for team leader dashboards)\n      queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/team-assignments`] });\n      // Invalidate messages (since a notification is sent)\n      queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/messages`] });\n      toast({\n        title: \"Rating submitted\",\n        description: `Successfully rated ${userName}`,\n      });\n      setOpen(false);\n      setRating(\"\");\n      setPeriod(\"\");\n      setFeedback(\"\");\n      onSuccess?.();\n    },\n    onError: (error: any) => {\n      // Handle duplicate rating error (409) with user-friendly message\n      if (error.message?.includes(\"already rated\")) {\n        toast({\n          title: \"Duplicate Rating\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: error.message || \"Failed to submit rating\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!rating || !period) {\n      toast({\n        title: \"Validation error\",\n        description: \"Please select a rating and period\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    submitRatingMutation.mutate({\n      userId,\n      rating,\n      period,\n      feedback: feedback.trim() || undefined,\n    });\n  };\n\n  const selectedRating = RATING_OPTIONS.find(r => r.value === rating);\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        {trigger}\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>Rate {userName}</DialogTitle>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"rating\">Performance Rating *</Label>\n            <Select value={rating} onValueChange={setRating}>\n              <SelectTrigger id=\"rating\" data-testid=\"select-rating\">\n                <SelectValue placeholder=\"Select rating\" />\n              </SelectTrigger>\n              <SelectContent>\n                {RATING_OPTIONS.map((option) => (\n                  <SelectItem key={option.value} value={option.value}>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"flex\">\n                        {[...Array(5)].map((_, i) => (\n                          <Star\n                            key={i}\n                            className={`h-3 w-3 ${\n                              i < option.stars\n                                ? \"fill-yellow-400 text-yellow-400\"\n                                : \"text-muted-foreground\"\n                            }`}\n                          />\n                        ))}\n                      </div>\n                      <span>{option.label}</span>\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            {selectedRating && (\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <div className=\"flex\">\n                  {[...Array(5)].map((_, i) => (\n                    <Star\n                      key={i}\n                      className={`h-4 w-4 ${\n                        i < selectedRating.stars\n                          ? \"fill-yellow-400 text-yellow-400\"\n                          : \"text-muted-foreground\"\n                      }`}\n                    />\n                  ))}\n                </div>\n                <span>{selectedRating.label}</span>\n              </div>\n            )}\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"period\">Rating Period *</Label>\n            <Select value={period} onValueChange={setPeriod}>\n              <SelectTrigger id=\"period\" data-testid=\"select-period\">\n                <SelectValue placeholder=\"Select period\" />\n              </SelectTrigger>\n              <SelectContent>\n                {PERIOD_OPTIONS.map((option) => (\n                  <SelectItem key={option.value} value={option.value}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"feedback\">Feedback (Optional)</Label>\n            <Textarea\n              id=\"feedback\"\n              placeholder=\"Provide constructive feedback...\"\n              value={feedback}\n              onChange={(e) => setFeedback(e.target.value)}\n              rows={4}\n              data-testid=\"textarea-feedback\"\n            />\n          </div>\n\n          <div className=\"flex justify-end gap-2\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setOpen(false)}\n              disabled={submitRatingMutation.isPending}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={submitRatingMutation.isPending || !rating || !period}\n              data-testid=\"button-submit-rating\"\n            >\n              {submitRatingMutation.isPending ? \"Submitting...\" : \"Submit Rating\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect, Router as WouterRouter, useRouter } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider, useAuth } from \"@/contexts/AuthContext\";\nimport { WebSocketProvider } from \"@/contexts/WebSocketContext\";\nimport { NotificationPermissionBanner } from \"@/components/NotificationPermissionBanner\";\nimport LandingPage from \"@/pages/LandingPage\";\nimport LoginPage from \"@/components/LoginPage\";\nimport SuperAdminLogin from \"@/pages/SuperAdminLogin\";\nimport ForgotPasswordPage from \"@/components/ForgotPasswordPage\";\nimport ForgotCompanyIdPage from \"@/components/ForgotCompanyIdPage\";\nimport ResetPasswordPage from \"@/components/ResetPasswordPage\";\nimport CompanyRegistration from \"@/pages/CompanyRegistration\";\nimport EmailVerification from \"@/pages/EmailVerification\";\nimport UserLayout from \"@/components/UserLayout\";\nimport AdminLayout from \"@/components/AdminLayout\";\nimport TeamLeaderLayout from \"@/components/TeamLeaderLayout\";\nimport Overview from \"@/pages/user/Overview\";\nimport Reports from \"@/pages/user/Reports\";\nimport Messages from \"@/pages/user/Messages\";\nimport Feedback from \"@/pages/user/Feedback\";\nimport Tasks from \"@/pages/user/Tasks\";\nimport ReportView from \"@/pages/user/ReportView\";\nimport Ratings from \"@/pages/user/Ratings\";\nimport LeaveManagement from \"@/pages/user/LeaveManagement\";\nimport Attendance from \"@/pages/user/Attendance\";\nimport AttendanceHistory from \"@/pages/user/AttendanceHistory\";\nimport CorrectionRequests from \"@/pages/user/CorrectionRequests\";\nimport Dashboard from \"@/pages/admin/Dashboard\";\nimport LeaveApproval from \"@/pages/admin/LeaveApproval\";\nimport CorrectionApproval from \"@/pages/admin/CorrectionApproval\";\nimport AttendanceMonitor from \"@/pages/admin/AttendanceMonitor\";\nimport AttendanceReports from \"@/pages/admin/AttendanceReports\";\nimport AttendancePolicy from \"@/pages/admin/AttendancePolicy\";\nimport HolidayManagement from \"@/pages/admin/HolidayManagement\";\nimport Users from \"@/pages/admin/Users\";\nimport TeamMembersManagement from \"@/pages/admin/TeamMembersManagement\";\nimport AdminReports from \"@/pages/admin/AdminReports\";\nimport AdminTasks from \"@/pages/admin/AdminTasks\";\nimport AdminMessages from \"@/pages/admin/AdminMessages\";\nimport AdminRatings from \"@/pages/admin/AdminRatings\";\nimport AdminFeedback from \"@/pages/admin/AdminFeedback\";\nimport CompanyManagement from \"@/pages/admin/CompanyManagement\";\nimport CompanyProfile from \"@/pages/admin/CompanyProfile\";\nimport PaymentHistory from \"@/pages/admin/PaymentHistory\";\nimport CRM from \"@/pages/admin/CRM\";\nimport SuperAdminDashboard from \"@/pages/super-admin/SuperAdminDashboard\";\nimport PaymentTracking from \"@/pages/super-admin/PaymentTracking\";\nimport ActivityLogs from \"@/pages/super-admin/ActivityLogs\";\nimport TeamLeaderDashboard from \"@/pages/team-leader/TeamLeaderDashboard\";\nimport TeamMembers from \"@/pages/team-leader/TeamMembers\";\nimport TeamTasks from \"@/pages/team-leader/TeamTasks\";\nimport TeamLeaveApproval from \"@/pages/team-leader/TeamLeaveApproval\";\nimport TeamLeaderLeaveRequests from \"@/pages/team-leader/TeamLeaderLeaveRequests\";\nimport TeamCorrectionRequests from \"@/pages/team-leader/TeamCorrectionRequests\";\nimport TeamLeaderAttendance from \"@/pages/team-leader/TeamLeaderAttendance\";\nimport TeamAttendanceMonitor from \"@/pages/team-leader/TeamAttendanceMonitor\";\nimport TeamAttendanceReports from \"@/pages/team-leader/TeamAttendanceReports\";\nimport TeamLeaderMessages from \"@/pages/team-leader/TeamLeaderMessages\";\nimport TeamRatings from \"@/pages/team-leader/TeamRatings\";\nimport TeamFeedback from \"@/pages/team-leader/TeamFeedback\";\nfunction ProtectedRoute({\n    component: Component,\n    allowedRole,\n}: {\n    component: any;\n    allowedRole?: \"admin\" | \"user\" | \"super_admin\" | \"team_leader\";\n}) {\n    const { user, loading, userRole } = useAuth();\n\n    if (loading) {\n        return (\n            <div className=\"min-h-screen flex items-center justify-center bg-background\">\n                <div className=\"text-center space-y-4\">\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\n                    <p className=\"text-muted-foreground\">Loading...</p>\n                </div>\n            </div>\n        );\n    }\n\n    if (!user) {\n        return <Redirect to=\"/\" />;\n    }\n\n    const isSuperAdmin = userRole === \"super_admin\";\n    const isCompanyAdmin = userRole === \"company_admin\";\n    const isUser = userRole === \"company_member\";\n    const isTeamLeader = userRole === \"team_leader\";\n\n    if (allowedRole === \"super_admin\" && !isSuperAdmin) {\n        if (isCompanyAdmin) {\n            return <Redirect to=\"/admin\" />;\n        }\n        if (isTeamLeader) {\n            return <Redirect to=\"/team-leader\" />;\n        }\n        return <Redirect to=\"/user\" />;\n    }\n\n    if (allowedRole === \"admin\" && !isCompanyAdmin && !isSuperAdmin) {\n        if (isTeamLeader) {\n            return <Redirect to=\"/team-leader\" />;\n        }\n        return <Redirect to=\"/user\" />;\n    }\n\n    if (allowedRole === \"team_leader\" && !isTeamLeader) {\n        if (isSuperAdmin) {\n            return <Redirect to=\"/super-admin\" />;\n        }\n        if (isCompanyAdmin) {\n            return <Redirect to=\"/admin\" />;\n        }\n        return <Redirect to=\"/user\" />;\n    }\n\n    if (allowedRole === \"user\" && !isUser) {\n        if (isSuperAdmin) {\n            return <Redirect to=\"/super-admin\" />;\n        }\n        if (isCompanyAdmin) {\n            return <Redirect to=\"/admin\" />;\n        }\n        if (isTeamLeader) {\n            return <Redirect to=\"/team-leader\" />;\n        }\n    }\n\n    return <Component />;\n}\n\nfunction Router() {\n    const { user, userRole } = useAuth();\n\n    const getDefaultRoute = () => {\n        if (!user) return null;\n        if (userRole === \"super_admin\") return \"/super-admin/dashboard\";\n        if (userRole === \"company_admin\") return \"/admin/dashboard\";\n        if (userRole === \"team_leader\") return \"/team-leader/dashboard\";\n        if (userRole === \"company_member\") return \"/user/overview\";\n        return \"/admin/dashboard\";\n    };\n\n    const defaultRoute = getDefaultRoute();\n\n    return (\n        <Switch>\n            <Route\n                path=\"/\"\n                component={\n                    user && defaultRoute\n                        ? () => <Redirect to={defaultRoute} />\n                        : LandingPage\n                }\n            />\n            <Route path=\"/register\" component={CompanyRegistration} />\n            <Route path=\"/verify\" component={EmailVerification} />\n            <Route path=\"/login/admin\" component={LoginPage} />\n            <Route path=\"/login/user\" component={LoginPage} />\n            <Route\n                path=\"/login/company\"\n                component={() => <Redirect to=\"/login/admin\" />}\n            />\n            <Route path=\"/forgot-password\" component={ForgotPasswordPage} />\n            <Route path=\"/forgot-company-id\" component={ForgotCompanyIdPage} />\n            <Route path=\"/reset-password\" component={ResetPasswordPage} />\n            <Route path=\"/superadmin\" component={SuperAdminLogin} />\n            <Route path=\"/user/overview\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <Overview />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/reports\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <Reports />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/messages\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <Messages />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/feedback\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <Feedback />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/tasks\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <Tasks />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/report-view\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <ReportView />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/ratings\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <Ratings />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/leaves\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <LeaveManagement />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/attendance\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <Attendance />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/attendance-history\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <AttendanceHistory />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user/correction-requests\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <UserLayout>\n                                <CorrectionRequests />\n                            </UserLayout>\n                        )}\n                        allowedRole=\"user\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/user\">\n                <Redirect to=\"/user/overview\" />\n            </Route>\n            <Route path=\"/admin/dashboard\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <Dashboard />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/leaves\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <LeaveApproval />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/corrections\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <CorrectionApproval />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/attendance\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <AttendanceMonitor />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/attendance-reports\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <AttendanceReports />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/attendance-policy\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <AttendancePolicy />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/holidays\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <HolidayManagement />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/users\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <Users />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/team-members/:teamLeaderId\">\n                {(params) => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <TeamMembersManagement params={params} />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/reports\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <AdminReports />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/tasks\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <AdminTasks />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/messages\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <AdminMessages />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/ratings\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <AdminRatings />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/feedback\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <AdminFeedback />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/company-profile\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <CompanyProfile />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/company\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <CompanyManagement />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/payment-history\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <PaymentHistory />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin/crm\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <CRM />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/admin\">\n                <Redirect to=\"/admin/dashboard\" />\n            </Route>\n            <Route path=\"/super-admin/dashboard\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <SuperAdminDashboard />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"super_admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/super-admin/payments\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <PaymentTracking />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"super_admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/super-admin/activity\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <AdminLayout>\n                                <ActivityLogs />\n                            </AdminLayout>\n                        )}\n                        allowedRole=\"super_admin\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/super-admin\">\n                <Redirect to=\"/super-admin/dashboard\" />\n            </Route>\n            <Route path=\"/team-leader/dashboard\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamLeaderDashboard />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/team\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamMembers />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/tasks\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamTasks />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/leaves\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamLeaveApproval />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/leave-requests\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamLeaderLeaveRequests />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/corrections\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamCorrectionRequests />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/attendance\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamLeaderAttendance />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/attendance-monitor\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamAttendanceMonitor />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/attendance-reports\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamAttendanceReports />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/messages\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamLeaderMessages />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/ratings\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamRatings />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader/feedback\">\n                {() => (\n                    <ProtectedRoute\n                        component={() => (\n                            <TeamLeaderLayout>\n                                <TeamFeedback />\n                            </TeamLeaderLayout>\n                        )}\n                        allowedRole=\"team_leader\"\n                    />\n                )}\n            </Route>\n            <Route path=\"/team-leader\">\n                <Redirect to=\"/team-leader/dashboard\" />\n            </Route>\n            <Route>\n                <div className=\"min-h-screen flex items-center justify-center bg-background\">\n                    <div className=\"text-center space-y-4\">\n                        <h1 className=\"text-4xl font-bold\">404</h1>\n                        <p className=\"text-muted-foreground\">Page not found</p>\n                    </div>\n                </div>\n            </Route>\n        </Switch>\n    );\n}\n\nfunction App() {\n    const basePath = import.meta.env.MODE === \"production\" ? \"/worklogix\" : \"\";\n    return (\n        <WouterRouter base={basePath}>\n            <WebSocketProvider>\n                <QueryClientProvider client={queryClient}>\n                    <TooltipProvider>\n                        <AuthProvider>\n                            <Toaster />\n                            <NotificationPermissionBanner />\n                            <Router />\n                        </AuthProvider>\n                    </TooltipProvider>\n                </QueryClientProvider>\n            </WebSocketProvider>\n        </WouterRouter>\n    );\n}\n\nexport default App;\n","path":null,"size_bytes":27546,"size_tokens":null},"client/src/components/MetricCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface MetricCardProps {\n  title: string;\n  value: string | number;\n  icon: LucideIcon;\n  trend?: string;\n}\n\nexport default function MetricCard({ title, value, icon: Icon, trend }: MetricCardProps) {\n  return (\n    <Card data-testid={`card-metric-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"space-y-2\">\n            <p className=\"text-sm text-muted-foreground\">{title}</p>\n            <p className=\"text-3xl font-bold text-primary\">{value}</p>\n            {trend && (\n              <p className=\"text-xs text-muted-foreground\">{trend}</p>\n            )}\n          </div>\n          <div className=\"p-2 bg-primary/10 rounded-lg\">\n            <Icon className=\"h-6 w-6 text-primary\" />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":982,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/pages/CompanyRegistration.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport {\n    Form,\n    FormControl,\n    FormField,\n    FormItem,\n    FormLabel,\n    FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n    Building2,\n    Eye,\n    EyeOff,\n    Loader2,\n    CheckCircle2,\n    AlertCircle,\n} from \"lucide-react\";\nimport { SiGoogle } from \"react-icons/si\";\nimport { apiRequest, API_BASE_URL } from \"@/lib/queryClient\";\n\nconst registrationSchema = z\n    .object({\n        companyName: z\n            .string()\n            .min(2, \"Company name must be at least 2 characters\"),\n        email: z.string().email(\"Invalid email address\"),\n        password: z\n            .string()\n            .min(8, \"Password must be at least 8 characters\")\n            .regex(\n                /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/,\n                \"Password must contain uppercase, lowercase, number, and special character\"\n            ),\n        confirmPassword: z.string(),\n        acceptTerms: z.boolean(),\n    })\n    .refine((data) => data.password === data.confirmPassword, {\n        message: \"Passwords do not match\",\n        path: [\"confirmPassword\"],\n    });\n\ntype RegistrationFormData = z.infer<typeof registrationSchema>;\n\nexport default function CompanyRegistration() {\n    const [, setLocation] = useLocation();\n    const { toast } = useToast();\n    const [showPassword, setShowPassword] = useState(false);\n    const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n    const [isLoading, setIsLoading] = useState(false);\n    const [registrationSuccess, setRegistrationSuccess] = useState(false);\n    const [serverIdInfo, setServerIdInfo] = useState<{\n        serverId: string;\n        email: string;\n    } | null>(null);\n    const [googleOAuthEnabled, setGoogleOAuthEnabled] = useState(false);\n\n    const form = useForm<RegistrationFormData>({\n        resolver: zodResolver(registrationSchema),\n        defaultValues: {\n            companyName: \"\",\n            email: \"\",\n            password: \"\",\n            confirmPassword: \"\",\n            acceptTerms: false,\n        },\n    });\n\n    const password = form.watch(\"password\");\n\n    const getPasswordStrength = (pwd: string) => {\n        if (pwd.length === 0) return { strength: \"\", color: \"\" };\n        if (pwd.length < 6) return { strength: \"Weak\", color: \"text-red-500\" };\n        if (pwd.length < 8 || !/(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/.test(pwd))\n            return { strength: \"Medium\", color: \"text-yellow-500\" };\n        if (\n            /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/.test(\n                pwd\n            )\n        )\n            return { strength: \"Strong\", color: \"text-green-500\" };\n        return { strength: \"Medium\", color: \"text-yellow-500\" };\n    };\n\n    const passwordStrength = getPasswordStrength(password);\n\n    useEffect(() => {\n        const checkConfig = async () => {\n            try {\n                const res = await fetch(`${API_BASE_URL}/api/config`);\n                const config = await res.json();\n                setGoogleOAuthEnabled(config.googleOAuthEnabled || false);\n            } catch (error) {\n                console.error(\"Failed to fetch config:\", error);\n                setGoogleOAuthEnabled(false);\n            }\n        };\n        checkConfig();\n    }, []);\n\n    const onSubmit = async (data: RegistrationFormData) => {\n        if (!data.acceptTerms) {\n            toast({\n                title: \"Terms Required\",\n                description:\n                    \"You must accept the terms and conditions to register\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n\n        try {\n            setIsLoading(true);\n\n            const res = await apiRequest(\n                \"/api/auth/register-company-basic\",\n                \"POST\",\n                data\n            );\n            const response = await res.json();\n\n            setServerIdInfo({\n                serverId: response.serverId,\n                email: response.email,\n            });\n            setRegistrationSuccess(true);\n\n            toast({\n                title: \"Registration Successful!\",\n                description: `Your Company Server ID is ${response.serverId}. Please check your email for verification.`,\n            });\n        } catch (error: any) {\n            toast({\n                title: \"Registration Failed\",\n                description:\n                    error.message || \"An error occurred during registration\",\n                variant: \"destructive\",\n            });\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const handleGoogleSignIn = () => {\n        window.location.href = `${API_BASE_URL}/api/auth/google`;\n    };\n\n    if (registrationSuccess && serverIdInfo) {\n        return (\n            <div className=\"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4\">\n                <Card className=\"w-full max-w-md\">\n                    <CardHeader className=\"text-center\">\n                        <div className=\"mx-auto w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mb-4\">\n                            <CheckCircle2 className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n                        </div>\n                        <CardTitle className=\"text-2xl\">\n                            Registration Successful!\n                        </CardTitle>\n                        <CardDescription>\n                            Your company has been registered successfully\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-6\">\n                        <div className=\"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg p-6 text-center\">\n                            <p className=\"text-white text-sm mb-2 opacity-90\">\n                                Your Company Server ID\n                            </p>\n                            <p className=\"text-white text-3xl font-bold tracking-wider\">\n                                {serverIdInfo.serverId}\n                            </p>\n                        </div>\n\n                        <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 p-4 rounded\">\n                            <div className=\"flex items-start gap-2\">\n                                <AlertCircle className=\"h-5 w-5 text-yellow-600 dark:text-yellow-500 flex-shrink-0 mt-0.5\" />\n                                <div className=\"text-sm\">\n                                    <p className=\"font-semibold text-yellow-800 dark:text-yellow-500 mb-1\">\n                                        Important!\n                                    </p>\n                                    <p className=\"text-yellow-700 dark:text-yellow-400\">\n                                        Please save your Company Server ID. You\n                                        will need it to log in along with your\n                                        email and password.\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 p-4 rounded\">\n                            <div className=\"flex items-start gap-2\">\n                                <CheckCircle2 className=\"h-5 w-5 text-blue-600 dark:text-blue-500 flex-shrink-0 mt-0.5\" />\n                                <div className=\"text-sm\">\n                                    <p className=\"font-semibold text-blue-800 dark:text-blue-500 mb-1\">\n                                        Next Steps\n                                    </p>\n                                    <p className=\"text-blue-700 dark:text-blue-400\">\n                                        A verification email has been sent to{\" \"}\n                                        <strong>{serverIdInfo.email}</strong>.\n                                        Please check your inbox and verify your\n                                        email to activate your account.\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <Button\n                            onClick={() => setLocation(\"login/admin\")}\n                            className=\"w-full bg-indigo-600 hover:bg-indigo-700\"\n                            data-testid=\"button-go-to-login\">\n                            Go to Login\n                        </Button>\n                    </CardContent>\n                </Card>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4\">\n            <Card className=\"w-full max-w-md\">\n                <CardHeader className=\"text-center\">\n                    <div className=\"flex justify-center mb-4\">\n                        <Building2 className=\"h-12 w-12 text-indigo-600\" />\n                    </div>\n                    <CardTitle className=\"text-2xl\">\n                        Register Your Company\n                    </CardTitle>\n                    <CardDescription>\n                        Get your unique Company Server ID\n                    </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                    {googleOAuthEnabled && (\n                        <>\n                            <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                className=\"w-full gap-2\"\n                                onClick={handleGoogleSignIn}\n                                disabled={isLoading}\n                                data-testid=\"button-google-register\">\n                                <SiGoogle className=\"h-5 w-5\" />\n                                Register with Google\n                            </Button>\n\n                            <div className=\"relative\">\n                                <div className=\"absolute inset-0 flex items-center\">\n                                    <span className=\"w-full border-t\" />\n                                </div>\n                                <div className=\"relative flex justify-center text-xs uppercase\">\n                                    <span className=\"bg-background px-2 text-muted-foreground\">\n                                        Or\n                                    </span>\n                                </div>\n                            </div>\n                        </>\n                    )}\n\n                    <Form {...form}>\n                        <form\n                            onSubmit={form.handleSubmit(onSubmit)}\n                            className=\"space-y-4\">\n                            <FormField\n                                control={form.control}\n                                name=\"companyName\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>Company Name</FormLabel>\n                                        <FormControl>\n                                            <Input\n                                                placeholder=\"Enter your company name\"\n                                                {...field}\n                                                data-testid=\"input-company-name\"\n                                            />\n                                        </FormControl>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <FormField\n                                control={form.control}\n                                name=\"email\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>Email Address</FormLabel>\n                                        <FormControl>\n                                            <Input\n                                                type=\"email\"\n                                                placeholder=\"your.email@company.com\"\n                                                {...field}\n                                                data-testid=\"input-email\"\n                                            />\n                                        </FormControl>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <FormField\n                                control={form.control}\n                                name=\"password\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>Password</FormLabel>\n                                        <FormControl>\n                                            <div className=\"relative\">\n                                                <Input\n                                                    type={\n                                                        showPassword\n                                                            ? \"text\"\n                                                            : \"password\"\n                                                    }\n                                                    placeholder=\"Create a strong password\"\n                                                    {...field}\n                                                    data-testid=\"input-password\"\n                                                />\n                                                <button\n                                                    type=\"button\"\n                                                    onClick={() =>\n                                                        setShowPassword(\n                                                            !showPassword\n                                                        )\n                                                    }\n                                                    className=\"absolute right-3 top-1/2 -translate-y-1/2\"\n                                                    data-testid=\"button-toggle-password\">\n                                                    {showPassword ? (\n                                                        <EyeOff className=\"h-4 w-4 text-gray-500\" />\n                                                    ) : (\n                                                        <Eye className=\"h-4 w-4 text-gray-500\" />\n                                                    )}\n                                                </button>\n                                            </div>\n                                        </FormControl>\n                                        {password && (\n                                            <p\n                                                className={`text-sm ${passwordStrength.color}`}>\n                                                Strength:{\" \"}\n                                                {passwordStrength.strength}\n                                            </p>\n                                        )}\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <FormField\n                                control={form.control}\n                                name=\"confirmPassword\"\n                                render={({ field }) => (\n                                    <FormItem>\n                                        <FormLabel>Confirm Password</FormLabel>\n                                        <FormControl>\n                                            <div className=\"relative\">\n                                                <Input\n                                                    type={\n                                                        showConfirmPassword\n                                                            ? \"text\"\n                                                            : \"password\"\n                                                    }\n                                                    placeholder=\"Confirm your password\"\n                                                    {...field}\n                                                    data-testid=\"input-confirm-password\"\n                                                />\n                                                <button\n                                                    type=\"button\"\n                                                    onClick={() =>\n                                                        setShowConfirmPassword(\n                                                            !showConfirmPassword\n                                                        )\n                                                    }\n                                                    className=\"absolute right-3 top-1/2 -translate-y-1/2\"\n                                                    data-testid=\"button-toggle-confirm-password\">\n                                                    {showConfirmPassword ? (\n                                                        <EyeOff className=\"h-4 w-4 text-gray-500\" />\n                                                    ) : (\n                                                        <Eye className=\"h-4 w-4 text-gray-500\" />\n                                                    )}\n                                                </button>\n                                            </div>\n                                        </FormControl>\n                                        <FormMessage />\n                                    </FormItem>\n                                )}\n                            />\n\n                            <FormField\n                                control={form.control}\n                                name=\"acceptTerms\"\n                                render={({ field }) => (\n                                    <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                                        <FormControl>\n                                            <Checkbox\n                                                checked={field.value}\n                                                onCheckedChange={field.onChange}\n                                                data-testid=\"checkbox-terms\"\n                                            />\n                                        </FormControl>\n                                        <div className=\"space-y-1 leading-none\">\n                                            <FormLabel className=\"text-sm font-normal\">\n                                                I accept the{\" \"}\n                                                <a\n                                                    href=\"#\"\n                                                    className=\"text-indigo-600 hover:underline\">\n                                                    Terms & Conditions\n                                                </a>\n                                            </FormLabel>\n                                            <FormMessage />\n                                        </div>\n                                    </FormItem>\n                                )}\n                            />\n\n                            <Button\n                                type=\"submit\"\n                                className=\"w-full bg-indigo-600 hover:bg-indigo-700\"\n                                disabled={isLoading}\n                                data-testid=\"button-submit\">\n                                {isLoading ? (\n                                    <>\n                                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                                        Registering...\n                                    </>\n                                ) : (\n                                    \"Register Company\"\n                                )}\n                            </Button>\n                        </form>\n                    </Form>\n\n                    <div className=\"text-center text-sm text-gray-600 dark:text-gray-400\">\n                        Already have an account?{\" \"}\n                        <a\n                            href=\"login/admin\"\n                            className=\"text-indigo-600 hover:underline font-medium\"\n                            data-testid=\"link-login\">\n                            Login here\n                        </a>\n                    </div>\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":21767,"size_tokens":null},"client/src/pages/super-admin/ActivityLogs.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { format } from \"date-fns\";\nimport { Activity, Building2, User, Settings } from \"lucide-react\";\nimport type { AdminActivityLog } from \"@shared/schema\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function ActivityLogs() {\n    const { data: logs = [], isLoading } = useQuery<AdminActivityLog[]>({\n        queryKey: [\"/api/super-admin/activity-logs\"],\n    });\n\n    const getActionIcon = (actionType: string) => {\n        if (actionType.includes(\"company\"))\n            return <Building2 className=\"h-4 w-4\" />;\n        if (actionType.includes(\"user\")) return <User className=\"h-4 w-4\" />;\n        return <Settings className=\"h-4 w-4\" />;\n    };\n\n    const getActionColor = (actionType: string) => {\n        if (actionType.includes(\"delete\")) return \"destructive\" as const;\n        if (actionType.includes(\"suspend\")) return \"secondary\" as const;\n        if (actionType.includes(\"reactivate\")) return \"default\" as const;\n        return \"outline\" as const;\n    };\n\n    const formatActionType = (actionType: string) => {\n        return actionType\n            .split(\"_\")\n            .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n            .join(\" \");\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            className=\"container mx-auto p-6 space-y-6\"\n            data-testid=\"activity-logs-page\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\" data-testid=\"page-title\">\n                        Activity Logs\n                    </h1>\n                    <p className=\"text-muted-foreground\">\n                        Track all Super Admin actions and changes\n                    </p>\n                </div>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                        <Activity className=\"h-5 w-5\" />\n                        Recent Activity\n                    </CardTitle>\n                    <CardDescription>\n                        Complete audit trail of administrative actions\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    <ScrollArea className=\"h-[600px]\">\n                        <div className=\"space-y-4\">\n                            {logs.map((log) => (\n                                <div\n                                    key={log.id}\n                                    className=\"flex items-start gap-4 p-4 rounded-lg border hover:bg-accent transition-colors\"\n                                    data-testid={`log-item-${log.id}`}>\n                                    <div className=\"mt-1\">\n                                        {getActionIcon(log.actionType)}\n                                    </div>\n                                    <div className=\"flex-1 space-y-1\">\n                                        <div className=\"flex items-center gap-2\">\n                                            <Badge\n                                                variant={getActionColor(\n                                                    log.actionType\n                                                )}\n                                                data-testid={`badge-action-${log.id}`}>\n                                                {formatActionType(\n                                                    log.actionType\n                                                )}\n                                            </Badge>\n                                            <span\n                                                className=\"text-xs text-muted-foreground\"\n                                                data-testid={`text-date-${log.id}`}>\n                                                {format(\n                                                    new Date(log.createdAt),\n                                                    \"MMM dd, yyyy 'at' HH:mm:ss\"\n                                                )}\n                                            </span>\n                                        </div>\n                                        <p\n                                            className=\"text-sm\"\n                                            data-testid={`text-details-${log.id}`}>\n                                            {log.details ||\n                                                \"No details provided\"}\n                                        </p>\n                                        <div className=\"flex gap-4 text-xs text-muted-foreground\">\n                                            {log.targetCompanyId && (\n                                                <span>\n                                                    Company ID:{\" \"}\n                                                    {log.targetCompanyId}\n                                                </span>\n                                            )}\n                                            {log.targetUserId && (\n                                                <span>\n                                                    User ID: {log.targetUserId}\n                                                </span>\n                                            )}\n                                            <span>\n                                                Performed by User ID:{\" \"}\n                                                {log.performedBy}\n                                            </span>\n                                        </div>\n                                    </div>\n                                </div>\n                            ))}\n\n                            {logs.length === 0 && (\n                                <div className=\"text-center py-12\">\n                                    <p\n                                        className=\"text-muted-foreground\"\n                                        data-testid=\"text-no-logs\">\n                                        No activity logs found\n                                    </p>\n                                </div>\n                            )}\n                        </div>\n                    </ScrollArea>\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":6832,"size_tokens":null},"client/src/components/StripeCheckoutForm.tsx":{"content":"import { useStripe, useElements, PaymentElement, PaymentRequestButtonElement } from '@stripe/react-stripe-js';\nimport type { StripePaymentRequestButtonElementOptions } from '@stripe/stripe-js';\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, QrCode } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\n\ninterface StripeCheckoutFormProps {\n  onSuccess: (paymentIntentId: string) => void;\n  onFailure: () => void;\n  amount: number;\n  clientSecret: string;\n}\n\nexport default function StripeCheckoutForm({ onSuccess, onFailure, amount, clientSecret }: StripeCheckoutFormProps) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [paymentRequest, setPaymentRequest] = useState<any>(null);\n  const [showQRCode, setShowQRCode] = useState(false);\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\n  const [paymentStatus, setPaymentStatus] = useState<'idle' | 'pending' | 'checking'>('idle');\n\n  // Initialize PaymentRequest for Google Pay / PhonePe wallet buttons\n  useEffect(() => {\n    if (!stripe) return;\n\n    const pr = stripe.paymentRequest({\n      country: 'IN',\n      currency: 'inr',\n      total: {\n        label: 'WorkLogix Slot Purchase',\n        amount: Math.round(amount * 100), // Convert to paise\n      },\n      requestPayerName: true,\n      requestPayerEmail: true,\n    });\n\n    // Check if PaymentRequest is available (Google Pay, PhonePe, etc.)\n    pr.canMakePayment().then((result) => {\n      if (result) {\n        setPaymentRequest(pr);\n      }\n    });\n\n    pr.on('paymentmethod', async (ev) => {\n      // Confirm the payment with the payment method from the wallet\n      const { error: confirmError, paymentIntent } = await stripe.confirmCardPayment(\n        clientSecret,\n        { payment_method: ev.paymentMethod.id },\n        { handleActions: false }\n      );\n\n      if (confirmError) {\n        ev.complete('fail');\n        toast({\n          title: \"Payment Failed\",\n          description: confirmError.message,\n          variant: \"destructive\",\n        });\n        onFailure();\n      } else if (paymentIntent) {\n        // Handle different payment intent statuses explicitly\n        if (paymentIntent.status === 'succeeded') {\n          ev.complete('success');\n          onSuccess(paymentIntent.id);\n        } else if (paymentIntent.status === 'requires_action' || paymentIntent.status === 'processing') {\n          // Payment needs more time (common with UPI wallets)\n          ev.complete('success');\n          setPaymentStatus('checking');\n          \n          // Check if QR code is available in next_action\n          if (paymentIntent.next_action?.type === 'display_qr_code') {\n            const qrData = paymentIntent.next_action as any;\n            if (qrData?.display_qr_code?.image_url_svg) {\n              setQrCodeUrl(qrData.display_qr_code.image_url_svg);\n              setShowQRCode(true);\n              toast({\n                title: \"Scan QR Code\",\n                description: \"Please scan the QR code with your UPI app to complete payment\",\n              });\n            } else {\n              toast({\n                title: \"Processing Payment\",\n                description: \"Your payment is being processed. Please wait...\",\n              });\n            }\n          } else {\n            toast({\n              title: \"Processing Payment\",\n              description: \"Your payment is being processed. Please wait...\",\n            });\n          }\n          \n          pollPaymentStatus(paymentIntent.id);\n        } else if (paymentIntent.status === 'requires_payment_method' || paymentIntent.status === 'canceled') {\n          // Payment failed or was canceled\n          ev.complete('fail');\n          toast({\n            title: \"Payment Failed\",\n            description: \"Payment was not completed. Please try again.\",\n            variant: \"destructive\",\n          });\n          onFailure();\n        } else {\n          // Unexpected status - treat as failure for safety\n          ev.complete('fail');\n          console.error('Unexpected payment intent status from wallet:', paymentIntent.status);\n          toast({\n            title: \"Payment Error\",\n            description: \"An unexpected error occurred. Please try again.\",\n            variant: \"destructive\",\n          });\n          onFailure();\n        }\n      }\n    });\n  }, [stripe, amount, clientSecret, onSuccess, onFailure, toast]);\n\n  // Check for UPI QR code in payment intent\n  useEffect(() => {\n    const checkForQRCode = async () => {\n      if (!stripe || !clientSecret) return;\n\n      try {\n        const { paymentIntent } = await stripe.retrievePaymentIntent(clientSecret);\n        \n        // Check if payment intent has next_action with display_qr_code\n        if (paymentIntent?.next_action?.type === 'display_qr_code') {\n          const qrData = paymentIntent.next_action as any;\n          if (qrData?.display_qr_code?.image_url_svg) {\n            setQrCodeUrl(qrData.display_qr_code.image_url_svg);\n          }\n        }\n      } catch (error) {\n        console.error('Error checking for QR code:', error);\n      }\n    };\n\n    checkForQRCode();\n  }, [stripe, clientSecret]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsProcessing(true);\n    setPaymentStatus('pending');\n\n    try {\n      const { error, paymentIntent } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: window.location.href,\n        },\n        redirect: 'if_required',\n      });\n\n      if (error) {\n        toast({\n          title: \"Payment Failed\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n        setPaymentStatus('idle');\n        onFailure();\n      } else if (paymentIntent) {\n        if (paymentIntent.status === 'succeeded') {\n          setPaymentStatus('idle');\n          onSuccess(paymentIntent.id);\n        } else if (paymentIntent.status === 'requires_action') {\n          // Payment requires additional action (e.g., UPI QR code display)\n          setPaymentStatus('checking');\n          \n          // Check if QR code is available in next_action\n          if (paymentIntent.next_action?.type === 'display_qr_code') {\n            const qrData = paymentIntent.next_action as any;\n            if (qrData?.display_qr_code?.image_url_svg) {\n              setQrCodeUrl(qrData.display_qr_code.image_url_svg);\n              setShowQRCode(true); // Automatically show QR modal\n              toast({\n                title: \"Scan QR Code\",\n                description: \"Please scan the QR code with your UPI app to complete payment\",\n              });\n            } else {\n              toast({\n                title: \"Action Required\",\n                description: \"Please complete the payment using UPI\",\n              });\n            }\n          } else {\n            toast({\n              title: \"Action Required\",\n              description: \"Please complete the payment using UPI\",\n            });\n          }\n          \n          // Start polling for payment status\n          pollPaymentStatus(paymentIntent.id);\n        } else if (paymentIntent.status === 'processing') {\n          // Payment is being processed (common with UPI)\n          setPaymentStatus('checking');\n          toast({\n            title: \"Processing Payment\",\n            description: \"Your payment is being processed. Please wait...\",\n          });\n          \n          // Poll for payment status\n          pollPaymentStatus(paymentIntent.id);\n        }\n      }\n    } catch (err: any) {\n      toast({\n        title: \"Payment Error\",\n        description: err.message || \"An unexpected error occurred\",\n        variant: \"destructive\",\n      });\n      setPaymentStatus('idle');\n      onFailure();\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const pollPaymentStatus = async (paymentIntentId: string) => {\n    const maxAttempts = 20; // 20 attempts × 3 seconds = 60 seconds max\n    let attempts = 0;\n\n    const checkStatus = async () => {\n      attempts++;\n\n      if (attempts > maxAttempts) {\n        setPaymentStatus('idle');\n        setShowQRCode(false);\n        toast({\n          title: \"Payment Verification Timeout\",\n          description: \"We couldn't verify your payment. If you completed the payment, it will be processed automatically. Please check your payment history in a few minutes.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      try {\n        if (!stripe) return;\n        \n        // Retrieve payment intent using the explicit ID passed in\n        const { paymentIntent } = await stripe.retrievePaymentIntent(clientSecret);\n        \n        // Verify we're checking the correct payment intent\n        if (paymentIntent?.id !== paymentIntentId) {\n          console.error('Payment intent ID mismatch during polling');\n          return;\n        }\n        \n        if (paymentIntent.status === 'succeeded') {\n          setPaymentStatus('idle');\n          setShowQRCode(false);\n          toast({\n            title: \"Payment Successful!\",\n            description: \"Your payment has been confirmed\",\n          });\n          onSuccess(paymentIntent.id);\n        } else if (paymentIntent.status === 'requires_payment_method' || paymentIntent.status === 'canceled') {\n          setPaymentStatus('idle');\n          setShowQRCode(false);\n          toast({\n            title: \"Payment Failed\",\n            description: \"Please try again with a different payment method\",\n            variant: \"destructive\",\n          });\n          onFailure();\n        } else if (paymentIntent.status === 'processing' || paymentIntent.status === 'requires_action') {\n          // Still processing, check again after delay\n          setTimeout(checkStatus, 3000); // Check every 3 seconds\n        } else {\n          // Unknown status, stop polling\n          setPaymentStatus('idle');\n          console.error('Unexpected payment intent status:', paymentIntent.status);\n        }\n      } catch (error) {\n        console.error('Error polling payment status:', error);\n        // Continue polling despite errors (network issues, etc.)\n        if (attempts < maxAttempts) {\n          setTimeout(checkStatus, 3000);\n        }\n      }\n    };\n\n    checkStatus();\n  };\n\n  const handleShowQRCode = async () => {\n    setShowQRCode(true);\n    setPaymentStatus('checking');\n    \n    // Retrieve the payment intent to get the ID and start polling\n    if (stripe && clientSecret) {\n      try {\n        const { paymentIntent } = await stripe.retrievePaymentIntent(clientSecret);\n        if (paymentIntent) {\n          pollPaymentStatus(paymentIntent.id);\n        }\n      } catch (error) {\n        console.error('Error retrieving payment intent for QR polling:', error);\n      }\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* PaymentRequest Button (Google Pay, PhonePe, etc.) */}\n      {paymentRequest && (\n        <div className=\"border-b pb-4 mb-4\">\n          <p className=\"text-sm text-muted-foreground mb-3 text-center\">Express Checkout</p>\n          <PaymentRequestButtonElement \n            options={{ paymentRequest } as StripePaymentRequestButtonElementOptions}\n          />\n        </div>\n      )}\n\n      {/* QR Code Button (if available) */}\n      {qrCodeUrl && (\n        <div className=\"mb-4\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            className=\"w-full\"\n            onClick={handleShowQRCode}\n            data-testid=\"button-show-qr\"\n          >\n            <QrCode className=\"mr-2 h-4 w-4\" />\n            Pay with UPI QR Code\n          </Button>\n        </div>\n      )}\n\n      {/* Standard Payment Form */}\n      <form onSubmit={handleSubmit} className=\"space-y-4\" data-testid=\"form-stripe-checkout\">\n        <PaymentElement \n          options={{\n            layout: 'accordion',\n            paymentMethodOrder: ['upi', 'card'],\n          }}\n        />\n        <div className=\"pt-4\">\n          <Button\n            type=\"submit\"\n            className=\"w-full\"\n            disabled={!stripe || !elements || isProcessing || paymentStatus === 'checking'}\n            data-testid=\"button-submit-payment\"\n          >\n            {isProcessing ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Processing Payment...\n              </>\n            ) : paymentStatus === 'checking' ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Waiting for Payment...\n              </>\n            ) : (\n              `Pay ₹${amount}`\n            )}\n          </Button>\n        </div>\n\n        {paymentStatus === 'checking' && (\n          <p className=\"text-sm text-center text-muted-foreground\">\n            Checking payment status... This may take a few moments.\n          </p>\n        )}\n      </form>\n\n      {/* QR Code Modal */}\n      <Dialog open={showQRCode} onOpenChange={setShowQRCode}>\n        <DialogContent className=\"sm:max-w-md\" data-testid=\"dialog-qr-code\">\n          <DialogHeader>\n            <DialogTitle>Scan to Pay with UPI</DialogTitle>\n            <DialogDescription>\n              Scan this QR code with any UPI app (Google Pay, PhonePe, Paytm, etc.)\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"flex flex-col items-center justify-center py-6 space-y-4\">\n            {qrCodeUrl && (\n              <div className=\"border-2 border-gray-200 rounded-lg p-4 bg-white\">\n                <img \n                  src={qrCodeUrl} \n                  alt=\"UPI QR Code\" \n                  className=\"w-64 h-64\"\n                  data-testid=\"img-qr-code\"\n                />\n              </div>\n            )}\n            <div className=\"text-center space-y-2\">\n              <p className=\"font-semibold text-lg\">₹{amount}</p>\n              <p className=\"text-sm text-muted-foreground\">\n                Waiting for payment confirmation...\n              </p>\n              {paymentStatus === 'checking' && (\n                <div className=\"flex items-center justify-center gap-2 text-sm text-blue-600\">\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  <span>Checking payment status...</span>\n                </div>\n              )}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":14630,"size_tokens":null},"server/utils/badges.ts":{"content":"export interface BadgeResult {\n  badge: string;\n  grade: string;\n  color: string;\n  icon: string;\n}\n\nexport function calculateMonthlyBadge(monthlyPoints: number): BadgeResult {\n  if (monthlyPoints >= 200) {\n    return {\n      badge: 'Gold',\n      grade: 'A',\n      color: 'text-yellow-500',\n      icon: '🥇'\n    };\n  } else if (monthlyPoints >= 150) {\n    return {\n      badge: 'Silver',\n      grade: 'B',\n      color: 'text-gray-400',\n      icon: '🥈'\n    };\n  } else if (monthlyPoints >= 100) {\n    return {\n      badge: 'Bronze',\n      grade: 'C',\n      color: 'text-orange-600',\n      icon: '🥉'\n    };\n  } else {\n    return {\n      badge: 'No Badge',\n      grade: 'D',\n      color: 'text-gray-500',\n      icon: '⭐'\n    };\n  }\n}\n\nexport function calculateYearlyBadge(yearlyPoints: number): BadgeResult {\n  if (yearlyPoints >= 2400) {\n    return {\n      badge: 'Diamond',\n      grade: 'A+',\n      color: 'text-cyan-400',\n      icon: '💎'\n    };\n  } else if (yearlyPoints >= 2000) {\n    return {\n      badge: 'Gold',\n      grade: 'A',\n      color: 'text-yellow-500',\n      icon: '🥇'\n    };\n  } else if (yearlyPoints >= 1500) {\n    return {\n      badge: 'Silver',\n      grade: 'B',\n      color: 'text-gray-400',\n      icon: '🥈'\n    };\n  } else if (yearlyPoints >= 1000) {\n    return {\n      badge: 'Bronze',\n      grade: 'C',\n      color: 'text-orange-600',\n      icon: '🥉'\n    };\n  } else {\n    return {\n      badge: 'No Badge',\n      grade: 'D',\n      color: 'text-gray-500',\n      icon: '⭐'\n    };\n  }\n}\n\nexport function getPointsForAttendance(loginTimeMinutes: number): number {\n  if (loginTimeMinutes >= 540 && loginTimeMinutes < 550) {\n    return 10;\n  } else if (loginTimeMinutes >= 550 && loginTimeMinutes < 570) {\n    return 10;\n  } else if (loginTimeMinutes >= 570 && loginTimeMinutes < 600) {\n    return 10;\n  } else if (loginTimeMinutes >= 600 && loginTimeMinutes < 630) {\n    return 10;\n  } else if (loginTimeMinutes >= 780 && loginTimeMinutes < 840) {\n    return 10;\n  } else if (loginTimeMinutes >= 840 && loginTimeMinutes < 900) {\n    return 10;\n  } else {\n    return 0;\n  }\n}\n","path":null,"size_bytes":2115,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig, loadEnv } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig(({ mode }) => {\n    const env = loadEnv(mode, process.cwd(), \"VITE_\");\n    const isProduction = mode === \"production\";\n    const apiUrl =\n        env.VITE_API_URL || process.env.VITE_API_URL || \"http://localhost:3000\";\n    const isExternalApi = apiUrl !== \"http://localhost:3000\";\n\n    const proxyConfig: Record<string, any> = {};\n\n    if (!isProduction) {\n        proxyConfig[\"/api\"] = {\n            target: apiUrl,\n            changeOrigin: true,\n            secure: false,\n        };\n        proxyConfig[\"/ws\"] = isExternalApi\n            ? { target: apiUrl, changeOrigin: true, secure: false }\n            : { target: \"ws://localhost:3000\", ws: true };\n    }\n\n    return {\n        base: isProduction ? \"/worklogix/\" : \"/\",\n        define: {\n            \"import.meta.env.VITE_API_URL\": JSON.stringify(apiUrl),\n        },\n        plugins: [\n            react(),\n            runtimeErrorOverlay(),\n            ...(process.env.NODE_ENV !== \"production\" &&\n            process.env.REPL_ID !== undefined\n                ? [\n                      import(\"@replit/vite-plugin-cartographer\").then((m) =>\n                          m.cartographer()\n                      ),\n                      import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n                          m.devBanner()\n                      ),\n                  ]\n                : []),\n        ],\n        resolve: {\n            alias: {\n                \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n                \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n                \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n            },\n        },\n        root: path.resolve(import.meta.dirname, \"client\"),\n        build: {\n            outDir: path.resolve(import.meta.dirname, \"dist\"),\n            emptyOutDir: true,\n        },\n        server: {\n            host: \"0.0.0.0\",\n            port: 5000,\n            strictPort: true,\n            hmr:\n                mode === \"production\"\n                    ? {\n                          protocol: \"wss\",\n                          clientPort: 443,\n                      }\n                    : true,\n\n            fs: {\n                strict: true,\n                deny: [\"**/.*\"],\n            },\n            proxy: proxyConfig,\n            allowedHosts: true,\n        },\n    };\n});\n","path":null,"size_bytes":2552,"size_tokens":null},"client/src/pages/admin/AttendanceMonitor.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Calendar, Users, Clock, UserCheck, UserX, MoreVertical, History, Shield, Award, Flame, Settings } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { DailyAttendanceRecord, AttendanceRecord, AttendanceBadge, AttendancePolicy, AttendanceStreak } from \"@shared/schema\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function AttendanceMonitor() {\n  const [selectedDate, setSelectedDate] = useState(\n    new Date().toISOString().split('T')[0]\n  );\n  const [historyDialogOpen, setHistoryDialogOpen] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<{id: number; name: string; email: string} | null>(null);\n\n  const { data: attendanceRecords, isLoading } = useQuery<DailyAttendanceRecord[]>({\n    queryKey: [`/api/admin/attendance/daily?date=${selectedDate}`],\n  });\n\n  const { data: userHistory } = useQuery<{\n    records: AttendanceRecord[];\n    summary: any;\n    user: {id: number; displayName: string; email: string};\n  }>({\n    queryKey: [`/api/admin/attendance/history/${selectedUser?.id}`],\n    enabled: !!selectedUser && historyDialogOpen,\n  });\n\n  const { data: policyData } = useQuery<{\n    policy: AttendancePolicy;\n    shift: { startTime: string; endTime: string } | null;\n  }>({\n    queryKey: [\"/api/attendance/policy\"],\n  });\n\n  const { data: companyBadges = [] } = useQuery<AttendanceBadge[]>({\n    queryKey: [\"/api/admin/attendance/badges\"],\n  });\n\n  const { data: companyStreaks = [] } = useQuery<(AttendanceStreak & { fullName: string; userId: number })[]>({\n    queryKey: [\"/api/admin/attendance/streaks\"],\n  });\n\n  const badgeStats = {\n    earlyBird: companyBadges.filter(b => b.badgeType === 'early_bird').length,\n    streak: companyBadges.filter(b => b.badgeType === 'streak').length,\n    perfectMonth: companyBadges.filter(b => b.badgeType === 'perfect_month').length,\n    total: companyBadges.length,\n  };\n\n  const topStreaks = [...companyStreaks]\n    .sort((a, b) => (b.currentStreak || 0) - (a.currentStreak || 0))\n    .slice(0, 5);\n\n  const stats = {\n    total: attendanceRecords?.length || 0,\n    present: attendanceRecords?.filter((r) => r.status === \"present\").length || 0,\n    late: attendanceRecords?.filter((r) => r.status === \"late\").length || 0,\n    absent: attendanceRecords?.filter((r) => r.status === \"absent\").length || 0,\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { variant: any; label: string }> = {\n      present: { variant: \"default\", label: \"Present\" },\n      absent: { variant: \"destructive\", label: \"Absent\" },\n      late: { variant: \"secondary\", label: \"Late\" },\n      leave: { variant: \"outline\", label: \"Leave\" },\n    };\n    const config = variants[status] || variants.absent;\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  const formatTime = (time: string | Date | null) => {\n    if (!time) return \"-\";\n    const date = typeof time === 'string' ? new Date(time) : time;\n    return format(date, \"hh:mm a\");\n  };\n\n  const formatDuration = (minutes: number | null) => {\n    if (!minutes) return \"-\";\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return `${hours}h ${mins}m`;\n  };\n\n  return (\n    <div className=\"flex flex-col gap-6 p-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Attendance Monitor</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Monitor daily attendance records\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n          <Input\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            className=\"w-auto\"\n            data-testid=\"input-date\"\n          />\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Employees</CardTitle>\n            <Users className=\"w-4 h-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-total\">\n              {stats.total}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Present</CardTitle>\n            <UserCheck className=\"w-4 h-4 text-green-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\" data-testid=\"stat-present\">\n              {stats.present}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Late</CardTitle>\n            <Clock className=\"w-4 h-4 text-orange-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-600\" data-testid=\"stat-late\">\n              {stats.late}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Absent</CardTitle>\n            <UserX className=\"w-4 h-4 text-red-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\" data-testid=\"stat-absent\">\n              {stats.absent}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Settings className=\"w-5 h-5\" />\n              Policy Settings\n            </CardTitle>\n            <CardDescription>Current attendance policy enforcement</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {policyData?.shift && (\n                <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                  <span className=\"text-sm text-muted-foreground\">Shift Timing</span>\n                  <span className=\"text-sm font-medium\">\n                    {policyData.shift.startTime} - {policyData.shift.endTime}\n                  </span>\n                </div>\n              )}\n              <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Late Threshold</span>\n                <Badge variant=\"outline\">\n                  {policyData?.policy?.lateMarkThreshold || 3} min\n                </Badge>\n              </div>\n              <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Half Day Hours</span>\n                <Badge variant=\"outline\">{policyData?.policy?.halfDayHours || 4} hrs</Badge>\n              </div>\n              <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Full Day Hours</span>\n                <Badge variant=\"outline\">{policyData?.policy?.fullDayHours || 8} hrs</Badge>\n              </div>\n              <div className=\"flex justify-between items-center p-2 border rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">GPS Required</span>\n                <Badge variant={policyData?.policy?.requireGPS ? \"default\" : \"secondary\"}>\n                  {policyData?.policy?.requireGPS ? \"Yes\" : \"No\"}\n                </Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Award className=\"w-5 h-5\" />\n              Badge Statistics\n            </CardTitle>\n            <CardDescription>Company-wide badge awards</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div className=\"text-center p-3 border rounded-md bg-gradient-to-br from-yellow-500/5 to-yellow-500/10\">\n                <p className=\"text-xl font-bold text-yellow-600\" data-testid=\"stat-early-bird-badges\">\n                  {badgeStats.earlyBird}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">Early Bird</p>\n              </div>\n              <div className=\"text-center p-3 border rounded-md bg-gradient-to-br from-orange-500/5 to-orange-500/10\">\n                <p className=\"text-xl font-bold text-orange-600\" data-testid=\"stat-streak-badges\">\n                  {badgeStats.streak}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">Streak</p>\n              </div>\n              <div className=\"text-center p-3 border rounded-md bg-gradient-to-br from-green-500/5 to-green-500/10\">\n                <p className=\"text-xl font-bold text-green-600\" data-testid=\"stat-perfect-badges\">\n                  {badgeStats.perfectMonth}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">Perfect Month</p>\n              </div>\n              <div className=\"text-center p-3 border rounded-md bg-gradient-to-br from-primary/5 to-primary/10\">\n                <p className=\"text-xl font-bold\" data-testid=\"stat-total-badges\">\n                  {badgeStats.total}\n                </p>\n                <p className=\"text-xs text-muted-foreground\">Total Badges</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Flame className=\"w-5 h-5\" />\n              Top Streaks\n            </CardTitle>\n            <CardDescription>Employees with best attendance streaks</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {topStreaks.length > 0 ? (\n              <div className=\"space-y-2\">\n                {topStreaks.map((streakData, index) => (\n                  <div\n                    key={streakData.id}\n                    className=\"flex items-center justify-between p-2 border rounded-md\"\n                    data-testid={`streak-${streakData.id}`}\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm font-medium text-muted-foreground\">#{index + 1}</span>\n                      <span className=\"text-sm font-medium\">{streakData.fullName || `User ${streakData.userId}`}</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <Flame className=\"w-4 h-4 text-orange-500\" />\n                      <span className=\"font-bold text-orange-500\">{streakData.currentStreak || 0}</span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center p-6 text-muted-foreground\">\n                <Flame className=\"w-8 h-8 mx-auto mb-2 opacity-20\" />\n                <p className=\"text-sm\">No streak data yet</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Attendance Records</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <p className=\"text-sm text-muted-foreground\">Loading...</p>\n          ) : attendanceRecords && attendanceRecords.length > 0 ? (\n            <div className=\"border rounded-md\">\n              <table className=\"w-full\">\n                <thead className=\"border-b bg-muted/50\">\n                  <tr>\n                    <th className=\"p-3 text-left text-sm font-medium\">Employee</th>\n                    <th className=\"p-3 text-left text-sm font-medium\">Email</th>\n                    <th className=\"p-3 text-left text-sm font-medium\">Check-In</th>\n                    <th className=\"p-3 text-left text-sm font-medium\">Check-Out</th>\n                    <th className=\"p-3 text-left text-sm font-medium\">Duration</th>\n                    <th className=\"p-3 text-left text-sm font-medium\">Status</th>\n                    <th className=\"p-3 text-left text-sm font-medium\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {attendanceRecords.map((record) => (\n                    <tr\n                      key={record.id}\n                      className=\"border-b last:border-0 hover-elevate\"\n                      data-testid={`row-attendance-${record.id}`}\n                    >\n                      <td className=\"p-3 text-sm font-medium\">{record.userName || `User ${record.userId}`}</td>\n                      <td className=\"p-3 text-sm text-muted-foreground\">{record.userEmail || '-'}</td>\n                      <td className=\"p-3 text-sm\" data-testid={`checkin-${record.id}`}>\n                        {formatTime(record.checkIn)}\n                      </td>\n                      <td className=\"p-3 text-sm\" data-testid={`checkout-${record.id}`}>\n                        {formatTime(record.checkOut)}\n                      </td>\n                      <td className=\"p-3 text-sm\" data-testid={`duration-${record.id}`}>\n                        {formatDuration(record.workDuration)}\n                      </td>\n                      <td className=\"p-3 text-sm\">\n                        {getStatusBadge(record.status)}\n                      </td>\n                      <td className=\"p-3 text-sm\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${record.id}`}>\n                              <MoreVertical className=\"w-4 h-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem\n                              onClick={() => {\n                                setSelectedUser({\n                                  id: record.userId,\n                                  name: record.userName || `User ${record.userId}`,\n                                  email: record.userEmail || '',\n                                });\n                                setHistoryDialogOpen(true);\n                              }}\n                              data-testid={`menu-view-history-${record.id}`}\n                            >\n                              <History className=\"w-4 h-4 mr-2\" />\n                              View Details\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          ) : (\n            <p className=\"text-sm text-muted-foreground text-center py-8\">\n              No attendance records found for this date\n            </p>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={historyDialogOpen} onOpenChange={setHistoryDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Attendance History - {selectedUser?.name}</DialogTitle>\n            <DialogDescription>\n              {selectedUser?.email} | Current Month\n            </DialogDescription>\n          </DialogHeader>\n          {userHistory ? (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-4 gap-4\">\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"text-sm text-muted-foreground\">Present</div>\n                    <div className=\"text-2xl font-bold text-green-600\">\n                      {userHistory.summary.presentDays || 0}\n                    </div>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"text-sm text-muted-foreground\">Late</div>\n                    <div className=\"text-2xl font-bold text-yellow-600\">\n                      {userHistory.summary.lateDays || 0}\n                    </div>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"text-sm text-muted-foreground\">Absent</div>\n                    <div className=\"text-2xl font-bold text-red-600\">\n                      {userHistory.summary.absentDays || 0}\n                    </div>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"p-4\">\n                    <div className=\"text-sm text-muted-foreground\">Total Hours</div>\n                    <div className=\"text-2xl font-bold\">\n                      {userHistory.summary.totalHours || 0}h\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n              <div className=\"border rounded-md\">\n                <table className=\"w-full\">\n                  <thead className=\"border-b bg-muted/50\">\n                    <tr>\n                      <th className=\"p-3 text-left text-sm font-medium\">Date</th>\n                      <th className=\"p-3 text-left text-sm font-medium\">Check-In</th>\n                      <th className=\"p-3 text-left text-sm font-medium\">Check-Out</th>\n                      <th className=\"p-3 text-left text-sm font-medium\">Duration</th>\n                      <th className=\"p-3 text-left text-sm font-medium\">Status</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {userHistory.records && userHistory.records.length > 0 ? (\n                      userHistory.records.map((record) => (\n                        <tr key={record.id} className=\"border-b last:border-0\">\n                          <td className=\"p-3 text-sm\">{record.date}</td>\n                          <td className=\"p-3 text-sm\">{formatTime(record.checkIn)}</td>\n                          <td className=\"p-3 text-sm\">{formatTime(record.checkOut)}</td>\n                          <td className=\"p-3 text-sm\">{formatDuration(record.workDuration)}</td>\n                          <td className=\"p-3 text-sm\">{getStatusBadge(record.status)}</td>\n                        </tr>\n                      ))\n                    ) : (\n                      <tr>\n                        <td colSpan={5} className=\"p-6 text-center text-sm text-muted-foreground\">\n                          No attendance records found for this month\n                        </td>\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          ) : (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":20162,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/pages/super-admin/PaymentTracking.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from \"@/components/ui/table\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport {\n    Popover,\n    PopoverContent,\n    PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { CalendarIcon, Download } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { CompanyPayment } from \"@shared/schema\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function PaymentTracking() {\n    const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n    const [startDate, setStartDate] = useState<Date | undefined>();\n    const [endDate, setEndDate] = useState<Date | undefined>();\n\n    const queryParams = new URLSearchParams();\n    if (startDate && endDate) {\n        queryParams.append(\"startDate\", startDate.toISOString());\n        queryParams.append(\"endDate\", endDate.toISOString());\n    }\n    if (statusFilter && statusFilter !== \"all\") {\n        queryParams.append(\"status\", statusFilter);\n    }\n\n    const {\n        data: payments = [],\n        isLoading,\n        error,\n    } = useQuery<CompanyPayment[]>({\n        queryKey: [\"/api/super-admin/payments\", queryParams.toString()],\n        queryFn: async () => {\n            const res = await fetch(\n                `${API_BASE_URL}/api/super-admin/payments?${queryParams}`,\n                {\n                    headers: {\n                        \"x-user-id\": localStorage.getItem(\"userId\") || \"\",\n                    },\n                }\n            );\n            if (!res.ok) {\n                throw new Error(\"Failed to fetch payments\");\n            }\n            const data = await res.json();\n            return Array.isArray(data) ? data : [];\n        },\n    });\n\n    const getStatusBadge = (status: string) => {\n        const variants = {\n            paid: \"default\" as const,\n            pending: \"secondary\" as const,\n            failed: \"destructive\" as const,\n            cancelled: \"outline\" as const,\n        };\n        return (\n            <Badge\n                variant={variants[status as keyof typeof variants] || \"outline\"}\n                data-testid={`badge-status-${status}`}>\n                {status}\n            </Badge>\n        );\n    };\n\n    const exportToCSV = () => {\n        if (!payments || payments.length === 0) {\n            return;\n        }\n        const headers = [\n            \"ID\",\n            \"Company ID\",\n            \"Amount\",\n            \"Currency\",\n            \"Status\",\n            \"Payment Method\",\n            \"Date\",\n        ];\n        const rows = payments.map((p) => [\n            p.id,\n            p.companyId,\n            p.amount,\n            p.currency,\n            p.paymentStatus,\n            p.paymentMethod || \"\",\n            format(new Date(p.createdAt), \"yyyy-MM-dd HH:mm:ss\"),\n        ]);\n\n        const csv = [headers, ...rows].map((row) => row.join(\",\")).join(\"\\n\");\n        const blob = new Blob([csv], { type: \"text/csv\" });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = `payments-${format(new Date(), \"yyyy-MM-dd\")}.csv`;\n        a.click();\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    if (error) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <Card>\n                    <CardContent className=\"p-6\">\n                        <p className=\"text-destructive\">\n                            Error loading payments. Please try again later.\n                        </p>\n                    </CardContent>\n                </Card>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            className=\"container mx-auto p-6 space-y-6\"\n            data-testid=\"payment-tracking-page\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\" data-testid=\"page-title\">\n                        Payment Tracking\n                    </h1>\n                    <p className=\"text-muted-foreground\">\n                        Monitor all slot purchases and transactions\n                    </p>\n                </div>\n                <Button onClick={exportToCSV} data-testid=\"button-export-csv\">\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Export CSV\n                </Button>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Filter Payments</CardTitle>\n                    <CardDescription>\n                        Search and filter payment transactions\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"flex flex-col md:flex-row gap-4\">\n                        <div className=\"flex-1\">\n                            <Select\n                                value={statusFilter}\n                                onValueChange={setStatusFilter}>\n                                <SelectTrigger data-testid=\"select-status-filter\">\n                                    <SelectValue placeholder=\"Filter by status\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem\n                                        value=\"all\"\n                                        data-testid=\"select-option-all\">\n                                        All Statuses\n                                    </SelectItem>\n                                    <SelectItem\n                                        value=\"paid\"\n                                        data-testid=\"select-option-paid\">\n                                        Paid\n                                    </SelectItem>\n                                    <SelectItem\n                                        value=\"pending\"\n                                        data-testid=\"select-option-pending\">\n                                        Pending\n                                    </SelectItem>\n                                    <SelectItem\n                                        value=\"failed\"\n                                        data-testid=\"select-option-failed\">\n                                        Failed\n                                    </SelectItem>\n                                    <SelectItem\n                                        value=\"cancelled\"\n                                        data-testid=\"select-option-cancelled\">\n                                        Cancelled\n                                    </SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <Popover>\n                            <PopoverTrigger asChild>\n                                <Button\n                                    variant=\"outline\"\n                                    data-testid=\"button-start-date\">\n                                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                                    {startDate\n                                        ? format(startDate, \"PPP\")\n                                        : \"Start date\"}\n                                </Button>\n                            </PopoverTrigger>\n                            <PopoverContent className=\"w-auto p-0\">\n                                <Calendar\n                                    mode=\"single\"\n                                    selected={startDate}\n                                    onSelect={setStartDate}\n                                />\n                            </PopoverContent>\n                        </Popover>\n                        <Popover>\n                            <PopoverTrigger asChild>\n                                <Button\n                                    variant=\"outline\"\n                                    data-testid=\"button-end-date\">\n                                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                                    {endDate\n                                        ? format(endDate, \"PPP\")\n                                        : \"End date\"}\n                                </Button>\n                            </PopoverTrigger>\n                            <PopoverContent className=\"w-auto p-0\">\n                                <Calendar\n                                    mode=\"single\"\n                                    selected={endDate}\n                                    onSelect={setEndDate}\n                                />\n                            </PopoverContent>\n                        </Popover>\n                    </div>\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Payment Transactions</CardTitle>\n                    <CardDescription>\n                        Complete list of all payment transactions\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    <Table>\n                        <TableHeader>\n                            <TableRow>\n                                <TableHead data-testid=\"header-id\">\n                                    ID\n                                </TableHead>\n                                <TableHead data-testid=\"header-company-id\">\n                                    Company ID\n                                </TableHead>\n                                <TableHead data-testid=\"header-amount\">\n                                    Amount\n                                </TableHead>\n                                <TableHead data-testid=\"header-slot-type\">\n                                    Slot Type\n                                </TableHead>\n                                <TableHead data-testid=\"header-quantity\">\n                                    Quantity\n                                </TableHead>\n                                <TableHead data-testid=\"header-status\">\n                                    Status\n                                </TableHead>\n                                <TableHead data-testid=\"header-payment-method\">\n                                    Payment Method\n                                </TableHead>\n                                <TableHead data-testid=\"header-date\">\n                                    Date\n                                </TableHead>\n                            </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                            {payments.map((payment) => (\n                                <TableRow\n                                    key={payment.id}\n                                    data-testid={`row-payment-${payment.id}`}>\n                                    <TableCell\n                                        data-testid={`text-payment-id-${payment.id}`}>\n                                        {payment.id}\n                                    </TableCell>\n                                    <TableCell\n                                        data-testid={`text-company-id-${payment.id}`}>\n                                        {payment.companyId}\n                                    </TableCell>\n                                    <TableCell\n                                        data-testid={`text-amount-${payment.id}`}>\n                                        {payment.currency} {payment.amount}\n                                    </TableCell>\n                                    <TableCell\n                                        data-testid={`text-slot-type-${payment.id}`}>\n                                        {payment.slotType || \"-\"}\n                                    </TableCell>\n                                    <TableCell\n                                        data-testid={`text-quantity-${payment.id}`}>\n                                        {payment.slotQuantity || \"-\"}\n                                    </TableCell>\n                                    <TableCell>\n                                        {getStatusBadge(payment.paymentStatus)}\n                                    </TableCell>\n                                    <TableCell\n                                        data-testid={`text-payment-method-${payment.id}`}>\n                                        {payment.paymentMethod || \"-\"}\n                                    </TableCell>\n                                    <TableCell\n                                        data-testid={`text-date-${payment.id}`}>\n                                        {format(\n                                            new Date(payment.createdAt),\n                                            \"MMM dd, yyyy HH:mm\"\n                                        )}\n                                    </TableCell>\n                                </TableRow>\n                            ))}\n                        </TableBody>\n                    </Table>\n\n                    {payments.length === 0 && (\n                        <div className=\"text-center py-12\">\n                            <p\n                                className=\"text-muted-foreground\"\n                                data-testid=\"text-no-payments\">\n                                No payments found\n                            </p>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":14281,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 100%;\n\n  --foreground: 215 20% 15%;\n\n  --border: 214 20% 88%;\n\n  --card: 0 0% 98%;\n\n  --card-foreground: 215 20% 15%;\n\n  --card-border: 214 15% 90%;\n\n  --sidebar: 210 20% 96%;\n\n  --sidebar-foreground: 215 20% 15%;\n\n  --sidebar-border: 214 15% 88%;\n\n  --sidebar-primary: 215 25% 27%;\n\n  --sidebar-primary-foreground: 0 0% 100%;\n\n  --sidebar-accent: 210 15% 92%;\n\n  --sidebar-accent-foreground: 215 20% 15%;\n\n  --sidebar-ring: 215 25% 27%;\n\n  --popover: 0 0% 98%;\n\n  --popover-foreground: 215 20% 15%;\n\n  --popover-border: 214 15% 90%;\n\n  --primary: 215 25% 27%;\n\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 210 15% 92%;\n\n  --secondary-foreground: 215 20% 15%;\n\n  --muted: 210 15% 94%;\n\n  --muted-foreground: 215 12% 45%;\n\n  --accent: 210 15% 94%;\n\n  --accent-foreground: 215 20% 15%;\n\n  --destructive: 0 72% 51%;\n\n  --destructive-foreground: 0 0% 100%;\n\n  --input: 214 15% 85%;\n  --ring: 215 25% 27%;\n  --chart-1: 215 70% 50%;\n  --chart-2: 142 60% 45%;\n  --chart-3: 38 85% 55%;\n  --chart-4: 280 50% 50%;\n  --chart-5: 0 72% 51%;\n\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: JetBrains Mono, Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(222 47% 11% / 0.05);\n  --shadow-xs: 0px 1px 3px 0px hsl(222 47% 11% / 0.08);\n  --shadow-sm: 0px 2px 4px 0px hsl(222 47% 11% / 0.06), 0px 1px 2px -1px hsl(222 47% 11% / 0.08);\n  --shadow: 0px 4px 6px 0px hsl(222 47% 11% / 0.07), 0px 2px 4px -1px hsl(222 47% 11% / 0.06);\n  --shadow-md: 0px 6px 12px 0px hsl(222 47% 11% / 0.08), 0px 3px 6px -2px hsl(222 47% 11% / 0.07);\n  --shadow-lg: 0px 10px 20px 0px hsl(222 47% 11% / 0.09), 0px 4px 8px -2px hsl(222 47% 11% / 0.08);\n  --shadow-xl: 0px 16px 32px 0px hsl(222 47% 11% / 0.10), 0px 8px 16px -4px hsl(222 47% 11% / 0.09);\n  --shadow-2xl: 0px 24px 48px 0px hsl(222 47% 11% / 0.12);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Gradient colors for time-based forms - simplified business tones */\n  --morning-gradient-from: 38 70% 55%;\n  --morning-gradient-to: 45 75% 60%;\n  --evening-gradient-from: 215 50% 45%;\n  --evening-gradient-to: 230 55% 50%;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 215 25% 10%;\n\n  --foreground: 210 15% 90%;\n\n  --border: 215 20% 20%;\n\n  --card: 215 22% 14%;\n\n  --card-foreground: 210 15% 90%;\n\n  --card-border: 215 20% 18%;\n\n  --sidebar: 215 25% 12%;\n\n  --sidebar-foreground: 210 15% 90%;\n\n  --sidebar-border: 215 20% 17%;\n\n  --sidebar-primary: 210 20% 85%;\n\n  --sidebar-primary-foreground: 215 25% 12%;\n\n  --sidebar-accent: 215 20% 18%;\n\n  --sidebar-accent-foreground: 210 15% 90%;\n\n  --sidebar-ring: 210 20% 85%;\n\n  --popover: 215 22% 14%;\n\n  --popover-foreground: 210 15% 90%;\n\n  --popover-border: 215 20% 20%;\n\n  --primary: 210 20% 85%;\n\n  --primary-foreground: 215 25% 12%;\n\n  --secondary: 215 15% 22%;\n\n  --secondary-foreground: 210 15% 90%;\n\n  --muted: 215 15% 20%;\n\n  --muted-foreground: 215 10% 55%;\n\n  --accent: 215 15% 20%;\n\n  --accent-foreground: 210 15% 90%;\n\n  --destructive: 0 65% 55%;\n\n  --destructive-foreground: 0 0% 100%;\n\n  --input: 215 15% 22%;\n  --ring: 210 20% 85%;\n  --chart-1: 215 60% 65%;\n  --chart-2: 142 55% 60%;\n  --chart-3: 38 70% 65%;\n  --chart-4: 280 45% 65%;\n  --chart-5: 0 65% 60%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.30);\n  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.35);\n  --shadow-sm: 0px 2px 4px 0px hsl(0 0% 0% / 0.30), 0px 1px 2px -1px hsl(0 0% 0% / 0.35);\n  --shadow: 0px 4px 6px 0px hsl(0 0% 0% / 0.32), 0px 2px 4px -1px hsl(0 0% 0% / 0.30);\n  --shadow-md: 0px 6px 12px 0px hsl(0 0% 0% / 0.35), 0px 3px 6px -2px hsl(0 0% 0% / 0.32);\n  --shadow-lg: 0px 10px 20px 0px hsl(0 0% 0% / 0.38), 0px 4px 8px -2px hsl(0 0% 0% / 0.35);\n  --shadow-xl: 0px 16px 32px 0px hsl(0 0% 0% / 0.40), 0px 8px 16px -4px hsl(0 0% 0% / 0.38);\n  --shadow-2xl: 0px 24px 48px 0px hsl(0 0% 0% / 0.45);\n\n  /* Gradient colors for time-based forms - simplified business tones */\n  --morning-gradient-from: 38 60% 55%;\n  --morning-gradient-to: 45 65% 60%;\n  --evening-gradient-from: 215 40% 50%;\n  --evening-gradient-to: 230 45% 55%;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n\n  /* Hide scrollbar while keeping scroll functionality */\n  .hide-scrollbar {\n    -ms-overflow-style: none !important;\n    scrollbar-width: none !important;\n    overflow-y: auto !important;\n  }\n\n  .hide-scrollbar::-webkit-scrollbar {\n    display: none !important;\n    width: 0 !important;\n    height: 0 !important;\n  }\n\n  .hide-scrollbar::-webkit-scrollbar-track {\n    display: none !important;\n  }\n\n  .hide-scrollbar::-webkit-scrollbar-thumb {\n    display: none !important;\n  }\n}","path":null,"size_bytes":12291,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, boolean, integer, serial, uniqueIndex } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const companies = pgTable(\"companies\", {\n  id: serial(\"id\").primaryKey(),\n  serverId: varchar(\"server_id\", { length: 50 }).notNull().unique(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  phone: varchar(\"phone\", { length: 20 }),\n  website: text(\"website\"),\n  location: varchar(\"location\", { length: 100 }),\n  description: text(\"description\"),\n  \n  companyType: varchar(\"company_type\", { length: 50 }),\n  contactPerson: varchar(\"contact_person\", { length: 255 }),\n  designation: varchar(\"designation\", { length: 100 }),\n  mobile: varchar(\"mobile\", { length: 20 }),\n  \n  address: text(\"address\"),\n  pincode: varchar(\"pincode\", { length: 10 }),\n  city: varchar(\"city\", { length: 100 }),\n  state: varchar(\"state\", { length: 100 }),\n  country: varchar(\"country\", { length: 100 }),\n  \n  employees: integer(\"employees\"),\n  annualTurnover: varchar(\"annual_turnover\", { length: 50 }),\n  yearEstablished: integer(\"year_established\"),\n  logo: text(\"logo\"),\n  \n  verificationToken: varchar(\"verification_token\", { length: 255 }),\n  verificationTokenExpiry: timestamp(\"verification_token_expiry\"),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  \n  maxAdmins: integer(\"max_admins\").notNull().default(1),\n  maxMembers: integer(\"max_members\").notNull().default(10),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  \n  createdBy: varchar(\"created_by\", { length: 255 }),\n  updatedBy: varchar(\"updated_by\", { length: 255 }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  uniqueUserId: varchar(\"unique_user_id\", { length: 50 }).notNull().unique(),\n  email: text(\"email\").notNull().unique(),\n  displayName: text(\"display_name\").notNull(),\n  password: text(\"password\"),\n  photoURL: text(\"photo_url\"),\n  role: varchar(\"role\", { length: 20 }).notNull().default(\"company_member\"),\n  companyId: integer(\"company_id\").references(() => companies.id),\n  firebaseUid: text(\"firebase_uid\").unique(),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  deletedAt: timestamp(\"deleted_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const tasks = pgTable(\"tasks\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  assignedBy: integer(\"assigned_by\").references(() => users.id),\n  assignedTo: integer(\"assigned_to\").references(() => users.id).notNull(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  priority: varchar(\"priority\", { length: 20 }).notNull().default(\"medium\"),\n  deadline: timestamp(\"deadline\"),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const reports = pgTable(\"reports\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  reportType: varchar(\"report_type\", { length: 20 }).notNull(),\n  plannedTasks: text(\"planned_tasks\"),\n  completedTasks: text(\"completed_tasks\"),\n  pendingTasks: text(\"pending_tasks\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  senderId: integer(\"sender_id\").references(() => users.id).notNull(),\n  receiverId: integer(\"receiver_id\").references(() => users.id).notNull(),\n  message: text(\"message\").notNull(),\n  messageType: varchar(\"message_type\", { length: 30 }).notNull().default(\"team_leader_to_employee\"),\n  relatedTaskId: integer(\"related_task_id\").references(() => tasks.id),\n  readStatus: boolean(\"read_status\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const ratings = pgTable(\"ratings\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  ratedBy: integer(\"rated_by\").references(() => users.id).notNull(),\n  rating: varchar(\"rating\", { length: 30 }).notNull(),\n  feedback: text(\"feedback\"),\n  period: varchar(\"period\", { length: 20 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  uniqueRatingPerPeriod: uniqueIndex(\"unique_rating_per_period\").on(table.userId, table.ratedBy, table.period),\n}));\n\nexport const fileUploads = pgTable(\"file_uploads\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  reportId: integer(\"report_id\").references(() => reports.id),\n  fileName: text(\"file_name\").notNull(),\n  fileUrl: text(\"file_url\").notNull(),\n  fileType: varchar(\"file_type\", { length: 20 }).notNull(),\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow().notNull(),\n});\n\nexport const archiveReports = pgTable(\"archive_reports\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  reportType: varchar(\"report_type\", { length: 20 }).notNull(),\n  plannedTasks: text(\"planned_tasks\"),\n  completedTasks: text(\"completed_tasks\"),\n  pendingTasks: text(\"pending_tasks\"),\n  notes: text(\"notes\"),\n  originalDate: timestamp(\"original_date\").notNull(),\n  archivedAt: timestamp(\"archived_at\").defaultNow().notNull(),\n});\n\nexport const groupMessages = pgTable(\"group_messages\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  senderId: integer(\"sender_id\").references(() => users.id).notNull(),\n  message: text(\"message\").notNull(),\n  title: varchar(\"title\", { length: 255 }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const groupMessageReplies = pgTable(\"group_message_replies\", {\n  id: serial(\"id\").primaryKey(),\n  groupMessageId: integer(\"group_message_id\").references(() => groupMessages.id).notNull(),\n  senderId: integer(\"sender_id\").references(() => users.id).notNull(),\n  message: text(\"message\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const taskTimeLogs = pgTable(\"task_time_logs\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").references(() => tasks.id).notNull(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  date: varchar(\"date\", { length: 10 }).notNull(),\n  totalSeconds: integer(\"total_seconds\").notNull().default(0),\n  oldTimeSeconds: integer(\"old_time_seconds\").notNull().default(0),\n  newTimeSeconds: integer(\"new_time_seconds\").notNull().default(0),\n  timerStartedAt: timestamp(\"timer_started_at\"),\n  timerStatus: varchar(\"timer_status\", { length: 20 }).notNull().default(\"stopped\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const feedbacks = pgTable(\"feedbacks\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  submittedBy: integer(\"submitted_by\").references(() => users.id).notNull(),\n  recipientType: varchar(\"recipient_type\", { length: 20 }).notNull(),\n  message: text(\"message\").notNull(),\n  adminResponse: varchar(\"admin_response\", { length: 50 }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  respondedAt: timestamp(\"responded_at\"),\n});\n\nexport const slotPricing = pgTable(\"slot_pricing\", {\n  id: serial(\"id\").primaryKey(),\n  slotType: varchar(\"slot_type\", { length: 20 }).notNull(),\n  pricePerSlot: integer(\"price_per_slot\").notNull(),\n  currency: varchar(\"currency\", { length: 10 }).notNull().default(\"USD\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const companyPayments = pgTable(\"company_payments\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  slotType: varchar(\"slot_type\", { length: 20 }),\n  slotQuantity: integer(\"slot_quantity\"),\n  amount: integer(\"amount\").notNull(),\n  currency: varchar(\"currency\", { length: 10 }).notNull().default(\"INR\"),\n  paymentStatus: varchar(\"payment_status\", { length: 20 }).notNull().default(\"pending\"),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }),\n  transactionId: varchar(\"transaction_id\", { length: 255 }),\n  stripePaymentIntentId: varchar(\"stripe_payment_intent_id\", { length: 255 }),\n  receiptNumber: varchar(\"receipt_number\", { length: 50 }).unique(),\n  invoiceUrl: text(\"invoice_url\"),\n  emailSent: boolean(\"email_sent\").notNull().default(false),\n  billingPeriodStart: timestamp(\"billing_period_start\"),\n  billingPeriodEnd: timestamp(\"billing_period_end\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const passwordResetTokens = pgTable(\"password_reset_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull(),\n  token: varchar(\"token\", { length: 255 }).notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  used: boolean(\"used\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const adminActivityLogs = pgTable(\"admin_activity_logs\", {\n  id: serial(\"id\").primaryKey(),\n  actionType: varchar(\"action_type\", { length: 50 }).notNull(),\n  performedBy: integer(\"performed_by\").references(() => users.id).notNull(),\n  targetCompanyId: integer(\"target_company_id\").references(() => companies.id),\n  targetUserId: integer(\"target_user_id\").references(() => users.id),\n  details: text(\"details\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const badges = pgTable(\"badges\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  description: text(\"description\"),\n  icon: varchar(\"icon\", { length: 50 }),\n  criteria: text(\"criteria\"),\n  type: varchar(\"type\", { length: 50 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const autoTasks = pgTable(\"auto_tasks\", {\n  id: serial(\"id\").primaryKey(),\n  taskName: varchar(\"task_name\", { length: 100 }).notNull(),\n  taskType: varchar(\"task_type\", { length: 50 }).notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull(),\n  details: text(\"details\"),\n  executedAt: timestamp(\"executed_at\").defaultNow().notNull(),\n});\n\nexport const leaves = pgTable(\"leaves\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  leaveType: varchar(\"leave_type\", { length: 50 }).notNull(),\n  startDate: varchar(\"start_date\", { length: 10 }).notNull(),\n  endDate: varchar(\"end_date\", { length: 10 }).notNull(),\n  reason: text(\"reason\").notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n  approvedBy: integer(\"approved_by\").references(() => users.id),\n  remarks: text(\"remarks\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const holidays = pgTable(\"holidays\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  date: varchar(\"date\", { length: 10 }).notNull(),\n  description: text(\"description\"),\n  isOptional: boolean(\"is_optional\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const tasksReports = pgTable(\"tasks_reports\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  date: varchar(\"date\", { length: 10 }).notNull(),\n  tasksCompleted: text(\"tasks_completed\").notNull(),\n  notes: text(\"notes\"),\n  submitTime: timestamp(\"submit_time\").defaultNow().notNull(),\n  allowedEarlyLogout: boolean(\"allowed_early_logout\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const shifts = pgTable(\"shifts\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  startTime: varchar(\"start_time\", { length: 10 }).notNull(),\n  endTime: varchar(\"end_time\", { length: 10 }).notNull(),\n  gracePeriod: integer(\"grace_period\").notNull().default(15),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const attendancePolicies = pgTable(\"attendance_policies\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  halfDayHours: integer(\"half_day_hours\").notNull().default(4),\n  fullDayHours: integer(\"full_day_hours\").notNull().default(8),\n  lateMarkThreshold: integer(\"late_mark_threshold\").notNull().default(3),\n  autoAbsentHours: integer(\"auto_absent_hours\").notNull().default(2),\n  allowSelfCheckIn: boolean(\"allow_self_check_in\").notNull().default(true),\n  requireGPS: boolean(\"require_gps\").notNull().default(false),\n  requireDeviceBinding: boolean(\"require_device_binding\").notNull().default(false),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const attendanceRecords = pgTable(\"attendance_records\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  shiftId: integer(\"shift_id\").references(() => shifts.id),\n  date: varchar(\"date\", { length: 10 }).notNull(),\n  checkIn: timestamp(\"check_in\"),\n  checkOut: timestamp(\"check_out\"),\n  workDuration: integer(\"work_duration\"),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"absent\"),\n  gpsLocation: text(\"gps_location\"),\n  ipAddress: varchar(\"ip_address\", { length: 50 }),\n  deviceId: varchar(\"device_id\", { length: 255 }),\n  remarks: text(\"remarks\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const correctionRequests = pgTable(\"correction_requests\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  attendanceId: integer(\"attendance_id\").references(() => attendanceRecords.id),\n  date: varchar(\"date\", { length: 10 }).notNull(),\n  requestedCheckIn: timestamp(\"requested_check_in\"),\n  requestedCheckOut: timestamp(\"requested_check_out\"),\n  reason: text(\"reason\").notNull(),\n  attachment: text(\"attachment\"),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n  reviewedBy: integer(\"reviewed_by\").references(() => users.id),\n  reviewComments: text(\"review_comments\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const rewards = pgTable(\"rewards\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  points: integer(\"points\").notNull(),\n  reason: varchar(\"reason\", { length: 255 }).notNull(),\n  date: varchar(\"date\", { length: 10 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const attendanceLogs = pgTable(\"attendance_logs\", {\n  id: serial(\"id\").primaryKey(),\n  attendanceId: integer(\"attendance_id\").references(() => attendanceRecords.id).notNull(),\n  action: varchar(\"action\", { length: 100 }).notNull(),\n  performedBy: integer(\"performed_by\").references(() => users.id).notNull(),\n  oldValue: text(\"old_value\"),\n  newValue: text(\"new_value\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const attendanceBadges = pgTable(\"attendance_badges\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  badgeType: varchar(\"badge_type\", { length: 50 }).notNull(),\n  badgeName: varchar(\"badge_name\", { length: 100 }).notNull(),\n  description: text(\"description\"),\n  earnedDate: varchar(\"earned_date\", { length: 10 }).notNull(),\n  month: varchar(\"month\", { length: 7 }),\n  streakCount: integer(\"streak_count\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const attendanceStreaks = pgTable(\"attendance_streaks\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  currentStreak: integer(\"current_streak\").notNull().default(0),\n  longestStreak: integer(\"longest_streak\").notNull().default(0),\n  lastPresentDate: varchar(\"last_present_date\", { length: 10 }),\n  earlyBirdCount: integer(\"early_bird_count\").notNull().default(0),\n  onTimeCount: integer(\"on_time_count\").notNull().default(0),\n  lateCount: integer(\"late_count\").notNull().default(0),\n  absentCount: integer(\"absent_count\").notNull().default(0),\n  totalWorkingDays: integer(\"total_working_days\").notNull().default(0),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const teamAssignments = pgTable(\"team_assignments\", {\n  id: serial(\"id\").primaryKey(),\n  teamLeaderId: integer(\"team_leader_id\").references(() => users.id).notNull(),\n  memberId: integer(\"member_id\").references(() => users.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  assignedAt: timestamp(\"assigned_at\").defaultNow().notNull(),\n  removedAt: timestamp(\"removed_at\"),\n}, (table) => ({\n  uniqueAssignment: sql`UNIQUE (team_leader_id, member_id, company_id, COALESCE(removed_at, '1970-01-01'))`,\n}));\n\nexport const enquiries = pgTable(\"enquiries\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  customerName: varchar(\"customer_name\", { length: 255 }).notNull(),\n  address: text(\"address\"),\n  mobileNo: varchar(\"mobile_no\", { length: 20 }).notNull(),\n  productName: varchar(\"product_name\", { length: 255 }),\n  productVariant: varchar(\"product_variant\", { length: 255 }),\n  color: varchar(\"color\", { length: 100 }),\n  paymentMethod: varchar(\"payment_method\", { length: 50 }),\n  enquiryDate: varchar(\"enquiry_date\", { length: 10 }).notNull(),\n  leadSource: varchar(\"lead_source\", { length: 100 }),\n  status: varchar(\"status\", { length: 50 }).notNull().default(\"new\"),\n  createdBy: integer(\"created_by\").references(() => users.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const followups = pgTable(\"followups\", {\n  id: serial(\"id\").primaryKey(),\n  enquiryId: integer(\"enquiry_id\").references(() => enquiries.id).notNull(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  followupDate: varchar(\"followup_date\", { length: 10 }).notNull(),\n  remark: text(\"remark\").notNull(),\n  enquiryStatus: varchar(\"enquiry_status\", { length: 50 }).notNull(),\n  nextFollowupDate: varchar(\"next_followup_date\", { length: 10 }),\n  payment: varchar(\"payment\", { length: 100 }),\n  expectedDeliveryDate: varchar(\"expected_delivery_date\", { length: 10 }),\n  createdBy: integer(\"created_by\").references(() => users.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertCompanySchema = createInsertSchema(companies).omit({\n  id: true,\n  serverId: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  uniqueUserId: true,\n  createdAt: true,\n});\n\nexport const loginSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nexport const signupSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  displayName: z.string().min(2, \"Name must be at least 2 characters\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nexport const firebaseSigninSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  displayName: z.string().min(1, \"Display name is required\"),\n  photoURL: z.string().optional(),\n  firebaseUid: z.string().min(1, \"Firebase UID is required\"),\n});\n\nconst strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/;\n\nexport const companyBasicRegistrationSchema = z.object({\n  companyName: z.string().min(2, \"Company name must be at least 2 characters\"),\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(strongPasswordRegex, \"Password must contain at least 1 uppercase, 1 lowercase, 1 number, and 1 special character (@$!%*?&)\"),\n  confirmPassword: z.string(),\n  acceptTerms: z.literal(true, {\n    errorMap: () => ({ message: \"You must accept the terms and conditions\" }),\n  }),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords do not match\",\n  path: [\"confirmPassword\"],\n});\n\nexport const companyGoogleRegistrationSchema = z.object({\n  companyName: z.string().min(2, \"Company name must be at least 2 characters\"),\n  email: z.string().email(\"Invalid email address\"),\n  firebaseUid: z.string().min(1, \"Firebase UID is required\"),\n  photoURL: z.string().optional(),\n  acceptTerms: z.literal(true, {\n    errorMap: () => ({ message: \"You must accept the terms and conditions\" }),\n  }),\n});\n\nexport const companyRegistrationSchema = z.object({\n  fullName: z.string().min(2, \"Full name must be at least 2 characters\"),\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(strongPasswordRegex, \"Password must contain at least 1 uppercase, 1 lowercase, 1 number, and 1 special character (@$!%*?&)\"),\n  confirmPassword: z.string(),\n  \n  name: z.string().min(2, \"Company name must be at least 2 characters\"),\n  companyType: z.string().min(1, \"Please select a company type\"),\n  contactPerson: z.string().min(2, \"Contact person name is required\"),\n  designation: z.string().min(1, \"Please select a designation\"),\n  mobile: z.string().regex(/^\\d{10}$/, \"Please enter a valid 10-digit mobile number\"),\n  website: z.string().url(\"Please enter a valid URL\").optional().or(z.literal(\"\")),\n  \n  address: z.string().min(5, \"Please enter a complete address\"),\n  pincode: z.string().regex(/^\\d{6}$/, \"Please enter a valid 6-digit pincode\"),\n  city: z.string().min(2, \"City is required\"),\n  state: z.string().min(2, \"State is required\"),\n  country: z.string().min(2, \"Country is required\"),\n  \n  employees: z.number().min(1, \"Number of employees must be at least 1\"),\n  annualTurnover: z.string().min(1, \"Please select annual turnover range\"),\n  yearEstablished: z.number()\n    .min(1800, \"Year must be valid\")\n    .max(new Date().getFullYear(), \"Year cannot be in the future\"),\n  description: z.string().optional(),\n  logo: z.string().optional(),\n  \n  acceptTerms: z.literal(true, {\n    errorMap: () => ({ message: \"You must accept the terms and conditions\" }),\n  }),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords do not match\",\n  path: [\"confirmPassword\"],\n});\n\nexport const superAdminLoginSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nexport const companyAdminLoginSchema = z.object({\n  companyName: z.string().min(1, \"Company name is required\"),\n  email: z.string().email(\"Invalid email address\"),\n  serverId: z.string().min(1, \"Company Server ID is required\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nexport const companyUserLoginSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  userId: z.string().min(1, \"User ID is required\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nexport const insertTaskSchema = createInsertSchema(tasks).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  deadline: z.string().nullable().optional().transform(val => val ? new Date(val) : null),\n});\n\nexport const insertReportSchema = createInsertSchema(reports).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  messageType: z.enum(['admin_to_employee', 'admin_to_team_leader', 'team_leader_to_employee', 'employee_to_team_leader', 'team_leader_to_admin', 'employee_to_admin', 'admin_to_admin']),\n});\n\nexport const insertRatingSchema = createInsertSchema(ratings).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertFileUploadSchema = createInsertSchema(fileUploads).omit({\n  id: true,\n  uploadedAt: true,\n});\n\nexport const insertGroupMessageSchema = createInsertSchema(groupMessages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertGroupMessageReplySchema = createInsertSchema(groupMessageReplies).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertTaskTimeLogSchema = createInsertSchema(taskTimeLogs).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport const insertFeedbackSchema = createInsertSchema(feedbacks).omit({\n  id: true,\n  createdAt: true,\n  respondedAt: true,\n}).extend({\n  recipientType: z.enum(['Admin', 'TeamLeader', 'Employee']),\n});\n\nexport const insertSlotPricingSchema = createInsertSchema(slotPricing).omit({\n  id: true,\n  updatedAt: true,\n}).extend({\n  slotType: z.enum(['admin', 'member']),\n  pricePerSlot: z.number().min(0, \"Price must be non-negative\"),\n});\n\nexport const insertCompanyPaymentSchema = createInsertSchema(companyPayments).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  slotType: z.enum(['admin', 'member']).optional(),\n  paymentStatus: z.enum(['pending', 'paid', 'failed', 'cancelled']),\n});\n\nexport const slotPurchaseSchema = z.object({\n  slotType: z.enum(['admin', 'member']),\n  quantity: z.number().min(1, \"Quantity must be at least 1\"),\n});\n\nexport const updatePaymentStatusSchema = z.object({\n  status: z.enum(['pending', 'paid', 'failed', 'cancelled']),\n});\n\nexport const passwordResetRequestSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n});\n\nexport const passwordResetSchema = z.object({\n  token: z.string().min(1, \"Token is required\"),\n  newPassword: z.string().min(6, \"Password must be at least 6 characters\"),\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertTask = z.infer<typeof insertTaskSchema>;\nexport type Task = typeof tasks.$inferSelect;\n\nexport type InsertReport = z.infer<typeof insertReportSchema>;\nexport type Report = typeof reports.$inferSelect;\n\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type Message = typeof messages.$inferSelect;\n\nexport type InsertRating = z.infer<typeof insertRatingSchema>;\nexport type Rating = typeof ratings.$inferSelect;\n\nexport type InsertFileUpload = z.infer<typeof insertFileUploadSchema>;\nexport type FileUpload = typeof fileUploads.$inferSelect;\n\nexport type InsertGroupMessage = z.infer<typeof insertGroupMessageSchema>;\nexport type GroupMessage = typeof groupMessages.$inferSelect;\n\nexport type InsertGroupMessageReply = z.infer<typeof insertGroupMessageReplySchema>;\nexport type GroupMessageReply = typeof groupMessageReplies.$inferSelect;\n\nexport type InsertTaskTimeLog = z.infer<typeof insertTaskTimeLogSchema>;\nexport type TaskTimeLog = typeof taskTimeLogs.$inferSelect;\n\nexport type InsertFeedback = z.infer<typeof insertFeedbackSchema>;\nexport type Feedback = typeof feedbacks.$inferSelect;\n\nexport type ArchiveReport = typeof archiveReports.$inferSelect;\n\nexport type InsertCompany = z.infer<typeof insertCompanySchema>;\nexport type Company = typeof companies.$inferSelect;\n\nexport type InsertSlotPricing = z.infer<typeof insertSlotPricingSchema>;\nexport type SlotPricing = typeof slotPricing.$inferSelect;\n\nexport type InsertCompanyPayment = z.infer<typeof insertCompanyPaymentSchema>;\nexport type CompanyPayment = typeof companyPayments.$inferSelect;\n\nexport type PasswordResetToken = typeof passwordResetTokens.$inferSelect;\n\nexport const insertAdminActivityLogSchema = createInsertSchema(adminActivityLogs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertAdminActivityLog = z.infer<typeof insertAdminActivityLogSchema>;\nexport type AdminActivityLog = typeof adminActivityLogs.$inferSelect;\n\nexport const insertBadgeSchema = createInsertSchema(badges).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertBadge = z.infer<typeof insertBadgeSchema>;\nexport type Badge = typeof badges.$inferSelect;\n\nexport const insertAutoTaskSchema = createInsertSchema(autoTasks).omit({\n  id: true,\n  executedAt: true,\n});\n\nexport type InsertAutoTask = z.infer<typeof insertAutoTaskSchema>;\nexport type AutoTask = typeof autoTasks.$inferSelect;\n\nexport const insertLeaveSchema = createInsertSchema(leaves).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertLeave = z.infer<typeof insertLeaveSchema>;\nexport type Leave = typeof leaves.$inferSelect;\n\nexport const insertHolidaySchema = createInsertSchema(holidays).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertHoliday = z.infer<typeof insertHolidaySchema>;\nexport type Holiday = typeof holidays.$inferSelect;\n\nexport const insertTasksReportSchema = createInsertSchema(tasksReports).omit({\n  id: true,\n  createdAt: true,\n  submitTime: true,\n});\n\nexport type InsertTasksReport = z.infer<typeof insertTasksReportSchema>;\nexport type TasksReport = typeof tasksReports.$inferSelect;\n\nexport const insertShiftSchema = createInsertSchema(shifts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertShift = z.infer<typeof insertShiftSchema>;\nexport type Shift = typeof shifts.$inferSelect;\n\nexport const insertAttendancePolicySchema = createInsertSchema(attendancePolicies).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertAttendancePolicy = z.infer<typeof insertAttendancePolicySchema>;\nexport type AttendancePolicy = typeof attendancePolicies.$inferSelect;\n\nexport const insertAttendanceRecordSchema = createInsertSchema(attendanceRecords).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertAttendanceRecord = z.infer<typeof insertAttendanceRecordSchema>;\nexport type AttendanceRecord = typeof attendanceRecords.$inferSelect;\n\nexport type DailyAttendanceRecord = AttendanceRecord & {\n  userName: string | null;\n  userEmail: string | null;\n  userPhotoURL: string | null;\n};\n\nexport const insertCorrectionRequestSchema = createInsertSchema(correctionRequests).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertCorrectionRequest = z.infer<typeof insertCorrectionRequestSchema>;\nexport type CorrectionRequest = typeof correctionRequests.$inferSelect;\n\nexport const insertRewardSchema = createInsertSchema(rewards).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertReward = z.infer<typeof insertRewardSchema>;\nexport type Reward = typeof rewards.$inferSelect;\n\nexport const insertAttendanceLogSchema = createInsertSchema(attendanceLogs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertAttendanceLog = z.infer<typeof insertAttendanceLogSchema>;\nexport type AttendanceLog = typeof attendanceLogs.$inferSelect;\n\nexport const insertAttendanceBadgeSchema = createInsertSchema(attendanceBadges).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertAttendanceBadge = z.infer<typeof insertAttendanceBadgeSchema>;\nexport type AttendanceBadge = typeof attendanceBadges.$inferSelect;\n\nexport const insertAttendanceStreakSchema = createInsertSchema(attendanceStreaks).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertAttendanceStreak = z.infer<typeof insertAttendanceStreakSchema>;\nexport type AttendanceStreak = typeof attendanceStreaks.$inferSelect;\n\nexport const insertTeamAssignmentSchema = createInsertSchema(teamAssignments).omit({\n  id: true,\n  assignedAt: true,\n});\n\nexport type InsertTeamAssignment = z.infer<typeof insertTeamAssignmentSchema>;\nexport type TeamAssignment = typeof teamAssignments.$inferSelect;\n\nexport const insertEnquirySchema = createInsertSchema(enquiries).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertEnquiry = z.infer<typeof insertEnquirySchema>;\nexport type Enquiry = typeof enquiries.$inferSelect;\n\nexport const insertFollowupSchema = createInsertSchema(followups).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertFollowup = z.infer<typeof insertFollowupSchema>;\nexport type Followup = typeof followups.$inferSelect;\n\nexport const deviceTokens = pgTable(\"device_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  token: text(\"token\").notNull().unique(),\n  deviceType: varchar(\"device_type\", { length: 20 }).notNull().default(\"web\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertDeviceTokenSchema = createInsertSchema(deviceTokens).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertDeviceToken = z.infer<typeof insertDeviceTokenSchema>;\nexport type DeviceToken = typeof deviceTokens.$inferSelect;\n","path":null,"size_bytes":33917,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/pages/SuperAdminLogin.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useLocation } from \"wouter\";\nimport { useEffect, useState } from \"react\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\nexport default function SuperAdminLogin() {\n    const { user, userRole, setUser, setUserRole, setDbUserId, setCompanyId } =\n        useAuth();\n    const [, setLocation] = useLocation();\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState(\"\");\n\n    const [superAdminData, setSuperAdminData] = useState({\n        email: \"\",\n        password: \"\",\n    });\n\n    useEffect(() => {\n        if (user && userRole) {\n            const isAdmin =\n                userRole === \"super_admin\" || userRole === \"company_admin\";\n            const isUser = userRole === \"company_member\";\n            if (isAdmin) {\n                setLocation(\"/admin\");\n            } else if (isUser) {\n                setLocation(\"/user\");\n            }\n        }\n    }, [user, userRole, setLocation]);\n\n    const handleSuperAdminLogin = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setIsLoading(true);\n        setError(\"\");\n        try {\n            const response = await fetch(`${API_BASE_URL}/api/auth/super-admin-login`, {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify(superAdminData),\n            });\n\n            if (!response.ok) {\n                const error = await response.json();\n                throw new Error(error.message || \"Login failed\");\n            }\n\n            const userData = await response.json();\n            setUser(userData);\n            setUserRole(userData.role);\n            setDbUserId(userData.id);\n            setCompanyId(userData.companyId || null);\n            localStorage.setItem(\"user\", JSON.stringify(userData));\n        } catch (error: any) {\n            setError(error.message || \"Login failed\");\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen flex items-center justify-center p-4 sm:p-6 md:p-8 bg-gradient-to-br from-background via-background to-primary/5\">\n            <div className=\"w-full max-w-md space-y-6 sm:space-y-8\">\n                <div className=\"text-center\">\n                    <h1 className=\"text-3xl sm:text-4xl font-bold text-foreground mb-2\">\n                        WorkLogix\n                    </h1>\n                    <p className=\"text-sm sm:text-base text-muted-foreground\">\n                        Super Admin Access\n                    </p>\n                </div>\n\n                <Card className=\"shadow-lg\">\n                    <CardHeader>\n                        <CardTitle>Super Admin Login</CardTitle>\n                        <CardDescription>\n                            Access server-level controls\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                        <form\n                            onSubmit={handleSuperAdminLogin}\n                            className=\"space-y-4\">\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"super-email\">Email</Label>\n                                <Input\n                                    id=\"super-email\"\n                                    type=\"email\"\n                                    placeholder=\"Enter your super admin email\"\n                                    value={superAdminData.email}\n                                    onChange={(e) =>\n                                        setSuperAdminData({\n                                            ...superAdminData,\n                                            email: e.target.value,\n                                        })\n                                    }\n                                    required\n                                    data-testid=\"input-super-admin-email\"\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"super-password\">Password</Label>\n                                <Input\n                                    id=\"super-password\"\n                                    type=\"password\"\n                                    value={superAdminData.password}\n                                    onChange={(e) =>\n                                        setSuperAdminData({\n                                            ...superAdminData,\n                                            password: e.target.value,\n                                        })\n                                    }\n                                    required\n                                    data-testid=\"input-super-admin-password\"\n                                />\n                            </div>\n                            {error && (\n                                <p\n                                    className=\"text-sm text-red-500\"\n                                    data-testid=\"error-message\">\n                                    {error}\n                                </p>\n                            )}\n                            <Button\n                                type=\"submit\"\n                                className=\"w-full\"\n                                disabled={isLoading}\n                                data-testid=\"button-super-admin-login\">\n                                {isLoading ? \"Signing in...\" : \"Sign In\"}\n                            </Button>\n                        </form>\n                    </CardContent>\n                </Card>\n\n                <div className=\"text-center\">\n                    <Link href=\"/\">\n                        <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"text-muted-foreground hover:text-foreground\"\n                            data-testid=\"link-back-to-login\">\n                            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                            Back to Main Login\n                        </Button>\n                    </Link>\n                </div>\n\n                <p className=\"text-xs text-center text-muted-foreground\">\n                    By continuing, you agree to our Terms of Service and Privacy\n                    Policy\n                </p>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":6798,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/pages/admin/LeaveApproval.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Calendar, Clock, Check, X } from \"lucide-react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\nimport { useCallback } from \"react\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport type { Leave } from \"@shared/schema\";\n\ntype LeaveWithUser = Leave & { userName: string };\n\nexport default function LeaveApproval() {\n    const { toast } = useToast();\n\n    const { data: user } = useQuery<any>({\n        queryKey: [\"/api/me\"],\n    });\n\n    const handleWebSocketMessage = useCallback(\n        (data: any) => {\n            if (\n                data.type === \"LEAVE_STATUS_UPDATE\" &&\n                data.data.companyId === user?.companyId\n            ) {\n                queryClient.invalidateQueries({\n                    queryKey: [\"/api/leaves/company\", user?.companyId],\n                });\n                const actionBy =\n                    data.data.changedBy ||\n                    data.data.approvedBy ||\n                    data.data.rejectedBy;\n                toast({\n                    title: \"Leave Status Updated\",\n                    description: `${data.data.userName}'s leave status changed to ${data.data.status} by ${actionBy}`,\n                });\n            }\n        },\n        [toast, user?.companyId]\n    );\n\n    useWebSocket(handleWebSocketMessage);\n\n    const { data: leaves = [], isLoading } = useQuery<LeaveWithUser[]>({\n        queryKey: [\"/api/leaves/company\", user?.companyId],\n        enabled: !!user?.companyId,\n    });\n\n    const approveMutation = useMutation({\n        mutationFn: async (leaveId: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/leaves/${leaveId}/approve`,\n                \"PATCH\",\n                {}\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/leaves/company\", user?.companyId],\n            });\n            toast({\n                title: \"Leave approved\",\n                description:\n                    \"The leave request has been approved successfully.\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description:\n                    \"Failed to approve leave request. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const rejectMutation = useMutation({\n        mutationFn: async (leaveId: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/leaves/${leaveId}/reject`,\n                \"PATCH\",\n                {}\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/leaves/company\", user?.companyId],\n            });\n            toast({\n                title: \"Leave rejected\",\n                description: \"The leave request has been rejected.\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description:\n                    \"Failed to reject leave request. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const changeStatusMutation = useMutation({\n        mutationFn: async ({\n            leaveId,\n            status,\n        }: {\n            leaveId: number;\n            status: string;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/leaves/${leaveId}/status`,\n                \"PATCH\",\n                { status }\n            );\n        },\n        onSuccess: (_data, variables) => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/leaves/company\", user?.companyId],\n            });\n            toast({\n                title: \"Status updated\",\n                description: `Leave status changed to ${variables.status}`,\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description: \"Failed to update leave status. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case \"approved\":\n                return \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\";\n            case \"rejected\":\n                return \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\";\n            default:\n                return \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\";\n        }\n    };\n\n    const pendingLeaves = leaves.filter(\n        (leave: any) => leave.status === \"pending\"\n    );\n    const processedLeaves = leaves.filter(\n        (leave: any) => leave.status !== \"pending\"\n    );\n\n    return (\n        <div className=\"container mx-auto p-6 space-y-6\">\n            <div>\n                <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n                    Leave Approvals\n                </h1>\n                <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\n                    Review and approve employee leave requests\n                </p>\n            </div>\n\n            <div className=\"space-y-6\">\n                <div>\n                    <h2 className=\"text-xl font-semibold mb-4 text-gray-900 dark:text-white\">\n                        Pending Requests ({pendingLeaves.length})\n                    </h2>\n                    <div className=\"grid gap-4\">\n                        {isLoading && (\n                            <Card className=\"p-6\">\n                                <p className=\"text-center text-gray-500 dark:text-gray-400\">\n                                    Loading...\n                                </p>\n                            </Card>\n                        )}\n\n                        {!isLoading && pendingLeaves.length === 0 && (\n                            <Card className=\"p-6\">\n                                <p\n                                    className=\"text-center text-gray-500 dark:text-gray-400\"\n                                    data-testid=\"text-no-pending\">\n                                    No pending leave requests.\n                                </p>\n                            </Card>\n                        )}\n\n                        {pendingLeaves.map((leave: any) => (\n                            <Card\n                                key={leave.id}\n                                className=\"p-6\"\n                                data-testid={`card-leave-${leave.id}`}>\n                                <div className=\"flex justify-between items-start\">\n                                    <div className=\"space-y-2 flex-1\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <h3\n                                                className=\"font-semibold text-lg\"\n                                                data-testid={`text-employee-${leave.id}`}>\n                                                {leave.userName}\n                                            </h3>\n                                            <span\n                                                className=\"px-3 py-1 rounded-full text-xs font-medium capitalize bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\"\n                                                data-testid={`text-leave-type-${leave.id}`}>\n                                                {leave.leaveType} Leave\n                                            </span>\n                                            <span\n                                                className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(\n                                                    leave.status\n                                                )}`}\n                                                data-testid={`status-leave-${leave.id}`}>\n                                                {leave.status.toUpperCase()}\n                                            </span>\n                                        </div>\n                                        <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400\">\n                                            <div className=\"flex items-center gap-1\">\n                                                <Calendar className=\"h-4 w-4\" />\n                                                <span\n                                                    data-testid={`text-dates-${leave.id}`}>\n                                                    {new Date(\n                                                        leave.startDate\n                                                    ).toLocaleDateString()}{\" \"}\n                                                    -{\" \"}\n                                                    {new Date(\n                                                        leave.endDate\n                                                    ).toLocaleDateString()}\n                                                </span>\n                                            </div>\n                                            <div className=\"flex items-center gap-1\">\n                                                <Clock className=\"h-4 w-4\" />\n                                                <span\n                                                    data-testid={`text-applied-${leave.id}`}>\n                                                    Applied:{\" \"}\n                                                    {new Date(\n                                                        leave.appliedDate\n                                                    ).toLocaleDateString()}\n                                                </span>\n                                            </div>\n                                        </div>\n                                        <p\n                                            className=\"text-sm text-gray-700 dark:text-gray-300\"\n                                            data-testid={`text-reason-${leave.id}`}>\n                                            <span className=\"font-medium\">\n                                                Reason:\n                                            </span>{\" \"}\n                                            {leave.reason}\n                                        </p>\n                                    </div>\n                                    <div className=\"flex gap-2\">\n                                        <Button\n                                            onClick={() =>\n                                                approveMutation.mutate(leave.id)\n                                            }\n                                            disabled={\n                                                approveMutation.isPending ||\n                                                rejectMutation.isPending\n                                            }\n                                            className=\"bg-green-600 hover:bg-green-700\"\n                                            data-testid={`button-approve-${leave.id}`}>\n                                            <Check className=\"h-4 w-4 mr-1\" />\n                                            Approve\n                                        </Button>\n                                        <Button\n                                            onClick={() =>\n                                                rejectMutation.mutate(leave.id)\n                                            }\n                                            disabled={\n                                                approveMutation.isPending ||\n                                                rejectMutation.isPending\n                                            }\n                                            variant=\"destructive\"\n                                            data-testid={`button-reject-${leave.id}`}>\n                                            <X className=\"h-4 w-4 mr-1\" />\n                                            Reject\n                                        </Button>\n                                    </div>\n                                </div>\n                            </Card>\n                        ))}\n                    </div>\n                </div>\n\n                <div>\n                    <h2 className=\"text-xl font-semibold mb-4 text-gray-900 dark:text-white\">\n                        Processed Requests ({processedLeaves.length})\n                    </h2>\n                    <div className=\"grid gap-4\">\n                        {processedLeaves.length === 0 && (\n                            <Card className=\"p-6\">\n                                <p\n                                    className=\"text-center text-gray-500 dark:text-gray-400\"\n                                    data-testid=\"text-no-processed\">\n                                    No processed leave requests yet.\n                                </p>\n                            </Card>\n                        )}\n\n                        {processedLeaves.map((leave: any) => (\n                            <Card\n                                key={leave.id}\n                                className=\"p-6\"\n                                data-testid={`card-processed-leave-${leave.id}`}>\n                                <div className=\"flex justify-between items-start\">\n                                    <div className=\"space-y-2 flex-1\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <h3\n                                                className=\"font-semibold text-lg\"\n                                                data-testid={`text-employee-${leave.id}`}>\n                                                {leave.userName}\n                                            </h3>\n                                            <span className=\"px-3 py-1 rounded-full text-xs font-medium capitalize bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\">\n                                                {leave.leaveType} Leave\n                                            </span>\n                                            <span\n                                                className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(\n                                                    leave.status\n                                                )}`}>\n                                                {leave.status.toUpperCase()}\n                                            </span>\n                                        </div>\n                                        <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400\">\n                                            <div className=\"flex items-center gap-1\">\n                                                <Calendar className=\"h-4 w-4\" />\n                                                <span>\n                                                    {new Date(\n                                                        leave.startDate\n                                                    ).toLocaleDateString()}{\" \"}\n                                                    -{\" \"}\n                                                    {new Date(\n                                                        leave.endDate\n                                                    ).toLocaleDateString()}\n                                                </span>\n                                            </div>\n                                            <div className=\"flex items-center gap-1\">\n                                                <Clock className=\"h-4 w-4\" />\n                                                <span>\n                                                    Applied:{\" \"}\n                                                    {new Date(\n                                                        leave.appliedDate\n                                                    ).toLocaleDateString()}\n                                                </span>\n                                            </div>\n                                        </div>\n                                        <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n                                            <span className=\"font-medium\">\n                                                Reason:\n                                            </span>{\" \"}\n                                            {leave.reason}\n                                        </p>\n                                    </div>\n                                    <div className=\"flex gap-2 items-center\">\n                                        <Select\n                                            value={leave.status}\n                                            onValueChange={(status) =>\n                                                changeStatusMutation.mutate({\n                                                    leaveId: leave.id,\n                                                    status,\n                                                })\n                                            }\n                                            disabled={\n                                                changeStatusMutation.isPending\n                                            }>\n                                            <SelectTrigger\n                                                className=\"w-32\"\n                                                data-testid={`select-status-${leave.id}`}>\n                                                <SelectValue />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                <SelectItem value=\"pending\">\n                                                    Pending\n                                                </SelectItem>\n                                                <SelectItem value=\"approved\">\n                                                    Approved\n                                                </SelectItem>\n                                                <SelectItem value=\"rejected\">\n                                                    Rejected\n                                                </SelectItem>\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                </div>\n                            </Card>\n                        ))}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":19191,"size_tokens":null},"CPANEL_DEPLOYMENT.md":{"content":"# cPanel Frontend Deployment Guide\n\nThis guide explains how to deploy the WorkLogix frontend to cPanel while keeping the backend on Render.\n\n## Architecture\n\n- **Frontend**: Hosted on cPanel (static files)\n- **Backend**: Hosted on Render (https://worllogix-03.onrender.com)\n\n## Prerequisites\n\n1. Node.js 18+ installed on your local machine\n2. cPanel access with File Manager or FTP\n3. Backend already deployed and running on Render\n\n## Step 1: Build the Frontend\n\nRun this command to build the frontend with your Render backend URL:\n\n```bash\n# Replace with your actual Render backend URL\nnpm run build:cpanel\n```\n\nThis creates a `dist/` folder with all the static files.\n\n## Step 2: Upload to cPanel\n\n### Option A: Using File Manager\n\n1. Log in to cPanel\n2. Open **File Manager**\n3. Navigate to `public_html/` (or your subdomain folder)\n4. Delete existing files (if updating)\n5. Upload all contents from your local `dist/` folder:\n   - `index.html`\n   - `assets/` folder\n   - `.htaccess` file\n\n### Option B: Using FTP\n\n1. Connect to your cPanel via FTP (FileZilla, etc.)\n2. Navigate to `public_html/`\n3. Upload all contents from `dist/` folder\n\n## Step 3: Configure .htaccess\n\nThe `.htaccess` file is included in the build and handles:\n- SPA routing (all routes serve index.html)\n- Security headers\n- GZIP compression\n- Static asset caching\n\nMake sure the `.htaccess` file is uploaded to `public_html/`.\n\n## Step 4: Configure CORS on Render Backend\n\nYour Render backend must allow requests from your cPanel domain. Add this environment variable in Render:\n\n**In Render Dashboard > Your Service > Environment:**\n\n```\nALLOWED_ORIGINS=https://your-cpanel-domain.com,https://www.your-cpanel-domain.com\n```\n\nReplace `your-cpanel-domain.com` with your actual cPanel domain.\n\nThe backend is already configured to read this environment variable and allow cross-origin requests.\n\n## Troubleshooting\n\n### API calls failing?\n- Check browser console for CORS errors\n- Verify VITE_API_URL was set correctly during build\n- Ensure Render backend CORS allows your cPanel domain\n\n### Page refresh shows 404?\n- Make sure `.htaccess` file is uploaded\n- Check that mod_rewrite is enabled on your cPanel\n\n### Login/session issues?\n- Ensure `credentials: true` is set in both frontend fetch calls and backend CORS\n- Check that cookies are being set with proper SameSite and Secure attributes\n\n## Updating the Frontend\n\nTo update after code changes:\n\n1. Run the build command again:\n   ```bash\n   VITE_API_URL=https://worllogix-03.onrender.com npm run build:cpanel\n   ```\n\n2. Upload the new `dist/` contents to cPanel (replace old files)\n\n## Environment Variables Reference\n\n| Variable | Description | Example |\n|----------|-------------|---------|\n| VITE_API_URL | Your Render backend URL | https://worllogix-03.onrender.com |\n\n## Notes\n\n- Environment variables in Vite are \"baked in\" at build time\n- You must rebuild the frontend if the backend URL changes\n- The `.htaccess` file is essential for SPA routing on Apache servers\n","path":null,"size_bytes":3006,"size_tokens":null},"client/src/pages/admin/AdminMessages.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Card } from \"@/components/ui/card\";\nimport { MessageSquare, Send, Users, ArrowLeft, Search } from \"lucide-react\";\nimport { format, isToday, isYesterday } from \"date-fns\";\nimport type { User, Message, GroupMessage } from \"@shared/schema\";\nimport { Textarea as TextareaComponent } from \"@/components/ui/textarea\";\n\ntype ConversationType = \"direct\" | \"group\";\ninterface Conversation {\n    id: string;\n    type: ConversationType;\n    userId?: number;\n    userName?: string;\n    userRole?: string;\n    userPhoto?: string;\n    lastMessage?: string;\n    lastMessageTime?: Date;\n    unreadCount?: number;\n}\n\nexport default function AdminMessages() {\n    const { toast } = useToast();\n    const { dbUserId } = useAuth();\n    const messagesEndRef = useRef<HTMLDivElement>(null);\n\n    const [selectedConversation, setSelectedConversation] =\n        useState<Conversation | null>(null);\n    const [messageInput, setMessageInput] = useState(\"\");\n    const [searchQuery, setSearchQuery] = useState(\"\");\n    const [conversations, setConversations] = useState<Conversation[]>([]);\n    const [showConversationList, setShowConversationList] = useState(true);\n\n    const { data: users = [] } = useQuery<User[]>({\n        queryKey: [\"/api/users\"],\n    });\n\n    const { data: privateMessages = [] } = useQuery<Message[]>({\n        queryKey: [\"/api/messages\"],\n    });\n\n    const { data: groupMessages = [] } = useQuery<GroupMessage[]>({\n        queryKey: [\"/api/group-messages\"],\n    });\n\n    // Real-time updates\n    useWebSocket((data) => {\n        if (data.type === \"NEW_MESSAGE\") {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/messages\"],\n            });\n        }\n        if (data.type === \"NEW_GROUP_MESSAGE\") {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/group-messages\"],\n            });\n        }\n    });\n\n    // Build conversations from messages and all available users\n    useEffect(() => {\n        const convMap = new Map<string, Conversation>();\n\n        // First, add all team members and team leaders as conversation starters\n        const teamUsers = users.filter(\n            (u) =>\n                u.id !== dbUserId &&\n                (u.role === \"company_member\" || u.role === \"team_leader\")\n        );\n        teamUsers.forEach((user) => {\n            const key = `direct-${user.id}`;\n            convMap.set(key, {\n                id: key,\n                type: \"direct\",\n                userId: user.id,\n                userName: user.displayName || \"Unknown\",\n                userRole: user.role || \"\",\n                userPhoto: user.photoURL || \"\",\n                lastMessage: \"No messages yet\",\n                lastMessageTime: new Date(0),\n                unreadCount: 0,\n            });\n        });\n\n        // Then update with actual messages\n        privateMessages.forEach((msg) => {\n            const otherUserId =\n                msg.senderId === dbUserId ? msg.receiverId : msg.senderId;\n            const otherUser = users.find((u) => u.id === otherUserId);\n            const key = `direct-${otherUserId}`;\n\n            if (convMap.has(key)) {\n                const lastMessageTime = new Date(msg.createdAt);\n                const current = convMap.get(key)!;\n\n                if (\n                    lastMessageTime > (current.lastMessageTime || new Date(0))\n                ) {\n                    convMap.set(key, {\n                        ...current,\n                        lastMessage: msg.message,\n                        lastMessageTime,\n                        unreadCount: msg.readStatus\n                            ? 0\n                            : (current.unreadCount || 0) + 1,\n                    });\n                }\n            }\n        });\n\n        // Group conversations (always shown as single group chat)\n        if (groupMessages.length > 0) {\n            const lastGroup = groupMessages.sort(\n                (a, b) =>\n                    new Date(b.createdAt).getTime() -\n                    new Date(a.createdAt).getTime()\n            )[0];\n            convMap.set(\"group-all\", {\n                id: \"group-all\",\n                type: \"group\",\n                userName: \"Announcements\",\n                lastMessage:\n                    lastGroup?.title || lastGroup?.message || \"No messages\",\n                lastMessageTime: new Date(lastGroup?.createdAt || Date.now()),\n                unreadCount: 0,\n            });\n        }\n\n        // Sort by most recent message first, then by user name\n        const sorted = Array.from(convMap.values()).sort((a, b) => {\n            // Group announcements always at top\n            if (a.type === \"group\") return -1;\n            if (b.type === \"group\") return 1;\n\n            // Then sort by most recent message\n            const timeA = a.lastMessageTime?.getTime() || 0;\n            const timeB = b.lastMessageTime?.getTime() || 0;\n\n            if (timeA !== timeB) return timeB - timeA;\n\n            // If same time, sort by name\n            return (a.userName || \"\").localeCompare(b.userName || \"\");\n        });\n\n        setConversations(sorted);\n    }, [privateMessages, groupMessages, users, dbUserId]);\n\n    const sendPrivateMessageMutation = useMutation({\n        mutationFn: async ({\n            receiverId,\n            message,\n            role,\n        }: {\n            receiverId: number;\n            message: string;\n            role?: string;\n        }) => {\n            // Determine messageType based on recipient role\n            let messageType = \"direct_message\";\n            if (role === \"team_leader\") {\n                messageType = \"admin_to_team_leader\";\n            } else if (role === \"company_member\") {\n                messageType = \"admin_to_employee\";\n            }\n\n            return await apiRequest(`${API_BASE_URL}/api/messages`, \"POST\", {\n                senderId: dbUserId,\n                receiverId,\n                message,\n                messageType,\n                readStatus: false,\n            });\n        },\n        onSuccess: () => {\n            setMessageInput(\"\");\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/messages\"],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to send message\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const sendGroupMessageMutation = useMutation({\n        mutationFn: async ({ message }: { message: string }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/group-messages`,\n                \"POST\",\n                {\n                    message,\n                    title: null,\n                }\n            );\n        },\n        onSuccess: () => {\n            setMessageInput(\"\");\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/group-messages\"],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to send message\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleSendMessage = () => {\n        if (!messageInput.trim() || !selectedConversation) return;\n\n        if (\n            selectedConversation.type === \"direct\" &&\n            selectedConversation.userId\n        ) {\n            sendPrivateMessageMutation.mutate({\n                receiverId: selectedConversation.userId,\n                message: messageInput,\n                role: selectedConversation.userRole,\n            });\n        } else if (selectedConversation.type === \"group\") {\n            sendGroupMessageMutation.mutate({\n                message: messageInput,\n            });\n        }\n    };\n\n    const getConversationMessages = () => {\n        if (!selectedConversation) return [];\n\n        if (\n            selectedConversation.type === \"direct\" &&\n            selectedConversation.userId\n        ) {\n            return privateMessages\n                .filter(\n                    (msg) =>\n                        (msg.senderId === dbUserId &&\n                            msg.receiverId === selectedConversation.userId) ||\n                        (msg.receiverId === dbUserId &&\n                            msg.senderId === selectedConversation.userId)\n                )\n                .sort(\n                    (a, b) =>\n                        new Date(a.createdAt).getTime() -\n                        new Date(b.createdAt).getTime()\n                );\n        }\n\n        if (selectedConversation.type === \"group\") {\n            return groupMessages.sort(\n                (a, b) =>\n                    new Date(a.createdAt).getTime() -\n                    new Date(b.createdAt).getTime()\n            );\n        }\n\n        return [];\n    };\n\n    const formatTime = (date: Date) => {\n        if (isToday(date)) return format(date, \"HH:mm\");\n        if (isYesterday(date)) return \"Yesterday\";\n        return format(date, \"MMM dd\");\n    };\n\n    const filteredConversations = conversations.filter((conv) =>\n        conv.userName?.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n\n    useEffect(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [getConversationMessages()]);\n\n    const messages = getConversationMessages();\n\n    return (\n        <div className=\"h-[80vh] md:h-[90vh] w-full flex flex-col overflow-hidden\">\n            <div className=\"flex-1 flex flex-col md:flex-row gap-0 bg-background overflow-hidden min-w-0 w-full\">\n                {/* Conversations List */}\n                <div\n                    className={`${\n                        showConversationList ? \"flex\" : \"hidden\"\n                    } md:flex w-full md:w-72 lg:w-80 border-b md:border-b-0 md:border-r border-border flex-col min-h-0`}>\n                    <div className=\"flex-shrink-0 p-3 sm:p-4 lg:p-5 border-b border-border space-y-3\">\n                        <h2 className=\"text-base sm:text-lg lg:text-xl font-bold flex items-center gap-2\">\n                            <MessageSquare className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                            Chats\n                        </h2>\n                        <div className=\"relative\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                            <Input\n                                placeholder=\"Search conversations...\"\n                                value={searchQuery}\n                                onChange={(e) => setSearchQuery(e.target.value)}\n                                className=\"pl-9 h-9 text-sm\"\n                                data-testid=\"input-search-conversations\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto hide-scrollbar\">\n                        <div className=\"space-y-1 p-2\">\n                            {filteredConversations.length === 0 ? (\n                                <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                                    No conversations yet\n                                </div>\n                            ) : (\n                                filteredConversations.map((conv) => (\n                                    <button\n                                        key={conv.id}\n                                        onClick={() => {\n                                            setSelectedConversation(conv);\n                                            setShowConversationList(false);\n                                        }}\n                                        className={`w-full text-left p-2 sm:p-3 rounded-lg transition-colors hover:bg-accent ${\n                                            selectedConversation?.id === conv.id\n                                                ? \"bg-primary/10 border border-primary\"\n                                                : \"\"\n                                        }`}\n                                        data-testid={`conv-${conv.id}`}>\n                                        <div className=\"flex items-start gap-2 sm:gap-3\">\n                                            <Avatar className=\"h-10 w-10 flex-shrink-0\">\n                                                <AvatarFallback className=\"text-xs\">\n                                                    {conv.type === \"group\" ? (\n                                                        <Users className=\"h-5 w-5\" />\n                                                    ) : (\n                                                        conv.userName?.[0] ||\n                                                        \"?\"\n                                                    )}\n                                                </AvatarFallback>\n                                            </Avatar>\n                                            <div className=\"flex-1 min-w-0\">\n                                                <div className=\"flex items-center justify-between gap-2\">\n                                                    <p className=\"font-medium text-sm truncate\">\n                                                        {conv.userName}\n                                                    </p>\n                                                    <span className=\"text-xs text-muted-foreground flex-shrink-0 whitespace-nowrap\">\n                                                        {conv.lastMessageTime &&\n                                                            formatTime(\n                                                                conv.lastMessageTime\n                                                            )}\n                                                    </span>\n                                                </div>\n                                                <p className=\"text-xs text-muted-foreground truncate mt-1\">\n                                                    {conv.lastMessage}\n                                                </p>\n                                            </div>\n                                        </div>\n                                    </button>\n                                ))\n                            )}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Chat Area */}\n                {selectedConversation ? (\n                    <div className=\"flex-1 flex flex-col min-w-0 min-h-0 overflow-hidden\">\n                        <div className=\"flex flex-col h-full min-h-0 overflow-hidden\">\n                            {/* Chat Header - Fixed at Top */}\n                            <div className=\"flex-shrink-0 sticky top-0 z-50 border-b border-border px-3 sm:px-4 lg:px-5 py-2 sm:py-2 flex items-center gap-3 bg-background shadow-sm\">\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    onClick={() => {\n                                        setShowConversationList(true);\n                                        setSelectedConversation(null);\n                                    }}\n                                    className=\"md:hidden h-8 w-8\"\n                                    data-testid=\"button-back-to-conversations\">\n                                    <ArrowLeft className=\"h-3 w-3\" />\n                                </Button>\n                                <Avatar className=\"h-8 w-8 shrink-0\">\n                                    <AvatarImage\n                                        src={selectedConversation.userPhoto}\n                                    />\n                                    <AvatarFallback className=\"text-xs\">\n                                        {selectedConversation.type ===\n                                        \"group\" ? (\n                                            <Users className=\"h-4 w-4\" />\n                                        ) : (\n                                            selectedConversation\n                                                .userName?.[0] || \"?\"\n                                        )}\n                                    </AvatarFallback>\n                                </Avatar>\n                                <div className=\"flex-1 min-w-0\">\n                                    <p className=\"font-semibold text-xs sm:text-sm truncate\">\n                                        {selectedConversation.userName}\n                                    </p>\n                                    {selectedConversation.type === \"direct\" &&\n                                        selectedConversation.userRole && (\n                                            <p className=\"text-xs text-muted-foreground leading-tight\">\n                                                {selectedConversation.userRole ===\n                                                \"team_leader\"\n                                                    ? \"Team Leader\"\n                                                    : \"Team Member\"}\n                                            </p>\n                                        )}\n                                </div>\n                            </div>\n\n                            {/* Messages - Scrollable */}\n                            <div className=\"flex-1 overflow-y-auto min-h-0 px-3 sm:px-4 lg:px-5 py-1 sm:py-2 hide-scrollbar\">\n                                <div className=\"space-y-1 sm:space-y-2 flex flex-col\">\n                                    {messages.length === 0 ? (\n                                        <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                                            No messages yet. Start a\n                                            conversation!\n                                        </div>\n                                    ) : (\n                                        messages.map((msg, idx) => {\n                                            const isOwn =\n                                                \"senderId\" in msg &&\n                                                msg.senderId === dbUserId;\n                                            return (\n                                                <div\n                                                    key={`${msg.id}-${idx}`}\n                                                    className={`flex ${\n                                                        isOwn\n                                                            ? \"justify-end\"\n                                                            : \"justify-start\"\n                                                    }`}\n                                                    data-testid={`message-${msg.id}`}>\n                                                    <div\n                                                        className={`rounded-lg p-2 sm:p-3 max-w-xs sm:max-w-md lg:max-w-lg text-sm break-words ${\n                                                            isOwn\n                                                                ? \"bg-primary text-primary-foreground\"\n                                                                : \"bg-muted text-muted-foreground\"\n                                                        }`}>\n                                                        {\"title\" in msg &&\n                                                            msg.title && (\n                                                                <p className=\"font-semibold text-sm mb-1\">\n                                                                    {msg.title}\n                                                                </p>\n                                                            )}\n                                                        <p className=\"break-words whitespace-pre-wrap\">\n                                                            {msg.message}\n                                                        </p>\n                                                        <p\n                                                            className={`text-xs mt-2 ${\n                                                                isOwn\n                                                                    ? \"text-primary-foreground/70\"\n                                                                    : \"text-muted-foreground/70\"\n                                                            }`}>\n                                                            {format(\n                                                                new Date(\n                                                                    msg.createdAt\n                                                                ),\n                                                                \"HH:mm\"\n                                                            )}\n                                                        </p>\n                                                    </div>\n                                                </div>\n                                            );\n                                        })\n                                    )}\n                                    <div ref={messagesEndRef} />\n                                </div>\n                            </div>\n\n                            {/* Message Input - Fixed */}\n                            <div className=\"flex-shrink-0 border-t border-border px-3 sm:px-4 lg:px-5 pt-2 sm:pt-3 pb-0 bg-background\">\n                                <div className=\"flex gap-2 items-center flex-nowrap\">\n                                    <div className=\"flex-1 flex items-center gap-2 bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-3xl px-3 py-2 shadow-sm\">\n                                        <TextareaComponent\n                                            placeholder=\"Type a message\"\n                                            value={messageInput}\n                                            onChange={(e) =>\n                                                setMessageInput(e.target.value)\n                                            }\n                                            onKeyDown={(e) => {\n                                                if (\n                                                    e.key === \"Enter\" &&\n                                                    !e.shiftKey\n                                                ) {\n                                                    e.preventDefault();\n                                                    handleSendMessage();\n                                                }\n                                            }}\n                                            disabled={\n                                                sendPrivateMessageMutation.isPending ||\n                                                sendGroupMessageMutation.isPending\n                                            }\n                                            data-testid=\"input-message\"\n                                            className=\"resize-none text-xs sm:text-sm flex-1 bg-transparent border-0 focus-visible:ring-0 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus-visible:outline-none min-h-4\"\n                                            rows={1}\n                                        />\n                                    </div>\n                                    <Button\n                                        onClick={handleSendMessage}\n                                        disabled={\n                                            !messageInput.trim() ||\n                                            sendPrivateMessageMutation.isPending ||\n                                            sendGroupMessageMutation.isPending\n                                        }\n                                        size=\"icon\"\n                                        data-testid=\"button-send-message\"\n                                        className=\"flex-shrink-0 h-8 w-8 sm:h-9 sm:w-9 rounded-full shadow-sm hover:shadow-md transition-shadow\">\n                                        <Send className=\"h-4 w-4\" />\n                                    </Button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                ) : (\n                    <div className=\"hidden md:flex flex-1 items-center justify-center text-muted-foreground\">\n                        <div className=\"text-center space-y-4\">\n                            <MessageSquare className=\"h-16 w-16 mx-auto opacity-20\" />\n                            <p className=\"text-sm\">\n                                Select a conversation to start messaging\n                            </p>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":25820,"size_tokens":null},"client/src/components/examples/MessageCard.tsx":{"content":"import MessageCard from '../MessageCard'\nimport { useState } from 'react'\n\nexport default function MessageCardExample() {\n  const [messages, setMessages] = useState([\n    { id: \"1\", message: \"New task assigned: Complete Q4 Sales Report. Please review the requirements.\", timestamp: new Date(), isRead: false, relatedTask: \"Q4 Sales Report\" },\n    { id: \"2\", message: \"Great work on the marketing analysis! Keep it up.\", timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), isRead: true },\n  ])\n\n  const markAsRead = (id: string) => {\n    setMessages(messages.map(msg => msg.id === id ? { ...msg, isRead: true } : msg))\n  }\n\n  return (\n    <div className=\"space-y-3 max-w-2xl\">\n      {messages.map(msg => (\n        <MessageCard\n          key={msg.id}\n          {...msg}\n          onMarkRead={() => markAsRead(msg.id)}\n        />\n      ))}\n    </div>\n  )\n}\n","path":null,"size_bytes":856,"size_tokens":null},"client/src/pages/team-leader/TeamAttendanceReports.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Download, TrendingUp, TrendingDown, Minus } from \"lucide-react\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useState } from \"react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface TeamMemberStat {\n    id: number;\n    name: string;\n    presentDays: number;\n    absentDays: number;\n    lateDays: number;\n    avgHours: string;\n    trend: string;\n}\n\ninterface AttendanceReportData {\n    teamAttendanceRate: string;\n    avgWorkingHours: string;\n    lateArrivals: number;\n    memberStats: TeamMemberStat[];\n}\n\nexport default function TeamAttendanceReports() {\n    const { dbUserId } = useAuth();\n    const [period, setPeriod] = useState<string>(\"month\");\n\n    const getDateRange = (periodType: string) => {\n        const now = new Date();\n        let startDate: string, endDate: string;\n\n        switch (periodType) {\n            case \"week\":\n                const weekAgo = new Date(now);\n                weekAgo.setDate(now.getDate() - 7);\n                startDate = weekAgo.toISOString().split(\"T\")[0];\n                endDate = now.toISOString().split(\"T\")[0];\n                break;\n            case \"quarter\":\n                const quarter = Math.floor(now.getMonth() / 3);\n                const quarterStart = new Date(\n                    now.getFullYear(),\n                    quarter * 3,\n                    1\n                );\n                startDate = quarterStart.toISOString().split(\"T\")[0];\n                endDate = now.toISOString().split(\"T\")[0];\n                break;\n            case \"year\":\n                const yearStart = new Date(now.getFullYear(), 0, 1);\n                startDate = yearStart.toISOString().split(\"T\")[0];\n                endDate = now.toISOString().split(\"T\")[0];\n                break;\n            default: // month\n                const monthStart = new Date(\n                    now.getFullYear(),\n                    now.getMonth(),\n                    1\n                );\n                startDate = monthStart.toISOString().split(\"T\")[0];\n                endDate = now.toISOString().split(\"T\")[0];\n                break;\n        }\n\n        return { startDate, endDate };\n    };\n\n    const { startDate, endDate } = getDateRange(period);\n\n    const { data: reportData, isLoading } = useQuery<AttendanceReportData>({\n        queryKey: [\n            `/api/team-assignments/${dbUserId}/attendance/reports`,\n            { startDate, endDate },\n        ],\n        enabled: !!dbUserId,\n    });\n\n    const getTrendIcon = (trend: string) => {\n        switch (trend) {\n            case \"up\":\n                return <TrendingUp className=\"h-4 w-4 text-green-600\" />;\n            case \"down\":\n                return <TrendingDown className=\"h-4 w-4 text-red-600\" />;\n            default:\n                return <Minus className=\"h-4 w-4 text-muted-foreground\" />;\n        }\n    };\n\n    const handleExport = () => {\n        if (!reportData) return;\n\n        const csv = [\n            [\n                \"Name\",\n                \"Present Days\",\n                \"Absent Days\",\n                \"Late Days\",\n                \"Avg Hours\",\n                \"Trend\",\n            ].join(\",\"),\n            ...reportData.memberStats.map((m) =>\n                [\n                    m.name,\n                    m.presentDays,\n                    m.absentDays,\n                    m.lateDays,\n                    m.avgHours,\n                    m.trend,\n                ].join(\",\")\n            ),\n        ].join(\"\\n\");\n\n        const blob = new Blob([csv], { type: \"text/csv\" });\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = `team-attendance-report-${startDate}-${endDate}.csv`;\n        a.click();\n        window.URL.revokeObjectURL(url);\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                    <div>\n                        <Skeleton className=\"h-10 w-48 mb-2\" />\n                        <Skeleton className=\"h-5 w-72\" />\n                    </div>\n                </div>\n                <div className=\"grid gap-4 md:grid-cols-3\">\n                    {[...Array(3)].map((_, i) => (\n                        <Skeleton key={i} className=\"h-24 w-full\" />\n                    ))}\n                </div>\n                <Skeleton className=\"h-96 w-full\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\">Attendance Reports</h1>\n                    <p className=\"text-muted-foreground\">\n                        View team attendance analytics and trends\n                    </p>\n                </div>\n                <div className=\"flex gap-2\">\n                    <Select value={period} onValueChange={setPeriod}>\n                        <SelectTrigger\n                            className=\"w-40\"\n                            data-testid=\"select-report-period\">\n                            <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"week\">This Week</SelectItem>\n                            <SelectItem value=\"month\">This Month</SelectItem>\n                            <SelectItem value=\"quarter\">\n                                This Quarter\n                            </SelectItem>\n                            <SelectItem value=\"year\">This Year</SelectItem>\n                        </SelectContent>\n                    </Select>\n                    <Button\n                        variant=\"outline\"\n                        onClick={handleExport}\n                        data-testid=\"button-download-report\">\n                        <Download className=\"h-4 w-4 mr-2\" />\n                        Export\n                    </Button>\n                </div>\n            </div>\n\n            <div className=\"grid gap-4 md:grid-cols-3\">\n                <Card>\n                    <CardHeader className=\"pb-3\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Team Attendance Rate\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-attendance-rate\">\n                            {reportData?.teamAttendanceRate || \"0.0\"}%\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                            Overall performance\n                        </p>\n                    </CardContent>\n                </Card>\n                <Card>\n                    <CardHeader className=\"pb-3\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Avg Working Hours\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-avg-hours\">\n                            {reportData?.avgWorkingHours || \"0h\"}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                            Per team member\n                        </p>\n                    </CardContent>\n                </Card>\n                <Card>\n                    <CardHeader className=\"pb-3\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Late Arrivals\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-late-arrivals\">\n                            {reportData?.lateArrivals || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                            Total instances\n                        </p>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Team Member Statistics</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    {!reportData || reportData.memberStats.length === 0 ? (\n                        <div className=\"flex flex-col items-center justify-center py-12\">\n                            <p className=\"text-muted-foreground\">\n                                No attendance data available for this period\n                            </p>\n                        </div>\n                    ) : (\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full\">\n                                <thead>\n                                    <tr className=\"border-b\">\n                                        <th className=\"text-left py-3 px-2 font-medium\">\n                                            Name\n                                        </th>\n                                        <th className=\"text-left py-3 px-2 font-medium\">\n                                            Present\n                                        </th>\n                                        <th className=\"text-left py-3 px-2 font-medium\">\n                                            Absent\n                                        </th>\n                                        <th className=\"text-left py-3 px-2 font-medium\">\n                                            Late\n                                        </th>\n                                        <th className=\"text-left py-3 px-2 font-medium\">\n                                            Avg Hours\n                                        </th>\n                                        <th className=\"text-left py-3 px-2 font-medium\">\n                                            Trend\n                                        </th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {reportData.memberStats.map((member) => (\n                                        <tr\n                                            key={member.id}\n                                            className=\"border-b last:border-0\"\n                                            data-testid={`report-row-${member.id}`}>\n                                            <td className=\"py-3 px-2 font-medium\">\n                                                {member.name}\n                                            </td>\n                                            <td className=\"py-3 px-2 text-green-600\">\n                                                {member.presentDays}\n                                            </td>\n                                            <td className=\"py-3 px-2 text-red-600\">\n                                                {member.absentDays}\n                                            </td>\n                                            <td className=\"py-3 px-2 text-orange-600\">\n                                                {member.lateDays}\n                                            </td>\n                                            <td className=\"py-3 px-2\">\n                                                {member.avgHours}\n                                            </td>\n                                            <td className=\"py-3 px-2\">\n                                                {getTrendIcon(member.trend)}\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":12614,"size_tokens":null},"client/src/pages/team-leader/TeamAttendanceMonitor.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { CheckCircle, XCircle, Clock, Calendar } from \"lucide-react\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useState } from \"react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface AttendanceRecord {\n    userId: number;\n    userName: string | null;\n    userPhotoURL?: string | null;\n    checkIn?: Date | null;\n    checkOut?: Date | null;\n    clockIn?: string | null;\n    clockOut?: string | null;\n    workDuration?: number | null;\n    totalHours?: number;\n    status: string;\n}\n\nexport default function TeamAttendanceMonitor() {\n    const { dbUserId } = useAuth();\n\n    const { data: attendanceRecords = [], isLoading } = useQuery<\n        AttendanceRecord[]\n    >({\n        queryKey: [`/api/team-assignments/${dbUserId}/attendance/today`],\n        enabled: !!dbUserId,\n        refetchInterval: 30000, // Refresh every 30 seconds for real-time updates\n    });\n\n    const stats = {\n        present: attendanceRecords.filter((r) => r.status === \"present\").length,\n        absent: attendanceRecords.filter((r) => r.status === \"absent\").length,\n        late: attendanceRecords.filter((r) => r.status === \"late\").length,\n        onLeave: attendanceRecords.filter((r) => r.status === \"on_leave\")\n            .length,\n    };\n\n    const formatTime = (timeStr?: string) => {\n        if (!timeStr) return null;\n        return new Date(timeStr).toLocaleTimeString(\"en-US\", {\n            hour: \"2-digit\",\n            minute: \"2-digit\",\n        });\n    };\n\n    const formatHours = (hours?: number) => {\n        if (!hours) return \"0h\";\n        const h = Math.floor(hours);\n        const m = Math.round((hours - h) * 60);\n        return `${h}h ${m}m`;\n    };\n\n    const getInitials = (name?: string) => {\n        if (!name) return \"??\";\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    const getStatusBadgeVariant = (status: string) => {\n        switch (status) {\n            case \"present\":\n                return \"default\";\n            case \"late\":\n                return \"secondary\";\n            case \"absent\":\n                return \"destructive\";\n            case \"on_leave\":\n                return \"secondary\";\n            default:\n                return \"secondary\";\n        }\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                    <div>\n                        <Skeleton className=\"h-10 w-48 mb-2\" />\n                        <Skeleton className=\"h-5 w-72\" />\n                    </div>\n                    <Skeleton className=\"h-10 w-40\" />\n                </div>\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                    {[...Array(4)].map((_, i) => (\n                        <Card key={i}>\n                            <CardHeader>\n                                <Skeleton className=\"h-4 w-24\" />\n                            </CardHeader>\n                            <CardContent>\n                                <Skeleton className=\"h-8 w-12\" />\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\">\n                        Team Attendance - Today\n                    </h1>\n                    <p className=\"text-muted-foreground\">\n                        Monitor your team's attendance in real-time\n                    </p>\n                </div>\n            </div>\n\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Present\n                        </CardTitle>\n                        <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-present\">\n                            {stats.present}\n                        </div>\n                    </CardContent>\n                </Card>\n                <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Absent\n                        </CardTitle>\n                        <XCircle className=\"h-4 w-4 text-red-600\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-absent\">\n                            {stats.absent}\n                        </div>\n                    </CardContent>\n                </Card>\n                <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Late\n                        </CardTitle>\n                        <Clock className=\"h-4 w-4 text-orange-600\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-late\">\n                            {stats.late}\n                        </div>\n                    </CardContent>\n                </Card>\n                <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            On Leave\n                        </CardTitle>\n                        <Calendar className=\"h-4 w-4 text-blue-600\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-leave\">\n                            {stats.onLeave}\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Team Members</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    {attendanceRecords.length === 0 ? (\n                        <div className=\"flex flex-col items-center justify-center py-12\">\n                            <p className=\"text-muted-foreground\">\n                                No attendance records for today\n                            </p>\n                        </div>\n                    ) : (\n                        <div className=\"space-y-4\">\n                            {attendanceRecords.map((member) => (\n                                <div\n                                    key={member.userId}\n                                    className=\"flex flex-wrap items-center justify-between gap-4 pb-4 border-b last:border-0\"\n                                    data-testid={`member-attendance-${member.userId}`}>\n                                    <div className=\"flex items-center gap-3\">\n                                        <Avatar>\n                                            <AvatarImage\n                                                src={\n                                                    member.userPhotoURL ||\n                                                    undefined\n                                                }\n                                            />\n                                            <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                                                {getInitials(\n                                                    member.userName || undefined\n                                                )}\n                                            </AvatarFallback>\n                                        </Avatar>\n                                        <div>\n                                            <p className=\"font-medium\">\n                                                {member.userName || \"Unknown\"}\n                                            </p>\n                                            <p className=\"text-sm text-muted-foreground\">\n                                                {member.clockIn\n                                                    ? `In: ${formatTime(\n                                                          member.clockIn\n                                                      )}`\n                                                    : \"Not clocked in\"}\n                                                {member.clockOut &&\n                                                    ` | Out: ${formatTime(\n                                                        member.clockOut\n                                                    )}`}\n                                            </p>\n                                        </div>\n                                    </div>\n                                    <div className=\"flex items-center gap-3\">\n                                        <span className=\"text-sm font-medium\">\n                                            {formatHours(member.totalHours)}\n                                        </span>\n                                        <Badge\n                                            variant={getStatusBadgeVariant(\n                                                member.status\n                                            )}>\n                                            {member.status.replace(\"_\", \" \")}\n                                        </Badge>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":10905,"size_tokens":null},"client/src/pages/team-leader/TeamFeedback.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MessageSquare, ThumbsUp, ThumbsDown } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useState, useMemo } from \"react\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Feedback {\n    id: number;\n    submittedBy: number;\n    recipientType: string;\n    message: string;\n    createdAt: string;\n    submitterName?: string | null;\n    submitterRole?: string | null;\n}\n\nexport default function TeamFeedback() {\n    const { dbUserId, companyId } = useAuth();\n    const { toast } = useToast();\n    const [selectedType, setSelectedType] = useState<string | null>(null);\n    const [isSubmitDialogOpen, setIsSubmitDialogOpen] = useState(false);\n    const [feedbackMessage, setFeedbackMessage] = useState(\"\");\n    const [recipientType, setRecipientType] = useState<\"Admin\" | \"TeamLeader\">(\n        \"Admin\"\n    );\n\n    const { data: teamFeedbackList = [], isLoading: loadingFeedbacks } =\n        useQuery<Feedback[]>({\n            queryKey: [\"/api/feedbacks\"],\n            enabled: !!companyId,\n        });\n\n    const feedbackStats = useMemo(() => {\n        const positive = teamFeedbackList.filter(\n            (f) =>\n                f.message.toLowerCase().includes(\"great\") ||\n                f.message.toLowerCase().includes(\"excellent\") ||\n                f.message.toLowerCase().includes(\"good job\") ||\n                f.message.toLowerCase().includes(\"well done\")\n        ).length;\n\n        const concern = teamFeedbackList.filter(\n            (f) =>\n                f.message.toLowerCase().includes(\"concern\") ||\n                f.message.toLowerCase().includes(\"issue\") ||\n                f.message.toLowerCase().includes(\"problem\")\n        ).length;\n\n        const suggestion = teamFeedbackList.length - positive - concern;\n\n        return { positive, concern, suggestion };\n    }, [teamFeedbackList]);\n\n    const getTypeIcon = (message: string) => {\n        const lowerMessage = message.toLowerCase();\n        if (\n            lowerMessage.includes(\"great\") ||\n            lowerMessage.includes(\"excellent\") ||\n            lowerMessage.includes(\"good job\") ||\n            lowerMessage.includes(\"well done\")\n        ) {\n            return <ThumbsUp className=\"h-4 w-4 text-green-600\" />;\n        }\n        if (\n            lowerMessage.includes(\"concern\") ||\n            lowerMessage.includes(\"issue\") ||\n            lowerMessage.includes(\"problem\")\n        ) {\n            return <ThumbsDown className=\"h-4 w-4 text-red-600\" />;\n        }\n        return <MessageSquare className=\"h-4 w-4 text-blue-600\" />;\n    };\n\n    const getTypeBadge = (message: string) => {\n        const lowerMessage = message.toLowerCase();\n        if (\n            lowerMessage.includes(\"great\") ||\n            lowerMessage.includes(\"excellent\") ||\n            lowerMessage.includes(\"good job\") ||\n            lowerMessage.includes(\"well done\")\n        ) {\n            return (\n                <Badge variant=\"default\" className=\"bg-green-600\">\n                    Positive\n                </Badge>\n            );\n        }\n        if (\n            lowerMessage.includes(\"concern\") ||\n            lowerMessage.includes(\"issue\") ||\n            lowerMessage.includes(\"problem\")\n        ) {\n            return <Badge variant=\"destructive\">Concern</Badge>;\n        }\n        return <Badge variant=\"default\">Suggestion</Badge>;\n    };\n\n    const submitFeedbackMutation = useMutation({\n        mutationFn: async (data: {\n            message: string;\n            recipientType: string;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/feedbacks`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Success\",\n                description: `Your feedback has been submitted to ${recipientType}`,\n            });\n            setFeedbackMessage(\"\");\n            setIsSubmitDialogOpen(false);\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/feedbacks\"],\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to submit feedback\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleSubmitFeedback = () => {\n        if (!feedbackMessage.trim()) {\n            toast({\n                title: \"Error\",\n                description: \"Please enter your feedback\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n        submitFeedbackMutation.mutate({\n            message: feedbackMessage,\n            recipientType,\n        });\n    };\n\n    const filteredFeedbackList = selectedType\n        ? teamFeedbackList.filter((f) => {\n              const lowerMessage = f.message.toLowerCase();\n              if (selectedType === \"positive\") {\n                  return (\n                      lowerMessage.includes(\"great\") ||\n                      lowerMessage.includes(\"excellent\") ||\n                      lowerMessage.includes(\"good job\") ||\n                      lowerMessage.includes(\"well done\")\n                  );\n              }\n              if (selectedType === \"concern\") {\n                  return (\n                      lowerMessage.includes(\"concern\") ||\n                      lowerMessage.includes(\"issue\") ||\n                      lowerMessage.includes(\"problem\")\n                  );\n              }\n              return (\n                  !lowerMessage.includes(\"great\") &&\n                  !lowerMessage.includes(\"excellent\") &&\n                  !lowerMessage.includes(\"good job\") &&\n                  !lowerMessage.includes(\"well done\") &&\n                  !lowerMessage.includes(\"concern\") &&\n                  !lowerMessage.includes(\"issue\") &&\n                  !lowerMessage.includes(\"problem\")\n              );\n          })\n        : teamFeedbackList;\n\n    if (loadingFeedbacks) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                    <div>\n                        <Skeleton className=\"h-10 w-48 mb-2\" />\n                        <Skeleton className=\"h-5 w-72\" />\n                    </div>\n                </div>\n                <div className=\"grid gap-4 md:grid-cols-3\">\n                    {[...Array(3)].map((_, i) => (\n                        <Skeleton key={i} className=\"h-24 w-full\" />\n                    ))}\n                </div>\n                <div className=\"space-y-4\">\n                    {[...Array(2)].map((_, i) => (\n                        <Skeleton key={i} className=\"h-40 w-full\" />\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\">Team Feedback</h1>\n                    <p className=\"text-muted-foreground\">\n                        Review feedback from your team members\n                    </p>\n                </div>\n                <Button\n                    onClick={() => setIsSubmitDialogOpen(true)}\n                    data-testid=\"button-provide-feedback\">\n                    <MessageSquare className=\"h-4 w-4 mr-2\" />\n                    Provide Feedback\n                </Button>\n            </div>\n\n            <div className=\"grid gap-4 md:grid-cols-3\">\n                <Card\n                    className=\"cursor-pointer hover-elevate\"\n                    onClick={() =>\n                        setSelectedType(\n                            selectedType === \"positive\" ? null : \"positive\"\n                        )\n                    }\n                    data-testid=\"card-filter-positive\">\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Positive\n                        </CardTitle>\n                        <ThumbsUp className=\"h-4 w-4 text-green-600\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-positive\">\n                            {feedbackStats.positive}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                            Team feedback\n                        </p>\n                    </CardContent>\n                </Card>\n                <Card\n                    className=\"cursor-pointer hover-elevate\"\n                    onClick={() =>\n                        setSelectedType(\n                            selectedType === \"suggestion\" ? null : \"suggestion\"\n                        )\n                    }\n                    data-testid=\"card-filter-suggestion\">\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Suggestions\n                        </CardTitle>\n                        <MessageSquare className=\"h-4 w-4 text-blue-600\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-suggestions\">\n                            {feedbackStats.suggestion}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                            Team feedback\n                        </p>\n                    </CardContent>\n                </Card>\n                <Card\n                    className=\"cursor-pointer hover-elevate\"\n                    onClick={() =>\n                        setSelectedType(\n                            selectedType === \"concern\" ? null : \"concern\"\n                        )\n                    }\n                    data-testid=\"card-filter-concern\">\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Concerns\n                        </CardTitle>\n                        <ThumbsDown className=\"h-4 w-4 text-red-600\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"stat-concerns\">\n                            {feedbackStats.concern}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                            Team feedback\n                        </p>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <div className=\"grid gap-4\">\n                {filteredFeedbackList.map((feedback) => (\n                    <Card\n                        key={feedback.id}\n                        data-testid={`card-feedback-${feedback.id}`}>\n                        <CardHeader>\n                            <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                                <div className=\"flex items-center gap-3\">\n                                    <Avatar>\n                                        <AvatarImage src=\"\" />\n                                        <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                                            {feedback.submitterName\n                                                ?.split(\" \")\n                                                .map((n) => n[0])\n                                                .join(\"\") || \"U\"}\n                                        </AvatarFallback>\n                                    </Avatar>\n                                    <div className=\"flex-1 min-w-0\">\n                                        <div className=\"flex flex-wrap items-center gap-2\">\n                                            {getTypeIcon(feedback.message)}\n                                            <CardTitle className=\"text-base\">\n                                                Feedback from{\" \"}\n                                                {feedback.submitterName ||\n                                                    \"Unknown User\"}\n                                            </CardTitle>\n                                            {feedback.submitterRole ===\n                                                \"company_admin\" && (\n                                                <Badge variant=\"secondary\">\n                                                    Admin\n                                                </Badge>\n                                            )}\n                                        </div>\n                                        <p className=\"text-sm text-muted-foreground\">\n                                            {new Date(\n                                                feedback.createdAt\n                                            ).toLocaleDateString()}\n                                        </p>\n                                    </div>\n                                </div>\n                                <div className=\"flex gap-2\">\n                                    {getTypeBadge(feedback.message)}\n                                </div>\n                            </div>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                            <p className=\"text-sm text-muted-foreground\">\n                                {feedback.message}\n                            </p>\n                            <div className=\"flex gap-2\">\n                                <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    data-testid={`button-respond-${feedback.id}`}>\n                                    Respond\n                                </Button>\n                                <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    data-testid={`button-archive-${feedback.id}`}>\n                                    Archive\n                                </Button>\n                            </div>\n                        </CardContent>\n                    </Card>\n                ))}\n            </div>\n\n            {filteredFeedbackList.length === 0 && (\n                <Card>\n                    <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                        <p\n                            className=\"text-muted-foreground\"\n                            data-testid=\"text-no-feedback\">\n                            {selectedType\n                                ? `No ${selectedType} feedback found`\n                                : \"No feedback received yet\"}\n                        </p>\n                    </CardContent>\n                </Card>\n            )}\n\n            <Dialog\n                open={isSubmitDialogOpen}\n                onOpenChange={setIsSubmitDialogOpen}>\n                <DialogContent data-testid=\"dialog-submit-feedback\">\n                    <DialogHeader>\n                        <DialogTitle>Submit Feedback</DialogTitle>\n                        <DialogDescription>\n                            Share your feedback with the admin or other team\n                            leaders\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"recipient\">Send to</Label>\n                            <Select\n                                value={recipientType}\n                                onValueChange={(value) =>\n                                    setRecipientType(\n                                        value as \"Admin\" | \"TeamLeader\"\n                                    )\n                                }>\n                                <SelectTrigger\n                                    id=\"recipient\"\n                                    data-testid=\"select-recipient\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"Admin\">Admin</SelectItem>\n                                    <SelectItem value=\"TeamLeader\">\n                                        Team Leader\n                                    </SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"message\">Message</Label>\n                            <Textarea\n                                id=\"message\"\n                                placeholder=\"Enter your feedback here...\"\n                                value={feedbackMessage}\n                                onChange={(e) =>\n                                    setFeedbackMessage(e.target.value)\n                                }\n                                rows={5}\n                                data-testid=\"textarea-feedback-message\"\n                            />\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => setIsSubmitDialogOpen(false)}\n                            data-testid=\"button-cancel-feedback\">\n                            Cancel\n                        </Button>\n                        <Button\n                            onClick={handleSubmitFeedback}\n                            disabled={submitFeedbackMutation.isPending}\n                            data-testid=\"button-submit-feedback\">\n                            {submitFeedbackMutation.isPending\n                                ? \"Submitting...\"\n                                : \"Submit\"}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":19444,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic, log } from \"./vite\";\nimport { WebSocketServer } from \"ws\";\nimport { storage } from \"./storage\";\nimport bcrypt from \"bcryptjs\";\nimport session from \"express-session\";\nimport connectPgSimple from \"connect-pg-simple\";\nimport { Pool } from \"pg\";\nimport passport from \"./passport\";\nimport dotenv from \"dotenv\";\nimport cron from \"node-cron\";\nimport path from \"path\";\nimport cors from \"cors\";\ndotenv.config();\nconst app = express();\n\nconst allowedOrigins = process.env.ALLOWED_ORIGINS\n    ? process.env.ALLOWED_ORIGINS.split(\",\").map((origin) => origin.trim())\n    : [\"http://localhost:5000\", \"http://localhost:3000\"];\n\napp.use(\n    cors({\n        /*************  ✨ Windsurf Command ⭐  *************/\n        /**\n * The origin function for CORS. This function is called by the cors middleware\n * for each incoming request. It checks if the origin of the request is allowed\n * and calls the callback function accordingly.\n *\n * @param {string} origin - The origin of the request.\n/*******  869e80a9-2771-471b-8aa8-98d3138bd5cf  *******/ origin: (\n            origin,\n            callback\n        ) => {\n            if (!origin || allowedOrigins.includes(origin)) {\n                callback(null, true);\n            } else {\n                log(`CORS blocked request from origin: ${origin}`);\n                callback(new Error(\"Not allowed by CORS\"), false);\n            }\n        },\n        credentials: true,\n        methods: [\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\", \"OPTIONS\"],\n        allowedHeaders: [\"Content-Type\", \"Authorization\", \"x-user-id\"],\n    })\n);\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\n// Disable caching for Replit's iframe proxy\napp.use((req, res, next) => {\n    res.set(\n        \"Cache-Control\",\n        \"no-store, no-cache, must-revalidate, proxy-revalidate\"\n    );\n    res.set(\"Pragma\", \"no-cache\");\n    res.set(\"Expires\", \"0\");\n    next();\n});\n\n// Serve public files (including service worker) from root public directory\nconst currentDir =\n    typeof __dirname !== \"undefined\" ? __dirname : import.meta.dirname;\napp.use(express.static(path.join(currentDir, \"..\", \"public\")));\n\nconst PgSession = connectPgSimple(session);\n\nconst isProduction = process.env.NODE_ENV === \"production\";\nconst isCrossOrigin = !!process.env.ALLOWED_ORIGINS;\n\nconst sessionConfig: session.SessionOptions = {\n    secret:\n        process.env.SESSION_SECRET ||\n        \"worklogix-secret-key-change-in-production\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n        secure: isProduction,\n        httpOnly: true,\n        maxAge: 24 * 60 * 60 * 1000,\n        sameSite: isCrossOrigin ? \"none\" : \"lax\",\n    },\n};\n\nif (process.env.DATABASE_URL) {\n    const pool = new Pool({\n        connectionString: process.env.DATABASE_URL,\n    });\n    sessionConfig.store = new PgSession({\n        pool,\n        tableName: \"user_sessions\",\n        createTableIfMissing: true,\n    });\n    log(\"Using PostgreSQL session storage\");\n} else {\n    log(\n        \"Warning: Using in-memory session storage (sessions will be lost on restart)\"\n    );\n}\n\napp.use(session(sessionConfig));\n\napp.use(passport.initialize());\napp.use(passport.session());\n\nexport let broadcast: (message: any) => void;\n\napp.use((req, res, next) => {\n    const start = Date.now();\n    const path = req.path;\n    let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n    const originalResJson = res.json;\n    res.json = function (bodyJson, ...args) {\n        capturedJsonResponse = bodyJson;\n        return originalResJson.apply(res, [bodyJson, ...args]);\n    };\n\n    res.on(\"finish\", () => {\n        const duration = Date.now() - start;\n        if (path.startsWith(\"/api\")) {\n            let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n            if (capturedJsonResponse) {\n                logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n            }\n\n            if (logLine.length > 80) {\n                logLine = logLine.slice(0, 79) + \"…\";\n            }\n\n            log(logLine);\n        }\n    });\n\n    next();\n});\n\nasync function initializeSuperAdmin() {\n    try {\n        const superAdminEmail = process.env.SUPER_ADMIN_EMAIL;\n        const superAdminPassword = process.env.SUPER_ADMIN_PASSWORD;\n\n        if (!superAdminEmail || !superAdminPassword) {\n            log(\n                \"⚠️  Super Admin not initialized: SUPER_ADMIN_EMAIL and SUPER_ADMIN_PASSWORD environment variables must be set\"\n            );\n            return;\n        }\n\n        const existingSuperAdmin = await storage.getUserByEmail(\n            superAdminEmail\n        );\n\n        if (!existingSuperAdmin) {\n            const hashedPassword = await bcrypt.hash(superAdminPassword, 10);\n            await storage.createUser({\n                email: superAdminEmail,\n                displayName: \"Super Admin\",\n                password: hashedPassword,\n                role: \"super_admin\",\n            });\n            log(\n                `✅ Super Admin created successfully with email: ${superAdminEmail}`\n            );\n        } else {\n            log(\"ℹ️  Super Admin already exists\");\n        }\n    } catch (error) {\n        console.error(\"Error initializing super admin:\", error);\n    }\n}\n\n(async () => {\n    const server = await registerRoutes(app);\n\n    await initializeSuperAdmin();\n\n    cron.schedule(\n        \"59 23 * * *\",\n        async () => {\n            try {\n                const today = new Date().toISOString().split(\"T\")[0];\n                const markedCount = await storage.markAbsentUsers(today);\n                log(\n                    `✅ Auto-marked ${markedCount} users as absent for ${today}`\n                );\n            } catch (error) {\n                console.error(\"Error in daily absent marking cron job:\", error);\n            }\n        },\n        {\n            timezone: \"Asia/Kolkata\",\n        }\n    );\n\n    log(\"📅 Daily absent marking cron job scheduled at 11:59 PM IST\");\n\n    const wss = new WebSocketServer({ noServer: true });\n\n    server.on(\"upgrade\", (request, socket, head) => {\n        const url = request.url || \"\";\n        log(`[WebSocket] Upgrade request received for: ${url}`);\n\n        // Use startsWith to handle query parameters that Render might add\n        if (url.startsWith(\"/ws\")) {\n            log(`[WebSocket] Upgrading connection for path: ${url}`);\n            wss.handleUpgrade(request, socket, head, (ws) => {\n                wss.emit(\"connection\", ws, request);\n            });\n        } else {\n            log(`[WebSocket] Rejected upgrade for path: ${url}`);\n            socket.destroy();\n        }\n    });\n\n    // Ping interval to keep connections alive (Render has 60s timeout)\n    const pingInterval = setInterval(() => {\n        wss.clients.forEach((ws) => {\n            if (ws.readyState === 1) {\n                ws.ping();\n            }\n        });\n    }, 30000); // Ping every 30 seconds\n\n    wss.on(\"close\", () => {\n        clearInterval(pingInterval);\n    });\n\n    wss.on(\"connection\", (ws) => {\n        log(`[WebSocket] Client connected. Total clients: ${wss.clients.size}`);\n\n        ws.on(\"error\", (error) => {\n            console.error(\"[WebSocket] Client error:\", error);\n        });\n\n        ws.on(\"pong\", () => {\n            // Client responded to ping - connection is alive\n        });\n\n        ws.on(\"close\", () => {\n            log(\n                `[WebSocket] Client disconnected. Total clients: ${wss.clients.size}`\n            );\n        });\n    });\n\n    broadcast = (message: any) => {\n        console.log(\n            `[WebSocket] Broadcasting to ${wss.clients.size} clients:`,\n            message.type\n        );\n        wss.clients.forEach((client) => {\n            if (client.readyState === 1) {\n                client.send(JSON.stringify(message));\n            }\n        });\n    };\n\n    app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n        const status = err.status || err.statusCode || 500;\n        const message = err.message || \"Internal Server Error\";\n\n        res.status(status).json({ message });\n        throw err;\n    });\n\n    // In production, serve static files\n    if (process.env.NODE_ENV === \"production\") {\n        serveStatic(app);\n    }\n\n    // In development: server runs on port 3000, client (Vite) on port 5000 proxies here\n    // In production: server runs on port 5000 and serves static files\n    const port =\n        process.env.NODE_ENV === \"production\"\n            ? parseInt(process.env.PORT || \"5000\", 10)\n            : 3000;\n    server.listen(\n        {\n            port,\n            host: \"0.0.0.0\",\n        },\n        () => {\n            log(`serving on port ${port}`);\n        }\n    );\n})();\n","path":null,"size_bytes":8837,"size_tokens":null},"client/src/components/AdminLayout.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { \n  LayoutDashboard, \n  Users, \n  FileText, \n  CheckSquare, \n  MessageSquare, \n  Star,\n  MessageCircle,\n  LogOut,\n  Menu,\n  Building2,\n  BarChart3,\n  DollarSign,\n  Activity,\n  Receipt,\n  Calendar,\n  Clock,\n  TrendingUp,\n  Settings,\n  FileEdit,\n  Briefcase\n} from \"lucide-react\";\nimport ThemeToggle from \"./ThemeToggle\";\nimport BottomNav, { BottomNavItem } from \"./BottomNav\";\nimport CompanyDetailsSetupDialog from \"./CompanyDetailsSetupDialog\";\nimport { useState, useEffect } from \"react\";\n\ninterface NavItem {\n  path: string;\n  label: string;\n  icon: any;\n}\n\nconst navItems: NavItem[] = [\n  { path: \"/admin/dashboard\", label: \"Dashboard\", icon: LayoutDashboard },\n  { path: \"/admin/company-profile\", label: \"Company Profile\", icon: Building2 },\n  { path: \"/admin/company\", label: \"Company Settings\", icon: BarChart3 },\n  { path: \"/admin/payment-history\", label: \"Payment History\", icon: Receipt },\n  { path: \"/admin/crm\", label: \"CRM\", icon: Briefcase },\n  { path: \"/admin/users\", label: \"Users\", icon: Users },\n  { path: \"/admin/reports\", label: \"Reports\", icon: FileText },\n  { path: \"/admin/tasks\", label: \"Tasks\", icon: CheckSquare },\n  { path: \"/admin/messages\", label: \"Messages\", icon: MessageSquare },\n  { path: \"/admin/ratings\", label: \"Ratings\", icon: Star },\n  { path: \"/admin/feedback\", label: \"Feedback\", icon: MessageCircle },\n  { path: \"/admin/leaves\", label: \"Leave Approval\", icon: Calendar },\n  { path: \"/admin/corrections\", label: \"Correction Requests\", icon: FileEdit },\n  { path: \"/admin/attendance\", label: \"Attendance Monitor\", icon: Clock },\n  { path: \"/admin/attendance-reports\", label: \"Attendance Reports\", icon: TrendingUp },\n  { path: \"/admin/attendance-policy\", label: \"Attendance Policy\", icon: Settings },\n  { path: \"/admin/holidays\", label: \"Holiday Management\", icon: Calendar },\n];\n\nconst superAdminNavItems: NavItem[] = [\n  { path: \"/super-admin/dashboard\", label: \"Companies\", icon: Building2 },\n  { path: \"/super-admin/payments\", label: \"Payments\", icon: DollarSign },\n  { path: \"/super-admin/activity\", label: \"Activity Logs\", icon: Activity },\n];\n\nconst bottomNavItems: BottomNavItem[] = [\n  { path: \"/admin/dashboard\", label: \"Home\", icon: LayoutDashboard },\n  { path: \"/admin/users\", label: \"Users\", icon: Users },\n  { path: \"/admin/tasks\", label: \"Tasks\", icon: CheckSquare },\n  { path: \"/admin/messages\", label: \"Messages\", icon: MessageSquare },\n];\n\nconst superAdminBottomNavItems: BottomNavItem[] = [\n  { path: \"/super-admin/dashboard\", label: \"Companies\", icon: Building2 },\n  { path: \"/super-admin/payments\", label: \"Payments\", icon: DollarSign },\n  { path: \"/super-admin/activity\", label: \"Activity\", icon: Activity },\n];\n\nexport default function AdminLayout({ children }: { children: React.ReactNode }) {\n  const [location] = useLocation();\n  const { user, userRole, signOut, loggingOut, companyId, setUser } = useAuth();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [showProfileSetup, setShowProfileSetup] = useState(false);\n  \n  const isSuperAdmin = userRole === 'super_admin';\n  const isCompanyAdmin = userRole === 'company_admin';\n  \n  const filteredNavItems = isSuperAdmin ? superAdminNavItems : navItems;\n  const filteredBottomNavItems = isSuperAdmin ? superAdminBottomNavItems : bottomNavItems;\n\n  useEffect(() => {\n    if (isCompanyAdmin && user && companyId) {\n      const profileCompleteKey = `companyProfileComplete_${companyId}`;\n      const profileDismissedKey = `companySetupDismissed_${companyId}`;\n      const isProfileComplete = localStorage.getItem(profileCompleteKey) === 'true';\n      const isSetupDismissed = localStorage.getItem(profileDismissedKey) === 'true';\n      \n      if (!isProfileComplete && !isSetupDismissed && !(user as any).companyProfileComplete) {\n        setShowProfileSetup(true);\n      }\n    }\n  }, [isCompanyAdmin, user, companyId]);\n\n  const handleProfileSetupComplete = () => {\n    setShowProfileSetup(false);\n    if (user && companyId) {\n      const updatedUser = { ...user, companyProfileComplete: true };\n      setUser(updatedUser as any);\n      \n      const profileCompleteKey = `companyProfileComplete_${companyId}`;\n      localStorage.setItem(profileCompleteKey, 'true');\n      \n      localStorage.setItem('user', JSON.stringify(updatedUser));\n    }\n  };\n\n  const handleLogout = async () => {\n    await signOut();\n    window.location.href = \"/worklogix/\";\n  };\n\n  const SidebarContent = () => (\n    <div className=\"flex flex-col h-full\">\n      {/* Admin Info */}\n      <div className=\"p-6 border-b\">\n        <div className=\"flex items-center gap-3\">\n          <Avatar>\n            <AvatarImage src={user?.photoURL || \"\"} />\n            <AvatarFallback className=\"bg-primary text-primary-foreground\">\n              {user?.displayName?.[0] || \"A\"}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-semibold text-sm truncate\">{user?.displayName}</h3>\n            <p className=\"text-xs text-muted-foreground truncate\">{user?.email}</p>\n            <p className=\"text-xs font-medium text-primary\">Admin</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <nav className=\"flex-1 p-4 overflow-y-auto\">\n        <ul className=\"space-y-1\">\n          {filteredNavItems.map((item) => {\n            const isActive = location === item.path;\n            const Icon = item.icon;\n            \n            return (\n              <li key={item.path}>\n                <Link \n                  href={item.path}\n                  onClick={() => setMobileMenuOpen(false)}\n                  className={`flex items-center gap-3 px-3 py-2 rounded-md transition-colors ${\n                    isActive\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"hover:bg-accent hover:text-accent-foreground\"\n                  }`}\n                  data-testid={`nav-link-${item.label.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  <Icon className=\"h-5 w-5\" />\n                  <span className=\"text-sm font-medium\">{item.label}</span>\n                </Link>\n              </li>\n            );\n          })}\n        </ul>\n      </nav>\n\n      {/* Footer Actions */}\n      <div className=\"p-4 border-t space-y-2\">\n        <ThemeToggle />\n        <Button\n          variant=\"outline\"\n          className=\"w-full justify-start\"\n          onClick={handleLogout}\n          disabled={loggingOut}\n          data-testid=\"button-logout\"\n        >\n          <LogOut className=\"h-4 w-4 mr-2\" />\n          {loggingOut ? \"Logging out...\" : \"Logout\"}\n        </Button>\n      </div>\n    </div>\n  );\n\n  return (\n    <>\n      <div className=\"flex h-screen bg-background\">\n        {/* Desktop Sidebar */}\n        <aside className=\"hidden md:flex md:w-64 border-r bg-card flex-col\">\n          <SidebarContent />\n        </aside>\n\n        {/* Main Content */}\n        <main className=\"flex-1 flex flex-col overflow-hidden\">\n          {/* Mobile Header */}\n          <div className=\"md:hidden flex items-center justify-between p-4 border-b bg-card\">\n            <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>\n              <SheetTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-mobile-menu\">\n                  <Menu className=\"h-6 w-6\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"left\" className=\"w-64 p-0\">\n                <SidebarContent />\n              </SheetContent>\n            </Sheet>\n            <h1 className=\"font-semibold text-lg\">WorkLogix Admin</h1>\n            <div className=\"w-10\" /> {/* Spacer for balance */}\n          </div>\n\n          {/* Content Area */}\n          <div className=\"flex-1 overflow-y-auto\">\n            <div className=\"container max-w-7xl mx-auto p-3 sm:p-4 md:p-6 lg:p-8 pb-20 md:pb-6\">\n              {children}\n            </div>\n          </div>\n\n          {/* Bottom Navigation for Mobile */}\n          <BottomNav items={filteredBottomNavItems} />\n        </main>\n      </div>\n\n      {/* Company Profile Setup Dialog */}\n      {showProfileSetup && companyId && user && (\n        <CompanyDetailsSetupDialog\n          open={showProfileSetup}\n          companyId={companyId}\n          companyName={user.displayName || \"\"}\n          onComplete={handleProfileSetupComplete}\n          onClose={() => {\n            setShowProfileSetup(false);\n            const profileDismissedKey = `companySetupDismissed_${companyId}`;\n            localStorage.setItem(profileDismissedKey, 'true');\n          }}\n        />\n      )}\n    </>\n  );\n}\n","path":null,"size_bytes":8909,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/pages/admin/PaymentHistory.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from \"@/components/ui/table\";\nimport { Download, Receipt, Mail, CreditCard } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { CompanyPayment } from \"@shared/schema\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function PaymentHistory() {\n    const { dbUserId } = useAuth();\n\n    const { data: payments = [], isLoading } = useQuery<CompanyPayment[]>({\n        queryKey: [\"/api/my-company-payments\"],\n        enabled: !!dbUserId,\n    });\n\n    const getStatusBadge = (status: string) => {\n        const variants = {\n            paid: \"default\" as const,\n            pending: \"secondary\" as const,\n            failed: \"destructive\" as const,\n            cancelled: \"outline\" as const,\n        };\n        return (\n            <Badge\n                variant={variants[status as keyof typeof variants] || \"outline\"}\n                data-testid={`badge-status-${status}`}>\n                {status}\n            </Badge>\n        );\n    };\n\n    const handleDownloadReceipt = (payment: CompanyPayment) => {\n        const receiptContent = `\nWORKLOGIX - PAYMENT RECEIPT\n===============================\n\nReceipt Number: ${payment.receiptNumber}\nTransaction ID: ${payment.transactionId}\nDate: ${format(new Date(payment.createdAt), \"PPP 'at' p\")}\n\nCompany Details:\nCompany ID: ${payment.companyId}\n\nPayment Details:\nSlot Type: ${payment.slotType === \"admin\" ? \"Admin Slots\" : \"Member Slots\"}\nQuantity: ${payment.slotQuantity}\nAmount: ${\n            payment.currency === \"INR\" ? \"₹\" : \"$\"\n        }${payment.amount.toLocaleString()}\nPayment Method: ${payment.paymentMethod || \"Stripe\"}\nStatus: ${payment.paymentStatus}\n\n===============================\nThank you for your purchase!\n\nFor support, contact: support@worklogix.com\n`;\n\n        const blob = new Blob([receiptContent], { type: \"text/plain\" });\n        const url = window.URL.createObjectURL(blob);\n        const link = document.createElement(\"a\");\n        link.href = url;\n        link.download = `Receipt-${payment.receiptNumber}.txt`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        window.URL.revokeObjectURL(url);\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n            </div>\n        );\n    }\n\n    const totalSpent = payments\n        .filter((p) => p.paymentStatus === \"paid\")\n        .reduce((sum, p) => sum + p.amount, 0);\n\n    const successfulPayments = payments.filter(\n        (p) => p.paymentStatus === \"paid\"\n    ).length;\n\n    return (\n        <div className=\"space-y-6\" data-testid=\"page-payment-history\">\n            <div>\n                <h1\n                    className=\"text-3xl font-bold mb-2\"\n                    data-testid=\"heading-payment-history\">\n                    Payment History\n                </h1>\n                <p\n                    className=\"text-muted-foreground\"\n                    data-testid=\"text-description\">\n                    View all your payment transactions and download receipts\n                </p>\n            </div>\n\n            <div className=\"grid gap-4 md:grid-cols-3\">\n                <Card data-testid=\"card-total-spent\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Total Spent\n                        </CardTitle>\n                        <CreditCard className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-total-spent\">\n                            ₹{totalSpent.toLocaleString()}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            All time spending\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-successful-payments\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Successful Payments\n                        </CardTitle>\n                        <Receipt className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-successful-count\">\n                            {successfulPayments}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            Completed transactions\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-total-transactions\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Total Transactions\n                        </CardTitle>\n                        <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-total-transactions\">\n                            {payments.length}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            All payment attempts\n                        </p>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <Card data-testid=\"card-payment-table\">\n                <CardHeader>\n                    <CardTitle data-testid=\"heading-transaction-history\">\n                        Transaction History\n                    </CardTitle>\n                    <CardDescription data-testid=\"text-transaction-description\">\n                        Complete list of all your payment transactions\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    {payments.length === 0 ? (\n                        <div\n                            className=\"text-center py-12\"\n                            data-testid=\"text-no-payments\">\n                            <Receipt className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n                            <h3 className=\"text-lg font-semibold mb-2\">\n                                No Payments Yet\n                            </h3>\n                            <p className=\"text-muted-foreground\">\n                                Your payment history will appear here once you\n                                make a purchase\n                            </p>\n                        </div>\n                    ) : (\n                        <div className=\"overflow-x-auto\">\n                            <Table>\n                                <TableHeader>\n                                    <TableRow>\n                                        <TableHead data-testid=\"header-date\">\n                                            Date\n                                        </TableHead>\n                                        <TableHead data-testid=\"header-receipt\">\n                                            Receipt Number\n                                        </TableHead>\n                                        <TableHead data-testid=\"header-description\">\n                                            Description\n                                        </TableHead>\n                                        <TableHead data-testid=\"header-amount\">\n                                            Amount\n                                        </TableHead>\n                                        <TableHead data-testid=\"header-status\">\n                                            Status\n                                        </TableHead>\n                                        <TableHead data-testid=\"header-email\">\n                                            Email\n                                        </TableHead>\n                                        <TableHead data-testid=\"header-actions\">\n                                            Actions\n                                        </TableHead>\n                                    </TableRow>\n                                </TableHeader>\n                                <TableBody>\n                                    {payments.map((payment) => (\n                                        <TableRow\n                                            key={payment.id}\n                                            data-testid={`row-payment-${payment.id}`}>\n                                            <TableCell\n                                                data-testid={`cell-date-${payment.id}`}>\n                                                {format(\n                                                    new Date(payment.createdAt),\n                                                    \"MMM dd, yyyy\"\n                                                )}\n                                                <div className=\"text-xs text-muted-foreground\">\n                                                    {format(\n                                                        new Date(\n                                                            payment.createdAt\n                                                        ),\n                                                        \"hh:mm a\"\n                                                    )}\n                                                </div>\n                                            </TableCell>\n                                            <TableCell\n                                                data-testid={`cell-receipt-${payment.id}`}>\n                                                <div className=\"font-mono text-sm\">\n                                                    {payment.receiptNumber ||\n                                                        \"—\"}\n                                                </div>\n                                            </TableCell>\n                                            <TableCell\n                                                data-testid={`cell-description-${payment.id}`}>\n                                                <div className=\"font-medium\">\n                                                    {payment.slotType ===\n                                                    \"admin\"\n                                                        ? \"Admin Slots\"\n                                                        : \"Member Slots\"}\n                                                </div>\n                                                <div className=\"text-xs text-muted-foreground\">\n                                                    Quantity:{\" \"}\n                                                    {payment.slotQuantity}\n                                                </div>\n                                            </TableCell>\n                                            <TableCell\n                                                data-testid={`cell-amount-${payment.id}`}>\n                                                <div className=\"font-semibold\">\n                                                    ₹\n                                                    {payment.amount.toLocaleString()}\n                                                </div>\n                                            </TableCell>\n                                            <TableCell\n                                                data-testid={`cell-status-${payment.id}`}>\n                                                {getStatusBadge(\n                                                    payment.paymentStatus\n                                                )}\n                                            </TableCell>\n                                            <TableCell\n                                                data-testid={`cell-email-${payment.id}`}>\n                                                {payment.emailSent ? (\n                                                    <Badge\n                                                        variant=\"outline\"\n                                                        className=\"bg-green-50 text-green-700 border-green-200\"\n                                                        data-testid={`badge-email-sent-${payment.id}`}>\n                                                        <Mail className=\"w-3 h-3 mr-1\" />\n                                                        Sent\n                                                    </Badge>\n                                                ) : (\n                                                    <Badge\n                                                        variant=\"outline\"\n                                                        className=\"bg-gray-50 text-gray-600\"\n                                                        data-testid={`badge-email-not-sent-${payment.id}`}>\n                                                        Not Sent\n                                                    </Badge>\n                                                )}\n                                            </TableCell>\n                                            <TableCell\n                                                data-testid={`cell-actions-${payment.id}`}>\n                                                {payment.paymentStatus ===\n                                                    \"paid\" &&\n                                                    payment.receiptNumber && (\n                                                        <Button\n                                                            variant=\"ghost\"\n                                                            size=\"sm\"\n                                                            onClick={() =>\n                                                                handleDownloadReceipt(\n                                                                    payment\n                                                                )\n                                                            }\n                                                            data-testid={`button-download-receipt-${payment.id}`}>\n                                                            <Download className=\"w-4 h-4 mr-1\" />\n                                                            Receipt\n                                                        </Button>\n                                                    )}\n                                            </TableCell>\n                                        </TableRow>\n                                    ))}\n                                </TableBody>\n                            </Table>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":15877,"size_tokens":null},"client/src/pages/admin/AdminTasks.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuTrigger,\n    DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    Plus,\n    ListTodo,\n    UserCheck,\n    MoreVertical,\n    Edit,\n    Trash2,\n    Undo2,\n    Eye,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { format } from \"date-fns\";\nimport TaskDetailsModal from \"@/components/TaskDetailsModal\";\nimport type { Task, User } from \"@shared/schema\";\n\nexport default function AdminTasks() {\n    const { toast } = useToast();\n    const { dbUserId } = useAuth();\n    const [taskDialogOpen, setTaskDialogOpen] = useState(false);\n    const [editingTask, setEditingTask] = useState<Task | null>(null);\n    const [taskForm, setTaskForm] = useState({\n        title: \"\",\n        description: \"\",\n        assignedTo: \"\",\n        priority: \"medium\",\n        deadline: \"\",\n    });\n    const [taskDetailsOpen, setTaskDetailsOpen] = useState(false);\n    const [selectedTaskForDetails, setSelectedTaskForDetails] =\n        useState<Task | null>(null);\n    const [taskDetailsData, setTaskDetailsData] = useState<any>(null);\n\n    const handleViewTaskDetails = async (task: Task) => {\n        setSelectedTaskForDetails(task);\n        try {\n            const response = await apiRequest(\n                `${API_BASE_URL}/api/tasks/${task.id}/details`,\n                \"GET\"\n            );\n            setTaskDetailsData(response);\n            setTaskDetailsOpen(true);\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Failed to load task details\",\n                variant: \"destructive\",\n            });\n        }\n    };\n\n    const safeConvertToISO = (\n        dateValue: string | null | undefined\n    ): string | null => {\n        if (!dateValue) return null;\n        try {\n            const date = new Date(dateValue);\n            if (isNaN(date.getTime())) return null;\n            return date.toISOString();\n        } catch {\n            return null;\n        }\n    };\n\n    const { data: users = [] } = useQuery<User[]>({\n        queryKey: [\"/api/users\"],\n    });\n\n    const { data: allTasks = [], isLoading: tasksLoading } = useQuery<Task[]>({\n        queryKey: [\"/api/tasks\"],\n    });\n\n    const { data: myTasks = [], isLoading: myTasksLoading } = useQuery<Task[]>({\n        queryKey: [`/api/tasks?assignedBy=${dbUserId}`],\n        enabled: !!dbUserId,\n    });\n\n    const createTaskMutation = useMutation({\n        mutationFn: async (taskData: typeof taskForm) => {\n            const payload = {\n                assignedBy: dbUserId,\n                assignedTo: parseInt(taskData.assignedTo),\n                title: taskData.title,\n                description: taskData.description || null,\n                priority: taskData.priority,\n                deadline: safeConvertToISO(taskData.deadline),\n                status: \"pending\",\n            };\n            return await apiRequest(\n                `${API_BASE_URL}/api/tasks`,\n                \"POST\",\n                payload\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Task created successfully\",\n                description: \"The task has been assigned to the user.\",\n            });\n            setTaskDialogOpen(false);\n            setTaskForm({\n                title: \"\",\n                description: \"\",\n                assignedTo: \"\",\n                priority: \"medium\",\n                deadline: \"\",\n            });\n            queryClient.invalidateQueries({ queryKey: [\"/api/tasks\"] });\n            queryClient.invalidateQueries({\n                queryKey: [`/api/tasks?assignedBy=${dbUserId}`],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/dashboard/stats\"],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to create task\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const updateTaskMutation = useMutation({\n        mutationFn: async ({\n            taskId,\n            taskData,\n        }: {\n            taskId: number;\n            taskData: typeof taskForm;\n        }) => {\n            const payload = {\n                assignedTo: parseInt(taskData.assignedTo),\n                title: taskData.title,\n                description: taskData.description || null,\n                priority: taskData.priority,\n                deadline: safeConvertToISO(taskData.deadline),\n            };\n            return await apiRequest(\n                `${API_BASE_URL}/api/tasks/${taskId}`,\n                \"PATCH\",\n                payload\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Task updated successfully\",\n            });\n            setTaskDialogOpen(false);\n            setEditingTask(null);\n            setTaskForm({\n                title: \"\",\n                description: \"\",\n                assignedTo: \"\",\n                priority: \"medium\",\n                deadline: \"\",\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/tasks\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [`/api/tasks?assignedBy=${dbUserId}`],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to update task\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const deleteTaskMutation = useMutation({\n        mutationFn: async (taskId: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/tasks/${taskId}`,\n                \"DELETE\"\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Task deleted successfully\",\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/tasks\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [`/api/tasks?assignedBy=${dbUserId}`],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to delete task\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const returnTaskMutation = useMutation({\n        mutationFn: async (taskId: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/tasks/${taskId}`,\n                \"PATCH\",\n                { status: \"pending\" }\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Task returned to pending\",\n            });\n            queryClient.invalidateQueries({\n                queryKey: [`${API_BASE_URL}/api/tasks`],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [`/api/tasks?assignedBy=${dbUserId}`],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to return task\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const getUserNameById = (userId: number) => {\n        const user = users.find((u) => u.id === userId);\n        return user?.displayName || \"Unknown User\";\n    };\n\n    const handleCreateTask = () => {\n        if (!taskForm.title || !taskForm.assignedTo) {\n            toast({\n                title: \"Missing required fields\",\n                description: \"Please fill in task title and assign to a user.\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n        if (editingTask) {\n            updateTaskMutation.mutate({\n                taskId: editingTask.id,\n                taskData: taskForm,\n            });\n        } else {\n            createTaskMutation.mutate(taskForm);\n        }\n    };\n\n    const handleEditTask = (task: Task) => {\n        setEditingTask(task);\n        setTaskForm({\n            title: task.title,\n            description: task.description || \"\",\n            assignedTo: task.assignedTo.toString(),\n            priority: task.priority,\n            deadline: task.deadline\n                ? new Date(task.deadline).toISOString().slice(0, 16)\n                : \"\",\n        });\n        setTaskDialogOpen(true);\n    };\n\n    const handleCloseDialog = () => {\n        setTaskDialogOpen(false);\n        setEditingTask(null);\n        setTaskForm({\n            title: \"\",\n            description: \"\",\n            assignedTo: \"\",\n            priority: \"medium\",\n            deadline: \"\",\n        });\n    };\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h2 className=\"text-2xl sm:text-3xl font-bold\">\n                        Task Management\n                    </h2>\n                    <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                        Assign and track tasks\n                    </p>\n                </div>\n                <Button\n                    className=\"gap-2\"\n                    onClick={() => {\n                        setEditingTask(null);\n                        setTaskForm({\n                            title: \"\",\n                            description: \"\",\n                            assignedTo: \"\",\n                            priority: \"medium\",\n                            deadline: \"\",\n                        });\n                        setTaskDialogOpen(true);\n                    }}\n                    data-testid=\"button-open-task-dialog\">\n                    <Plus className=\"h-4 w-4\" />\n                    <span className=\"hidden sm:inline\">Create Task</span>\n                </Button>\n            </div>\n\n            <Dialog\n                open={taskDialogOpen}\n                onOpenChange={(open) => {\n                    if (!open) {\n                        handleCloseDialog();\n                    }\n                }}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>\n                            {editingTask ? \"Edit Task\" : \"Create New Task\"}\n                        </DialogTitle>\n                        <DialogDescription>\n                            {editingTask\n                                ? \"Update task details\"\n                                : \"Assign a new task to one or more users\"}\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"task-title\">Task Title *</Label>\n                            <Input\n                                id=\"task-title\"\n                                placeholder=\"Enter task title\"\n                                value={taskForm.title}\n                                onChange={(e) =>\n                                    setTaskForm({\n                                        ...taskForm,\n                                        title: e.target.value,\n                                    })\n                                }\n                                data-testid=\"input-task-title\"\n                            />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"task-description\">\n                                Description\n                            </Label>\n                            <Textarea\n                                id=\"task-description\"\n                                placeholder=\"Enter task description\"\n                                value={taskForm.description}\n                                onChange={(e) =>\n                                    setTaskForm({\n                                        ...taskForm,\n                                        description: e.target.value,\n                                    })\n                                }\n                                data-testid=\"input-task-description\"\n                            />\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"assign-to\">\n                                    Assign To Member *\n                                </Label>\n                                <Select\n                                    value={taskForm.assignedTo}\n                                    onValueChange={(value) =>\n                                        setTaskForm({\n                                            ...taskForm,\n                                            assignedTo: value,\n                                        })\n                                    }>\n                                    <SelectTrigger data-testid=\"select-assign-to\">\n                                        <SelectValue placeholder=\"Select member\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {users\n                                            .filter(\n                                                (u) =>\n                                                    u.role === \"team_leader\" ||\n                                                    u.role === \"company_member\"\n                                            )\n                                            .map((user) => (\n                                                <SelectItem\n                                                    key={user.id}\n                                                    value={user.id.toString()}>\n                                                    {user.displayName} (\n                                                    {user.role === \"team_leader\"\n                                                        ? \"Team Leader\"\n                                                        : \"Member\"}\n                                                    )\n                                                </SelectItem>\n                                            ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"priority\">Priority</Label>\n                                <Select\n                                    value={taskForm.priority}\n                                    onValueChange={(value) =>\n                                        setTaskForm({\n                                            ...taskForm,\n                                            priority: value,\n                                        })\n                                    }>\n                                    <SelectTrigger data-testid=\"select-priority\">\n                                        <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        <SelectItem value=\"low\">Low</SelectItem>\n                                        <SelectItem value=\"medium\">\n                                            Medium\n                                        </SelectItem>\n                                        <SelectItem value=\"high\">\n                                            High\n                                        </SelectItem>\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"deadline\">Deadline</Label>\n                            <Input\n                                id=\"deadline\"\n                                type=\"datetime-local\"\n                                value={taskForm.deadline}\n                                onChange={(e) =>\n                                    setTaskForm({\n                                        ...taskForm,\n                                        deadline: e.target.value,\n                                    })\n                                }\n                                data-testid=\"input-deadline\"\n                            />\n                        </div>\n                        <Button\n                            onClick={handleCreateTask}\n                            className=\"w-full\"\n                            data-testid=\"button-create-task\"\n                            disabled={\n                                createTaskMutation.isPending ||\n                                updateTaskMutation.isPending\n                            }>\n                            {createTaskMutation.isPending ||\n                            updateTaskMutation.isPending\n                                ? editingTask\n                                    ? \"Updating...\"\n                                    : \"Creating...\"\n                                : editingTask\n                                ? \"Update Task\"\n                                : \"Create Task\"}\n                        </Button>\n                    </div>\n                </DialogContent>\n            </Dialog>\n\n            {/* Task Details Modal */}\n            {selectedTaskForDetails && (\n                <TaskDetailsModal\n                    open={taskDetailsOpen}\n                    onOpenChange={setTaskDetailsOpen}\n                    task={selectedTaskForDetails}\n                    timeLogs={taskDetailsData?.timeLogs}\n                    returnCount={taskDetailsData?.returnCount || 0}\n                    reworkHistory={taskDetailsData?.reworkHistory}\n                />\n            )}\n\n            <Tabs defaultValue=\"all\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n                    <TabsTrigger\n                        value=\"all\"\n                        className=\"flex items-center gap-2\">\n                        <ListTodo className=\"h-4 w-4\" />\n                        All Tasks ({allTasks.length})\n                    </TabsTrigger>\n                    <TabsTrigger\n                        value=\"mine\"\n                        className=\"flex items-center gap-2\">\n                        <UserCheck className=\"h-4 w-4\" />\n                        My Created Tasks ({myTasks.length})\n                    </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"all\">\n                    <Card>\n                        <CardHeader>\n                            <CardTitle className=\"text-lg sm:text-xl\">\n                                All Tasks ({allTasks.length})\n                            </CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                            {tasksLoading ? (\n                                <div className=\"flex items-center justify-center py-8\">\n                                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                                </div>\n                            ) : allTasks.length > 0 ? (\n                                <div className=\"overflow-x-auto -mx-3 sm:mx-0\">\n                                    <div className=\"min-w-full inline-block align-middle\">\n                                        <table className=\"w-full\">\n                                            <thead>\n                                                <tr className=\"border-b\">\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Task\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Assigned To\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Priority\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Status\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Deadline\n                                                    </th>\n                                                    <th className=\"text-right py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Actions\n                                                    </th>\n                                                </tr>\n                                            </thead>\n                                            <tbody>\n                                                {allTasks.map(\n                                                    (\n                                                        task: any,\n                                                        index: number\n                                                    ) => (\n                                                        <tr\n                                                            key={task.id}\n                                                            className={`border-b ${\n                                                                index % 2 === 0\n                                                                    ? \"bg-card\"\n                                                                    : \"bg-muted/20\"\n                                                            } hover-elevate`}\n                                                            data-testid={`row-task-${task.id}`}>\n                                                            <td className=\"py-3 px-4\">\n                                                                <div className=\"font-medium text-xs sm:text-sm\">\n                                                                    {task.title}\n                                                                </div>\n                                                                <div className=\"text-xs text-muted-foreground line-clamp-1\">\n                                                                    {task.description ||\n                                                                        \"—\"}\n                                                                </div>\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-xs sm:text-sm\">\n                                                                {getUserNameById(\n                                                                    task.assignedTo\n                                                                )}\n                                                            </td>\n                                                            <td className=\"py-3 px-4\">\n                                                                <Badge\n                                                                    variant={\n                                                                        task.priority ===\n                                                                        \"high\"\n                                                                            ? \"destructive\"\n                                                                            : task.priority ===\n                                                                              \"medium\"\n                                                                            ? \"default\"\n                                                                            : \"secondary\"\n                                                                    }\n                                                                    className=\"text-xs\">\n                                                                    {\n                                                                        task.priority\n                                                                    }\n                                                                </Badge>\n                                                            </td>\n                                                            <td className=\"py-3 px-4\">\n                                                                <Badge\n                                                                    variant={\n                                                                        task.status ===\n                                                                        \"completed\"\n                                                                            ? \"default\"\n                                                                            : \"outline\"\n                                                                    }\n                                                                    className=\"text-xs\">\n                                                                    {\n                                                                        task.status\n                                                                    }\n                                                                </Badge>\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-xs font-mono\">\n                                                                {task.deadline\n                                                                    ? format(\n                                                                          new Date(\n                                                                              task.deadline\n                                                                          ),\n                                                                          \"MMM dd, yyyy\"\n                                                                      )\n                                                                    : \"—\"}\n                                                            </td>\n                                                            <td className=\"py-3 px-4\">\n                                                                {task.assignedBy ===\n                                                                    dbUserId && (\n                                                                    <div className=\"flex justify-end\">\n                                                                        <DropdownMenu>\n                                                                            <DropdownMenuTrigger\n                                                                                asChild>\n                                                                                <Button\n                                                                                    variant=\"ghost\"\n                                                                                    size=\"icon\"\n                                                                                    className=\"h-8 w-8\"\n                                                                                    data-testid={`button-task-actions-${task.id}`}>\n                                                                                    <MoreVertical className=\"h-4 w-4\" />\n                                                                                </Button>\n                                                                            </DropdownMenuTrigger>\n                                                                            <DropdownMenuContent align=\"end\">\n                                                                                <DropdownMenuItem\n                                                                                    onClick={() =>\n                                                                                        handleViewTaskDetails(\n                                                                                            task\n                                                                                        )\n                                                                                    }\n                                                                                    data-testid={`menu-view-details-${task.id}`}>\n                                                                                    <Eye className=\"h-4 w-4 mr-2\" />\n                                                                                    View\n                                                                                    Details\n                                                                                </DropdownMenuItem>\n                                                                                <DropdownMenuItem\n                                                                                    onClick={() =>\n                                                                                        handleEditTask(\n                                                                                            task\n                                                                                        )\n                                                                                    }\n                                                                                    data-testid={`menu-edit-task-${task.id}`}>\n                                                                                    <Edit className=\"h-4 w-4 mr-2\" />\n                                                                                    Edit\n                                                                                </DropdownMenuItem>\n                                                                                {(task.status ===\n                                                                                    \"completed\" ||\n                                                                                    task.status ===\n                                                                                        \"in_progress\") && (\n                                                                                    <DropdownMenuItem\n                                                                                        onClick={() =>\n                                                                                            returnTaskMutation.mutate(\n                                                                                                task.id\n                                                                                            )\n                                                                                        }\n                                                                                        data-testid={`menu-return-task-${task.id}`}>\n                                                                                        <Undo2 className=\"h-4 w-4 mr-2\" />\n                                                                                        Return\n                                                                                        to\n                                                                                        Pending\n                                                                                    </DropdownMenuItem>\n                                                                                )}\n                                                                                <DropdownMenuSeparator />\n                                                                                <DropdownMenuItem\n                                                                                    className=\"text-destructive\"\n                                                                                    onClick={() =>\n                                                                                        deleteTaskMutation.mutate(\n                                                                                            task.id\n                                                                                        )\n                                                                                    }\n                                                                                    data-testid={`menu-delete-task-${task.id}`}>\n                                                                                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                                                                                    Delete\n                                                                                </DropdownMenuItem>\n                                                                            </DropdownMenuContent>\n                                                                        </DropdownMenu>\n                                                                    </div>\n                                                                )}\n                                                            </td>\n                                                        </tr>\n                                                    )\n                                                )}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                </div>\n                            ) : (\n                                <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                                    No tasks found\n                                </div>\n                            )}\n                        </CardContent>\n                    </Card>\n                </TabsContent>\n\n                <TabsContent value=\"mine\">\n                    <Card>\n                        <CardHeader>\n                            <CardTitle className=\"text-lg sm:text-xl\">\n                                Tasks I Created ({myTasks.length})\n                            </CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                            {myTasksLoading ? (\n                                <div className=\"flex items-center justify-center py-8\">\n                                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                                </div>\n                            ) : myTasks.length > 0 ? (\n                                <div className=\"overflow-x-auto -mx-3 sm:mx-0\">\n                                    <div className=\"min-w-full inline-block align-middle\">\n                                        <table className=\"w-full\">\n                                            <thead>\n                                                <tr className=\"border-b\">\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Task\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Assigned To\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Priority\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Status\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Deadline\n                                                    </th>\n                                                    <th className=\"text-right py-3 px-4 text-xs sm:text-sm font-semibold\">\n                                                        Actions\n                                                    </th>\n                                                </tr>\n                                            </thead>\n                                            <tbody>\n                                                {myTasks.map(\n                                                    (\n                                                        task: any,\n                                                        index: number\n                                                    ) => (\n                                                        <tr\n                                                            key={task.id}\n                                                            className={`border-b ${\n                                                                index % 2 === 0\n                                                                    ? \"bg-card\"\n                                                                    : \"bg-muted/20\"\n                                                            } hover-elevate`}\n                                                            data-testid={`row-task-${task.id}`}>\n                                                            <td className=\"py-3 px-4\">\n                                                                <div className=\"font-medium text-xs sm:text-sm\">\n                                                                    {task.title}\n                                                                </div>\n                                                                <div className=\"text-xs text-muted-foreground line-clamp-1\">\n                                                                    {task.description ||\n                                                                        \"—\"}\n                                                                </div>\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-xs sm:text-sm\">\n                                                                {getUserNameById(\n                                                                    task.assignedTo\n                                                                )}\n                                                            </td>\n                                                            <td className=\"py-3 px-4\">\n                                                                <Badge\n                                                                    variant={\n                                                                        task.priority ===\n                                                                        \"high\"\n                                                                            ? \"destructive\"\n                                                                            : task.priority ===\n                                                                              \"medium\"\n                                                                            ? \"default\"\n                                                                            : \"secondary\"\n                                                                    }\n                                                                    className=\"text-xs\">\n                                                                    {\n                                                                        task.priority\n                                                                    }\n                                                                </Badge>\n                                                            </td>\n                                                            <td className=\"py-3 px-4\">\n                                                                <Badge\n                                                                    variant={\n                                                                        task.status ===\n                                                                        \"completed\"\n                                                                            ? \"default\"\n                                                                            : \"outline\"\n                                                                    }\n                                                                    className=\"text-xs\">\n                                                                    {\n                                                                        task.status\n                                                                    }\n                                                                </Badge>\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-xs font-mono\">\n                                                                {task.deadline\n                                                                    ? format(\n                                                                          new Date(\n                                                                              task.deadline\n                                                                          ),\n                                                                          \"MMM dd, yyyy\"\n                                                                      )\n                                                                    : \"—\"}\n                                                            </td>\n                                                            <td className=\"py-3 px-4\">\n                                                                <div className=\"flex justify-end\">\n                                                                    <DropdownMenu>\n                                                                        <DropdownMenuTrigger\n                                                                            asChild>\n                                                                            <Button\n                                                                                variant=\"ghost\"\n                                                                                size=\"icon\"\n                                                                                className=\"h-8 w-8\"\n                                                                                data-testid={`button-my-task-actions-${task.id}`}>\n                                                                                <MoreVertical className=\"h-4 w-4\" />\n                                                                            </Button>\n                                                                        </DropdownMenuTrigger>\n                                                                        <DropdownMenuContent align=\"end\">\n                                                                            <DropdownMenuItem\n                                                                                onClick={() =>\n                                                                                    handleViewTaskDetails(\n                                                                                        task\n                                                                                    )\n                                                                                }\n                                                                                data-testid={`menu-view-details-my-task-${task.id}`}>\n                                                                                <Eye className=\"h-4 w-4 mr-2\" />\n                                                                                View\n                                                                                Details\n                                                                            </DropdownMenuItem>\n                                                                            <DropdownMenuItem\n                                                                                onClick={() =>\n                                                                                    handleEditTask(\n                                                                                        task\n                                                                                    )\n                                                                                }\n                                                                                data-testid={`menu-edit-my-task-${task.id}`}>\n                                                                                <Edit className=\"h-4 w-4 mr-2\" />\n                                                                                Edit\n                                                                            </DropdownMenuItem>\n                                                                            {(task.status ===\n                                                                                \"completed\" ||\n                                                                                task.status ===\n                                                                                    \"in_progress\") && (\n                                                                                <DropdownMenuItem\n                                                                                    onClick={() =>\n                                                                                        returnTaskMutation.mutate(\n                                                                                            task.id\n                                                                                        )\n                                                                                    }\n                                                                                    data-testid={`menu-return-my-task-${task.id}`}>\n                                                                                    <Undo2 className=\"h-4 w-4 mr-2\" />\n                                                                                    Return\n                                                                                    to\n                                                                                    Pending\n                                                                                </DropdownMenuItem>\n                                                                            )}\n                                                                            <DropdownMenuSeparator />\n                                                                            <DropdownMenuItem\n                                                                                className=\"text-destructive\"\n                                                                                onClick={() =>\n                                                                                    deleteTaskMutation.mutate(\n                                                                                        task.id\n                                                                                    )\n                                                                                }\n                                                                                data-testid={`menu-delete-my-task-${task.id}`}>\n                                                                                <Trash2 className=\"h-4 w-4 mr-2\" />\n                                                                                Delete\n                                                                            </DropdownMenuItem>\n                                                                        </DropdownMenuContent>\n                                                                    </DropdownMenu>\n                                                                </div>\n                                                            </td>\n                                                        </tr>\n                                                    )\n                                                )}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                </div>\n                            ) : (\n                                <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                                    You haven't created any tasks yet\n                                </div>\n                            )}\n                        </CardContent>\n                    </Card>\n                </TabsContent>\n            </Tabs>\n        </div>\n    );\n}\n","path":null,"size_bytes":51032,"size_tokens":null},"client/src/pages/user/Announcements.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { format } from \"date-fns\";\nimport { Megaphone, MessageCircle, Send, Mail } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport type { GroupMessage, GroupMessageReply } from \"@shared/schema\";\n\ninterface Message {\n    id: number;\n    senderId: number;\n    receiverId: number;\n    message: string;\n    messageType: string;\n    readStatus: boolean;\n    createdAt: string;\n}\n\ninterface User {\n    id: number;\n    displayName: string;\n    email: string;\n    photoURL?: string;\n    role: string;\n}\n\nfunction AdminMessageCard({\n    message,\n    sender,\n}: {\n    message: Message;\n    sender?: User;\n}) {\n    const getInitials = (name: string) => {\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    return (\n        <Card data-testid={`admin-message-${message.id}`}>\n            <CardHeader>\n                <div className=\"flex items-start gap-3\">\n                    <Avatar className=\"h-10 w-10\">\n                        <AvatarImage\n                            src={sender?.photoURL}\n                            alt={sender?.displayName}\n                        />\n                        <AvatarFallback>\n                            {sender ? getInitials(sender.displayName) : \"AD\"}\n                        </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                            <CardTitle className=\"text-base\">\n                                {sender?.displayName || \"Administrator\"}\n                            </CardTitle>\n                            {!message.readStatus && (\n                                <Badge variant=\"secondary\">New</Badge>\n                            )}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground font-mono\">\n                            {format(\n                                new Date(message.createdAt),\n                                \"MMM dd, yyyy 'at' h:mm a\"\n                            )}\n                        </p>\n                    </div>\n                    <Mail className=\"h-5 w-5 text-primary\" />\n                </div>\n            </CardHeader>\n            <CardContent>\n                <p className=\"text-sm whitespace-pre-wrap break-words\">\n                    {message.message}\n                </p>\n            </CardContent>\n        </Card>\n    );\n}\n\nfunction AnnouncementCard({ announcement }: { announcement: GroupMessage }) {\n    const [showReplies, setShowReplies] = useState(false);\n    const [replyText, setReplyText] = useState(\"\");\n    const { toast } = useToast();\n\n    const user = localStorage.getItem(\"user\");\n    const userId = user ? JSON.parse(user).id : null;\n\n    const { data: replies = [], isLoading: repliesLoading } = useQuery<\n        GroupMessageReply[]\n    >({\n        queryKey: [`/api/group-messages/${announcement.id}/replies`, userId],\n        queryFn: async () => {\n            const headers: Record<string, string> = {};\n            if (userId) {\n                headers[\"x-user-id\"] = userId.toString();\n            }\n\n            const res = await fetch(\n                `${API_BASE_URL}/api/group-messages/${announcement.id}/replies`,\n                { headers, credentials: \"include\" }\n            );\n            if (!res.ok) throw new Error(\"Failed to fetch replies\");\n            return res.json();\n        },\n        enabled: showReplies,\n    });\n\n    const replyMutation = useMutation({\n        mutationFn: async (message: string) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/group-messages/${announcement.id}/replies`,\n                \"POST\",\n                { message }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [`/api/group-messages/${announcement.id}/replies`],\n            });\n            setReplyText(\"\");\n            toast({\n                title: \"Reply sent\",\n                description: \"Your reply has been posted successfully\",\n            });\n        },\n        onError: (error: Error) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to post reply\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleReplySubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!replyText.trim()) return;\n        replyMutation.mutate(replyText);\n    };\n\n    return (\n        <Card data-testid={`card-announcement-${announcement.id}`}>\n            <CardHeader>\n                <div className=\"flex items-start gap-3\">\n                    <Megaphone className=\"h-5 w-5 text-primary mt-0.5\" />\n                    <div className=\"flex-1\">\n                        {announcement.title && (\n                            <CardTitle className=\"text-lg mb-2\">\n                                {announcement.title}\n                            </CardTitle>\n                        )}\n                        <p className=\"text-sm text-muted-foreground font-mono\">\n                            {format(\n                                new Date(announcement.createdAt),\n                                \"MMM dd, yyyy HH:mm\"\n                            )}\n                        </p>\n                    </div>\n                </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                <p className=\"text-sm whitespace-pre-wrap\">\n                    {announcement.message}\n                </p>\n\n                <div className=\"border-t pt-4\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"gap-2\"\n                        onClick={() => setShowReplies(!showReplies)}\n                        data-testid={`button-toggle-replies-${announcement.id}`}>\n                        <MessageCircle className=\"h-4 w-4\" />\n                        {showReplies ? \"Hide\" : \"Show\"} Replies{\" \"}\n                        {replies.length > 0 && `(${replies.length})`}\n                    </Button>\n\n                    {showReplies && (\n                        <div className=\"mt-4 space-y-4\">\n                            {repliesLoading ? (\n                                <div className=\"flex justify-center py-4\">\n                                    <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n                                </div>\n                            ) : (\n                                <>\n                                    {replies.length > 0 && (\n                                        <div\n                                            className=\"space-y-3\"\n                                            data-testid={`replies-list-${announcement.id}`}>\n                                            {replies.map((reply) => (\n                                                <div\n                                                    key={reply.id}\n                                                    className=\"bg-muted rounded-md p-3\"\n                                                    data-testid={`reply-${reply.id}`}>\n                                                    <p className=\"text-sm whitespace-pre-wrap\">\n                                                        {reply.message}\n                                                    </p>\n                                                    <p className=\"text-xs text-muted-foreground mt-2\">\n                                                        {format(\n                                                            new Date(\n                                                                reply.createdAt\n                                                            ),\n                                                            \"MMM dd, yyyy HH:mm\"\n                                                        )}\n                                                    </p>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    )}\n\n                                    <form\n                                        onSubmit={handleReplySubmit}\n                                        className=\"space-y-2\">\n                                        <Textarea\n                                            placeholder=\"Write your reply...\"\n                                            value={replyText}\n                                            onChange={(e) =>\n                                                setReplyText(e.target.value)\n                                            }\n                                            className=\"min-h-[80px]\"\n                                            data-testid={`textarea-reply-${announcement.id}`}\n                                        />\n                                        <Button\n                                            type=\"submit\"\n                                            size=\"sm\"\n                                            disabled={\n                                                !replyText.trim() ||\n                                                replyMutation.isPending\n                                            }\n                                            className=\"gap-2\"\n                                            data-testid={`button-submit-reply-${announcement.id}`}>\n                                            {replyMutation.isPending ? (\n                                                <>Sending...</>\n                                            ) : (\n                                                <>\n                                                    <Send className=\"h-4 w-4\" />\n                                                    Send Reply\n                                                </>\n                                            )}\n                                        </Button>\n                                    </form>\n                                </>\n                            )}\n                        </div>\n                    )}\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n\nexport default function Announcements() {\n    const { dbUserId } = useAuth();\n    const { toast } = useToast();\n\n    const {\n        data: announcements = [],\n        isLoading: loadingAnnouncements,\n        refetch: refetchAnnouncements,\n    } = useQuery<GroupMessage[]>({\n        queryKey: [\"/api/group-messages\"],\n        queryFn: async () => {\n            const user = localStorage.getItem(\"user\");\n            const userId = user ? JSON.parse(user).id : null;\n            const headers: Record<string, string> = {};\n            if (userId) {\n                headers[\"x-user-id\"] = userId.toString();\n            }\n\n            const res = await fetch(`${API_BASE_URL}/api/group-messages`, {\n                headers,\n                credentials: \"include\",\n            });\n            if (!res.ok) throw new Error(\"Failed to fetch announcements\");\n            return res.json();\n        },\n    });\n\n    const {\n        data: allMessages = [],\n        isLoading: loadingMessages,\n        refetch: refetchMessages,\n    } = useQuery<Message[]>({\n        queryKey: [\"/api/messages\"],\n        enabled: !!dbUserId,\n    });\n\n    const { data: users = [] } = useQuery<User[]>({\n        queryKey: [\"/api/users\"],\n    });\n\n    const adminMessages = allMessages\n        .filter(\n            (msg) =>\n                msg.receiverId === dbUserId &&\n                msg.messageType === \"admin_to_employee\"\n        )\n        .sort(\n            (a, b) =>\n                new Date(b.createdAt).getTime() -\n                new Date(a.createdAt).getTime()\n        );\n\n    const sortedAnnouncements = [...announcements].sort(\n        (a, b) =>\n            new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n\n    const getSenderInfo = (senderId: number) => {\n        return users.find((u) => u.id === senderId);\n    };\n\n    // Real-time updates via WebSocket\n    useWebSocket((data) => {\n        // New group message/announcement\n        if (data.type === \"NEW_GROUP_MESSAGE\") {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/group-messages\"],\n            });\n            toast({\n                title: \"New Announcement\",\n                description:\n                    data.data?.title || \"A new announcement has been posted\",\n            });\n        }\n\n        // New message (from admin or team leader)\n        if (data.type === \"NEW_MESSAGE\") {\n            const messageData = data.data;\n            // Refresh if employee receives any message\n            if (messageData.receiverId === dbUserId) {\n                queryClient.invalidateQueries({\n                    queryKey: [\"/api/messages\"],\n                });\n                toast({\n                    title: \"New Message\",\n                    description: `${\n                        messageData.senderName\n                    }: ${messageData.message.substring(0, 50)}${\n                        messageData.message.length > 50 ? \"...\" : \"\"\n                    }`,\n                });\n            }\n        }\n\n        // Reply to group message\n        if (data.type === \"GROUP_MESSAGE_REPLY\") {\n            queryClient.invalidateQueries({\n                queryKey: [\n                    `/api/group-messages/${data.groupMessageId}/replies`,\n                ],\n            });\n            // Also refresh the main announcements list to update reply counts\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/group-messages\"],\n            });\n        }\n    });\n\n    if (loadingAnnouncements || loadingMessages) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold\">\n                    Announcements\n                </h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    Messages from administration and company-wide updates\n                </p>\n            </div>\n\n            {adminMessages.length > 0 && (\n                <div className=\"space-y-4\">\n                    <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n                        <Mail className=\"h-5 w-5\" />\n                        Admin Messages ({adminMessages.length})\n                    </h3>\n                    <div className=\"space-y-3\">\n                        {adminMessages.map((message) => (\n                            <AdminMessageCard\n                                key={`admin-${message.id}`}\n                                message={message}\n                                sender={getSenderInfo(message.senderId)}\n                            />\n                        ))}\n                    </div>\n                </div>\n            )}\n\n            <div className=\"space-y-4\">\n                <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n                    <Megaphone className=\"h-5 w-5\" />\n                    Company Announcements ({sortedAnnouncements.length})\n                </h3>\n                {sortedAnnouncements.length > 0 ? (\n                    <div className=\"space-y-4\">\n                        {sortedAnnouncements.map((announcement) => (\n                            <AnnouncementCard\n                                key={`announcement-${announcement.id}`}\n                                announcement={announcement}\n                            />\n                        ))}\n                    </div>\n                ) : (\n                    <Card>\n                        <CardContent className=\"p-8\">\n                            <div className=\"text-center\">\n                                <Megaphone className=\"h-12 w-12 mx-auto text-muted-foreground mb-3\" />\n                                <p className=\"text-sm text-muted-foreground\">\n                                    No company announcements yet\n                                </p>\n                            </div>\n                        </CardContent>\n                    </Card>\n                )}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":17214,"size_tokens":null},"client/src/components/examples/ThemeToggle.tsx":{"content":"import ThemeToggle from '../ThemeToggle'\n\nexport default function ThemeToggleExample() {\n  return <ThemeToggle />\n}\n","path":null,"size_bytes":116,"size_tokens":null},"client/src/pages/admin/CompanyProfile.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n    Form,\n    FormControl,\n    FormField,\n    FormItem,\n    FormLabel,\n    FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n    Building2,\n    Mail,\n    Phone,\n    MapPin,\n    Users,\n    TrendingUp,\n    Calendar,\n    Edit,\n    Loader2,\n    CheckCircle2,\n    Upload,\n} from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { format } from \"date-fns\";\n\ninterface CompanyProfile {\n    id: number;\n    serverId: string;\n    name: string;\n    email: string;\n    phone: string | null;\n    website: string | null;\n    location: string | null;\n    description: string | null;\n    companyType: string | null;\n    contactPerson: string | null;\n    designation: string | null;\n    mobile: string | null;\n    address: string | null;\n    pincode: string | null;\n    city: string | null;\n    state: string | null;\n    country: string | null;\n    employees: number | null;\n    annualTurnover: string | null;\n    yearEstablished: number | null;\n    logo: string | null;\n    isActive: boolean;\n    createdBy: string | null;\n    updatedBy: string | null;\n    createdAt: string;\n    updatedAt: string;\n}\n\nconst companyProfileSchema = z.object({\n    companyType: z.string().min(1, \"Company type is required\"),\n    contactPerson: z.string().min(1, \"Contact person is required\"),\n    designation: z.string().min(1, \"Designation is required\"),\n    mobile: z.string().min(10, \"Valid mobile number is required\"),\n    phone: z.string().optional(),\n    website: z.string().url(\"Must be a valid URL\").optional().or(z.literal(\"\")),\n    address: z.string().min(5, \"Address is required\"),\n    pincode: z.string().min(4, \"Valid pincode is required\"),\n    city: z.string().min(2, \"City is required\"),\n    state: z.string().min(2, \"State is required\"),\n    country: z.string().min(2, \"Country is required\"),\n    employees: z.string().min(1, \"Number of employees is required\"),\n    annualTurnover: z.string().min(1, \"Annual turnover is required\"),\n    yearEstablished: z.string().min(4, \"Year established is required\"),\n    description: z.string().optional(),\n    logo: z.string().optional(),\n});\n\ntype CompanyProfileFormData = z.infer<typeof companyProfileSchema>;\n\nconst companyTypes = [\n    \"Contractor\",\n    \"Builder\",\n    \"Developer\",\n    \"Supplier\",\n    \"Architect\",\n    \"Consultant\",\n    \"Other\",\n];\n\nconst designations = [\n    \"Owner\",\n    \"Director\",\n    \"Manager\",\n    \"Engineer\",\n    \"Supervisor\",\n    \"Administrator\",\n    \"Other\",\n];\n\nconst turnoverRanges = [\n    \"₹1–10 Cr\",\n    \"₹10–50 Cr\",\n    \"₹50–100 Cr\",\n    \"₹100–500 Cr\",\n    \"₹500+ Cr\",\n];\n\nexport default function CompanyProfile() {\n    const { dbUserId } = useAuth();\n    const { toast } = useToast();\n    const [editDialogOpen, setEditDialogOpen] = useState(false);\n    const [logoFile, setLogoFile] = useState<File | null>(null);\n    const [logoPreview, setLogoPreview] = useState<string | null>(null);\n\n    const { data: company, isLoading } = useQuery<CompanyProfile>({\n        queryKey: [\"/api/my-company/profile\"],\n        enabled: !!dbUserId,\n    });\n\n    const form = useForm<CompanyProfileFormData>({\n        resolver: zodResolver(companyProfileSchema),\n        defaultValues: {\n            companyType: \"\",\n            contactPerson: \"\",\n            designation: \"\",\n            mobile: \"\",\n            phone: \"\",\n            website: \"\",\n            address: \"\",\n            pincode: \"\",\n            city: \"\",\n            state: \"\",\n            country: \"India\",\n            employees: \"\",\n            annualTurnover: \"\",\n            yearEstablished: \"\",\n            description: \"\",\n            logo: \"\",\n        },\n    });\n\n    // Reset form when company data loads\n    useEffect(() => {\n        if (company) {\n            form.reset({\n                companyType: company.companyType || \"\",\n                contactPerson: company.contactPerson || \"\",\n                designation: company.designation || \"\",\n                mobile: company.mobile || \"\",\n                phone: company.phone || \"\",\n                website: company.website || \"\",\n                address: company.address || \"\",\n                pincode: company.pincode || \"\",\n                city: company.city || \"\",\n                state: company.state || \"\",\n                country: company.country || \"India\",\n                employees: company.employees?.toString() || \"\",\n                annualTurnover: company.annualTurnover || \"\",\n                yearEstablished: company.yearEstablished?.toString() || \"\",\n                description: company.description || \"\",\n                logo: company.logo || \"\",\n            });\n        }\n    }, [company, form]);\n\n    const updateProfileMutation = useMutation({\n        mutationFn: async (data: CompanyProfileFormData) => {\n            const payload = {\n                ...data,\n                employees: parseInt(data.employees),\n                yearEstablished: parseInt(data.yearEstablished),\n            };\n            return await apiRequest(\n                `${API_BASE_URL}/api/my-company/profile`,\n                \"PATCH\",\n                payload\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/my-company/profile\"],\n            });\n            toast({\n                title: \"Success\",\n                description: \"✅ Company details updated successfully!\",\n            });\n            setEditDialogOpen(false);\n            setLogoFile(null);\n            setLogoPreview(null);\n        },\n        onError: (error: any) => {\n            toast({\n                variant: \"destructive\",\n                title: \"Error\",\n                description:\n                    error.message || \"Failed to update company details\",\n            });\n        },\n    });\n\n    const handleEditClick = () => {\n        if (company) {\n            form.reset({\n                companyType: company.companyType || \"\",\n                contactPerson: company.contactPerson || \"\",\n                designation: company.designation || \"\",\n                mobile: company.mobile || \"\",\n                phone: company.phone || \"\",\n                website: company.website || \"\",\n                address: company.address || \"\",\n                pincode: company.pincode || \"\",\n                city: company.city || \"\",\n                state: company.state || \"\",\n                country: company.country || \"India\",\n                employees: company.employees?.toString() || \"\",\n                annualTurnover: company.annualTurnover || \"\",\n                yearEstablished: company.yearEstablished?.toString() || \"\",\n                description: company.description || \"\",\n                logo: company.logo || \"\",\n            });\n        }\n        setEditDialogOpen(true);\n    };\n\n    const handleLogoChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files?.[0];\n        if (file) {\n            if (file.size > 5 * 1024 * 1024) {\n                toast({\n                    variant: \"destructive\",\n                    title: \"File too large\",\n                    description: \"Logo must be smaller than 5MB\",\n                });\n                return;\n            }\n            setLogoFile(file);\n            const reader = new FileReader();\n            reader.onloadend = () => {\n                setLogoPreview(reader.result as string);\n                form.setValue(\"logo\", reader.result as string);\n            };\n            reader.readAsDataURL(file);\n        }\n    };\n\n    const onSubmit = (data: CompanyProfileFormData) => {\n        updateProfileMutation.mutate(data);\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n        );\n    }\n\n    if (!company) {\n        return (\n            <div className=\"p-6\">\n                <Card>\n                    <CardContent className=\"py-10\">\n                        <p className=\"text-center text-muted-foreground\">\n                            Company profile not found\n                        </p>\n                    </CardContent>\n                </Card>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            className=\"space-y-6 p-6 bg-background\"\n            data-testid=\"page-company-profile\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1\n                        className=\"text-3xl font-bold\"\n                        data-testid=\"text-page-title\">\n                        Company Profile\n                    </h1>\n                    <p className=\"text-muted-foreground\">\n                        View and manage your company information\n                    </p>\n                </div>\n                <Button\n                    onClick={handleEditClick}\n                    data-testid=\"button-edit-profile\">\n                    <Edit className=\"mr-2 h-4 w-4\" />\n                    Edit Profile\n                </Button>\n            </div>\n\n            <div className=\"grid gap-6 md:grid-cols-2\">\n                <Card data-testid=\"card-basic-info\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Building2 className=\"h-5 w-5\" />\n                            Basic Information\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div className=\"flex items-center gap-4\">\n                            {company.logo ? (\n                                <img\n                                    src={company.logo}\n                                    alt=\"Company Logo\"\n                                    className=\"h-16 w-16 rounded-lg object-cover border\"\n                                    data-testid=\"img-company-logo\"\n                                />\n                            ) : (\n                                <div className=\"h-16 w-16 rounded-lg bg-muted flex items-center justify-center\">\n                                    <Building2 className=\"h-8 w-8 text-muted-foreground\" />\n                                </div>\n                            )}\n                            <div>\n                                <h3\n                                    className=\"font-semibold text-lg\"\n                                    data-testid=\"text-company-name\">\n                                    {company.name}\n                                </h3>\n                                <Badge\n                                    variant={\n                                        company.isActive\n                                            ? \"default\"\n                                            : \"destructive\"\n                                    }\n                                    data-testid=\"badge-company-status\">\n                                    {company.isActive\n                                        ? \"🟢 Active\"\n                                        : \"🔴 Inactive\"}\n                                </Badge>\n                            </div>\n                        </div>\n                        <Separator />\n                        <div className=\"grid gap-3\">\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Company ID\n                                </p>\n                                <p\n                                    className=\"font-medium\"\n                                    data-testid=\"text-server-id\">\n                                    {company.serverId}\n                                </p>\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Company Type\n                                </p>\n                                <p\n                                    className=\"font-medium\"\n                                    data-testid=\"text-company-type\">\n                                    {company.companyType || \"Not specified\"}\n                                </p>\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Description\n                                </p>\n                                <p\n                                    className=\"text-sm\"\n                                    data-testid=\"text-description\">\n                                    {company.description ||\n                                        \"No description provided\"}\n                                </p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-contact-info\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Mail className=\"h-5 w-5\" />\n                            Contact Information\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Contact Person\n                            </p>\n                            <p\n                                className=\"font-medium\"\n                                data-testid=\"text-contact-person\">\n                                {company.contactPerson || \"Not specified\"}\n                            </p>\n                        </div>\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Designation\n                            </p>\n                            <p\n                                className=\"font-medium\"\n                                data-testid=\"text-designation\">\n                                {company.designation || \"Not specified\"}\n                            </p>\n                        </div>\n                        <Separator />\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Email\n                            </p>\n                            <p className=\"font-medium\" data-testid=\"text-email\">\n                                {company.email}\n                            </p>\n                        </div>\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Mobile\n                            </p>\n                            <p\n                                className=\"font-medium\"\n                                data-testid=\"text-mobile\">\n                                {company.mobile || \"Not specified\"}\n                            </p>\n                        </div>\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Phone\n                            </p>\n                            <p className=\"font-medium\" data-testid=\"text-phone\">\n                                {company.phone || \"Not specified\"}\n                            </p>\n                        </div>\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Website\n                            </p>\n                            <p\n                                className=\"font-medium\"\n                                data-testid=\"text-website\">\n                                {company.website || \"Not specified\"}\n                            </p>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-address-info\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <MapPin className=\"h-5 w-5\" />\n                            Address Information\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Address\n                            </p>\n                            <p className=\"text-sm\" data-testid=\"text-address\">\n                                {company.address || \"Not specified\"}\n                            </p>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-3\">\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    City\n                                </p>\n                                <p\n                                    className=\"font-medium\"\n                                    data-testid=\"text-city\">\n                                    {company.city || \"N/A\"}\n                                </p>\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Pincode\n                                </p>\n                                <p\n                                    className=\"font-medium\"\n                                    data-testid=\"text-pincode\">\n                                    {company.pincode || \"N/A\"}\n                                </p>\n                            </div>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-3\">\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    State\n                                </p>\n                                <p\n                                    className=\"font-medium\"\n                                    data-testid=\"text-state\">\n                                    {company.state || \"N/A\"}\n                                </p>\n                            </div>\n                            <div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Country\n                                </p>\n                                <p\n                                    className=\"font-medium\"\n                                    data-testid=\"text-country\">\n                                    {company.country || \"N/A\"}\n                                </p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-business-info\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <TrendingUp className=\"h-5 w-5\" />\n                            Business Information\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Number of Employees\n                            </p>\n                            <p\n                                className=\"font-medium flex items-center gap-2\"\n                                data-testid=\"text-employees\">\n                                <Users className=\"h-4 w-4\" />\n                                {company.employees || \"Not specified\"}\n                            </p>\n                        </div>\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Average Annual Turnover\n                            </p>\n                            <p\n                                className=\"font-medium\"\n                                data-testid=\"text-turnover\">\n                                {company.annualTurnover || \"Not specified\"}\n                            </p>\n                        </div>\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                Year Established\n                            </p>\n                            <p\n                                className=\"font-medium flex items-center gap-2\"\n                                data-testid=\"text-year-established\">\n                                <Calendar className=\"h-4 w-4\" />\n                                {company.yearEstablished || \"Not specified\"}\n                            </p>\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <Card data-testid=\"card-audit-info\">\n                <CardHeader>\n                    <CardTitle>Audit Information</CardTitle>\n                    <CardDescription>\n                        Track changes to your company profile\n                    </CardDescription>\n                </CardHeader>\n                <CardContent className=\"grid gap-3 sm:grid-cols-2\">\n                    <div>\n                        <p className=\"text-sm text-muted-foreground\">\n                            Created By\n                        </p>\n                        <p\n                            className=\"font-medium\"\n                            data-testid=\"text-created-by\">\n                            {company.createdBy || \"System\"}\n                        </p>\n                    </div>\n                    <div>\n                        <p className=\"text-sm text-muted-foreground\">\n                            Created Date\n                        </p>\n                        <p\n                            className=\"font-medium\"\n                            data-testid=\"text-created-date\">\n                            {format(new Date(company.createdAt), \"PPP p\")}\n                        </p>\n                    </div>\n                    <div>\n                        <p className=\"text-sm text-muted-foreground\">\n                            Updated By\n                        </p>\n                        <p\n                            className=\"font-medium\"\n                            data-testid=\"text-updated-by\">\n                            {company.updatedBy || \"Not updated\"}\n                        </p>\n                    </div>\n                    <div>\n                        <p className=\"text-sm text-muted-foreground\">\n                            Updated Date\n                        </p>\n                        <p\n                            className=\"font-medium\"\n                            data-testid=\"text-updated-date\">\n                            {format(new Date(company.updatedAt), \"PPP p\")}\n                        </p>\n                    </div>\n                </CardContent>\n            </Card>\n\n            <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n                <DialogContent\n                    className=\"max-w-2xl max-h-[90vh] overflow-y-auto\"\n                    data-testid=\"dialog-edit-profile\">\n                    <DialogHeader>\n                        <DialogTitle>Edit Company Profile</DialogTitle>\n                        <DialogDescription>\n                            Update your company information. All changes will be\n                            tracked with your username and timestamp.\n                        </DialogDescription>\n                    </DialogHeader>\n\n                    <Form {...form}>\n                        <form\n                            onSubmit={form.handleSubmit(onSubmit)}\n                            className=\"space-y-6\">\n                            <div className=\"space-y-4\">\n                                <div>\n                                    <FormLabel>Company Logo</FormLabel>\n                                    <div className=\"flex items-center gap-4 mt-2\">\n                                        {(logoPreview || company.logo) && (\n                                            <img\n                                                src={\n                                                    logoPreview ||\n                                                    company.logo ||\n                                                    \"\"\n                                                }\n                                                alt=\"Logo Preview\"\n                                                className=\"h-20 w-20 rounded-lg object-cover border\"\n                                                data-testid=\"img-logo-preview\"\n                                            />\n                                        )}\n                                        <div>\n                                            <Input\n                                                type=\"file\"\n                                                accept=\"image/*\"\n                                                onChange={handleLogoChange}\n                                                className=\"cursor-pointer\"\n                                                data-testid=\"input-logo-upload\"\n                                            />\n                                            <p className=\"text-xs text-muted-foreground mt-1\">\n                                                Max size: 5MB. Recommended:\n                                                500x500px\n                                            </p>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <Separator />\n\n                                <div className=\"grid gap-4 sm:grid-cols-2\">\n                                    <FormField\n                                        control={form.control}\n                                        name=\"companyType\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>\n                                                    Company Type *\n                                                </FormLabel>\n                                                <Select\n                                                    onValueChange={\n                                                        field.onChange\n                                                    }\n                                                    value={field.value}>\n                                                    <FormControl>\n                                                        <SelectTrigger data-testid=\"select-company-type\">\n                                                            <SelectValue placeholder=\"Select type\" />\n                                                        </SelectTrigger>\n                                                    </FormControl>\n                                                    <SelectContent>\n                                                        {companyTypes.map(\n                                                            (type) => (\n                                                                <SelectItem\n                                                                    key={type}\n                                                                    value={type}\n                                                                    data-testid={`option-type-${type}`}>\n                                                                    {type}\n                                                                </SelectItem>\n                                                            )\n                                                        )}\n                                                    </SelectContent>\n                                                </Select>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"contactPerson\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>\n                                                    Contact Person *\n                                                </FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        placeholder=\"John Doe\"\n                                                        data-testid=\"input-contact-person\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"designation\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>\n                                                    Designation *\n                                                </FormLabel>\n                                                <Select\n                                                    onValueChange={\n                                                        field.onChange\n                                                    }\n                                                    value={field.value}>\n                                                    <FormControl>\n                                                        <SelectTrigger data-testid=\"select-designation\">\n                                                            <SelectValue placeholder=\"Select designation\" />\n                                                        </SelectTrigger>\n                                                    </FormControl>\n                                                    <SelectContent>\n                                                        {designations.map(\n                                                            (des) => (\n                                                                <SelectItem\n                                                                    key={des}\n                                                                    value={des}\n                                                                    data-testid={`option-designation-${des}`}>\n                                                                    {des}\n                                                                </SelectItem>\n                                                            )\n                                                        )}\n                                                    </SelectContent>\n                                                </Select>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"mobile\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>\n                                                    Mobile Number *\n                                                </FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        placeholder=\"9876543210\"\n                                                        data-testid=\"input-mobile\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"phone\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>\n                                                    Phone Number\n                                                </FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        placeholder=\"Optional\"\n                                                        data-testid=\"input-phone\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"website\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>Website</FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        placeholder=\"https://example.com\"\n                                                        data-testid=\"input-website\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n                                </div>\n\n                                <Separator />\n\n                                <FormField\n                                    control={form.control}\n                                    name=\"address\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Address *</FormLabel>\n                                            <FormControl>\n                                                <Textarea\n                                                    {...field}\n                                                    placeholder=\"23, Main Street, Perundurai\"\n                                                    rows={2}\n                                                    data-testid=\"input-address\"\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n\n                                <div className=\"grid gap-4 sm:grid-cols-2\">\n                                    <FormField\n                                        control={form.control}\n                                        name=\"city\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>City *</FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        placeholder=\"Erode\"\n                                                        data-testid=\"input-city\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"pincode\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>Pincode *</FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        placeholder=\"638001\"\n                                                        data-testid=\"input-pincode\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"state\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>State *</FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        placeholder=\"Tamil Nadu\"\n                                                        data-testid=\"input-state\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"country\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>Country *</FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        placeholder=\"India\"\n                                                        data-testid=\"input-country\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n                                </div>\n\n                                <Separator />\n\n                                <div className=\"grid gap-4 sm:grid-cols-2\">\n                                    <FormField\n                                        control={form.control}\n                                        name=\"employees\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>\n                                                    Number of Employees *\n                                                </FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        type=\"number\"\n                                                        placeholder=\"25\"\n                                                        data-testid=\"input-employees\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"annualTurnover\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>\n                                                    Average Annual Turnover *\n                                                </FormLabel>\n                                                <Select\n                                                    onValueChange={\n                                                        field.onChange\n                                                    }\n                                                    value={field.value}>\n                                                    <FormControl>\n                                                        <SelectTrigger data-testid=\"select-turnover\">\n                                                            <SelectValue placeholder=\"Select range\" />\n                                                        </SelectTrigger>\n                                                    </FormControl>\n                                                    <SelectContent>\n                                                        {turnoverRanges.map(\n                                                            (range) => (\n                                                                <SelectItem\n                                                                    key={range}\n                                                                    value={\n                                                                        range\n                                                                    }\n                                                                    data-testid={`option-turnover-${range}`}>\n                                                                    {range}\n                                                                </SelectItem>\n                                                            )\n                                                        )}\n                                                    </SelectContent>\n                                                </Select>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n\n                                    <FormField\n                                        control={form.control}\n                                        name=\"yearEstablished\"\n                                        render={({ field }) => (\n                                            <FormItem>\n                                                <FormLabel>\n                                                    Year Established *\n                                                </FormLabel>\n                                                <FormControl>\n                                                    <Input\n                                                        {...field}\n                                                        type=\"number\"\n                                                        placeholder=\"2005\"\n                                                        data-testid=\"input-year-established\"\n                                                    />\n                                                </FormControl>\n                                                <FormMessage />\n                                            </FormItem>\n                                        )}\n                                    />\n                                </div>\n\n                                <FormField\n                                    control={form.control}\n                                    name=\"description\"\n                                    render={({ field }) => (\n                                        <FormItem>\n                                            <FormLabel>Description</FormLabel>\n                                            <FormControl>\n                                                <Textarea\n                                                    {...field}\n                                                    placeholder=\"Brief description about your company\"\n                                                    rows={3}\n                                                    data-testid=\"input-description\"\n                                                />\n                                            </FormControl>\n                                            <FormMessage />\n                                        </FormItem>\n                                    )}\n                                />\n                            </div>\n\n                            <DialogFooter>\n                                <Button\n                                    type=\"button\"\n                                    variant=\"outline\"\n                                    onClick={() => setEditDialogOpen(false)}\n                                    disabled={updateProfileMutation.isPending}\n                                    data-testid=\"button-cancel\">\n                                    Cancel\n                                </Button>\n                                <Button\n                                    type=\"submit\"\n                                    disabled={updateProfileMutation.isPending}\n                                    data-testid=\"button-save-changes\">\n                                    {updateProfileMutation.isPending ? (\n                                        <>\n                                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />{\" \"}\n                                            Saving...\n                                        </>\n                                    ) : (\n                                        <>\n                                            <CheckCircle2 className=\"mr-2 h-4 w-4\" />{\" \"}\n                                            Save Changes\n                                        </>\n                                    )}\n                                </Button>\n                            </DialogFooter>\n                        </form>\n                    </Form>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":49567,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport { Pool } from \"pg\";\nimport * as schema from \"@shared/schema\";\nimport dotenv from \"dotenv\";\ndotenv.config();\nif (!process.env.DATABASE_URL) {\n    throw new Error(\n        \"DATABASE_URL must be set. Did you forget to provision a database?\"\n    );\n}\n\nconst pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":430,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/contexts/WebSocketContext.tsx":{"content":"import {\n    createContext,\n    useContext,\n    useEffect,\n    useState,\n    useRef,\n    ReactNode,\n    useCallback,\n} from \"react\";\n\ninterface WebSocketMessage {\n    type: string;\n    data?: any;\n    [key: string]: any;\n}\n\ntype MessageHandler = (message: WebSocketMessage) => void;\n\ninterface WebSocketContextType {\n    lastMessage: WebSocketMessage | null;\n    sendMessage: (message: any) => void;\n    subscribe: (handler: MessageHandler) => () => void;\n}\n\nconst WebSocketContext = createContext<WebSocketContextType | null>(null);\n\nexport function WebSocketProvider({ children }: { children: ReactNode }) {\n    const [lastMessage, setLastMessage] = useState<WebSocketMessage | null>(\n        null\n    );\n    const [ws, setWs] = useState<WebSocket | null>(null);\n    const subscribersRef = useRef<Set<MessageHandler>>(new Set());\n    const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n    const reconnectAttemptsRef = useRef(0);\n    const socketRef = useRef<WebSocket | null>(null);\n    const isUnmountedRef = useRef(false);\n    const maxReconnectAttempts = 10;\n    const baseReconnectDelay = 1000;\n\n    useEffect(() => {\n        isUnmountedRef.current = false;\n\n        let wsUrl: string;\n        const externalApiUrl = import.meta.env.VITE_API_URL;\n\n        // Always use window.location for WebSocket in Replit environment\n        // to avoid mixed content issues\n        const isLocalhost = externalApiUrl && externalApiUrl.includes(\"localhost\");\n        if (externalApiUrl && !isLocalhost) {\n            wsUrl = externalApiUrl.replace(/^https?/, \"wss\") + \"/ws\";\n        } else {\n            const protocol =\n                window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n            const host = window.location.host || \"localhost:5000\";\n            wsUrl = `${protocol}//${host}/ws`;\n        }\n\n        const connect = () => {\n            if (isUnmountedRef.current) return;\n\n            try {\n                console.log(\"[WebSocket] Connecting to:\", wsUrl);\n                const websocket = new WebSocket(wsUrl);\n                socketRef.current = websocket;\n\n                websocket.onopen = () => {\n                    if (isUnmountedRef.current) {\n                        websocket.close();\n                        return;\n                    }\n                    console.log(\"[WebSocket] Connected successfully\");\n                    reconnectAttemptsRef.current = 0;\n                };\n\n                websocket.onmessage = (event) => {\n                    if (isUnmountedRef.current) return;\n\n                    try {\n                        const data = JSON.parse(event.data);\n                        console.log(\n                            \"[WebSocket] Message received:\",\n                            data.type,\n                            data\n                        );\n                        setLastMessage(data);\n\n                        subscribersRef.current.forEach((handler) => {\n                            try {\n                                handler(data);\n                            } catch (error) {\n                                console.error(\n                                    \"Error in WebSocket message handler:\",\n                                    error\n                                );\n                            }\n                        });\n                    } catch (error) {\n                        console.error(\n                            \"Failed to parse WebSocket message:\",\n                            error\n                        );\n                    }\n                };\n\n                websocket.onerror = (error) => {\n                    console.error(\"[WebSocket] Error:\", error);\n                };\n\n                websocket.onclose = (event) => {\n                    console.log(\"[WebSocket] Disconnected, code:\", event.code);\n                    socketRef.current = null;\n\n                    if (isUnmountedRef.current) return;\n\n                    setWs(null);\n\n                    // Attempt to reconnect with exponential backoff\n                    if (reconnectAttemptsRef.current < maxReconnectAttempts) {\n                        const delay = Math.min(\n                            baseReconnectDelay *\n                                Math.pow(2, reconnectAttemptsRef.current),\n                            30000\n                        );\n                        console.log(\n                            `[WebSocket] Reconnecting in ${delay}ms (attempt ${\n                                reconnectAttemptsRef.current + 1\n                            }/${maxReconnectAttempts})`\n                        );\n                        reconnectTimeoutRef.current = setTimeout(() => {\n                            reconnectAttemptsRef.current++;\n                            connect();\n                        }, delay);\n                    } else {\n                        console.log(\n                            \"[WebSocket] Max reconnect attempts reached\"\n                        );\n                    }\n                };\n\n                setWs(websocket);\n            } catch (error) {\n                console.error(\n                    \"[WebSocket] Failed to create connection:\",\n                    error\n                );\n            }\n        };\n\n        connect();\n\n        return () => {\n            isUnmountedRef.current = true;\n\n            if (reconnectTimeoutRef.current) {\n                clearTimeout(reconnectTimeoutRef.current);\n                reconnectTimeoutRef.current = null;\n            }\n\n            if (socketRef.current) {\n                socketRef.current.close();\n                socketRef.current = null;\n            }\n        };\n    }, []);\n\n    const sendMessage = useCallback(\n        (message: any) => {\n            if (ws && ws.readyState === WebSocket.OPEN) {\n                ws.send(JSON.stringify(message));\n            }\n        },\n        [ws]\n    );\n\n    const subscribe = useCallback((handler: MessageHandler) => {\n        subscribersRef.current.add(handler);\n\n        return () => {\n            subscribersRef.current.delete(handler);\n        };\n    }, []);\n\n    return (\n        <WebSocketContext.Provider\n            value={{ lastMessage, sendMessage, subscribe }}>\n            {children}\n        </WebSocketContext.Provider>\n    );\n}\n\nexport function useWebSocket(handler?: MessageHandler) {\n    const context = useContext(WebSocketContext);\n    if (!context) {\n        throw new Error(\"useWebSocket must be used within a WebSocketProvider\");\n    }\n\n    useEffect(() => {\n        if (handler) {\n            return context.subscribe(handler);\n        }\n    }, [handler, context]);\n\n    return context;\n}\n","path":null,"size_bytes":6656,"size_tokens":null},"client/src/components/AppSidebar.tsx":{"content":"import { LayoutDashboard, CheckSquare, Users, FileText, Archive, MessageSquare, Star } from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from \"@/components/ui/sidebar\";\n\nconst menuItems = [\n  {\n    title: \"Dashboard\",\n    url: \"#dashboard\",\n    icon: LayoutDashboard,\n  },\n  {\n    title: \"Tasks\",\n    url: \"#tasks\",\n    icon: CheckSquare,\n  },\n  {\n    title: \"Users\",\n    url: \"#users\",\n    icon: Users,\n  },\n  {\n    title: \"Reports\",\n    url: \"#reports\",\n    icon: FileText,\n  },\n  {\n    title: \"Messages\",\n    url: \"#messages\",\n    icon: MessageSquare,\n  },\n  {\n    title: \"Ratings\",\n    url: \"#ratings\",\n    icon: Star,\n  },\n  {\n    title: \"Archive\",\n    url: \"#archive\",\n    icon: Archive,\n  },\n];\n\nexport default function AppSidebar() {\n  return (\n    <Sidebar>\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"text-lg font-bold px-4 py-4\">\n            WorkLogix Admin\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {menuItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton asChild data-testid={`nav-${item.title.toLowerCase()}`}>\n                    <a href={item.url} className=\"flex items-center gap-3\">\n                      <item.icon className=\"h-5 w-5\" />\n                      <span>{item.title}</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":1739,"size_tokens":null},"client/src/components/MessageCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { format } from \"date-fns\";\nimport { Mail, MailOpen } from \"lucide-react\";\n\ninterface MessageCardProps {\n  id: string;\n  message: string;\n  timestamp: Date;\n  isRead: boolean;\n  relatedTask?: string;\n  onMarkRead?: () => void;\n}\n\nexport default function MessageCard({\n  id,\n  message,\n  timestamp,\n  isRead,\n  relatedTask,\n  onMarkRead,\n}: MessageCardProps) {\n  const handleClick = () => {\n    if (!isRead && onMarkRead) {\n      onMarkRead();\n      console.log(`Message ${id} marked as read`);\n    }\n  };\n\n  return (\n    <Card\n      className={`cursor-pointer hover-elevate ${!isRead ? \"border-primary\" : \"\"}`}\n      onClick={handleClick}\n      data-testid={`card-message-${id}`}\n    >\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start gap-3\">\n          <div className={`p-2 rounded-lg ${isRead ? \"bg-muted\" : \"bg-primary/10\"}`}>\n            {isRead ? (\n              <MailOpen className=\"h-4 w-4 text-muted-foreground\" />\n            ) : (\n              <Mail className=\"h-4 w-4 text-primary\" />\n            )}\n          </div>\n          <div className=\"flex-1 space-y-1\">\n            <div className=\"flex items-start justify-between gap-2\">\n              <p className={`text-sm ${!isRead ? \"font-semibold\" : \"\"}`}>{message}</p>\n              {!isRead && (\n                <Badge variant=\"secondary\" className=\"shrink-0\">New</Badge>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2 text-xs text-muted-foreground font-mono\">\n              <span>{format(timestamp, \"MMM dd, yyyy h:mm a\")}</span>\n              {relatedTask && (\n                <>\n                  <span>•</span>\n                  <span>Related to: {relatedTask}</span>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1944,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport express from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { broadcast } from \"./index\";\nimport { sendPushNotificationToUser } from \"./lib/firebase-admin\";\nimport {\n    insertCompanySchema,\n    insertUserSchema,\n    insertTaskSchema,\n    insertReportSchema,\n    insertMessageSchema,\n    insertRatingSchema,\n    insertFileUploadSchema,\n    insertGroupMessageSchema,\n    insertGroupMessageReplySchema,\n    insertFeedbackSchema,\n    loginSchema,\n    signupSchema,\n    firebaseSigninSchema,\n    companyRegistrationSchema,\n    companyBasicRegistrationSchema,\n    superAdminLoginSchema,\n    companyAdminLoginSchema,\n    companyUserLoginSchema,\n    insertSlotPricingSchema,\n    insertCompanyPaymentSchema,\n    updatePaymentStatusSchema,\n    slotPurchaseSchema,\n    passwordResetRequestSchema,\n    passwordResetSchema,\n    insertAttendanceRecordSchema,\n    insertCorrectionRequestSchema,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport bcrypt from \"bcryptjs\";\nimport {\n    sendReportNotification,\n    sendCompanyServerIdEmail,\n    sendUserIdEmail,\n    sendPasswordResetEmail,\n    sendPaymentConfirmationEmail,\n    sendCompanyVerificationEmail,\n} from \"./email\";\nimport crypto from \"crypto\";\nimport Stripe from \"stripe\";\nimport passport from \"passport\";\n\nconst stripe = process.env.STRIPE_SECRET_KEY\n    ? new Stripe(process.env.STRIPE_SECRET_KEY)\n    : null;\n\nconst endpointSecret = process.env.STRIPE_WEBHOOK_SECRET || \"\";\n\nconst isGoogleOAuthConfigured = !!(\n    process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET\n);\n\nasync function requireAuth(\n    req: express.Request,\n    res: express.Response,\n    next: express.NextFunction\n) {\n    const userId = parseInt(req.headers[\"x-user-id\"] as string);\n    if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    const user = await storage.getUserById(userId);\n    if (!user || !user.isActive) {\n        return res\n            .status(401)\n            .json({ message: \"User account disabled\", code: \"USER_INACTIVE\" });\n    }\n\n    next();\n}\n\nasync function requireAdmin(\n    req: express.Request,\n    res: express.Response,\n    next: express.NextFunction\n) {\n    const userId = parseInt(req.headers[\"x-user-id\"] as string);\n    if (!userId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    const user = await storage.getUserById(userId);\n    if (!user || !user.isActive) {\n        return res\n            .status(401)\n            .json({ message: \"User account disabled\", code: \"USER_INACTIVE\" });\n    }\n\n    if (user.role !== \"company_admin\" && user.role !== \"super_admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n    }\n\n    next();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n    // Config endpoint to check feature availability\n    app.get(\"/api/config\", (req, res) => {\n        res.json({\n            googleOAuthEnabled: isGoogleOAuthConfigured,\n            stripeEnabled: !!stripe,\n        });\n    });\n\n    // Stripe Webhook Handler (MUST be before express.json() middleware)\n    // This endpoint needs raw body for signature verification\n    app.post(\n        \"/api/stripe-webhook\",\n        express.raw({ type: \"application/json\" }),\n        async (req, res, next) => {\n            try {\n                if (!stripe) {\n                    return res\n                        .status(500)\n                        .json({ message: \"Payment gateway not configured\" });\n                }\n\n                const sig = req.headers[\"stripe-signature\"];\n                if (!sig) {\n                    return res.status(400).send(\"No signature header\");\n                }\n\n                let event: Stripe.Event;\n\n                try {\n                    event = stripe.webhooks.constructEvent(\n                        req.body,\n                        sig,\n                        endpointSecret\n                    );\n                } catch (err: any) {\n                    console.error(\n                        \"Webhook signature verification failed:\",\n                        err.message\n                    );\n                    return res\n                        .status(400)\n                        .send(`Webhook Error: ${err.message}`);\n                }\n\n                // Handle payment_intent.succeeded event\n                if (event.type === \"payment_intent.succeeded\") {\n                    const paymentIntent = event.data\n                        .object as Stripe.PaymentIntent;\n\n                    console.log(\"Payment succeeded webhook received:\", {\n                        id: paymentIntent.id,\n                        amount: paymentIntent.amount,\n                        metadata: paymentIntent.metadata,\n                    });\n\n                    const paymentId = parseInt(\n                        paymentIntent.metadata.paymentId || \"0\"\n                    );\n                    const companyId = parseInt(\n                        paymentIntent.metadata.companyId || \"0\"\n                    );\n                    const slotType = paymentIntent.metadata.slotType;\n                    const quantity = parseInt(\n                        paymentIntent.metadata.quantity || \"0\"\n                    );\n\n                    if (!paymentId || !companyId) {\n                        console.error(\"Invalid metadata in payment intent\");\n                        return res\n                            .status(400)\n                            .json({ message: \"Invalid payment metadata\" });\n                    }\n\n                    // Get payment record\n                    const payment = await storage.getPaymentById(paymentId);\n                    if (!payment) {\n                        console.error(\"Payment not found:\", paymentId);\n                        return res\n                            .status(404)\n                            .json({ message: \"Payment not found\" });\n                    }\n\n                    // Prevent duplicate processing\n                    if (payment.paymentStatus === \"paid\") {\n                        console.log(\"Payment already processed:\", paymentId);\n                        return res.json({\n                            received: true,\n                            message: \"Already processed\",\n                        });\n                    }\n\n                    // Get company details\n                    const company = await storage.getCompanyById(companyId);\n                    if (!company) {\n                        console.error(\"Company not found:\", companyId);\n                        return res\n                            .status(404)\n                            .json({ message: \"Company not found\" });\n                    }\n\n                    // Generate unique receipt number\n                    const date = new Date();\n                    const dateStr = date\n                        .toISOString()\n                        .slice(0, 10)\n                        .replace(/-/g, \"\");\n                    const receiptNumber = `WL-RCPT-${dateStr}-${paymentId\n                        .toString()\n                        .padStart(6, \"0\")}`;\n\n                    // Prepare slot updates\n                    const slotUpdates =\n                        slotType === \"admin\"\n                            ? { maxAdmins: quantity }\n                            : { maxMembers: quantity };\n\n                    // CRITICAL: Atomic transaction - complete payment and update slots together\n                    const updatedPayment =\n                        await storage.completePaymentWithSlots(\n                            paymentId,\n                            companyId,\n                            receiptNumber,\n                            paymentIntent.id,\n                            slotUpdates\n                        );\n\n                    if (updatedPayment) {\n                        console.log(\"Payment completed successfully:\", {\n                            paymentId,\n                            receiptNumber,\n                            slotType,\n                            quantity,\n                        });\n\n                        // Send notifications to Super Admin and Company\n                        try {\n                            // Get super admin\n                            const superAdmin = await storage.getUserByEmail(\n                                \"superadmin@worklogix.com\"\n                            );\n\n                            // Send email to company\n                            await sendPaymentConfirmationEmail({\n                                companyName: company.name,\n                                companyEmail: company.email,\n                                receiptNumber,\n                                amount: payment.amount,\n                                currency: payment.currency,\n                                slotType: slotType || \"\",\n                                slotQuantity: quantity,\n                                transactionId: paymentIntent.id,\n                                paymentDate: new Date(),\n                            });\n\n                            // Send notification to super admin\n                            if (superAdmin) {\n                                await sendPaymentConfirmationEmail({\n                                    companyName: `[ADMIN NOTIFICATION] ${company.name}`,\n                                    companyEmail: superAdmin.email,\n                                    receiptNumber,\n                                    amount: payment.amount,\n                                    currency: payment.currency,\n                                    slotType: slotType || \"\",\n                                    slotQuantity: quantity,\n                                    transactionId: paymentIntent.id,\n                                    paymentDate: new Date(),\n                                });\n                            }\n\n                            console.log(\"Notifications sent successfully\");\n                        } catch (emailError) {\n                            console.error(\n                                \"Error sending notifications:\",\n                                emailError\n                            );\n                            // Don't fail the webhook if email fails\n                        }\n                    }\n                }\n\n                res.json({ received: true });\n            } catch (error: any) {\n                console.error(\"Webhook handler error:\", error);\n                next(error);\n            }\n        }\n    );\n    // Company Registration\n    app.post(\"/api/auth/register-company\", async (req, res, next) => {\n        try {\n            const validatedData = companyRegistrationSchema.parse(req.body);\n\n            const existingCompany = await storage.getCompanyByEmail(\n                validatedData.email\n            );\n            if (existingCompany) {\n                return res.status(400).json({\n                    message: \"Company with this email already exists\",\n                });\n            }\n\n            const hashedPassword = await bcrypt.hash(\n                validatedData.password,\n                10\n            );\n            const verificationToken = crypto.randomBytes(32).toString(\"hex\");\n\n            const company = await storage.createCompany({\n                name: validatedData.name,\n                email: validatedData.email,\n                password: hashedPassword,\n                phone: validatedData.mobile,\n                website: validatedData.website,\n                location: validatedData.country,\n                description: validatedData.description,\n\n                companyType: validatedData.companyType,\n                contactPerson: validatedData.contactPerson,\n                designation: validatedData.designation,\n                mobile: validatedData.mobile,\n\n                address: validatedData.address,\n                pincode: validatedData.pincode,\n                city: validatedData.city,\n                state: validatedData.state,\n                country: validatedData.country,\n\n                employees: validatedData.employees,\n                annualTurnover: validatedData.annualTurnover,\n                yearEstablished: validatedData.yearEstablished,\n                logo: validatedData.logo,\n\n                verificationToken,\n                emailVerified: false,\n            });\n\n            await sendCompanyServerIdEmail({\n                companyName: company.name,\n                companyEmail: company.email,\n                serverId: company.serverId,\n            });\n\n            const { password: _, ...companyWithoutPassword } = company;\n            res.json({\n                ...companyWithoutPassword,\n                message: `Company registered successfully! Your Company Server ID is: ${company.serverId}. Please save this ID, it will be required for login. An email has been sent to ${company.email} with your server ID.`,\n            });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // Company Basic Registration (Manual)\n    app.post(\"/api/auth/register-company-basic\", async (req, res, next) => {\n        try {\n            const validatedData = companyBasicRegistrationSchema.parse(\n                req.body\n            );\n\n            const existingCompany = await storage.getCompanyByEmail(\n                validatedData.email\n            );\n            if (existingCompany) {\n                return res.status(400).json({\n                    message: \"A company with this email already exists\",\n                });\n            }\n\n            const hashedPassword = await bcrypt.hash(\n                validatedData.password,\n                10\n            );\n            const verificationToken = crypto.randomBytes(32).toString(\"hex\");\n            const verificationTokenExpiry = new Date(\n                Date.now() + 24 * 60 * 60 * 1000\n            );\n\n            const company = await storage.createCompany({\n                name: validatedData.companyName,\n                email: validatedData.email,\n                password: hashedPassword,\n                contactPerson: validatedData.companyName,\n                verificationToken,\n                verificationTokenExpiry,\n                emailVerified: false,\n            });\n\n            // Determine the correct frontend URL for verification emails\n            let baseUrl: string;\n            \n            // Priority 1: Replit domains (development and production)\n            if (process.env.REPLIT_DEV_DOMAIN) {\n                baseUrl = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n            } else if (process.env.REPLIT_DOMAINS) {\n                // REPLIT_DOMAINS can be comma-separated, take the first one\n                const domains = process.env.REPLIT_DOMAINS.split(',');\n                baseUrl = `https://${domains[0].trim()}`;\n            }\n            // Priority 2: Use Origin or Referer header from the request\n            else if (req.headers.origin) {\n                baseUrl = req.headers.origin as string;\n            } else if (req.headers.referer) {\n                const refererUrl = new URL(req.headers.referer as string);\n                baseUrl = `${refererUrl.protocol}//${refererUrl.host}`;\n            }\n            // Priority 3: Explicit environment variables\n            else if (process.env.FRONTEND_URL) {\n                baseUrl = process.env.FRONTEND_URL;\n            }\n            // Priority 4: Fall back to request headers\n            else {\n                const protocol = req.headers[\"x-forwarded-proto\"] || req.protocol || \"https\";\n                const host = req.headers[\"x-forwarded-host\"] || req.headers.host;\n                baseUrl = `${protocol}://${host}`;\n            }\n            \n            console.log(`[REGISTRATION] Using base URL for verification email: ${baseUrl}`);\n\n            await sendCompanyVerificationEmail({\n                companyName: validatedData.companyName,\n                email: validatedData.email,\n                serverId: company.serverId,\n                verificationToken,\n                baseUrl,\n            });\n\n            res.json({\n                serverId: company.serverId,\n                email: company.email,\n                message: `Registration successful! Your Company Server ID is ${company.serverId}. Please check your email to verify your account.`,\n            });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // Google OAuth - Initiate\n    app.get(\"/api/auth/google\", (req, res, next) => {\n        if (!isGoogleOAuthConfigured) {\n            return res.redirect(\"/?error=google_oauth_not_configured\");\n        }\n        passport.authenticate(\"google\", {\n            scope: [\"profile\", \"email\"],\n        })(req, res, next);\n    });\n\n    // Google OAuth - Callback\n    app.get(\n        \"/api/auth/google/callback\",\n        (req, res, next) => {\n            if (!isGoogleOAuthConfigured) {\n                return res.redirect(\"/?error=google_oauth_not_configured\");\n            }\n            passport.authenticate(\"google\", {\n                failureRedirect: \"/?error=google_auth_failed\",\n                session: false,\n            })(req, res, next);\n        },\n        async (req, res, next) => {\n            try {\n                const googleUser = req.user as any;\n\n                if (!googleUser || !googleUser.email) {\n                    return res.redirect(\"/?error=no_email\");\n                }\n\n                const existingCompany = await storage.getCompanyByEmail(\n                    googleUser.email\n                );\n                if (existingCompany) {\n                    return res.redirect(\n                        `/?error=company_exists&email=${encodeURIComponent(\n                            googleUser.email\n                        )}`\n                    );\n                }\n\n                const company = await storage.createCompany({\n                    name:\n                        googleUser.displayName ||\n                        googleUser.email.split(\"@\")[0],\n                    email: googleUser.email,\n                    password: \"\",\n                    contactPerson:\n                        googleUser.displayName ||\n                        googleUser.email.split(\"@\")[0],\n                    logo: googleUser.photoURL,\n                    emailVerified: true,\n                });\n\n                const admin = await storage.createUser({\n                    email: googleUser.email,\n                    displayName: googleUser.displayName,\n                    photoURL: googleUser.photoURL,\n                    role: \"company_admin\",\n                    companyId: company.id,\n                });\n\n                await sendCompanyServerIdEmail({\n                    companyName: company.name,\n                    companyEmail: company.email,\n                    serverId: company.serverId,\n                });\n\n                res.redirect(\n                    `/?success=true&serverId=${\n                        company.serverId\n                    }&email=${encodeURIComponent(company.email)}`\n                );\n            } catch (error) {\n                console.error(\"Google OAuth callback error:\", error);\n                res.redirect(\"/?error=registration_failed\");\n            }\n        }\n    );\n\n    // Verify Company Email\n    app.get(\"/api/auth/verify-company\", async (req, res, next) => {\n        try {\n            const { token } = req.query;\n            console.log(\n                `[VERIFY] Verification request received with token: ${\n                    token\n                        ? token.toString().substring(0, 20) + \"...\"\n                        : \"missing\"\n                }`\n            );\n\n            if (!token || typeof token !== \"string\") {\n                console.log(\"[VERIFY] Token is missing or invalid type\");\n                return res\n                    .status(400)\n                    .json({ message: \"Verification token is required\" });\n            }\n\n            console.log(`[VERIFY] Looking up company with token...`);\n            const company = await storage.verifyCompanyEmail(token);\n\n            if (!company) {\n                console.log(\n                    \"[VERIFY] No company found with this token or token expired\"\n                );\n                return res\n                    .status(400)\n                    .json({ message: \"Invalid or expired verification token\" });\n            }\n\n            console.log(\n                `[VERIFY] Company verified successfully: ${company.serverId}`\n            );\n            const { password: _, ...companyWithoutPassword } = company;\n            res.json({\n                company: companyWithoutPassword,\n                message:\n                    \"Email verified successfully! You can now log in to your dashboard.\",\n            });\n        } catch (error) {\n            console.error(\"[VERIFY] Error during verification:\", error);\n            next(error);\n        }\n    });\n\n    // Super Admin Login\n    app.post(\"/api/auth/super-admin-login\", async (req, res, next) => {\n        try {\n            const validatedData = superAdminLoginSchema.parse(req.body);\n\n            const user = await storage.getUserByEmail(validatedData.email);\n            if (!user || user.role !== \"super_admin\" || !user.password) {\n                return res.status(401).json({\n                    message: \"Invalid credentials or not a super admin\",\n                });\n            }\n\n            const isValidPassword = await bcrypt.compare(\n                validatedData.password,\n                user.password\n            );\n            if (!isValidPassword) {\n                return res\n                    .status(401)\n                    .json({ message: \"Invalid email or password\" });\n            }\n\n            const { password: _, ...userWithoutPassword } = user;\n            res.json(userWithoutPassword);\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // Company Admin Login\n    app.post(\"/api/auth/company-admin-login\", async (req, res, next) => {\n        try {\n            const validatedData = companyAdminLoginSchema.parse(req.body);\n\n            const company = await storage.getCompanyByServerId(\n                validatedData.serverId\n            );\n            if (!company) {\n                return res\n                    .status(401)\n                    .json({ message: \"Invalid Company Server ID\" });\n            }\n\n            if (!company.emailVerified) {\n                return res.status(401).json({\n                    message:\n                        \"Please verify your email before logging in. Check your inbox for the verification link.\",\n                });\n            }\n\n            if (\n                company.name.toLowerCase() !==\n                    validatedData.companyName.toLowerCase() ||\n                company.email.toLowerCase() !==\n                    validatedData.email.toLowerCase()\n            ) {\n                return res\n                    .status(401)\n                    .json({ message: \"Invalid company credentials\" });\n            }\n\n            if (company.password) {\n                const isValidPassword = await bcrypt.compare(\n                    validatedData.password,\n                    company.password\n                );\n                if (!isValidPassword) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Invalid password\" });\n                }\n            }\n\n            const adminUsers = await storage.getUsersByCompanyId(company.id);\n            const adminUser = adminUsers.find(\n                (u) =>\n                    u.role === \"company_admin\" &&\n                    u.email === validatedData.email\n            );\n\n            if (!adminUser) {\n                const hashedUserPassword = await bcrypt.hash(\n                    validatedData.password,\n                    10\n                );\n                const newAdmin = await storage.createUser({\n                    email: validatedData.email,\n                    displayName: validatedData.companyName + \" Admin\",\n                    password: hashedUserPassword,\n                    role: \"company_admin\",\n                    companyId: company.id,\n                });\n\n                await sendUserIdEmail({\n                    userName: newAdmin.displayName,\n                    userEmail: newAdmin.email,\n                    uniqueUserId: newAdmin.uniqueUserId,\n                    role: newAdmin.role,\n                });\n\n                const { password: _, ...userWithoutPassword } = newAdmin;\n                return res.json({\n                    ...userWithoutPassword,\n                    message: `Welcome! Your unique User ID is: ${newAdmin.uniqueUserId}. An email has been sent to ${newAdmin.email} with your user ID.`,\n                });\n            }\n\n            const isProfileComplete = !!(\n                company.companyType &&\n                company.designation &&\n                company.address &&\n                company.pincode &&\n                company.city &&\n                company.state &&\n                company.country &&\n                company.employees &&\n                company.annualTurnover &&\n                company.yearEstablished\n            );\n\n            const { password: _, ...userWithoutPassword } = adminUser;\n            res.json({\n                ...userWithoutPassword,\n                companyProfileComplete: isProfileComplete,\n            });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // Company User Login\n    app.post(\"/api/auth/company-user-login\", async (req, res, next) => {\n        try {\n            const validatedData = companyUserLoginSchema.parse(req.body);\n\n            const user = await storage.getUserByUniqueUserId(\n                validatedData.userId\n            );\n            if (!user || !user.password) {\n                return res.status(401).json({ message: \"Invalid User ID\" });\n            }\n\n            if (!user.isActive) {\n                return res.status(401).json({\n                    message:\n                        \"Account is inactive. Please contact your administrator.\",\n                });\n            }\n\n            if (!user.companyId) {\n                return res.status(401).json({\n                    message: \"User is not associated with any company\",\n                });\n            }\n\n            if (user.displayName !== validatedData.username) {\n                return res.status(401).json({ message: \"Invalid username\" });\n            }\n\n            if (user.role === \"super_admin\" || user.role === \"company_admin\") {\n                return res.status(401).json({\n                    message:\n                        \"Please use the appropriate login form for your role\",\n                });\n            }\n\n            const isValidPassword = await bcrypt.compare(\n                validatedData.password,\n                user.password\n            );\n            if (!isValidPassword) {\n                return res.status(401).json({ message: \"Invalid password\" });\n            }\n\n            const { password: _, ...userWithoutPassword } = user;\n            res.json(userWithoutPassword);\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // User routes\n    app.post(\"/api/auth/signup\", async (req, res, next) => {\n        try {\n            const validatedData = signupSchema.parse(req.body);\n\n            const existingUser = await storage.getUserByEmail(\n                validatedData.email\n            );\n            if (existingUser) {\n                return res.status(400).json({ message: \"User already exists\" });\n            }\n\n            const hashedPassword = await bcrypt.hash(\n                validatedData.password,\n                10\n            );\n\n            // Public signup only creates super admins\n            // Company users must be created by admins via POST /api/users\n            const role = validatedData.email\n                .toLowerCase()\n                .includes(\"superadmin\")\n                ? \"super_admin\"\n                : null;\n\n            if (!role) {\n                return res.status(400).json({\n                    message:\n                        \"Public signup is restricted. Please contact your company administrator to create an account.\",\n                });\n            }\n\n            const user = await storage.createUser({\n                email: validatedData.email,\n                displayName: validatedData.displayName,\n                password: hashedPassword,\n                role,\n            });\n\n            const { password: _, ...userWithoutPassword } = user;\n            res.json(userWithoutPassword);\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    app.post(\"/api/auth/login\", async (req, res, next) => {\n        try {\n            const validatedData = loginSchema.parse(req.body);\n\n            const user = await storage.getUserByEmail(validatedData.email);\n            if (!user || !user.password) {\n                return res\n                    .status(401)\n                    .json({ message: \"Invalid email or password\" });\n            }\n\n            const isValidPassword = await bcrypt.compare(\n                validatedData.password,\n                user.password\n            );\n            if (!isValidPassword) {\n                return res\n                    .status(401)\n                    .json({ message: \"Invalid email or password\" });\n            }\n\n            const { password: _, ...userWithoutPassword } = user;\n\n            let companyProfileComplete = true;\n            if (user.role === \"company_admin\" && user.companyId) {\n                const company = await storage.getCompanyById(user.companyId);\n                if (company) {\n                    companyProfileComplete = !!(\n                        company.companyType &&\n                        company.designation &&\n                        company.address &&\n                        company.pincode &&\n                        company.city &&\n                        company.state &&\n                        company.country &&\n                        company.employees &&\n                        company.annualTurnover &&\n                        company.yearEstablished\n                    );\n                }\n            }\n\n            res.json({ ...userWithoutPassword, companyProfileComplete });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    app.post(\"/api/auth/signin\", async (req, res, next) => {\n        try {\n            const validatedData = firebaseSigninSchema.parse(req.body);\n\n            let user = await storage.getUserByFirebaseUid(\n                validatedData.firebaseUid\n            );\n\n            if (!user) {\n                user = await storage.getUserByEmail(validatedData.email);\n\n                if (!user) {\n                    // Firebase signin only creates super admins\n                    // Company users must be created by admins\n                    const role = validatedData.email\n                        .toLowerCase()\n                        .includes(\"superadmin\")\n                        ? \"super_admin\"\n                        : null;\n\n                    if (!role) {\n                        return res.status(400).json({\n                            message:\n                                \"Account not found. Please contact your company administrator to create an account.\",\n                        });\n                    }\n\n                    user = await storage.createUser({\n                        email: validatedData.email,\n                        displayName: validatedData.displayName,\n                        photoURL: validatedData.photoURL,\n                        firebaseUid: validatedData.firebaseUid,\n                        role,\n                    });\n                }\n            }\n\n            const { password: _, ...userWithoutPassword } = user;\n\n            let companyProfileComplete = true;\n            if (user.role === \"company_admin\" && user.companyId) {\n                const company = await storage.getCompanyById(user.companyId);\n                if (company) {\n                    companyProfileComplete = !!(\n                        company.companyType &&\n                        company.designation &&\n                        company.address &&\n                        company.pincode &&\n                        company.city &&\n                        company.state &&\n                        company.country &&\n                        company.employees &&\n                        company.annualTurnover &&\n                        company.yearEstablished\n                    );\n                }\n            }\n\n            res.json({ ...userWithoutPassword, companyProfileComplete });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    app.get(\"/api/users\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const { includeDeleted } = req.query;\n            let users = await storage.getAllUsers(includeDeleted === \"true\");\n\n            // Filter by company unless super_admin\n            if (requestingUser.role === \"super_admin\") {\n                // Super admins can see all users\n            } else if (requestingUser.companyId) {\n                // Company admins and members can only see users in their company\n                users = users.filter(\n                    (u) => u.companyId === requestingUser.companyId\n                );\n            } else {\n                // Users without a company can't see any users\n                users = [];\n            }\n\n            const usersWithoutPasswords = users.map(\n                ({ password: _, ...user }) => user\n            );\n            res.json(usersWithoutPasswords);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/users/:id\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res\n                    .status(404)\n                    .json({ message: \"Requesting user not found\" });\n            }\n\n            const user = await storage.getUserById(parseInt(req.params.id));\n            if (!user) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            // Company scoping: users can only view users in their company (or all if super_admin)\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                user.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const { password: _, ...userWithoutPassword } = user;\n            res.json(userWithoutPassword);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Get the assigned team leader for the current user\n    app.get(\"/api/team-leader/me\", requireAuth, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            // Only company members can use this endpoint\n            if (requestingUser.role !== \"company_member\") {\n                return res.status(403).json({\n                    message: \"Only company members can view their team leader\",\n                });\n            }\n\n            // Get the assigned team leader\n            const teamLeader = await storage.getTeamLeaderByMember(\n                requestingUser.id\n            );\n\n            if (!teamLeader) {\n                return res.status(404).json({ message: \"NOT_ASSIGNED\" });\n            }\n\n            // Return minimal leader payload (normalize null photoURL to undefined)\n            const leaderData = {\n                id: teamLeader.id,\n                displayName: teamLeader.displayName,\n                email: teamLeader.email,\n                photoURL: teamLeader.photoURL || undefined,\n            };\n\n            res.json(leaderData);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Team Leader: Get today's team attendance\n    app.get(\"/api/team-leader/team-attendance/today\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const user = await storage.getUserById(userId);\n            \n            if (!user) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n            \n            if (user.role !== \"team_leader\" && user.role !== \"company_admin\" && user.role !== \"super_admin\") {\n                return res.status(403).json({ message: \"Team leader access required\" });\n            }\n            \n            // Get all team members assigned to this team leader\n            const teamMembers = await storage.getTeamMembersByLeader(userId);\n            \n            // Get today's date in IST (Indian Standard Time) for consistency\n            const today = new Date();\n            const todayStr = today.toISOString().split('T')[0];\n            \n            // Get attendance records for each team member\n            const teamAttendance = await Promise.all(\n                teamMembers.map(async (member) => {\n                    const attendance = await storage.getAttendanceByUserAndDate(member.id, todayStr);\n                    return {\n                        userId: member.id,\n                        fullName: member.fullName || member.displayName || member.email,\n                        email: member.email,\n                        checkIn: attendance?.checkIn || null,\n                        checkOut: attendance?.checkOut || null,\n                        status: attendance?.status || null,\n                        workDuration: attendance?.workDuration || null,\n                    };\n                })\n            );\n            \n            res.json(teamAttendance);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/users/:id/role\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can update roles\" });\n            }\n\n            const targetUser = await storage.getUserById(\n                parseInt(req.params.id)\n            );\n            if (!targetUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            // Company scoping: admins can only update users in their company (or all if super_admin)\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                targetUser.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const { role } = req.body;\n            \n            // If demoting from team_leader, remove their team assignments\n            if (targetUser.role === \"team_leader\" && role === \"company_member\") {\n                await storage.removeAllTeamAssignmentsByLeader(parseInt(req.params.id));\n            }\n            \n            await storage.updateUserRole(parseInt(req.params.id), role);\n            res.json({ message: \"Role updated successfully\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Permanently delete a user and all their data\n    app.delete(\"/api/users/:id/permanent\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can permanently delete users\" });\n            }\n\n            const targetUser = await storage.getUserById(\n                parseInt(req.params.id)\n            );\n            if (!targetUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            // Company scoping: admins can only delete users in their company\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                targetUser.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            // Cannot delete company admins\n            if (targetUser.role === \"company_admin\") {\n                return res.status(403).json({ message: \"Cannot delete company admins\" });\n            }\n\n            // Delete all user data\n            await storage.deleteAllUserData(parseInt(req.params.id));\n            res.json({ message: \"User permanently deleted\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/users\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can create users\" });\n            }\n\n            const validatedData = insertUserSchema.parse(req.body);\n\n            const existingUser = await storage.getUserByEmail(\n                validatedData.email\n            );\n            if (existingUser) {\n                return res.status(400).json({ message: \"User already exists\" });\n            }\n\n            // Check slot availability for company admins\n            if (\n                requestingUser.role === \"company_admin\" &&\n                requestingUser.companyId\n            ) {\n                const company = await storage.getCompanyById(\n                    requestingUser.companyId\n                );\n                const users = await storage.getUsersByCompanyId(\n                    requestingUser.companyId\n                );\n\n                if (!company) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Company not found\" });\n                }\n\n                const adminCount = users.filter(\n                    (u) => u.role === \"company_admin\"\n                ).length;\n                const memberCount = users.filter(\n                    (u) =>\n                        u.role === \"company_member\" || u.role === \"team_leader\"\n                ).length;\n\n                if (\n                    validatedData.role === \"company_admin\" &&\n                    adminCount >= company.maxAdmins\n                ) {\n                    return res.status(400).json({\n                        message: `Admin slots full. Current: ${adminCount}/${company.maxAdmins}. Please upgrade your plan.`,\n                    });\n                }\n\n                // Team leaders and members count against maxMembers limit\n                if (\n                    (validatedData.role === \"company_member\" ||\n                        validatedData.role === \"team_leader\") &&\n                    memberCount >= company.maxMembers\n                ) {\n                    return res.status(400).json({\n                        message: `Member slots full (includes team leaders). Current: ${memberCount}/${company.maxMembers}. Please upgrade your plan.`,\n                    });\n                }\n\n                validatedData.companyId = requestingUser.companyId;\n            }\n\n            const hashedPassword = validatedData.password\n                ? await bcrypt.hash(validatedData.password, 10)\n                : undefined;\n            const user = await storage.createUser({\n                ...validatedData,\n                password: hashedPassword,\n            });\n\n            const { password: _, ...userWithoutPassword } = user;\n            res.json(userWithoutPassword);\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/users/:id/status\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can change user status\" });\n            }\n\n            const userId = parseInt(req.params.id);\n\n            if (userId === requestingUser.id) {\n                return res\n                    .status(400)\n                    .json({ message: \"Cannot change your own account status\" });\n            }\n\n            const targetUser = await storage.getUserById(userId);\n            if (!targetUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            // Company scoping: admins can only modify users in their company (or all if super_admin)\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                targetUser.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const { isActive } = req.body;\n            if (typeof isActive !== \"boolean\") {\n                return res\n                    .status(400)\n                    .json({ message: \"isActive must be a boolean\" });\n            }\n\n            await storage.toggleUserStatus(userId, isActive);\n\n            const { broadcast } = await import(\"./index\");\n            if (broadcast) {\n                if (!isActive) {\n                    broadcast({ type: \"USER_SUSPENDED\", userId });\n                }\n                broadcast({ type: \"USERS_UPDATED\" });\n            }\n\n            res.json({\n                message: `User ${\n                    isActive ? \"activated\" : \"suspended\"\n                } successfully`,\n            });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Team Assignment routes\n    app.post(\"/api/team-assignments\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can assign team members\" });\n            }\n\n            const { teamLeaderId, memberIds } = req.body;\n\n            if (!teamLeaderId || !memberIds || !Array.isArray(memberIds)) {\n                return res.status(400).json({\n                    message: \"Team leader ID and member IDs are required\",\n                });\n            }\n\n            const teamLeader = await storage.getUserById(teamLeaderId);\n            if (!teamLeader) {\n                return res\n                    .status(404)\n                    .json({ message: \"Team leader not found\" });\n            }\n\n            // Validate team leader role\n            if (teamLeader.role !== \"team_leader\") {\n                return res.status(400).json({\n                    message:\n                        \"User must have team_leader role to be assigned members\",\n                });\n            }\n\n            // Company scoping\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                teamLeader.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            // Get existing assignments to avoid duplicates\n            const existingMembers = await storage.getTeamMembersByLeader(\n                teamLeaderId\n            );\n            const existingMemberIds = new Set(existingMembers.map((m) => m.id));\n\n            const assignments = [];\n            const skipped = [];\n\n            for (const memberId of memberIds) {\n                // Skip if already assigned (either previously or earlier in this request)\n                if (existingMemberIds.has(memberId)) {\n                    skipped.push(memberId);\n                    continue;\n                }\n\n                const member = await storage.getUserById(memberId);\n                if (!member) {\n                    continue;\n                }\n\n                // Verify member is in same company\n                if (member.companyId !== teamLeader.companyId) {\n                    continue;\n                }\n\n                const assignment = await storage.createTeamAssignment({\n                    teamLeaderId,\n                    memberId,\n                    companyId: teamLeader.companyId as number,\n                });\n                assignments.push(assignment);\n\n                // Add to set to prevent duplicate assignments within same request\n                existingMemberIds.add(memberId);\n            }\n\n            res.json({\n                message: \"Team members assigned successfully\",\n                assignments,\n                skipped:\n                    skipped.length > 0\n                        ? `${skipped.length} members were already assigned`\n                        : undefined,\n            });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\n        \"/api/team-assignments/:teamLeaderId/members\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (!requestingUser) {\n                    return res.status(404).json({ message: \"User not found\" });\n                }\n\n                const teamLeaderId = parseInt(req.params.teamLeaderId);\n                const teamLeader = await storage.getUserById(teamLeaderId);\n\n                if (!teamLeader) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Team leader not found\" });\n                }\n\n                // Company scoping: ensure team leader is in same company (except super_admin)\n                if (\n                    requestingUser.role !== \"super_admin\" &&\n                    teamLeader.companyId !== requestingUser.companyId\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                // Additional role-based access control\n                if (\n                    requestingUser.role !== \"super_admin\" &&\n                    requestingUser.role !== \"company_admin\" &&\n                    requestingUser.id !== teamLeaderId\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                const members = await storage.getTeamMembersByLeader(\n                    teamLeaderId\n                );\n                res.json(members);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Get team attendance for today\n    app.get(\n        \"/api/team-assignments/:teamLeaderId/attendance/today\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (!requestingUser) {\n                    return res.status(404).json({ message: \"User not found\" });\n                }\n\n                const teamLeaderId = parseInt(req.params.teamLeaderId);\n                const teamLeader = await storage.getUserById(teamLeaderId);\n\n                if (!teamLeader) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Team leader not found\" });\n                }\n\n                // Company scoping: ensure team leader is in same company (except super_admin)\n                if (\n                    requestingUser.role !== \"super_admin\" &&\n                    teamLeader.companyId !== requestingUser.companyId\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                // Additional role-based access control\n                if (\n                    requestingUser.role !== \"super_admin\" &&\n                    requestingUser.role !== \"company_admin\" &&\n                    requestingUser.id !== teamLeaderId\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                // Get team members\n                const members = await storage.getTeamMembersByLeader(\n                    teamLeaderId\n                );\n                const memberIds = members.map((m) => m.id);\n\n                // Get today's attendance for all team members\n                const today = new Date().toISOString().split(\"T\")[0];\n                if (!teamLeader.companyId) {\n                    return res.json([]);\n                }\n\n                const allAttendance = await storage.getDailyAttendance(\n                    teamLeader.companyId,\n                    today\n                );\n                const teamAttendance = allAttendance.filter((record) =>\n                    memberIds.includes(record.userId)\n                );\n\n                res.json(teamAttendance);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.get(\n        \"/api/team-assignments/:teamLeaderId/attendance/reports\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (!requestingUser) {\n                    return res.status(404).json({ message: \"User not found\" });\n                }\n\n                const teamLeaderId = parseInt(req.params.teamLeaderId);\n\n                // Verify the requesting user is the team leader\n                if (requestingUser.id !== teamLeaderId) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                const teamLeader = await storage.getUserById(teamLeaderId);\n                if (!teamLeader || !teamLeader.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Team leader not found\" });\n                }\n\n                // Get team members\n                const members = await storage.getTeamMembersByLeader(\n                    teamLeaderId\n                );\n\n                // Get date range from query params (default to current month)\n                const now = new Date();\n                const startDate =\n                    (req.query.startDate as string) ||\n                    new Date(now.getFullYear(), now.getMonth(), 1)\n                        .toISOString()\n                        .split(\"T\")[0];\n                const endDate =\n                    (req.query.endDate as string) ||\n                    now.toISOString().split(\"T\")[0];\n\n                // Calculate stats for each team member\n                const memberStats = [];\n                for (const member of members) {\n                    const attendanceHistory =\n                        await storage.getAttendanceHistory(\n                            member.id,\n                            startDate,\n                            endDate\n                        );\n\n                    const presentDays = attendanceHistory.filter(\n                        (a) => a.status === \"present\" || a.status === \"late\"\n                    ).length;\n                    const absentDays = attendanceHistory.filter(\n                        (a) => a.status === \"absent\"\n                    ).length;\n                    const lateDays = attendanceHistory.filter(\n                        (a) => a.status === \"late\"\n                    ).length;\n\n                    // Calculate average working hours\n                    const totalMinutes = attendanceHistory\n                        .filter((a) => a.workDuration)\n                        .reduce((sum, a) => sum + (a.workDuration || 0), 0);\n                    const avgMinutes =\n                        attendanceHistory.length > 0\n                            ? Math.round(\n                                  totalMinutes / attendanceHistory.length\n                              )\n                            : 0;\n                    const avgHours =\n                        avgMinutes > 0\n                            ? `${Math.floor(avgMinutes / 60)}.${Math.round(\n                                  (avgMinutes % 60) / 6\n                              )}h`\n                            : \"0h\";\n\n                    // Determine trend (compare to previous period)\n                    const previousStartDate = new Date(\n                        new Date(startDate).getTime() -\n                            (new Date(endDate).getTime() -\n                                new Date(startDate).getTime())\n                    );\n                    const previousEndDate = startDate;\n                    const previousHistory = await storage.getAttendanceHistory(\n                        member.id,\n                        previousStartDate.toISOString().split(\"T\")[0],\n                        previousEndDate\n                    );\n\n                    const currentAttendanceRate =\n                        attendanceHistory.length > 0\n                            ? presentDays / attendanceHistory.length\n                            : 0;\n                    const previousAttendanceRate =\n                        previousHistory.length > 0\n                            ? previousHistory.filter(\n                                  (a) =>\n                                      a.status === \"present\" ||\n                                      a.status === \"late\"\n                              ).length / previousHistory.length\n                            : 0;\n\n                    let trend = \"stable\";\n                    if (currentAttendanceRate > previousAttendanceRate + 0.05)\n                        trend = \"up\";\n                    if (currentAttendanceRate < previousAttendanceRate - 0.05)\n                        trend = \"down\";\n\n                    memberStats.push({\n                        id: member.id,\n                        name: member.displayName,\n                        presentDays,\n                        absentDays,\n                        lateDays,\n                        avgHours,\n                        trend,\n                    });\n                }\n\n                // Calculate overall team stats\n                const totalPresent = memberStats.reduce(\n                    (sum, m) => sum + m.presentDays,\n                    0\n                );\n                const totalRecords = memberStats.reduce(\n                    (sum, m) => sum + m.presentDays + m.absentDays,\n                    0\n                );\n                const attendanceRate =\n                    totalRecords > 0\n                        ? ((totalPresent / totalRecords) * 100).toFixed(1)\n                        : \"0.0\";\n\n                const totalLate = memberStats.reduce(\n                    (sum, m) => sum + m.lateDays,\n                    0\n                );\n\n                // Calculate average working hours\n                const allAvgHours = memberStats.map((m) => {\n                    const hours = parseFloat(m.avgHours.replace(\"h\", \"\"));\n                    return isNaN(hours) ? 0 : hours;\n                });\n                const overallAvgHours =\n                    allAvgHours.length > 0\n                        ? (\n                              allAvgHours.reduce((a, b) => a + b, 0) /\n                              allAvgHours.length\n                          ).toFixed(1)\n                        : \"0.0\";\n\n                res.json({\n                    teamAttendanceRate: attendanceRate,\n                    avgWorkingHours: `${overallAvgHours}h`,\n                    lateArrivals: totalLate,\n                    memberStats,\n                });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.delete(\n        \"/api/team-assignments/:teamLeaderId/members/:memberId\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res.status(403).json({\n                        message: \"Only admins can remove team assignments\",\n                    });\n                }\n\n                const teamLeaderId = parseInt(req.params.teamLeaderId);\n                const memberId = parseInt(req.params.memberId);\n\n                // Verify team leader exists and is in same company\n                const teamLeader = await storage.getUserById(teamLeaderId);\n                if (!teamLeader) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Team leader not found\" });\n                }\n\n                // Company scoping: ensure team leader is in same company (except super_admin)\n                if (\n                    requestingUser.role !== \"super_admin\" &&\n                    teamLeader.companyId !== requestingUser.companyId\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                await storage.removeTeamAssignment(teamLeaderId, memberId);\n                res.json({ message: \"Team member removed successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.get(\"/api/team-assignments\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can view team assignments\" });\n            }\n\n            const companyId = requestingUser.companyId as number;\n            const assignments = await storage.getAllTeamAssignments(companyId);\n            res.json(assignments);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Company routes (Super Admin only)\n    app.post(\"/api/companies\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can create companies\",\n                });\n            }\n\n            const validatedCompany = insertCompanySchema.parse(req.body);\n            const company = await storage.createCompany(validatedCompany);\n            res.json(company);\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    app.get(\"/api/companies\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can view all companies\",\n                });\n            }\n\n            const companies = await storage.getAllCompanies();\n            res.json(companies);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/companies/:id\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can view company details\",\n                });\n            }\n\n            const company = await storage.getCompanyById(\n                parseInt(req.params.id)\n            );\n            if (!company) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n            res.json(company);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/companies/:id/users\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can view company users\",\n                });\n            }\n\n            const users = await storage.getUsersByCompanyId(\n                parseInt(req.params.id)\n            );\n            const usersWithoutPasswords = users.map(\n                ({ password: _, ...user }) => user\n            );\n            res.json(usersWithoutPasswords);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/companies/:id\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(401).json({ message: \"User not found\" });\n            }\n\n            const companyId = parseInt(req.params.id);\n\n            if (requestingUser.role === \"company_admin\") {\n                if (requestingUser.companyId !== companyId) {\n                    return res.status(403).json({\n                        message: \"You can only update your own company\",\n                    });\n                }\n            } else if (requestingUser.role !== \"super_admin\") {\n                return res\n                    .status(403)\n                    .json({ message: \"Insufficient permissions\" });\n            }\n\n            const updates = req.body;\n            await storage.updateCompany(companyId, updates);\n            res.json({ message: \"Company updated successfully\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.delete(\"/api/companies/:id\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can delete companies\",\n                });\n            }\n\n            await storage.deleteCompany(parseInt(req.params.id));\n\n            await storage.createAdminActivityLog({\n                actionType: \"delete_company\",\n                performedBy: requestingUser.id,\n                targetCompanyId: parseInt(req.params.id),\n                details: `Company ${req.params.id} deleted`,\n            });\n\n            res.json({ message: \"Company deleted successfully\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Super Admin Dashboard Routes\n    app.get(\"/api/super-admin/companies-with-stats\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const companiesWithStats = await storage.getAllCompaniesWithStats();\n            res.json(companiesWithStats);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/super-admin/companies/:id/stats\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const companyStats = await storage.getCompanyWithStats(\n                parseInt(req.params.id)\n            );\n            if (!companyStats) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n            res.json(companyStats);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\n        \"/api/super-admin/companies/:id/suspend\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                await storage.suspendCompany(\n                    parseInt(req.params.id),\n                    requestingUser.id\n                );\n                res.json({ message: \"Company suspended successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.post(\n        \"/api/super-admin/companies/:id/reactivate\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                await storage.reactivateCompany(\n                    parseInt(req.params.id),\n                    requestingUser.id\n                );\n                res.json({ message: \"Company reactivated successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.get(\"/api/super-admin/analytics\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const analytics = await storage.getSuperAdminAnalytics();\n            res.json(analytics);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/super-admin/activity-logs\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const limit = req.query.limit\n                ? parseInt(req.query.limit as string)\n                : undefined;\n            const logs = await storage.getAllAdminActivityLogs(limit);\n            res.json(logs);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\n        \"/api/super-admin/activity-logs/company/:companyId\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                const logs = await storage.getAdminActivityLogsByCompany(\n                    parseInt(req.params.companyId)\n                );\n                res.json(logs);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.get(\"/api/super-admin/payments\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const { startDate, endDate, status } = req.query;\n\n            let payments;\n            if (startDate && endDate) {\n                payments = await storage.getPaymentsByDateRange(\n                    new Date(startDate as string),\n                    new Date(endDate as string)\n                );\n            } else if (status) {\n                payments = await storage.getPaymentsByStatus(status as string);\n            } else {\n                payments = await storage.getAllCompanyPayments();\n            }\n\n            res.json(payments);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Company Admin routes (for managing their own company)\n    app.get(\"/api/my-company\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || !requestingUser.companyId) {\n                return res\n                    .status(404)\n                    .json({ message: \"User not associated with a company\" });\n            }\n\n            const company = await storage.getCompanyById(\n                requestingUser.companyId\n            );\n            if (!company) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            const users = await storage.getUsersByCompanyId(\n                requestingUser.companyId\n            );\n            const adminCount = users.filter(\n                (u) => u.role === \"company_admin\"\n            ).length;\n            const memberCount = users.filter(\n                (u) => u.role === \"company_member\" || u.role === \"team_leader\"\n            ).length;\n\n            res.json({\n                ...company,\n                currentAdmins: adminCount,\n                currentMembers: memberCount,\n            });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/my-company\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"company_admin\") {\n                return res.status(403).json({\n                    message: \"Only company admins can update company settings\",\n                });\n            }\n\n            if (!requestingUser.companyId) {\n                return res\n                    .status(404)\n                    .json({ message: \"User not associated with a company\" });\n            }\n\n            const updates = req.body;\n            await storage.updateCompany(requestingUser.companyId, updates);\n            res.json({ message: \"Company updated successfully\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Task routes\n    app.post(\"/api/tasks\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || !requestingUser.companyId) {\n                return res\n                    .status(403)\n                    .json({ message: \"User must belong to a company\" });\n            }\n\n            const validatedTask = insertTaskSchema.parse({\n                ...req.body,\n                companyId: requestingUser.companyId,\n            });\n            const task = await storage.createTask(validatedTask);\n\n            if (validatedTask.assignedTo) {\n                const assignedByUser = validatedTask.assignedBy\n                    ? await storage.getUserById(validatedTask.assignedBy)\n                    : null;\n                const assignedToUser = await storage.getUserById(\n                    validatedTask.assignedTo\n                );\n\n                let notificationMessageType:\n                    | \"team_leader_to_employee\"\n                    | \"admin_to_team_leader\"\n                    | \"admin_to_employee\"\n                    | \"employee_to_team_leader\" = \"team_leader_to_employee\";\n                if (assignedByUser && assignedToUser) {\n                    if (\n                        assignedByUser.role === \"company_admin\" &&\n                        assignedToUser.role === \"team_leader\"\n                    ) {\n                        notificationMessageType = \"admin_to_team_leader\";\n                    } else if (\n                        assignedByUser.role === \"company_admin\" &&\n                        assignedToUser.role === \"company_member\"\n                    ) {\n                        notificationMessageType = \"admin_to_employee\";\n                    } else if (\n                        assignedByUser.role === \"team_leader\" &&\n                        assignedToUser.role === \"company_member\"\n                    ) {\n                        notificationMessageType = \"team_leader_to_employee\";\n                    }\n                }\n\n                await storage.createMessage({\n                    senderId: validatedTask.assignedBy || 0,\n                    receiverId: validatedTask.assignedTo,\n                    message: `New task assigned: ${validatedTask.title}`,\n                    messageType: notificationMessageType,\n                    relatedTaskId: task.id,\n                    readStatus: false,\n                });\n            }\n\n            res.json(task);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/tasks\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const { userId, assignedBy } = req.query;\n\n            if (userId) {\n                const tasks = await storage.getTasksByUserId(\n                    parseInt(userId as string)\n                );\n                // Filter by company unless super_admin\n                if (requestingUser.role === \"super_admin\") {\n                    res.json(tasks);\n                } else {\n                    res.json(\n                        tasks.filter(\n                            (task) =>\n                                task.companyId === requestingUser.companyId\n                        )\n                    );\n                }\n            } else if (assignedBy) {\n                const tasks = await storage.getTasksByAssignedBy(\n                    parseInt(assignedBy as string)\n                );\n                // Filter by company unless super_admin\n                if (requestingUser.role === \"super_admin\") {\n                    res.json(tasks);\n                } else {\n                    res.json(\n                        tasks.filter(\n                            (task) =>\n                                task.companyId === requestingUser.companyId\n                        )\n                    );\n                }\n            } else if (requestingUser.role === \"super_admin\") {\n                const tasks = await storage.getAllTasks();\n                res.json(tasks);\n            } else if (requestingUser.role === \"company_admin\") {\n                // Admin sees all tasks in their company\n                const tasks = await storage.getTasksByCompanyId(\n                    requestingUser.companyId\n                );\n                res.json(tasks);\n            } else if (requestingUser.role === \"team_leader\") {\n                // Team leader sees tasks assigned to their team members AND tasks assigned to them\n                const teamMembers = await storage.getTeamMembersByLeader(\n                    requestingUser.id\n                );\n                const teamMemberIds = teamMembers.map((m) => m.id);\n                const allTasks = await storage.getTasksByCompanyId(\n                    requestingUser.companyId\n                );\n                res.json(\n                    allTasks.filter(\n                        (task) =>\n                            teamMemberIds.includes(task.assignedTo) ||\n                            task.assignedTo === requestingUser.id\n                    )\n                );\n            } else if (requestingUser.role === \"company_member\") {\n                // Employee sees only their assigned tasks\n                const tasks = await storage.getTasksByUserId(requestingUser.id);\n                res.json(tasks);\n            } else {\n                res.json([]);\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/tasks/:id\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const task = await storage.getTaskById(parseInt(req.params.id));\n            if (!task) {\n                return res.status(404).json({ message: \"Task not found\" });\n            }\n\n            // Check company access unless super_admin\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                task.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            res.json(task);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/tasks/:id/status\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const task = await storage.getTaskById(parseInt(req.params.id));\n            if (!task) {\n                return res.status(404).json({ message: \"Task not found\" });\n            }\n\n            // Check company access unless super_admin\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                task.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const { status } = req.body;\n            console.log(\n                `[TaskStatus] Updating task ${parseInt(\n                    req.params.id\n                )} to status: ${status}`\n            );\n\n            // Set completedAt when status changes to completed\n            const updates: any = { status };\n            if (status === \"completed\") {\n                updates.completedAt = new Date();\n            }\n\n            await storage.updateTask(parseInt(req.params.id), updates);\n            console.log(\n                `[TaskStatus] Broadcasting task update: ${parseInt(\n                    req.params.id\n                )} -> ${status}`\n            );\n            broadcast({\n                type: \"task_updated\",\n                taskId: parseInt(req.params.id),\n                status,\n            });\n            res.json({ message: \"Task status updated\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Get task details with time logs and rework count\n    app.get(\"/api/tasks/:id/details\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const task = await storage.getTaskById(parseInt(req.params.id));\n            if (!task) {\n                return res.status(404).json({ message: \"Task not found\" });\n            }\n\n            // Check company access unless super_admin\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                task.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            // Get time logs for the user the task is assigned to\n            const timeLogs = await storage.getTaskTimeLogs(\n                parseInt(req.params.id),\n                task.assignedTo\n            );\n\n            // Aggregate all time logs for this task\n            let totalSeconds = 0;\n            let oldTimeSeconds = 0;\n            let newTimeSeconds = 0;\n\n            timeLogs.forEach((log) => {\n                if (log.totalSeconds) {\n                    totalSeconds += log.totalSeconds;\n                    if (log.oldTimeSeconds) {\n                        oldTimeSeconds += log.oldTimeSeconds;\n                    }\n                    if (log.newTimeSeconds) {\n                        newTimeSeconds += log.newTimeSeconds;\n                    }\n                }\n            });\n\n            // Get rework history with dates from message history\n            const messages = await storage.getAllMessages();\n            const reworkHistory = messages\n                .filter(\n                    (m) =>\n                        m.relatedTaskId === parseInt(req.params.id) &&\n                        m.message.includes(\"returned\")\n                )\n                .map((m) => ({\n                    date: m.createdAt,\n                    message: m.message,\n                }))\n                .sort(\n                    (a, b) =>\n                        new Date(b.date).getTime() - new Date(a.date).getTime()\n                );\n\n            res.json({\n                task,\n                timeLogs:\n                    totalSeconds > 0\n                        ? {\n                              totalSeconds,\n                              oldTimeSeconds,\n                              newTimeSeconds,\n                          }\n                        : null,\n                reworkHistory,\n                returnCount: reworkHistory.length,\n            });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/tasks/:id\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const task = await storage.getTaskById(parseInt(req.params.id));\n            if (!task) {\n                return res.status(404).json({ message: \"Task not found\" });\n            }\n\n            // Check company access unless super_admin\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                task.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const updates = req.body;\n            // Convert deadline string to Date object if present\n            if (updates.deadline && typeof updates.deadline === \"string\") {\n                updates.deadline = new Date(updates.deadline);\n            }\n            await storage.updateTask(parseInt(req.params.id), updates);\n\n            // Get the updated task to broadcast the actual status\n            const updatedTask = await storage.getTaskById(\n                parseInt(req.params.id)\n            );\n            if (updatedTask) {\n                broadcast({\n                    type: \"task_updated\",\n                    taskId: parseInt(req.params.id),\n                    status: updatedTask.status,\n                });\n            }\n\n            res.json({ message: \"Task updated\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.delete(\"/api/tasks/:id\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const task = await storage.getTaskById(parseInt(req.params.id));\n            if (!task) {\n                return res.status(404).json({ message: \"Task not found\" });\n            }\n\n            // Check company access unless super_admin\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                task.companyId !== requestingUser.companyId\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            await storage.deleteTask(parseInt(req.params.id));\n            broadcast({\n                type: \"task_deleted\",\n                taskId: parseInt(req.params.id),\n            });\n            res.json({ message: \"Task deleted\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Task timer routes\n    app.get(\"/api/tasks/:id/timer\", async (req, res, next) => {\n        try {\n            const { userId, date } = req.query;\n            if (!userId || !date) {\n                return res\n                    .status(400)\n                    .json({ message: \"userId and date are required\" });\n            }\n\n            const timeLog = await storage.getTaskTimeLog(\n                parseInt(req.params.id),\n                parseInt(userId as string),\n                date as string\n            );\n            res.json(timeLog);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/tasks/:id/timer/start\", async (req, res, next) => {\n        try {\n            const { userId, date } = req.body;\n            if (!userId || !date) {\n                return res\n                    .status(400)\n                    .json({ message: \"userId and date are required\" });\n            }\n\n            const timeLog = await storage.startTaskTimer(\n                parseInt(req.params.id),\n                userId,\n                date\n            );\n            res.json(timeLog);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/tasks/:id/timer/pause\", async (req, res, next) => {\n        try {\n            const { userId, date } = req.body;\n            if (!userId || !date) {\n                return res\n                    .status(400)\n                    .json({ message: \"userId and date are required\" });\n            }\n\n            const timeLog = await storage.pauseTaskTimer(\n                parseInt(req.params.id),\n                userId,\n                date\n            );\n            res.json(timeLog);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/tasks/:id/timer/complete\", async (req, res, next) => {\n        try {\n            const { userId, date } = req.body;\n            if (!userId || !date) {\n                return res\n                    .status(400)\n                    .json({ message: \"userId and date are required\" });\n            }\n\n            const timeLog = await storage.completeTaskTimer(\n                parseInt(req.params.id),\n                userId,\n                date\n            );\n            res.json(timeLog);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/tasks/:id/timer/logs\", async (req, res, next) => {\n        try {\n            const { userId } = req.query;\n            if (!userId) {\n                return res.status(400).json({ message: \"userId is required\" });\n            }\n\n            const timeLogs = await storage.getTaskTimeLogs(\n                parseInt(req.params.id),\n                parseInt(userId as string)\n            );\n            res.json(timeLogs);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Report routes\n    app.post(\"/api/reports\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || !requestingUser.companyId) {\n                return res\n                    .status(403)\n                    .json({ message: \"User must belong to a company\" });\n            }\n\n            const validatedReport = insertReportSchema.parse({\n                ...req.body,\n                companyId: requestingUser.companyId,\n            });\n            const report = await storage.createReport(validatedReport);\n\n            // Get user information and company admin email for notification\n            const user = await storage.getUserById(validatedReport.userId);\n            if (user) {\n                // Get company to find admin email\n                const company = await storage.getCompanyById(user.companyId!);\n                if (company && company.email) {\n                    // Send email notification to company admin asynchronously (don't wait for it)\n                    sendReportNotification({\n                        adminEmail: company.email,\n                        userName: user.displayName,\n                        reportType: validatedReport.reportType,\n                        plannedTasks: validatedReport.plannedTasks,\n                        completedTasks: validatedReport.completedTasks,\n                        pendingTasks: validatedReport.pendingTasks,\n                        notes: validatedReport.notes,\n                        createdAt: report.createdAt,\n                    }).catch((err) =>\n                        console.error(\"Failed to send email notification:\", err)\n                    );\n                }\n            }\n\n            res.json(report);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/reports\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const { userId, startDate, endDate } = req.query;\n\n            if (userId && startDate && endDate) {\n                const reports = await storage.getReportsByUserAndDate(\n                    parseInt(userId as string),\n                    new Date(startDate as string),\n                    new Date(endDate as string)\n                );\n                // Filter by company unless super_admin\n                if (requestingUser.role === \"super_admin\") {\n                    res.json(reports);\n                } else {\n                    res.json(\n                        reports.filter(\n                            (report) =>\n                                report.companyId === requestingUser.companyId\n                        )\n                    );\n                }\n            } else if (userId) {\n                const reports = await storage.getReportsByUserId(\n                    parseInt(userId as string)\n                );\n                // Filter by company unless super_admin\n                if (requestingUser.role === \"super_admin\") {\n                    res.json(reports);\n                } else {\n                    res.json(\n                        reports.filter(\n                            (report) =>\n                                report.companyId === requestingUser.companyId\n                        )\n                    );\n                }\n            } else if (startDate && endDate) {\n                const reports = await storage.getReportsByDate(\n                    new Date(startDate as string),\n                    new Date(endDate as string)\n                );\n                // Filter by company unless super_admin\n                if (requestingUser.role === \"super_admin\") {\n                    res.json(reports);\n                } else {\n                    res.json(\n                        reports.filter(\n                            (report) =>\n                                report.companyId === requestingUser.companyId\n                        )\n                    );\n                }\n            } else if (requestingUser.role === \"super_admin\") {\n                const reports = await storage.getAllReports();\n                res.json(reports);\n            } else if (requestingUser.companyId) {\n                const reports = await storage.getReportsByCompanyId(\n                    requestingUser.companyId\n                );\n                res.json(reports);\n            } else {\n                res.json([]);\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Message routes\n    app.post(\"/api/messages\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const receiverUser = await storage.getUserById(req.body.receiverId);\n            if (!receiverUser) {\n                return res.status(404).json({ message: \"Receiver not found\" });\n            }\n\n            // Same-company check: ensure both users belong to the same company\n            if (\n                requestingUser.companyId !== receiverUser.companyId &&\n                requestingUser.role !== \"super_admin\"\n            ) {\n                return res.status(403).json({\n                    message: \"Cannot send messages across different companies\",\n                });\n            }\n\n            // Determine message type based on sender and receiver roles\n            let messageType = \"team_leader_to_employee\";\n\n            // Super admin sending messages\n            if (\n                requestingUser.role === \"super_admin\" &&\n                receiverUser.role === \"team_leader\"\n            ) {\n                messageType = \"admin_to_team_leader\";\n            } else if (\n                requestingUser.role === \"super_admin\" &&\n                receiverUser.role === \"company_member\"\n            ) {\n                messageType = \"admin_to_employee\";\n            } else if (\n                requestingUser.role === \"super_admin\" &&\n                receiverUser.role === \"company_admin\"\n            ) {\n                messageType = \"admin_to_admin\";\n            }\n            // Company admin sending messages\n            else if (\n                requestingUser.role === \"company_admin\" &&\n                receiverUser.role === \"team_leader\"\n            ) {\n                messageType = \"admin_to_team_leader\";\n            } else if (\n                requestingUser.role === \"company_admin\" &&\n                receiverUser.role === \"company_member\"\n            ) {\n                messageType = \"admin_to_employee\";\n            }\n            // Team leader sending messages\n            else if (\n                requestingUser.role === \"team_leader\" &&\n                receiverUser.role === \"company_member\"\n            ) {\n                messageType = \"team_leader_to_employee\";\n            } else if (\n                requestingUser.role === \"team_leader\" &&\n                receiverUser.role === \"company_admin\"\n            ) {\n                messageType = \"team_leader_to_admin\";\n            }\n            // Employee (company member) sending messages\n            else if (\n                requestingUser.role === \"company_member\" &&\n                receiverUser.role === \"team_leader\"\n            ) {\n                messageType = \"employee_to_team_leader\";\n            } else if (\n                requestingUser.role === \"company_member\" &&\n                receiverUser.role === \"company_admin\"\n            ) {\n                messageType = \"employee_to_admin\";\n            }\n\n            // Authorization: Team leaders can message their team members and admins, employees can reply to their team leader or admin\n            if (requestingUser.role === \"team_leader\") {\n                // Team leader can message admins or their team members\n                if (\n                    receiverUser.role !== \"company_admin\" &&\n                    receiverUser.role !== \"super_admin\"\n                ) {\n                    // Check if receiver is in their team\n                    const teamMembers = await storage.getTeamMembersByLeader(\n                        requestingUser.id\n                    );\n                    const teamMemberIds = teamMembers.map((m) => m.id);\n                    if (!teamMemberIds.includes(receiverUser.id)) {\n                        return res.status(403).json({\n                            message:\n                                \"You can only message your team members or admins\",\n                        });\n                    }\n                }\n            } else if (requestingUser.role === \"company_member\") {\n                // Employee replying to team leader - check if sender is their team leader\n                const teamAssignments =\n                    await storage.getTeamAssignmentsByMemberId(\n                        requestingUser.id\n                    );\n                const leaderIds = teamAssignments.map((t) => t.teamLeaderId);\n                if (\n                    !leaderIds.includes(receiverUser.id) ||\n                    receiverUser.role !== \"team_leader\"\n                ) {\n                    return res.status(403).json({\n                        message: \"You can only reply to your team leader\",\n                    });\n                }\n            } else if (\n                requestingUser.role !== \"super_admin\" &&\n                requestingUser.role !== \"company_admin\"\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Unauthorized to send messages\" });\n            }\n\n            const messageData = {\n                senderId: requestingUser.id,\n                receiverId: req.body.receiverId,\n                message: req.body.message,\n                messageType,\n                relatedTaskId: req.body.relatedTaskId,\n                readStatus: false,\n            };\n\n            const validatedMessage = insertMessageSchema.parse(messageData);\n            const message = await storage.createMessage(validatedMessage);\n\n            // Broadcast new message via WebSocket\n            const { broadcast } = await import(\"./index.js\");\n            broadcast({\n                type: \"NEW_MESSAGE\",\n                data: {\n                    ...message,\n                    senderName: requestingUser.displayName,\n                    receiverName: receiverUser.displayName,\n                },\n            });\n\n            // Send push notification to receiver\n            sendPushNotificationToUser(\n                message.receiverId,\n                \"New Message\",\n                `${requestingUser.displayName}: ${message.message.substring(\n                    0,\n                    50\n                )}${message.message.length > 50 ? \"...\" : \"\"}`,\n                {\n                    messageId: message.id.toString(),\n                    url: \"/user/messages\",\n                },\n                storage\n            ).catch((error) =>\n                console.error(\"Failed to send push notification:\", error)\n            );\n\n            res.json(message);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/messages\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const { receiverId, unreadOnly } = req.query;\n\n            if (receiverId) {\n                // Only super_admin can query other users' messages\n                if (\n                    requestingUser.role !== \"super_admin\" &&\n                    parseInt(receiverId as string) !== requestingUser.id\n                ) {\n                    return res.status(403).json({\n                        message: \"You can only view your own messages\",\n                    });\n                }\n\n                const messages =\n                    unreadOnly === \"true\"\n                        ? await storage.getUnreadMessagesByReceiverId(\n                              parseInt(receiverId as string)\n                          )\n                        : await storage.getMessagesByReceiverId(\n                              parseInt(receiverId as string)\n                          );\n                res.json(messages);\n            } else if (requestingUser.role === \"super_admin\") {\n                const messages = await storage.getAllMessages();\n                res.json(messages);\n            } else {\n                // Return all messages where user is either sender or receiver\n                const allMessages = await storage.getAllMessages();\n                const userMessages = allMessages.filter(\n                    (msg) =>\n                        msg.senderId === requestingUser.id ||\n                        msg.receiverId === requestingUser.id\n                );\n                res.json(userMessages);\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/messages/:id/read\", async (req, res, next) => {\n        try {\n            await storage.markMessageAsRead(parseInt(req.params.id));\n            res.json({ message: \"Message marked as read\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Rating routes\n    app.post(\"/api/ratings\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const targetUser = await storage.getUserById(req.body.userId);\n            if (!targetUser) {\n                return res\n                    .status(404)\n                    .json({ message: \"Target user not found\" });\n            }\n\n            // Prevent self-rating\n            if (requestingUser.id === req.body.userId) {\n                return res\n                    .status(403)\n                    .json({ message: \"You cannot rate yourself\" });\n            }\n\n            // Authorization checks\n            if (requestingUser.role === \"team_leader\") {\n                // Team leader can only rate their team members (not themselves or other leaders)\n                const teamMembers = await storage.getTeamMembersByLeader(\n                    requestingUser.id\n                );\n                const teamMemberIds = teamMembers\n                    .map((m) => m.id)\n                    .filter((id) => id !== requestingUser.id);\n                if (!teamMemberIds.includes(req.body.userId)) {\n                    return res.status(403).json({\n                        message: \"You can only rate your team members\",\n                    });\n                }\n                // Ensure target is a team member, not another leader\n                if (\n                    targetUser.role === \"team_leader\" ||\n                    targetUser.role === \"company_admin\" ||\n                    targetUser.role === \"super_admin\"\n                ) {\n                    return res\n                        .status(403)\n                        .json({ message: \"You can only rate team members\" });\n                }\n            } else if (requestingUser.role === \"company_admin\") {\n                // Admin can rate both team leaders and employees in their company\n                if (targetUser.companyId !== requestingUser.companyId) {\n                    return res.status(403).json({\n                        message: \"You can only rate users in your company\",\n                    });\n                }\n                if (\n                    targetUser.role !== \"team_leader\" &&\n                    targetUser.role !== \"company_member\"\n                ) {\n                    return res.status(403).json({\n                        message: \"You can only rate team leaders and employees\",\n                    });\n                }\n            } else {\n                // Super admins can also rate both team leaders and employees\n                if (\n                    targetUser.role !== \"team_leader\" &&\n                    targetUser.role !== \"company_member\"\n                ) {\n                    return res.status(403).json({\n                        message: \"You can only rate team leaders and employees\",\n                    });\n                }\n            }\n\n            const ratingData = {\n                userId: req.body.userId,\n                ratedBy: requestingUser.id,\n                rating: req.body.rating,\n                feedback: req.body.feedback,\n                period: req.body.period,\n            };\n\n            const validatedRating = insertRatingSchema.parse(ratingData);\n\n            try {\n                const rating = await storage.createRating(validatedRating);\n\n                // Ratings are now shown only in the Ratings Section, not in messages\n                res.json(rating);\n            } catch (dbError: any) {\n                // Catch unique constraint violation (PostgreSQL error code 23505)\n                if (\n                    dbError.code === \"23505\" ||\n                    dbError.message?.includes(\"unique_rating_per_period\")\n                ) {\n                    return res.status(409).json({\n                        message: `You have already rated this user for the ${validatedRating.period} period`,\n                    });\n                }\n                throw dbError;\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/ratings\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const { userId, latest } = req.query;\n\n            if (userId && latest === \"true\") {\n                // Verify target user exists and belongs to same company\n                const ratedUser = await storage.getUserById(\n                    parseInt(userId as string)\n                );\n                if (\n                    !ratedUser ||\n                    ratedUser.companyId !== requestingUser.companyId\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                const rating = await storage.getLatestRatingByUserId(\n                    parseInt(userId as string)\n                );\n                res.json(rating);\n            } else if (userId) {\n                // Verify target user exists and belongs to same company\n                const ratedUser = await storage.getUserById(\n                    parseInt(userId as string)\n                );\n                if (\n                    !ratedUser ||\n                    ratedUser.companyId !== requestingUser.companyId\n                ) {\n                    return res.json([]);\n                }\n\n                const ratings = await storage.getRatingsByUserId(\n                    parseInt(userId as string)\n                );\n                res.json(ratings);\n            } else if (requestingUser.role === \"super_admin\") {\n                const ratings = await storage.getAllRatings();\n                res.json(ratings);\n            } else if (requestingUser.companyId) {\n                // Return ratings for users in the same company\n                const companyUsers = await storage.getUsersByCompanyId(\n                    requestingUser.companyId\n                );\n                const companyUserIds = companyUsers.map((u) => u.id);\n                const allRatings = await storage.getAllRatings();\n                const companyRatings = allRatings.filter((r) =>\n                    companyUserIds.includes(r.userId)\n                );\n                res.json(companyRatings);\n            } else {\n                res.json([]);\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Feedback routes\n    app.post(\"/api/feedbacks\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || !requestingUser.companyId) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            // Validate request body first\n            const validatedInput = z\n                .object({\n                    recipientType: z.enum([\"Admin\", \"TeamLeader\", \"Employee\"]),\n                    message: z.string().min(1, \"Message is required\"),\n                })\n                .parse(req.body);\n\n            const feedbackData = {\n                companyId: requestingUser.companyId,\n                submittedBy: requestingUser.id,\n                recipientType: validatedInput.recipientType,\n                message: validatedInput.message,\n                adminResponse: null,\n            };\n\n            const validatedFeedback = insertFeedbackSchema.parse(feedbackData);\n            const feedback = await storage.createFeedback(validatedFeedback);\n\n            res.json(feedback);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/feedbacks\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const { submittedBy } = req.query;\n\n            let feedbacks;\n            if (submittedBy) {\n                // Only allow users to query their own feedback or admins to query anyone's\n                const targetUserId = parseInt(submittedBy as string);\n                if (\n                    targetUserId !== requestingUser.id &&\n                    requestingUser.role !== \"super_admin\" &&\n                    requestingUser.role !== \"company_admin\"\n                ) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only view your own submitted feedback\",\n                    });\n                }\n\n                const targetUser = await storage.getUserById(targetUserId);\n                if (\n                    !targetUser ||\n                    targetUser.companyId !== requestingUser.companyId\n                ) {\n                    return res.json([]);\n                }\n                feedbacks = await storage.getFeedbacksByUserId(targetUserId);\n            } else if (requestingUser.role === \"super_admin\") {\n                feedbacks = await storage.getAllFeedbacks();\n            } else if (\n                requestingUser.role === \"company_admin\" &&\n                requestingUser.companyId\n            ) {\n                // Admins see all feedbacks in their company\n                feedbacks = await storage.getFeedbacksByCompanyId(\n                    requestingUser.companyId\n                );\n            } else if (\n                requestingUser.role === \"team_leader\" &&\n                requestingUser.companyId\n            ) {\n                // Team leaders see feedbacks intended for them (recipientType = 'TeamLeader')\n                const allCompanyFeedbacks =\n                    await storage.getFeedbacksByCompanyId(\n                        requestingUser.companyId\n                    );\n                feedbacks = allCompanyFeedbacks.filter(\n                    (f) => f.recipientType === \"TeamLeader\"\n                );\n            } else {\n                // Regular users see their own submitted feedbacks\n                feedbacks = await storage.getFeedbacksByUserId(\n                    requestingUser.id\n                );\n            }\n\n            // Enrich feedbacks with submitter information\n            const enrichedFeedbacks = await Promise.all(\n                feedbacks.map(async (feedback) => {\n                    const submitter = await storage.getUserById(\n                        feedback.submittedBy\n                    );\n                    return {\n                        ...feedback,\n                        submitterName: submitter?.displayName || null,\n                        submitterRole: submitter?.role || null,\n                    };\n                })\n            );\n\n            res.json(enrichedFeedbacks);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/feedbacks/:id/respond\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can respond to feedback\" });\n            }\n\n            // Validate admin response\n            const validatedInput = z\n                .object({\n                    adminResponse: z.enum([\n                        \"Good\",\n                        \"Bad\",\n                        \"Excellent\",\n                        \"Satisfactory\",\n                        \"Needs Improvement\",\n                    ]),\n                })\n                .parse(req.body);\n\n            // Get feedback by ID\n            const feedbackId = parseInt(req.params.id);\n            if (isNaN(feedbackId)) {\n                return res.status(404).json({ message: \"Feedback not found\" });\n            }\n\n            const feedback = await storage.getFeedbackById(feedbackId);\n\n            // Return generic 404 to prevent ID enumeration\n            if (!feedback) {\n                return res.status(404).json({ message: \"Feedback not found\" });\n            }\n\n            // Verify company scoping (super_admin can respond to any, company_admin only to their company's)\n            if (\n                requestingUser.role === \"company_admin\" &&\n                feedback.companyId !== requestingUser.companyId\n            ) {\n                return res.status(404).json({ message: \"Feedback not found\" });\n            }\n\n            await storage.respondToFeedback(\n                feedbackId,\n                validatedInput.adminResponse\n            );\n            res.json({ message: \"Response sent successfully\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // File upload routes\n    app.post(\"/api/files\", async (req, res, next) => {\n        try {\n            const validatedFile = insertFileUploadSchema.parse(req.body);\n            const file = await storage.createFileUpload(validatedFile);\n            res.json(file);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/files\", async (req, res, next) => {\n        try {\n            const { userId, reportId } = req.query;\n\n            if (userId) {\n                const files = await storage.getFilesByUserId(\n                    parseInt(userId as string)\n                );\n                res.json(files);\n            } else if (reportId) {\n                const files = await storage.getFilesByReportId(\n                    parseInt(reportId as string)\n                );\n                res.json(files);\n            } else {\n                const files = await storage.getAllFiles();\n                res.json(files);\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Archive routes\n    app.post(\"/api/archive\", async (req, res, next) => {\n        try {\n            const { month, year } = req.body;\n            await storage.archiveReports(month, year);\n            res.json({ message: \"Reports archived successfully\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/archive\", async (req, res, next) => {\n        try {\n            const { userId } = req.query;\n            const archives = await storage.getArchivedReports(\n                userId ? parseInt(userId as string) : undefined\n            );\n            res.json(archives);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Dashboard stats\n    app.get(\"/api/dashboard/stats\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n\n            let companyId: number | undefined;\n\n            if (requestingUserId) {\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n\n                if (\n                    requestingUser &&\n                    requestingUser.role !== \"super_admin\" &&\n                    requestingUser.companyId\n                ) {\n                    companyId = requestingUser.companyId;\n                }\n            }\n\n            const stats = await storage.getDashboardStats(companyId);\n            res.json(stats);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Group message routes\n    app.post(\"/api/group-messages\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can send announcements\" });\n            }\n\n            if (!requestingUser.companyId) {\n                return res\n                    .status(403)\n                    .json({ message: \"User must belong to a company\" });\n            }\n\n            const messageData = {\n                companyId: requestingUser.companyId,\n                senderId: requestingUser.id,\n                title: req.body.title,\n                message: req.body.message,\n            };\n\n            const validatedMessage =\n                insertGroupMessageSchema.parse(messageData);\n            const message = await storage.createGroupMessage(validatedMessage);\n\n            // Broadcast new group message via WebSocket\n            const { broadcast } = await import(\"./index.js\");\n            broadcast({\n                type: \"NEW_GROUP_MESSAGE\",\n                data: {\n                    ...message,\n                    senderName: requestingUser.displayName,\n                },\n            });\n\n            // Send push notification to all company users\n            const companyUsers = await storage.getUsersByCompanyId(\n                requestingUser.companyId\n            );\n            const otherUsers = companyUsers.filter(\n                (u) => u.id !== requestingUser.id\n            );\n            for (const user of otherUsers) {\n                sendPushNotificationToUser(\n                    user.id,\n                    message.title,\n                    message.message.substring(0, 100),\n                    {\n                        messageId: message.id.toString(),\n                        url: \"/user/announcements\",\n                    },\n                    storage\n                ).catch((error) =>\n                    console.error(\"Failed to send push notification:\", error)\n                );\n            }\n\n            res.json(message);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/group-messages\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const { limit } = req.query;\n\n            if (requestingUser.role === \"super_admin\") {\n                if (limit) {\n                    const messages = await storage.getRecentGroupMessages(\n                        parseInt(limit as string)\n                    );\n                    res.json(messages);\n                } else {\n                    const messages = await storage.getAllGroupMessages();\n                    res.json(messages);\n                }\n            } else if (requestingUser.companyId) {\n                const messages = await storage.getGroupMessagesByCompanyId(\n                    requestingUser.companyId\n                );\n                if (limit) {\n                    res.json(messages.slice(0, parseInt(limit as string)));\n                } else {\n                    res.json(messages);\n                }\n            } else {\n                res.json([]);\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Group message reply routes\n    app.post(\n        \"/api/group-messages/:messageId/replies\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (!requestingUser) {\n                    return res.status(404).json({ message: \"User not found\" });\n                }\n\n                if (!requestingUser.isActive) {\n                    return res.status(401).json({\n                        message: \"User account disabled\",\n                        code: \"USER_INACTIVE\",\n                    });\n                }\n\n                if (!requestingUser.companyId) {\n                    return res\n                        .status(403)\n                        .json({ message: \"User must belong to a company\" });\n                }\n\n                const messageId = parseInt(req.params.messageId);\n\n                const groupMessage = await storage.getGroupMessageById(\n                    messageId\n                );\n                if (!groupMessage) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Group message not found\" });\n                }\n\n                if (groupMessage.companyId !== requestingUser.companyId) {\n                    return res.status(403).json({\n                        message:\n                            \"Access denied: you can only reply to messages in your company\",\n                    });\n                }\n\n                if (\n                    typeof req.body.message !== \"string\" ||\n                    !req.body.message.trim()\n                ) {\n                    return res.status(400).json({\n                        message: \"Reply message must be a non-empty string\",\n                    });\n                }\n\n                const replyData = {\n                    groupMessageId: messageId,\n                    senderId: requestingUser.id,\n                    message: req.body.message,\n                };\n\n                const validatedReply =\n                    insertGroupMessageReplySchema.parse(replyData);\n                const reply = await storage.createGroupMessageReply(\n                    validatedReply\n                );\n\n                if (broadcast) {\n                    broadcast({\n                        type: \"GROUP_MESSAGE_REPLY\",\n                        reply,\n                        groupMessageId: messageId,\n                    });\n                }\n\n                res.json(reply);\n            } catch (error) {\n                if (error instanceof z.ZodError) {\n                    return res\n                        .status(400)\n                        .json({ message: error.errors[0].message });\n                }\n                next(error);\n            }\n        }\n    );\n\n    app.get(\n        \"/api/group-messages/:messageId/replies\",\n        async (req, res, next) => {\n            try {\n                const requestingUserId = req.headers[\"x-user-id\"];\n                if (!requestingUserId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestingUser = await storage.getUserById(\n                    parseInt(requestingUserId as string)\n                );\n                if (!requestingUser) {\n                    return res.status(404).json({ message: \"User not found\" });\n                }\n\n                if (!requestingUser.isActive) {\n                    return res.status(401).json({\n                        message: \"User account disabled\",\n                        code: \"USER_INACTIVE\",\n                    });\n                }\n\n                if (!requestingUser.companyId) {\n                    return res\n                        .status(403)\n                        .json({ message: \"User must belong to a company\" });\n                }\n\n                const messageId = parseInt(req.params.messageId);\n\n                const groupMessage = await storage.getGroupMessageById(\n                    messageId\n                );\n                if (!groupMessage) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Group message not found\" });\n                }\n\n                if (groupMessage.companyId !== requestingUser.companyId) {\n                    return res.status(403).json({\n                        message:\n                            \"Access denied: you can only view replies for messages in your company\",\n                    });\n                }\n\n                const replies = await storage.getGroupMessageReplies(messageId);\n                res.json(replies);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Device token routes\n    app.post(\"/api/device-tokens\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            if (!requestingUser.isActive) {\n                return res.status(401).json({\n                    message: \"User account disabled\",\n                    code: \"USER_INACTIVE\",\n                });\n            }\n\n            const { token, deviceType } = req.body;\n            if (!token) {\n                return res.status(400).json({ message: \"Token is required\" });\n            }\n\n            const deviceToken = await storage.createOrUpdateDeviceToken({\n                userId: requestingUser.id,\n                token,\n                deviceType: deviceType || \"web\",\n            });\n\n            res.json(deviceToken);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.delete(\"/api/device-tokens/:token\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            if (!requestingUser.isActive) {\n                return res.status(401).json({\n                    message: \"User account disabled\",\n                    code: \"USER_INACTIVE\",\n                });\n            }\n\n            const { token } = req.params;\n            await storage.deleteDeviceToken(token);\n\n            res.json({ message: \"Device token deleted successfully\" });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Feedback routes\n    app.post(\"/api/feedbacks\", async (req, res, next) => {\n        try {\n            const validatedFeedback = insertFeedbackSchema.parse(req.body);\n            const feedback = await storage.createFeedback(validatedFeedback);\n            res.json(feedback);\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    app.get(\"/api/feedbacks\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            const { userId } = req.query;\n\n            if (userId) {\n                const feedbacks = await storage.getFeedbacksByUserId(\n                    parseInt(userId as string)\n                );\n                res.json(feedbacks);\n            } else {\n                // Admin viewing all company feedbacks\n                if (\n                    requestingUser.role === \"company_admin\" ||\n                    requestingUser.role === \"super_admin\"\n                ) {\n                    const allFeedbacks = await storage.getAllFeedbacks();\n                    // Filter by company unless super_admin\n                    if (requestingUser.role === \"super_admin\") {\n                        res.json(allFeedbacks);\n                    } else {\n                        // Get all users in the company\n                        const companyUsers = await storage.getUsersByCompanyId(\n                            requestingUser.companyId!\n                        );\n                        const companyUserIds = companyUsers.map((u) => u.id);\n                        const companyFeedbacks = allFeedbacks.filter((f) =>\n                            companyUserIds.includes(f.submittedBy)\n                        );\n                        res.json(companyFeedbacks);\n                    }\n                } else if (requestingUser.role === \"team_leader\") {\n                    // Team leaders can view feedback from their team members\n                    const teamMembers = await storage.getTeamMembersByLeader(\n                        requestingUser.id\n                    );\n                    const teamMemberIds = teamMembers.map((m) => m.id);\n                    const allFeedbacks = await storage.getAllFeedbacks();\n                    const teamFeedbacks = allFeedbacks.filter((f) =>\n                        teamMemberIds.includes(f.submittedBy)\n                    );\n                    res.json(teamFeedbacks);\n                } else {\n                    // Regular users can only see their own feedbacks\n                    const feedbacks = await storage.getFeedbacksByUserId(\n                        requestingUser.id\n                    );\n                    res.json(feedbacks);\n                }\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Slot Pricing routes\n    app.get(\"/api/slot-pricing\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            // Allow super_admin and company_admin to view pricing\n            if (\n                requestingUser.role !== \"super_admin\" &&\n                requestingUser.role !== \"company_admin\"\n            ) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            const pricing = await storage.getAllSlotPricing();\n            res.json(pricing);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/slot-pricing\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can modify slot pricing\",\n                });\n            }\n\n            const validatedData = insertSlotPricingSchema.parse(req.body);\n            const pricing = await storage.createOrUpdateSlotPricing(\n                validatedData\n            );\n\n            res.json(pricing);\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // Purchase Slots\n    app.post(\"/api/purchase-slots\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || !requestingUser.companyId) {\n                return res\n                    .status(403)\n                    .json({ message: \"User must belong to a company\" });\n            }\n\n            if (requestingUser.role !== \"company_admin\") {\n                return res.status(403).json({\n                    message: \"Only company admins can purchase slots\",\n                });\n            }\n\n            const validatedData = slotPurchaseSchema.parse(req.body);\n\n            const pricing = await storage.getSlotPricingByType(\n                validatedData.slotType\n            );\n            if (!pricing) {\n                return res.status(404).json({\n                    message: `Pricing not found for ${validatedData.slotType} slots`,\n                });\n            }\n\n            const totalAmount = pricing.pricePerSlot * validatedData.quantity;\n\n            const payment = await storage.createCompanyPayment({\n                companyId: requestingUser.companyId,\n                slotType: validatedData.slotType,\n                slotQuantity: validatedData.quantity,\n                amount: totalAmount,\n                currency: pricing.currency,\n                paymentStatus: \"paid\",\n                paymentMethod: \"online\",\n                transactionId: `TXN-${Date.now()}`,\n            });\n\n            const updateData =\n                validatedData.slotType === \"admin\"\n                    ? { maxAdmins: validatedData.quantity }\n                    : { maxMembers: validatedData.quantity };\n\n            await storage.incrementCompanySlots(\n                requestingUser.companyId,\n                updateData\n            );\n\n            res.json({\n                success: true,\n                message: `Successfully purchased ${validatedData.quantity} ${validatedData.slotType} slot(s)`,\n                payment,\n            });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // Stripe Payment Intent Creation\n    app.post(\"/api/create-payment-intent\", async (req, res, next) => {\n        try {\n            if (!stripe) {\n                return res\n                    .status(500)\n                    .json({ message: \"Payment gateway not configured\" });\n            }\n\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || !requestingUser.companyId) {\n                return res\n                    .status(403)\n                    .json({ message: \"User must belong to a company\" });\n            }\n\n            if (requestingUser.role !== \"company_admin\") {\n                return res.status(403).json({\n                    message: \"Only company admins can purchase slots\",\n                });\n            }\n\n            const { slotType, quantity } = req.body;\n\n            // Fetch server-side pricing to prevent tampering\n            const pricing = await storage.getSlotPricingByType(slotType);\n            if (!pricing) {\n                return res.status(400).json({ message: \"Invalid slot type\" });\n            }\n\n            // Calculate amount server-side from authoritative pricing\n            const calculatedAmount = pricing.pricePerSlot * quantity;\n\n            // Create payment record with server-calculated amount\n            const payment = await storage.createCompanyPayment({\n                companyId: requestingUser.companyId,\n                slotType,\n                slotQuantity: quantity,\n                amount: calculatedAmount,\n                currency: \"INR\",\n                paymentStatus: \"pending\",\n                paymentMethod: \"stripe\",\n            });\n\n            // Create Stripe payment intent with server-calculated amount\n            // Automatic payment methods - Stripe will show available options based on:\n            // 1. Currency (INR)\n            // 2. Amount\n            // 3. Customer location\n            // 4. Payment methods enabled in your Stripe Dashboard\n            const paymentIntent = await stripe.paymentIntents.create({\n                amount: Math.round(calculatedAmount * 100), // Convert to paise (INR smallest unit)\n                currency: \"inr\",\n                automatic_payment_methods: {\n                    enabled: true,\n                    allow_redirects: \"always\",\n                },\n                metadata: {\n                    paymentId: payment.id.toString(),\n                    companyId: requestingUser.companyId.toString(),\n                    slotType,\n                    quantity: quantity.toString(),\n                },\n            });\n\n            console.log(\"Payment Intent created:\", {\n                id: paymentIntent.id,\n                amount: paymentIntent.amount,\n                currency: paymentIntent.currency,\n                status: paymentIntent.status,\n                hasClientSecret: !!paymentIntent.client_secret,\n                clientSecretPreview: paymentIntent.client_secret\n                    ? paymentIntent.client_secret.substring(0, 30) + \"...\"\n                    : \"MISSING\",\n            });\n\n            // Update payment with Stripe payment intent ID\n            await storage.updatePaymentStripeId(payment.id, paymentIntent.id);\n\n            const responseData = {\n                clientSecret: paymentIntent.client_secret,\n                paymentId: payment.id,\n            };\n\n            console.log(\"Sending response:\", {\n                hasClientSecret: !!responseData.clientSecret,\n                paymentId: responseData.paymentId,\n            });\n\n            res.json(responseData);\n        } catch (error: any) {\n            console.error(\"Payment intent creation error:\", error);\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // Verify Payment and Update Slots\n    app.post(\"/api/verify-payment\", async (req, res, next) => {\n        try {\n            if (!stripe) {\n                return res\n                    .status(500)\n                    .json({ message: \"Payment gateway not configured\" });\n            }\n\n            const { paymentIntentId, paymentId } = req.body;\n\n            // Retrieve payment intent from Stripe\n            const paymentIntent = await stripe.paymentIntents.retrieve(\n                paymentIntentId\n            );\n\n            if (paymentIntent.status !== \"succeeded\") {\n                return res\n                    .status(400)\n                    .json({ message: \"Payment not successful\" });\n            }\n\n            // Get payment record\n            const payment = await storage.getPaymentById(paymentId);\n            if (!payment) {\n                return res\n                    .status(404)\n                    .json({ message: \"Payment record not found\" });\n            }\n\n            // Verify metadata matches to prevent tampering\n            if (paymentIntent.metadata.paymentId !== paymentId.toString()) {\n                return res.status(400).json({\n                    message: \"Payment verification failed: metadata mismatch\",\n                });\n            }\n\n            // Prevent duplicate processing\n            if (payment.paymentStatus === \"paid\") {\n                // Payment already processed - return success with existing receipt\n                return res.json({\n                    success: true,\n                    message: \"Payment already processed\",\n                    payment,\n                    receiptNumber: payment.receiptNumber,\n                    emailSent: payment.emailSent,\n                });\n            }\n\n            // Get company details for email\n            const company = await storage.getCompanyById(payment.companyId);\n            if (!company) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            // Generate unique receipt number using payment ID for guaranteed uniqueness\n            const date = new Date();\n            const dateStr = date.toISOString().slice(0, 10).replace(/-/g, \"\");\n            const receiptNumber = `WL-RCPT-${dateStr}-${paymentId\n                .toString()\n                .padStart(6, \"0\")}`;\n\n            // Prepare slot updates\n            const slotUpdates =\n                payment.slotType === \"admin\"\n                    ? { maxAdmins: payment.slotQuantity || 0 }\n                    : { maxMembers: payment.slotQuantity || 0 };\n\n            // CRITICAL: Atomic transaction - complete payment and update slots together\n            const updatedPayment = await storage.completePaymentWithSlots(\n                paymentId,\n                payment.companyId,\n                receiptNumber,\n                paymentIntent.id,\n                slotUpdates\n            );\n\n            // If null, payment was already processed by concurrent request - fetch current state\n            if (!updatedPayment) {\n                const currentPayment = await storage.getPaymentById(paymentId);\n                if (!currentPayment) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Payment record not found\" });\n                }\n                // Return existing receipt data (idempotent retry succeeded)\n                return res.json({\n                    success: true,\n                    message: \"Payment already processed\",\n                    payment: currentPayment,\n                    receiptNumber: currentPayment.receiptNumber,\n                    emailSent: currentPayment.emailSent,\n                });\n            }\n\n            // Send email asynchronously (non-fatal - don't block on email failure)\n            let emailSent = false;\n            try {\n                emailSent = await sendPaymentConfirmationEmail({\n                    companyName: company.name,\n                    companyEmail: company.email,\n                    receiptNumber,\n                    amount: payment.amount,\n                    currency: payment.currency,\n                    slotType: payment.slotType || \"member\",\n                    slotQuantity: payment.slotQuantity || 1,\n                    transactionId: paymentIntent.id,\n                    paymentDate: date,\n                });\n\n                // Update email sent status if successful\n                if (emailSent) {\n                    await storage.updatePaymentEmailStatus(paymentId, true);\n                }\n            } catch (emailError: any) {\n                console.error(\"Email sending failed (non-fatal):\", emailError);\n                // Email failure is logged but doesn't fail the payment\n            }\n\n            res.json({\n                success: true,\n                message: \"Payment verified and slots added successfully\",\n                payment: updatedPayment,\n                receiptNumber,\n                emailSent,\n            });\n        } catch (error: any) {\n            console.error(\"Payment verification error:\", error);\n            next(error);\n        }\n    });\n\n    // Get company's own payment history (Company Admin)\n    app.get(\"/api/my-company-payments\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || !requestingUser.companyId) {\n                return res\n                    .status(403)\n                    .json({ message: \"User must belong to a company\" });\n            }\n\n            if (requestingUser.role !== \"company_admin\") {\n                return res.status(403).json({\n                    message: \"Only company admins can view payment history\",\n                });\n            }\n\n            const payments = await storage.getPaymentsByCompanyId(\n                requestingUser.companyId\n            );\n            res.json(payments);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Company Payment routes (Super Admin only)\n    app.get(\"/api/company-payments\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can access company payments\",\n                });\n            }\n\n            const { companyId } = req.query;\n\n            if (companyId) {\n                const payments = await storage.getPaymentsByCompanyId(\n                    parseInt(companyId as string)\n                );\n                res.json(payments);\n            } else {\n                const payments = await storage.getAllCompanyPayments();\n                res.json(payments);\n            }\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/company-payments\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can create company payments\",\n                });\n            }\n\n            const validatedData = insertCompanyPaymentSchema.parse(req.body);\n            const payment = await storage.createCompanyPayment(validatedData);\n            res.json(payment);\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    app.patch(\"/api/company-payments/:id/status\", async (req, res, next) => {\n        try {\n            const requestingUserId = req.headers[\"x-user-id\"];\n            if (!requestingUserId) {\n                return res\n                    .status(401)\n                    .json({ message: \"Authentication required\" });\n            }\n\n            const requestingUser = await storage.getUserById(\n                parseInt(requestingUserId as string)\n            );\n            if (!requestingUser || requestingUser.role !== \"super_admin\") {\n                return res.status(403).json({\n                    message: \"Only super admins can update payment status\",\n                });\n            }\n\n            const { id } = req.params;\n            const validatedData = updatePaymentStatusSchema.parse(req.body);\n\n            const paymentId = parseInt(id);\n            if (isNaN(paymentId)) {\n                return res.status(400).json({ message: \"Invalid payment ID\" });\n            }\n\n            await storage.updatePaymentStatus(paymentId, {\n                paymentStatus: validatedData.status,\n            });\n            res.json({ message: \"Payment status updated successfully\" });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    // Password Reset routes\n    const handlePasswordResetRequest = async (\n        req: express.Request,\n        res: express.Response,\n        next: express.NextFunction\n    ) => {\n        try {\n            const validatedData = passwordResetRequestSchema.parse(req.body);\n\n            const user = await storage.getUserByEmail(validatedData.email);\n            const company = await storage.getCompanyByEmail(\n                validatedData.email\n            );\n\n            if (!user && !company) {\n                return res.json({\n                    message:\n                        \"If an account exists with this email, a password reset link has been sent.\",\n                });\n            }\n\n            const resetToken = crypto.randomBytes(32).toString(\"hex\");\n            const expiresAt = new Date(Date.now() + 15 * 60 * 1000);\n\n            await storage.createPasswordResetToken(\n                validatedData.email,\n                resetToken,\n                expiresAt\n            );\n\n            const protocol =\n                req.headers[\"x-forwarded-proto\"] || req.protocol || \"https\";\n            const host = req.headers[\"x-forwarded-host\"] || req.headers.host;\n            const baseUrl = `${protocol}://${host}`;\n\n            await sendPasswordResetEmail({\n                email: validatedData.email,\n                resetToken,\n                userName: user?.displayName || company?.name || \"User\",\n                baseUrl,\n            });\n\n            res.json({\n                message:\n                    \"If an account exists with this email, a password reset link has been sent.\",\n            });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    };\n\n    app.post(\"/api/auth/request-password-reset\", handlePasswordResetRequest);\n    app.post(\"/api/auth/forgot-password\", handlePasswordResetRequest);\n\n    app.post(\"/api/auth/forgot-company-id\", async (req, res, next) => {\n        try {\n            const { email } = req.body;\n\n            if (!email) {\n                return res.status(400).json({ message: \"Email is required\" });\n            }\n\n            const company = await storage.getCompanyByEmail(email);\n\n            if (company) {\n                await sendCompanyServerIdEmail({\n                    companyName: company.name,\n                    companyEmail: company.email,\n                    serverId: company.serverId,\n                });\n            }\n\n            res.json({\n                message:\n                    \"If a company exists with this email, the Company Server ID has been sent.\",\n            });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/auth/reset-password\", async (req, res, next) => {\n        try {\n            const validatedData = passwordResetSchema.parse(req.body);\n\n            const tokenData = await storage.getPasswordResetToken(\n                validatedData.token\n            );\n\n            if (!tokenData) {\n                return res\n                    .status(400)\n                    .json({ message: \"Invalid or expired reset token\" });\n            }\n\n            if (tokenData.used) {\n                return res.status(400).json({\n                    message: \"This reset token has already been used\",\n                });\n            }\n\n            if (new Date() > new Date(tokenData.expiresAt)) {\n                return res\n                    .status(400)\n                    .json({ message: \"This reset token has expired\" });\n            }\n\n            const user = await storage.getUserByEmail(tokenData.email);\n            const company = await storage.getCompanyByEmail(tokenData.email);\n\n            if (!user && !company) {\n                return res.status(400).json({ message: \"Account not found\" });\n            }\n\n            const hashedPassword = await bcrypt.hash(\n                validatedData.newPassword,\n                10\n            );\n\n            if (user) {\n                await storage.updateUserPassword(user.id, hashedPassword);\n\n                if (user.role === \"company_admin\" && user.companyId) {\n                    await storage.updateCompany(user.companyId, {\n                        password: hashedPassword,\n                    });\n                }\n            }\n\n            if (company) {\n                await storage.updateCompany(company.id, {\n                    password: hashedPassword,\n                });\n            }\n\n            await storage.markTokenAsUsed(validatedData.token);\n\n            res.json({ message: \"Password reset successfully\" });\n        } catch (error) {\n            if (error instanceof z.ZodError) {\n                return res\n                    .status(400)\n                    .json({ message: error.errors[0].message });\n            }\n            next(error);\n        }\n    });\n\n    app.post(\n        \"/api/tasks-report/submit\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const userId = parseInt(req.headers[\"x-user-id\"] as string);\n                const { companyId, tasksCompleted, notes } = req.body;\n\n                if (!companyId || !tasksCompleted) {\n                    return res.status(400).json({\n                        message: \"Company ID and tasks completed are required\",\n                    });\n                }\n\n                const today = new Date().toISOString().split(\"T\")[0];\n\n                const existingReport = await storage.getTasksReportByDate(\n                    userId,\n                    today\n                );\n                if (existingReport) {\n                    return res.status(400).json({\n                        message: \"Report already submitted for today\",\n                    });\n                }\n\n                const report = await storage.createTasksReport({\n                    userId,\n                    companyId,\n                    date: today,\n                    tasksCompleted,\n                    notes: notes || null,\n                    allowedEarlyLogout: true,\n                });\n\n                res.json(report);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.get(\"/api/tasks-report/today\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const today = new Date().toISOString().split(\"T\")[0];\n            const report = await storage.getTasksReportByDate(userId, today);\n            res.json(report);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/tasks-report/user\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const reports = await storage.getTasksReportsByUserId(userId);\n            res.json(reports);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/me\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const user = await storage.getUserById(userId);\n\n            if (!user) {\n                return res.status(404).json({ message: \"User not found\" });\n            }\n\n            res.json({\n                id: user.id,\n                uniqueUserId: user.uniqueUserId,\n                email: user.email,\n                displayName: user.displayName,\n                role: user.role,\n                companyId: user.companyId,\n                photoURL: user.photoURL,\n                isActive: user.isActive,\n            });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/leaves\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const user = await storage.getUserById(userId);\n\n            if (!user || !user.companyId) {\n                return res\n                    .status(400)\n                    .json({ message: \"User not associated with a company\" });\n            }\n\n            const leave = await storage.createLeave({\n                userId,\n                companyId: user.companyId,\n                startDate: req.body.startDate,\n                endDate: req.body.endDate,\n                leaveType: req.body.leaveType,\n                reason: req.body.reason,\n                status: \"pending\",\n            });\n\n            res.json(leave);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/leaves/me\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const leaves = await storage.getLeavesByUserId(userId);\n            res.json(leaves);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\n        \"/api/leaves/company/:companyId\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n                const companyId = parseInt(req.params.companyId);\n\n                if (!requestingUser) {\n                    return res.status(401).json({ message: \"User not found\" });\n                }\n\n                // Allow admins and team leaders\n                if (\n                    requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\" &&\n                    requestingUser.role !== \"team_leader\"\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                // Verify company access\n                if (\n                    requestingUser.role === \"company_admin\" &&\n                    requestingUser.companyId !== companyId\n                ) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only view leave requests for your own company\",\n                    });\n                }\n\n                if (\n                    requestingUser.role === \"team_leader\" &&\n                    requestingUser.companyId !== companyId\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                let leaves;\n                if (requestingUser.role === \"team_leader\") {\n                    // Team leaders can only see their team members' leaves\n                    const teamMembers = await storage.getTeamMembersByLeader(\n                        requestingUserId\n                    );\n                    const teamMemberIds = teamMembers.map((m) => m.id);\n                    leaves = await storage.getLeavesByUserIds(teamMemberIds);\n                } else {\n                    // Admins can see all company leaves\n                    leaves = await storage.getLeavesByCompanyId(companyId);\n                }\n\n                res.json(leaves);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.patch(\n        \"/api/leaves/:leaveId/approve\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n                const leaveId = parseInt(req.params.leaveId);\n\n                if (!requestingUser) {\n                    return res.status(401).json({ message: \"User not found\" });\n                }\n\n                // Allow admins and team leaders\n                if (\n                    requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\" &&\n                    requestingUser.role !== \"team_leader\"\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                const leave = await storage.getLeaveById(leaveId);\n                if (!leave) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Leave request not found\" });\n                }\n\n                // Verify company access\n                if (requestingUser.companyId !== leave.companyId) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only approve leave requests for your own company\",\n                    });\n                }\n\n                // Team leaders can only approve their team members' leaves\n                if (requestingUser.role === \"team_leader\") {\n                    const teamMembers = await storage.getTeamMembersByLeader(\n                        requestingUserId\n                    );\n                    const teamMemberIds = teamMembers.map((m) => m.id);\n                    if (!teamMemberIds.includes(leave.userId)) {\n                        return res.status(403).json({\n                            message:\n                                \"You can only approve leave requests for your team members\",\n                        });\n                    }\n                }\n\n                await storage.updateLeaveStatus(\n                    leaveId,\n                    \"approved\",\n                    req.body.approvedBy || requestingUserId\n                );\n\n                // Broadcast WebSocket update for real-time notifications\n                const { broadcast } = await import(\"./index.js\");\n                const leaveUser = await storage.getUserById(leave.userId);\n                broadcast({\n                    type: \"LEAVE_STATUS_UPDATE\",\n                    data: {\n                        leaveId,\n                        userId: leave.userId,\n                        userName: leaveUser?.displayName,\n                        status: \"approved\",\n                        approvedBy: requestingUser.displayName,\n                        companyId: leave.companyId,\n                    },\n                });\n\n                res.json({ message: \"Leave approved successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.patch(\n        \"/api/leaves/:leaveId/reject\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n                const leaveId = parseInt(req.params.leaveId);\n\n                if (!requestingUser) {\n                    return res.status(401).json({ message: \"User not found\" });\n                }\n\n                // Allow admins and team leaders\n                if (\n                    requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\" &&\n                    requestingUser.role !== \"team_leader\"\n                ) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                const leave = await storage.getLeaveById(leaveId);\n                if (!leave) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Leave request not found\" });\n                }\n\n                // Verify company access\n                if (requestingUser.companyId !== leave.companyId) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only reject leave requests for your own company\",\n                    });\n                }\n\n                // Team leaders can only reject their team members' leaves\n                if (requestingUser.role === \"team_leader\") {\n                    const teamMembers = await storage.getTeamMembersByLeader(\n                        requestingUserId\n                    );\n                    const teamMemberIds = teamMembers.map((m) => m.id);\n                    if (!teamMemberIds.includes(leave.userId)) {\n                        return res.status(403).json({\n                            message:\n                                \"You can only reject leave requests for your team members\",\n                        });\n                    }\n                }\n\n                await storage.updateLeaveStatus(\n                    leaveId,\n                    \"rejected\",\n                    req.body.rejectedBy || requestingUserId\n                );\n\n                // Broadcast WebSocket update for real-time notifications\n                const { broadcast } = await import(\"./index.js\");\n                const leaveUser = await storage.getUserById(leave.userId);\n                broadcast({\n                    type: \"LEAVE_STATUS_UPDATE\",\n                    data: {\n                        leaveId,\n                        userId: leave.userId,\n                        userName: leaveUser?.displayName,\n                        status: \"rejected\",\n                        rejectedBy: requestingUser.displayName,\n                        companyId: leave.companyId,\n                    },\n                });\n\n                res.json({ message: \"Leave rejected successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.patch(\n        \"/api/leaves/:leaveId/status\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n                const leaveId = parseInt(req.params.leaveId);\n\n                if (!requestingUser) {\n                    return res.status(401).json({ message: \"User not found\" });\n                }\n\n                if (\n                    requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\"\n                ) {\n                    return res.status(403).json({\n                        message: \"Only admins can directly change leave status\",\n                    });\n                }\n\n                const validatedInput = z\n                    .object({\n                        status: z.enum([\"pending\", \"approved\", \"rejected\"], {\n                            errorMap: () => ({\n                                message:\n                                    \"Invalid status. Must be: pending, approved, or rejected\",\n                            }),\n                        }),\n                    })\n                    .parse(req.body);\n\n                const leave = await storage.getLeaveById(leaveId);\n                if (!leave) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Leave request not found\" });\n                }\n\n                if (requestingUser.companyId !== leave.companyId) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only modify leave requests for your own company\",\n                    });\n                }\n\n                await storage.updateLeaveStatus(\n                    leaveId,\n                    validatedInput.status,\n                    requestingUserId\n                );\n\n                const { broadcast } = await import(\"./index.js\");\n                const leaveUser = await storage.getUserById(leave.userId);\n                broadcast({\n                    type: \"LEAVE_STATUS_UPDATE\",\n                    data: {\n                        leaveId,\n                        userId: leave.userId,\n                        userName: leaveUser?.displayName,\n                        status: validatedInput.status,\n                        changedBy: requestingUser.displayName,\n                        companyId: leave.companyId,\n                    },\n                });\n\n                res.json({\n                    message: `Leave status changed to ${validatedInput.status} successfully`,\n                });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.post(\"/api/holidays\", requireAuth, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can create holidays\" });\n            }\n\n            if (!requestingUser.companyId) {\n                return res\n                    .status(400)\n                    .json({ message: \"User not associated with a company\" });\n            }\n\n            const holiday = await storage.createHoliday({\n                companyId: requestingUser.companyId,\n                name: req.body.name,\n                date: req.body.date,\n                description: req.body.description,\n            });\n\n            res.json(holiday);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\n        \"/api/holidays/company/:companyId\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n                const companyId = parseInt(req.params.companyId);\n\n                if (\n                    requestingUser &&\n                    requestingUser.role === \"company_admin\" &&\n                    requestingUser.companyId !== companyId\n                ) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only view holidays for your own company\",\n                    });\n                }\n\n                const holidays = await storage.getHolidaysByCompanyId(\n                    companyId\n                );\n                res.json(holidays);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.delete(\n        \"/api/holidays/:holidayId\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n                const holidayId = parseInt(req.params.holidayId);\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res\n                        .status(403)\n                        .json({ message: \"Only admins can delete holidays\" });\n                }\n\n                const holiday = await storage.getHolidayById(holidayId);\n                if (!holiday) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Holiday not found\" });\n                }\n\n                if (\n                    requestingUser.role === \"company_admin\" &&\n                    requestingUser.companyId !== holiday.companyId\n                ) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only delete holidays for your own company\",\n                    });\n                }\n\n                await storage.deleteHoliday(holidayId);\n                res.json({ message: \"Holiday deleted successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.get(\"/api/badges\", requireAuth, async (req, res, next) => {\n        try {\n            const badges = await storage.getAllBadges();\n            res.json(badges);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/badges\", requireAuth, async (req, res, next) => {\n        try {\n            const badge = await storage.createBadge(req.body);\n            res.json(badge);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Company Profile Management\n    app.get(\"/api/my-company/profile\", requireAuth, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (!requestingUser || !requestingUser.companyId) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            const company = await storage.getCompanyById(\n                requestingUser.companyId\n            );\n            if (!company) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            res.json(company);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\n        \"/api/my-company/profile\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    requestingUser.role !== \"company_admin\"\n                ) {\n                    return res.status(403).json({\n                        message:\n                            \"Only company admins can update company profile\",\n                    });\n                }\n\n                if (!requestingUser.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Company not found\" });\n                }\n\n                // Add audit trail\n                const updateData = {\n                    ...req.body,\n                    updatedBy:\n                        requestingUser.displayName || requestingUser.email,\n                    updatedAt: new Date(),\n                };\n\n                const updatedCompany = await storage.updateCompany(\n                    requestingUser.companyId,\n                    updateData\n                );\n                res.json(updatedCompany);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // ==================== ATTENDANCE MANAGEMENT ====================\n\n    // Validation schemas\n    const checkInSchema = z.object({\n        gpsLocation: z.string().nullable().optional(),\n        deviceId: z.string().optional(),\n    });\n\n    const dailyAttendanceQuerySchema = z.object({\n        date: z.string().optional(),\n        companyId: z.string().optional(),\n    });\n\n    const manualAttendanceSchema = z.object({\n        userId: z.number(),\n        companyId: z.number(),\n        date: z.string(),\n        checkIn: z\n            .string()\n            .or(z.date())\n            .optional()\n            .transform((val) => {\n                if (typeof val === \"string\") return new Date(val);\n                return val;\n            }),\n        checkOut: z\n            .string()\n            .or(z.date())\n            .optional()\n            .nullable()\n            .transform((val) => {\n                if (val === null || val === undefined) return null;\n                if (typeof val === \"string\") return new Date(val);\n                return val;\n            }),\n        status: z.enum([\"present\", \"absent\", \"late\", \"leave\"]),\n        workDuration: z.number().optional().nullable(),\n        gpsLocation: z.string().nullable().optional(),\n    });\n\n    const updateAttendanceSchema = z.object({\n        checkIn: z\n            .string()\n            .or(z.date())\n            .optional()\n            .transform((val) => {\n                if (typeof val === \"string\") return new Date(val);\n                return val;\n            }),\n        checkOut: z\n            .string()\n            .or(z.date())\n            .optional()\n            .nullable()\n            .transform((val) => {\n                if (val === null || val === undefined) return null;\n                if (typeof val === \"string\") return new Date(val);\n                return val;\n            }),\n        status: z.enum([\"present\", \"absent\", \"late\", \"leave\"]).optional(),\n        workDuration: z.number().optional().nullable(),\n        remarks: z.string().optional().nullable(),\n    });\n\n    const reportsQuerySchema = z.object({\n        startDate: z.string().optional(),\n        endDate: z.string().optional(),\n        userId: z.string().optional(),\n        companyId: z.string().optional(),\n    });\n\n    const correctionRequestSchema = z.object({\n        attendanceId: z.number(),\n        requestedCheckIn: z.string().or(z.date()).optional().nullable(),\n        requestedCheckOut: z.string().or(z.date()).optional().nullable(),\n        reason: z.string().min(1, \"Reason is required\"),\n    });\n\n    // Employee: Check-in\n    app.post(\n        \"/api/attendance/check-in\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const validatedBody = checkInSchema.parse(req.body);\n                const userId = parseInt(req.headers[\"x-user-id\"] as string);\n                const user = await storage.getUserById(userId);\n\n                if (!user || !user.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"User or company not found\" });\n                }\n\n                const today = new Date().toISOString().split(\"T\")[0];\n\n                // Check if already checked in today\n                const existingRecord = await storage.getAttendanceByUserAndDate(\n                    userId,\n                    today\n                );\n                if (existingRecord && existingRecord.checkIn) {\n                    return res\n                        .status(400)\n                        .json({ message: \"Already checked in today\" });\n                }\n\n                // Get company policy and shift info\n                const policy = await storage.getAttendancePolicyByCompany(\n                    user.companyId\n                );\n\n                const checkInTime = new Date();\n                const checkInHour = checkInTime.getHours();\n                const checkInMinutes = checkInTime.getMinutes();\n                \n                // Get user's shift or use default 10:00 AM start\n                const shifts = await storage.getShiftsByCompany(user.companyId);\n                const userShift = shifts.find(s => s.isActive) || null;\n                \n                // Parse shift start time or default to 10:00 AM\n                let shiftStartHour = 10;\n                let shiftStartMinute = 0;\n                if (userShift && userShift.startTime) {\n                    const [h, m] = userShift.startTime.split(':').map(Number);\n                    shiftStartHour = h || 10;\n                    shiftStartMinute = m || 0;\n                }\n                \n                // Calculate if late based on policy's lateMarkThreshold (in minutes after shift start)\n                const lateThresholdMinutes = policy?.lateMarkThreshold || 3;\n                const shiftStartTotalMinutes = shiftStartHour * 60 + shiftStartMinute;\n                const currentTotalMinutes = checkInHour * 60 + checkInMinutes;\n                \n                // Check if check-in is early (before shift start)\n                const isEarly = currentTotalMinutes < shiftStartTotalMinutes;\n                // Check if late (after shift start + threshold)\n                const isLate = currentTotalMinutes > (shiftStartTotalMinutes + lateThresholdMinutes);\n                \n                let status: \"late\" | \"present\" = isLate ? \"late\" : \"present\";\n\n                const checkInData = {\n                    userId,\n                    companyId: user.companyId,\n                    shiftId: userShift?.id || null,\n                    date: today,\n                    checkIn: checkInTime,\n                    status,\n                    gpsLocation: validatedBody.gpsLocation || null,\n                    ipAddress: req.ip || null,\n                    deviceId: validatedBody.deviceId || null,\n                };\n\n                const record = existingRecord\n                    ? await storage.updateAttendanceRecord(\n                          existingRecord.id,\n                          checkInData\n                      )\n                    : await storage.createAttendanceRecord(checkInData);\n\n                // Update attendance streak\n                try {\n                    const existingStreak = await storage.getAttendanceStreakByUser(userId);\n                    const yesterday = new Date();\n                    yesterday.setDate(yesterday.getDate() - 1);\n                    const yesterdayStr = yesterday.toISOString().split(\"T\")[0];\n                    \n                    let currentStreak = existingStreak?.currentStreak || 0;\n                    let longestStreak = existingStreak?.longestStreak || 0;\n                    let earlyBirdCount = existingStreak?.earlyBirdCount || 0;\n                    let onTimeCount = existingStreak?.onTimeCount || 0;\n                    let lateCount = existingStreak?.lateCount || 0;\n                    \n                    // Check if yesterday was present to continue streak\n                    if (existingStreak?.lastPresentDate === yesterdayStr) {\n                        currentStreak += 1;\n                    } else if (existingStreak?.lastPresentDate !== today) {\n                        // Reset streak if not consecutive\n                        currentStreak = 1;\n                    }\n                    \n                    if (currentStreak > longestStreak) {\n                        longestStreak = currentStreak;\n                    }\n                    \n                    // Update counts based on status\n                    if (isEarly) {\n                        earlyBirdCount += 1;\n                        onTimeCount += 1;\n                    } else if (!isLate) {\n                        onTimeCount += 1;\n                    } else {\n                        lateCount += 1;\n                    }\n                    \n                    await storage.createOrUpdateAttendanceStreak({\n                        userId,\n                        companyId: user.companyId,\n                        currentStreak,\n                        longestStreak,\n                        lastPresentDate: today,\n                        earlyBirdCount,\n                        onTimeCount,\n                        lateCount,\n                        absentCount: existingStreak?.absentCount || 0,\n                        totalWorkingDays: (existingStreak?.totalWorkingDays || 0) + 1,\n                    });\n                    \n                    // Award badges based on achievements\n                    const currentMonth = today.substring(0, 7);\n                    \n                    // Early Bird badge for 5+ early check-ins\n                    if (earlyBirdCount === 5 || earlyBirdCount === 10 || earlyBirdCount === 20) {\n                        await storage.createAttendanceBadge({\n                            userId,\n                            companyId: user.companyId,\n                            badgeType: \"early_bird\",\n                            badgeName: `Early Bird ${earlyBirdCount}`,\n                            description: `Checked in early ${earlyBirdCount} times`,\n                            earnedDate: today,\n                            month: currentMonth,\n                            streakCount: earlyBirdCount,\n                            isActive: true,\n                        });\n                    }\n                    \n                    // Perfect Streak badges\n                    if (currentStreak === 5 || currentStreak === 10 || currentStreak === 20 || currentStreak === 30) {\n                        await storage.createAttendanceBadge({\n                            userId,\n                            companyId: user.companyId,\n                            badgeType: \"streak\",\n                            badgeName: `${currentStreak} Day Streak`,\n                            description: `Maintained ${currentStreak} consecutive days of attendance`,\n                            earnedDate: today,\n                            month: currentMonth,\n                            streakCount: currentStreak,\n                            isActive: true,\n                        });\n                    }\n                } catch (streakError) {\n                    console.error(\"Error updating streak:\", streakError);\n                }\n\n                res.json(record);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Employee: Check-out\n    app.post(\n        \"/api/attendance/check-out\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const userId = parseInt(req.headers[\"x-user-id\"] as string);\n                const today = new Date().toISOString().split(\"T\")[0];\n\n                const record = await storage.getAttendanceByUserAndDate(\n                    userId,\n                    today\n                );\n                if (!record) {\n                    return res.status(404).json({\n                        message: \"No check-in record found for today\",\n                    });\n                }\n\n                if (record.checkOut) {\n                    return res\n                        .status(400)\n                        .json({ message: \"Already checked out today\" });\n                }\n\n                const checkOut = new Date();\n                const checkIn = new Date(record.checkIn!);\n                const workDuration = Math.floor(\n                    (checkOut.getTime() - checkIn.getTime()) / 1000 / 60\n                ); // in minutes\n\n                const updatedRecord = await storage.updateAttendanceRecord(\n                    record.id,\n                    {\n                        checkOut,\n                        workDuration,\n                    }\n                );\n\n                res.json(updatedRecord);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Employee: Get today's attendance\n    app.get(\"/api/attendance/today\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const today = new Date().toISOString().split(\"T\")[0];\n\n            const record = await storage.getAttendanceByUserAndDate(\n                userId,\n                today\n            );\n            res.json(record || null);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Employee: Get attendance history\n    app.get(\"/api/attendance/history\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const { startDate, endDate } = req.query;\n\n            // Default to current month if not provided\n            const now = new Date();\n            const defaultStartDate = new Date(\n                now.getFullYear(),\n                now.getMonth(),\n                1\n            )\n                .toISOString()\n                .split(\"T\")[0];\n            const defaultEndDate = new Date(\n                now.getFullYear(),\n                now.getMonth() + 1,\n                0\n            )\n                .toISOString()\n                .split(\"T\")[0];\n\n            const records = await storage.getAttendanceHistory(\n                userId,\n                (startDate as string) || defaultStartDate,\n                (endDate as string) || defaultEndDate\n            );\n\n            res.json(records);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Employee: Get monthly attendance summary\n    app.get(\n        \"/api/attendance/monthly-summary\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const userId = parseInt(req.headers[\"x-user-id\"] as string);\n                const { month, year } = req.query;\n\n                // Default to current month/year if not provided\n                const now = new Date();\n                const targetMonth = month\n                    ? parseInt(month as string)\n                    : now.getMonth() + 1;\n                const targetYear = year\n                    ? parseInt(year as string)\n                    : now.getFullYear();\n\n                const summary = await storage.getMonthlyAttendanceSummary(\n                    userId,\n                    targetMonth,\n                    targetYear\n                );\n\n                res.json(summary);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Employee: Get attendance badges\n    app.get(\"/api/attendance/badges\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const badges = await storage.getAttendanceBadgesByUser(userId);\n            res.json(badges);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Employee: Get attendance streak\n    app.get(\"/api/attendance/streak\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const streak = await storage.getAttendanceStreakByUser(userId);\n            res.json(streak || {\n                currentStreak: 0,\n                longestStreak: 0,\n                earlyBirdCount: 0,\n                onTimeCount: 0,\n                lateCount: 0,\n                absentCount: 0,\n                totalWorkingDays: 0,\n            });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Employee: Get attendance policy (for showing rules to user)\n    app.get(\"/api/attendance/policy\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const user = await storage.getUserById(userId);\n            if (!user || !user.companyId) {\n                return res.status(404).json({ message: \"User or company not found\" });\n            }\n            \n            const policy = await storage.getAttendancePolicyByCompany(user.companyId);\n            const shifts = await storage.getShiftsByCompany(user.companyId);\n            const activeShift = shifts.find(s => s.isActive);\n            \n            res.json({\n                policy: policy || {\n                    halfDayHours: 4,\n                    fullDayHours: 8,\n                    lateMarkThreshold: 3,\n                    autoAbsentHours: 2,\n                    allowSelfCheckIn: true,\n                    requireGPS: false,\n                    requireDeviceBinding: false,\n                },\n                shift: activeShift || null,\n            });\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Admin: Get all company badges\n    app.get(\"/api/admin/attendance/badges\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const user = await storage.getUserById(userId);\n            if (!user || !user.companyId) {\n                return res.status(404).json({ message: \"User or company not found\" });\n            }\n            if (user.role !== \"company_admin\") {\n                return res.status(403).json({ message: \"Admin access required\" });\n            }\n            \n            const badges = await storage.getAttendanceBadgesByCompany(user.companyId);\n            res.json(badges);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Admin: Get all company streaks with user names\n    app.get(\"/api/admin/attendance/streaks\", requireAuth, async (req, res, next) => {\n        try {\n            const userId = parseInt(req.headers[\"x-user-id\"] as string);\n            const user = await storage.getUserById(userId);\n            if (!user || !user.companyId) {\n                return res.status(404).json({ message: \"User or company not found\" });\n            }\n            if (user.role !== \"company_admin\") {\n                return res.status(403).json({ message: \"Admin access required\" });\n            }\n            \n            const streaks = await storage.getAttendanceStreaksByCompany(user.companyId);\n            \n            // Enrich streaks with user names\n            const enrichedStreaks = await Promise.all(\n                streaks.map(async (streak) => {\n                    const streakUser = await storage.getUserById(streak.userId);\n                    return {\n                        ...streak,\n                        fullName: streakUser?.fullName || streakUser?.displayName || streakUser?.email || `User ${streak.userId}`,\n                    };\n                })\n            );\n            \n            res.json(enrichedStreaks);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // Employee: Mark as leave\n    app.post(\n        \"/api/attendance/mark-leave\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const userId = parseInt(req.headers[\"x-user-id\"] as string);\n                const user = await storage.getUserById(userId);\n\n                if (!user || !user.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"User or company not found\" });\n                }\n\n                const markLeaveSchema = z.object({\n                    reason: z\n                        .string()\n                        .min(10, \"Reason must be at least 10 characters\"),\n                    date: z.string().optional(),\n                });\n\n                const validatedBody = markLeaveSchema.parse(req.body);\n                const targetDate =\n                    validatedBody.date ||\n                    new Date().toISOString().split(\"T\")[0];\n\n                // Check if already has attendance record for this date\n                const existingRecord = await storage.getAttendanceByUserAndDate(\n                    userId,\n                    targetDate\n                );\n                if (existingRecord && existingRecord.checkIn) {\n                    return res.status(400).json({\n                        message:\n                            \"Already checked in for this date. Cannot mark as leave.\",\n                    });\n                }\n\n                const leaveData = {\n                    userId,\n                    companyId: user.companyId,\n                    date: targetDate,\n                    status: \"leave\" as const,\n                    remarks: validatedBody.reason,\n                };\n\n                const record = existingRecord\n                    ? await storage.updateAttendanceRecord(\n                          existingRecord.id,\n                          leaveData\n                      )\n                    : await storage.createAttendanceRecord(leaveData);\n\n                res.json(record);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Employee: Request correction\n    app.post(\n        \"/api/attendance/correction-request\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const userId = parseInt(req.headers[\"x-user-id\"] as string);\n                const user = await storage.getUserById(userId);\n\n                if (!user || !user.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"User or company not found\" });\n                }\n\n                const correctionSchema = insertCorrectionRequestSchema\n                    .omit({\n                        userId: true,\n                        companyId: true,\n                        status: true,\n                        reviewedBy: true,\n                        reviewComments: true,\n                        requestedCheckIn: true,\n                        requestedCheckOut: true,\n                    })\n                    .extend({\n                        attendanceId: z.number().optional().nullable(),\n                        requestedCheckIn: z\n                            .string()\n                            .or(z.date())\n                            .optional()\n                            .nullable()\n                            .transform((val) => {\n                                if (typeof val === \"string\" && val)\n                                    return new Date(val);\n                                if (val instanceof Date) return val;\n                                return null;\n                            }),\n                        requestedCheckOut: z\n                            .string()\n                            .or(z.date())\n                            .optional()\n                            .nullable()\n                            .transform((val) => {\n                                if (typeof val === \"string\" && val)\n                                    return new Date(val);\n                                if (val instanceof Date) return val;\n                                return null;\n                            }),\n                    });\n\n                const validatedBody = correctionSchema.parse(req.body);\n\n                const correctionData = {\n                    userId,\n                    companyId: user.companyId,\n                    ...validatedBody,\n                };\n\n                const request = await storage.createCorrectionRequest(\n                    correctionData\n                );\n                res.json(request);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Employee: Get my correction requests\n    app.get(\n        \"/api/attendance/my-corrections\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const userId = parseInt(req.headers[\"x-user-id\"] as string);\n                const requests = await storage.getCorrectionRequestsByUser(\n                    userId\n                );\n                res.json(requests);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Employee: Get my rewards\n    app.get(\n        \"/api/attendance/my-rewards\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const userId = parseInt(req.headers[\"x-user-id\"] as string);\n                const rewards = await storage.getRewardsByUser(userId);\n                res.json(rewards);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Admin: Get daily attendance monitor\n    app.get(\n        \"/api/admin/attendance/daily\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const validatedQuery = dailyAttendanceQuerySchema.parse(\n                    req.query\n                );\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res.status(403).json({\n                        message: \"Only admins can view attendance monitor\",\n                    });\n                }\n\n                const { date, companyId } = validatedQuery;\n                const targetCompanyId =\n                    requestingUser.role === \"super_admin\"\n                        ? parseInt(companyId as string)\n                        : requestingUser.companyId;\n\n                if (!targetCompanyId) {\n                    if (process.env.NODE_ENV === \"development\") {\n                        console.warn(\"[Attendance] Admin missing companyId:\", {\n                            userId: requestingUser.id,\n                            role: requestingUser.role,\n                        });\n                    }\n                    return res\n                        .status(400)\n                        .json({ message: \"Company ID required\" });\n                }\n\n                const requestedDate =\n                    (date as string) || new Date().toISOString().split(\"T\")[0];\n                const records = await storage.getDailyAttendance(\n                    targetCompanyId,\n                    requestedDate\n                );\n\n                if (process.env.NODE_ENV === \"development\") {\n                    console.log(\"[Attendance] Query:\", {\n                        adminId: requestingUser.id,\n                        adminRole: requestingUser.role,\n                        targetCompanyId,\n                        date: requestedDate,\n                        recordsFound: records.length,\n                    });\n                }\n\n                res.json(records);\n            } catch (error) {\n                if (process.env.NODE_ENV === \"development\") {\n                    console.error(\n                        \"[Attendance] Error fetching daily attendance:\",\n                        error\n                    );\n                }\n                next(error);\n            }\n        }\n    );\n\n    // Admin: Manual attendance entry/update\n    app.post(\n        \"/api/admin/attendance/manual\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const validatedBody = manualAttendanceSchema.parse(req.body);\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res.status(403).json({\n                        message: \"Only admins can add manual attendance\",\n                    });\n                }\n\n                const record = await storage.createAttendanceRecord({\n                    ...validatedBody,\n                    remarks: `Manual entry by ${requestingUser.displayName}`,\n                });\n\n                // Log the action\n                await storage.createAttendanceLog({\n                    attendanceId: record.id,\n                    action: \"manual_entry\",\n                    performedBy: requestingUserId,\n                    newValue: JSON.stringify(record),\n                });\n\n                res.json(record);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Admin: Update attendance record\n    app.patch(\n        \"/api/admin/attendance/:id\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const validatedBody = updateAttendanceSchema.parse(req.body);\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res\n                        .status(403)\n                        .json({ message: \"Only admins can update attendance\" });\n                }\n\n                const recordId = parseInt(req.params.id);\n                const oldRecord = await storage.getAttendanceById(recordId);\n\n                if (!oldRecord) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Attendance record not found\" });\n                }\n\n                const updatedRecord = await storage.updateAttendanceRecord(\n                    recordId,\n                    validatedBody\n                );\n\n                // Log the action\n                await storage.createAttendanceLog({\n                    attendanceId: recordId,\n                    action: \"admin_update\",\n                    performedBy: requestingUserId,\n                    oldValue: JSON.stringify(oldRecord),\n                    newValue: JSON.stringify(updatedRecord),\n                });\n\n                res.json(updatedRecord);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Team Leader: Get correction requests for team members\n    app.get(\n        \"/api/corrections/team/:teamLeaderId\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const teamLeaderId = parseInt(req.params.teamLeaderId);\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                // Verify the requesting user is the team leader\n                if (requestingUserId !== teamLeaderId) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                if (!requestingUser || !requestingUser.companyId) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                // Get team member IDs\n                const teamMembers = await storage.getTeamMembersByLeader(\n                    teamLeaderId\n                );\n                const teamMemberIds = teamMembers.map((m) => m.id);\n\n                // Get all corrections for the company\n                const allCorrections =\n                    await storage.getPendingCorrectionRequests(\n                        requestingUser.companyId\n                    );\n\n                // Filter to only team members' corrections\n                const teamCorrections = allCorrections.filter((corr) =>\n                    teamMemberIds.includes(corr.userId)\n                );\n\n                res.json(teamCorrections);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Team Leader: Approve correction request\n    app.patch(\n        \"/api/corrections/:id/approve\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (!requestingUser) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestId = parseInt(req.params.id);\n                const correctionRequest =\n                    await storage.getCorrectionRequestById(requestId);\n\n                if (!correctionRequest) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Correction request not found\" });\n                }\n\n                // Verify the user making the correction is from the team\n                const teamMembers = await storage.getTeamMembersByLeader(\n                    requestingUserId\n                );\n                const teamMemberIds = teamMembers.map((m) => m.id);\n\n                if (!teamMemberIds.includes(correctionRequest.userId)) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only approve corrections for your team members\",\n                    });\n                }\n\n                // Update correction request status\n                const updatedRequest = await storage.updateCorrectionRequest(\n                    requestId,\n                    {\n                        status: \"approved\",\n                        reviewedBy: requestingUserId,\n                        reviewComments: req.body.comments,\n                    }\n                );\n\n                // Apply the correction to attendance record\n                if (correctionRequest.attendanceId) {\n                    const attendanceUpdate: any = {};\n                    if (correctionRequest.requestedCheckIn) {\n                        attendanceUpdate.checkIn =\n                            correctionRequest.requestedCheckIn;\n                    }\n                    if (correctionRequest.requestedCheckOut) {\n                        attendanceUpdate.checkOut =\n                            correctionRequest.requestedCheckOut;\n                    }\n\n                    if (attendanceUpdate.checkIn || attendanceUpdate.checkOut) {\n                        await storage.updateAttendanceRecord(\n                            correctionRequest.attendanceId,\n                            attendanceUpdate\n                        );\n\n                        // Log the correction\n                        await storage.createAttendanceLog({\n                            attendanceId: correctionRequest.attendanceId,\n                            action: \"correction_applied\",\n                            performedBy: requestingUserId,\n                            newValue: JSON.stringify(correctionRequest),\n                        });\n                    }\n                }\n\n                res.json(updatedRequest);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Team Leader: Reject correction request\n    app.patch(\n        \"/api/corrections/:id/reject\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (!requestingUser) {\n                    return res\n                        .status(401)\n                        .json({ message: \"Authentication required\" });\n                }\n\n                const requestId = parseInt(req.params.id);\n                const correctionRequest =\n                    await storage.getCorrectionRequestById(requestId);\n\n                if (!correctionRequest) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Correction request not found\" });\n                }\n\n                // Verify the user making the rejection is from the team\n                const teamMembers = await storage.getTeamMembersByLeader(\n                    requestingUserId\n                );\n                const teamMemberIds = teamMembers.map((m) => m.id);\n\n                if (!teamMemberIds.includes(correctionRequest.userId)) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only reject corrections for your team members\",\n                    });\n                }\n\n                const updatedRequest = await storage.updateCorrectionRequest(\n                    requestId,\n                    {\n                        status: \"rejected\",\n                        reviewedBy: requestingUserId,\n                        reviewComments: req.body.comments,\n                    }\n                );\n\n                res.json(updatedRequest);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Admin: Get pending correction requests\n    app.get(\n        \"/api/admin/attendance/corrections/pending\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res.status(403).json({\n                        message: \"Only admins can view correction requests\",\n                    });\n                }\n\n                const companyId =\n                    requestingUser.role === \"super_admin\"\n                        ? parseInt(req.query.companyId as string)\n                        : requestingUser.companyId;\n\n                if (!companyId) {\n                    return res\n                        .status(400)\n                        .json({ message: \"Company ID required\" });\n                }\n\n                const requests = await storage.getPendingCorrectionRequests(\n                    companyId\n                );\n                res.json(requests);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Admin: Approve correction request\n    app.patch(\n        \"/api/admin/attendance/corrections/:id/approve\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res.status(403).json({\n                        message: \"Only admins can approve corrections\",\n                    });\n                }\n\n                const requestId = parseInt(req.params.id);\n                const correctionRequest =\n                    await storage.getCorrectionRequestById(requestId);\n\n                if (!correctionRequest) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Correction request not found\" });\n                }\n\n                // Update correction request status\n                const updatedRequest = await storage.updateCorrectionRequest(\n                    requestId,\n                    {\n                        status: \"approved\",\n                        reviewedBy: requestingUserId,\n                        reviewComments: req.body.comments,\n                    }\n                );\n\n                // Apply the correction to attendance record\n                if (correctionRequest.attendanceId) {\n                    const attendanceUpdate: any = {};\n                    if (correctionRequest.requestedCheckIn) {\n                        attendanceUpdate.checkIn =\n                            correctionRequest.requestedCheckIn;\n                    }\n                    if (correctionRequest.requestedCheckOut) {\n                        attendanceUpdate.checkOut =\n                            correctionRequest.requestedCheckOut;\n                    }\n\n                    if (attendanceUpdate.checkIn || attendanceUpdate.checkOut) {\n                        await storage.updateAttendanceRecord(\n                            correctionRequest.attendanceId,\n                            attendanceUpdate\n                        );\n\n                        // Log the correction\n                        await storage.createAttendanceLog({\n                            attendanceId: correctionRequest.attendanceId,\n                            action: \"correction_applied\",\n                            performedBy: requestingUserId,\n                            newValue: JSON.stringify(correctionRequest),\n                        });\n                    }\n                }\n\n                res.json(updatedRequest);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Admin: Reject correction request\n    app.patch(\n        \"/api/admin/attendance/corrections/:id/reject\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res.status(403).json({\n                        message: \"Only admins can reject corrections\",\n                    });\n                }\n\n                const requestId = parseInt(req.params.id);\n                const updatedRequest = await storage.updateCorrectionRequest(\n                    requestId,\n                    {\n                        status: \"rejected\",\n                        reviewedBy: requestingUserId,\n                        reviewComments: req.body.comments,\n                    }\n                );\n\n                res.json(updatedRequest);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Admin: Get attendance reports\n    app.get(\n        \"/api/admin/attendance/reports\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const validatedQuery = reportsQuerySchema.parse(req.query);\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res\n                        .status(403)\n                        .json({ message: \"Only admins can view reports\" });\n                }\n\n                const { companyId, startDate, endDate } = validatedQuery;\n                const type = req.query.type;\n                const targetCompanyId =\n                    requestingUser.role === \"super_admin\"\n                        ? parseInt(companyId as string)\n                        : requestingUser.companyId;\n\n                if (!targetCompanyId) {\n                    return res\n                        .status(400)\n                        .json({ message: \"Company ID required\" });\n                }\n\n                const report = await storage.getAttendanceReport(\n                    targetCompanyId,\n                    startDate as string,\n                    endDate as string,\n                    type as string\n                );\n\n                res.json(report);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Admin: Get user attendance history\n    app.get(\n        \"/api/admin/attendance/history/:userId\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n                const targetUserId = parseInt(req.params.userId);\n                const { month, year } = req.query;\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res.status(403).json({\n                        message: \"Only admins can view user attendance history\",\n                    });\n                }\n\n                // Get target user to verify company access\n                const targetUser = await storage.getUserById(targetUserId);\n                if (!targetUser) {\n                    return res.status(404).json({ message: \"User not found\" });\n                }\n\n                // Ensure admin can only view users from their company (unless super admin)\n                if (\n                    requestingUser.role === \"company_admin\" &&\n                    targetUser.companyId !== requestingUser.companyId\n                ) {\n                    return res.status(403).json({\n                        message:\n                            \"You can only view attendance for users in your company\",\n                    });\n                }\n\n                // Default to current month if not provided\n                const now = new Date();\n                const targetMonth = month\n                    ? parseInt(month as string)\n                    : now.getMonth() + 1;\n                const targetYear = year\n                    ? parseInt(year as string)\n                    : now.getFullYear();\n\n                const startDate = `${targetYear}-${targetMonth\n                    .toString()\n                    .padStart(2, \"0\")}-01`;\n                const lastDay = new Date(targetYear, targetMonth, 0).getDate();\n                const endDate = `${targetYear}-${targetMonth\n                    .toString()\n                    .padStart(2, \"0\")}-${lastDay.toString().padStart(2, \"0\")}`;\n\n                const records = await storage.getAttendanceHistory(\n                    targetUserId,\n                    startDate,\n                    endDate\n                );\n                const summary = await storage.getMonthlyAttendanceSummary(\n                    targetUserId,\n                    targetMonth,\n                    targetYear\n                );\n\n                res.json({\n                    records,\n                    summary,\n                    user: {\n                        id: targetUser.id,\n                        displayName: targetUser.displayName,\n                        email: targetUser.email,\n                    },\n                });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Shifts Management\n    app.post(\"/api/admin/shifts\", requireAdmin, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (\n                !requestingUser ||\n                (requestingUser.role !== \"company_admin\" &&\n                    requestingUser.role !== \"super_admin\")\n            ) {\n                return res\n                    .status(403)\n                    .json({ message: \"Only admins can create shifts\" });\n            }\n\n            const shift = await storage.createShift({\n                ...req.body,\n                companyId: requestingUser.companyId!,\n            });\n\n            res.json(shift);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\n        \"/api/shifts/company/:companyId\",\n        requireAuth,\n        async (req, res, next) => {\n            try {\n                const companyId = parseInt(req.params.companyId);\n                const shifts = await storage.getShiftsByCompany(companyId);\n                res.json(shifts);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // Attendance Policy Management\n    app.get(\n        \"/api/admin/attendance-policy\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (!requestingUser || !requestingUser.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Company not found\" });\n                }\n\n                const policy = await storage.getAttendancePolicyByCompany(\n                    requestingUser.companyId\n                );\n                res.json(policy || null);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.post(\n        \"/api/admin/attendance-policy\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (\n                    !requestingUser ||\n                    (requestingUser.role !== \"company_admin\" &&\n                        requestingUser.role !== \"super_admin\")\n                ) {\n                    return res\n                        .status(403)\n                        .json({ message: \"Only admins can manage policies\" });\n                }\n\n                const policy = await storage.createOrUpdateAttendancePolicy({\n                    ...req.body,\n                    companyId: requestingUser.companyId!,\n                });\n\n                res.json(policy);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    // CRM - Enquiry Routes (Admin Only)\n    app.get(\"/api/crm/enquiries\", requireAdmin, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (!requestingUser || !requestingUser.companyId) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            const enquiries = await storage.getEnquiriesByCompanyId(\n                requestingUser.companyId\n            );\n            res.json(enquiries);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\"/api/crm/enquiries/:id\", requireAdmin, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (!requestingUser || !requestingUser.companyId) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            const enquiry = await storage.getEnquiryById(\n                parseInt(req.params.id)\n            );\n            if (!enquiry) {\n                return res.status(404).json({ message: \"Enquiry not found\" });\n            }\n\n            // Verify enquiry belongs to user's company\n            if (enquiry.companyId !== requestingUser.companyId) {\n                return res.status(403).json({ message: \"Access denied\" });\n            }\n\n            res.json(enquiry);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.post(\"/api/crm/enquiries\", requireAdmin, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (!requestingUser || !requestingUser.companyId) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            const enquiry = await storage.createEnquiry({\n                ...req.body,\n                companyId: requestingUser.companyId,\n                createdBy: requestingUserId,\n            });\n\n            res.json(enquiry);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\n        \"/api/crm/enquiries/:id\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (!requestingUser || !requestingUser.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Company not found\" });\n                }\n\n                const enquiry = await storage.getEnquiryById(\n                    parseInt(req.params.id)\n                );\n                if (!enquiry) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Enquiry not found\" });\n                }\n\n                // Verify enquiry belongs to user's company\n                if (enquiry.companyId !== requestingUser.companyId) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                await storage.updateEnquiry(parseInt(req.params.id), req.body);\n                res.json({ message: \"Enquiry updated successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.delete(\n        \"/api/crm/enquiries/:id\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (!requestingUser || !requestingUser.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Company not found\" });\n                }\n\n                const enquiry = await storage.getEnquiryById(\n                    parseInt(req.params.id)\n                );\n                if (!enquiry) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Enquiry not found\" });\n                }\n\n                // Verify enquiry belongs to user's company\n                if (enquiry.companyId !== requestingUser.companyId) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                await storage.deleteEnquiry(parseInt(req.params.id));\n                res.json({ message: \"Enquiry deleted successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.get(\"/api/crm/stats\", requireAdmin, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (!requestingUser || !requestingUser.companyId) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            const stats = await storage.getEnquiryStats(\n                requestingUser.companyId\n            );\n            res.json(stats);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    // CRM - Followup Routes (Admin Only)\n    app.get(\"/api/crm/followups\", requireAdmin, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (!requestingUser || !requestingUser.companyId) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            const followups = await storage.getFollowupsByCompanyId(\n                requestingUser.companyId\n            );\n            res.json(followups);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.get(\n        \"/api/crm/followups/enquiry/:enquiryId\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (!requestingUser || !requestingUser.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Company not found\" });\n                }\n\n                // Verify enquiry belongs to user's company\n                const enquiry = await storage.getEnquiryById(\n                    parseInt(req.params.enquiryId)\n                );\n                if (!enquiry) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Enquiry not found\" });\n                }\n\n                if (enquiry.companyId !== requestingUser.companyId) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                const followups = await storage.getFollowupsByEnquiryId(\n                    parseInt(req.params.enquiryId)\n                );\n                res.json(followups);\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.post(\"/api/crm/followups\", requireAdmin, async (req, res, next) => {\n        try {\n            const requestingUserId = parseInt(\n                req.headers[\"x-user-id\"] as string\n            );\n            const requestingUser = await storage.getUserById(requestingUserId);\n\n            if (!requestingUser || !requestingUser.companyId) {\n                return res.status(404).json({ message: \"Company not found\" });\n            }\n\n            // Verify the enquiry belongs to the user's company\n            const enquiry = await storage.getEnquiryById(\n                parseInt(req.body.enquiryId)\n            );\n            if (!enquiry) {\n                return res.status(404).json({ message: \"Enquiry not found\" });\n            }\n\n            if (enquiry.companyId !== requestingUser.companyId) {\n                return res.status(403).json({\n                    message:\n                        \"Access denied - enquiry belongs to another company\",\n                });\n            }\n\n            const followup = await storage.createFollowup({\n                ...req.body,\n                companyId: requestingUser.companyId,\n                createdBy: requestingUserId,\n            });\n\n            res.json(followup);\n        } catch (error) {\n            next(error);\n        }\n    });\n\n    app.patch(\n        \"/api/crm/followups/:id\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (!requestingUser || !requestingUser.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Company not found\" });\n                }\n\n                const followup = await storage.getFollowupById(\n                    parseInt(req.params.id)\n                );\n                if (!followup) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Followup not found\" });\n                }\n\n                // Verify followup belongs to user's company\n                if (followup.companyId !== requestingUser.companyId) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                await storage.updateFollowup(parseInt(req.params.id), req.body);\n                res.json({ message: \"Followup updated successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    app.delete(\n        \"/api/crm/followups/:id\",\n        requireAdmin,\n        async (req, res, next) => {\n            try {\n                const requestingUserId = parseInt(\n                    req.headers[\"x-user-id\"] as string\n                );\n                const requestingUser = await storage.getUserById(\n                    requestingUserId\n                );\n\n                if (!requestingUser || !requestingUser.companyId) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Company not found\" });\n                }\n\n                const followup = await storage.getFollowupById(\n                    parseInt(req.params.id)\n                );\n                if (!followup) {\n                    return res\n                        .status(404)\n                        .json({ message: \"Followup not found\" });\n                }\n\n                // Verify followup belongs to user's company\n                if (followup.companyId !== requestingUser.companyId) {\n                    return res.status(403).json({ message: \"Access denied\" });\n                }\n\n                await storage.deleteFollowup(parseInt(req.params.id));\n                res.json({ message: \"Followup deleted successfully\" });\n            } catch (error) {\n                next(error);\n            }\n        }\n    );\n\n    const httpServer = createServer(app);\n\n    return httpServer;\n}\n","path":null,"size_bytes":262422,"size_tokens":null},"server/storage.ts":{"content":"﻿﻿import { db } from \"./db\";\nimport {\n    companies,\n    users,\n    tasks,\n    reports,\n    messages,\n    ratings,\n    fileUploads,\n    archiveReports,\n    groupMessages,\n    groupMessageReplies,\n    taskTimeLogs,\n    feedbacks,\n    slotPricing,\n    companyPayments,\n    passwordResetTokens,\n    adminActivityLogs,\n    badges,\n    autoTasks,\n    leaves,\n    holidays,\n    tasksReports,\n    shifts,\n    attendancePolicies,\n    attendanceRecords,\n    correctionRequests,\n    rewards,\n    attendanceLogs,\n    attendanceBadges,\n    attendanceStreaks,\n    teamAssignments,\n    enquiries,\n    followups,\n    deviceTokens,\n    type Company,\n    type InsertCompany,\n    type User,\n    type InsertUser,\n    type Task,\n    type InsertTask,\n    type Report,\n    type InsertReport,\n    type Message,\n    type InsertMessage,\n    type Rating,\n    type InsertRating,\n    type FileUpload,\n    type InsertFileUpload,\n    type ArchiveReport,\n    type GroupMessage,\n    type InsertGroupMessage,\n    type GroupMessageReply,\n    type InsertGroupMessageReply,\n    type TaskTimeLog,\n    type InsertTaskTimeLog,\n    type Feedback,\n    type InsertFeedback,\n    type SlotPricing,\n    type InsertSlotPricing,\n    type CompanyPayment,\n    type InsertCompanyPayment,\n    type PasswordResetToken,\n    type AdminActivityLog,\n    type InsertAdminActivityLog,\n    type Badge,\n    type InsertBadge,\n    type AutoTask,\n    type InsertAutoTask,\n    type Leave,\n    type InsertLeave,\n    type Holiday,\n    type InsertHoliday,\n    type TasksReport,\n    type InsertTasksReport,\n    type Shift,\n    type InsertShift,\n    type AttendancePolicy,\n    type InsertAttendancePolicy,\n    type AttendanceRecord,\n    type InsertAttendanceRecord,\n    type DailyAttendanceRecord,\n    type CorrectionRequest,\n    type InsertCorrectionRequest,\n    type Reward,\n    type InsertReward,\n    type AttendanceLog,\n    type InsertAttendanceLog,\n    type AttendanceBadge,\n    type InsertAttendanceBadge,\n    type AttendanceStreak,\n    type InsertAttendanceStreak,\n    type TeamAssignment,\n    type InsertTeamAssignment,\n    type Enquiry,\n    type InsertEnquiry,\n    type Followup,\n    type InsertFollowup,\n    type DeviceToken,\n    type InsertDeviceToken,\n} from \"@shared/schema\";\nimport { eq, and, or, desc, gte, lte, sql, inArray } from \"drizzle-orm\";\n\nfunction generateUniqueId(prefix: string): string {\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n    let id = \"\";\n    for (let i = 0; i < 6; i++) {\n        id += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return `${prefix}-${id}`;\n}\n\nexport interface IStorage {\n    // Company operations\n    createCompany(company: InsertCompany): Promise<Company>;\n    getCompanyById(id: number): Promise<Company | null>;\n    getCompanyByServerId(serverId: string): Promise<Company | null>;\n    getCompanyByEmail(email: string): Promise<Company | null>;\n    getCompanyByVerificationToken(token: string): Promise<Company | null>;\n    verifyCompanyEmail(token: string): Promise<Company | null>;\n    getAllCompanies(): Promise<Company[]>;\n    updateCompany(id: number, updates: Partial<InsertCompany>): Promise<void>;\n    incrementCompanySlots(\n        id: number,\n        updates: { maxAdmins?: number; maxMembers?: number }\n    ): Promise<void>;\n    deleteCompany(id: number): Promise<void>;\n    getUsersByCompanyId(companyId: number): Promise<User[]>;\n\n    // User operations\n    getUserByEmail(email: string): Promise<User | null>;\n    getUserById(id: number): Promise<User | null>;\n    getUserByFirebaseUid(uid: string): Promise<User | null>;\n    getUserByUniqueUserId(uniqueUserId: string): Promise<User | null>;\n    getUserByDisplayName(displayName: string): Promise<User | null>;\n    createUser(user: InsertUser): Promise<User>;\n    updateUserRole(id: number, role: string): Promise<void>;\n    updateUserPassword(id: number, password: string): Promise<void>;\n    toggleUserStatus(id: number, isActive: boolean): Promise<void>;\n    getAllUsers(includeDeleted?: boolean): Promise<User[]>;\n    deleteUser(id: number): Promise<void>;\n    softDeleteUser(id: number): Promise<void>;\n    deleteAllUserData(id: number): Promise<void>;\n\n    // Task operations\n    createTask(task: InsertTask): Promise<Task>;\n    getTaskById(id: number): Promise<Task | null>;\n    getTasksByUserId(userId: number): Promise<Task[]>;\n    getTasksByAssignedBy(assignedBy: number): Promise<Task[]>;\n    getTasksByCompanyId(companyId: number): Promise<Task[]>;\n    getAllTasks(): Promise<Task[]>;\n    updateTaskStatus(id: number, status: string): Promise<void>;\n    updateTask(id: number, updates: Partial<InsertTask>): Promise<void>;\n    deleteTask(id: number): Promise<void>;\n\n    // Report operations\n    createReport(report: InsertReport): Promise<Report>;\n    getReportsByUserId(userId: number): Promise<Report[]>;\n    getReportsByUserAndDate(\n        userId: number,\n        startDate: Date,\n        endDate: Date\n    ): Promise<Report[]>;\n    getReportsByCompanyId(companyId: number): Promise<Report[]>;\n    getAllReports(): Promise<Report[]>;\n    getReportsByDate(startDate: Date, endDate: Date): Promise<Report[]>;\n\n    // Message operations\n    createMessage(message: InsertMessage): Promise<Message>;\n    getMessagesByReceiverId(receiverId: number): Promise<Message[]>;\n    getUnreadMessagesByReceiverId(receiverId: number): Promise<Message[]>;\n    markMessageAsRead(id: number): Promise<void>;\n    getAllMessages(): Promise<Message[]>;\n\n    // Device token operations\n    createOrUpdateDeviceToken(token: InsertDeviceToken): Promise<DeviceToken>;\n    getDeviceTokensByUserId(userId: number): Promise<DeviceToken[]>;\n    deleteDeviceToken(token: string): Promise<void>;\n\n    // Rating operations\n    createRating(rating: InsertRating): Promise<Rating>;\n    getRatingsByUserId(userId: number): Promise<Rating[]>;\n    getLatestRatingByUserId(userId: number): Promise<Rating | null>;\n    getAllRatings(): Promise<Rating[]>;\n\n    // File upload operations\n    createFileUpload(file: InsertFileUpload): Promise<FileUpload>;\n    getFilesByUserId(userId: number): Promise<FileUpload[]>;\n    getFilesByReportId(reportId: number): Promise<FileUpload[]>;\n    getAllFiles(): Promise<FileUpload[]>;\n\n    // Archive operations\n    archiveReports(month: number, year: number): Promise<void>;\n    getArchivedReports(userId?: number): Promise<ArchiveReport[]>;\n\n    // Group message operations\n    createGroupMessage(message: InsertGroupMessage): Promise<GroupMessage>;\n    getGroupMessageById(id: number): Promise<GroupMessage | null>;\n    getAllGroupMessages(): Promise<GroupMessage[]>;\n    getGroupMessagesByCompanyId(companyId: number): Promise<GroupMessage[]>;\n    getRecentGroupMessages(limit: number): Promise<GroupMessage[]>;\n\n    // Group message reply operations\n    createGroupMessageReply(\n        reply: InsertGroupMessageReply\n    ): Promise<GroupMessageReply>;\n    getGroupMessageReplies(\n        groupMessageId: number\n    ): Promise<GroupMessageReply[]>;\n\n    // Task time log operations\n    getTaskTimeLog(\n        taskId: number,\n        userId: number,\n        date: string\n    ): Promise<TaskTimeLog | null>;\n    createOrUpdateTaskTimeLog(log: InsertTaskTimeLog): Promise<TaskTimeLog>;\n    startTaskTimer(\n        taskId: number,\n        userId: number,\n        date: string\n    ): Promise<TaskTimeLog>;\n    pauseTaskTimer(\n        taskId: number,\n        userId: number,\n        date: string\n    ): Promise<TaskTimeLog>;\n    completeTaskTimer(\n        taskId: number,\n        userId: number,\n        date: string\n    ): Promise<TaskTimeLog>;\n    getTaskTimeLogs(taskId: number, userId: number): Promise<TaskTimeLog[]>;\n\n    // Feedback operations\n    createFeedback(feedback: InsertFeedback): Promise<Feedback>;\n    getAllFeedbacks(): Promise<Feedback[]>;\n    getFeedbacksByUserId(userId: number): Promise<Feedback[]>;\n    getFeedbacksByCompanyId(companyId: number): Promise<Feedback[]>;\n    getFeedbackById(id: number): Promise<Feedback | null>;\n    respondToFeedback(id: number, adminResponse: string): Promise<void>;\n\n    // Slot pricing operations\n    createOrUpdateSlotPricing(pricing: InsertSlotPricing): Promise<SlotPricing>;\n    getAllSlotPricing(): Promise<SlotPricing[]>;\n    getSlotPricingByType(slotType: string): Promise<SlotPricing | null>;\n\n    // Company payment operations\n    createCompanyPayment(\n        payment: InsertCompanyPayment\n    ): Promise<CompanyPayment>;\n    getPaymentsByCompanyId(companyId: number): Promise<CompanyPayment[]>;\n    getAllCompanyPayments(): Promise<CompanyPayment[]>;\n    getPaymentById(id: number): Promise<CompanyPayment | null>;\n    updatePaymentStatus(\n        id: number,\n        updates: { paymentStatus: string; transactionId?: string }\n    ): Promise<void>;\n    updatePaymentStripeId(\n        id: number,\n        stripePaymentIntentId: string\n    ): Promise<void>;\n    completePaymentWithSlots(\n        paymentId: number,\n        companyId: number,\n        receiptNumber: string,\n        transactionId: string,\n        slotUpdates: { maxAdmins?: number; maxMembers?: number }\n    ): Promise<CompanyPayment | null>;\n    updatePaymentEmailStatus(id: number, emailSent: boolean): Promise<void>;\n\n    // Password reset operations\n    createPasswordResetToken(\n        email: string,\n        token: string,\n        expiresAt: Date\n    ): Promise<PasswordResetToken>;\n    getPasswordResetToken(token: string): Promise<PasswordResetToken | null>;\n    markTokenAsUsed(token: string): Promise<void>;\n\n    // Dashboard stats\n    getDashboardStats(companyId?: number): Promise<{\n        totalUsers: number;\n        todayReports: number;\n        pendingTasks: number;\n        completedTasks: number;\n        totalFiles: number;\n    }>;\n\n    // Admin activity log operations\n    createAdminActivityLog(\n        log: InsertAdminActivityLog\n    ): Promise<AdminActivityLog>;\n    getAllAdminActivityLogs(limit?: number): Promise<AdminActivityLog[]>;\n    getAdminActivityLogsByCompany(\n        companyId: number\n    ): Promise<AdminActivityLog[]>;\n    getAdminActivityLogsByUser(userId: number): Promise<AdminActivityLog[]>;\n\n    // Super Admin analytics\n    getSuperAdminAnalytics(): Promise<{\n        totalCompanies: number;\n        activeCompanies: number;\n        suspendedCompanies: number;\n        totalUsers: number;\n        totalAdmins: number;\n        totalMembers: number;\n        totalTasks: number;\n        totalPayments: number;\n        totalRevenue: number;\n        recentPayments: CompanyPayment[];\n    }>;\n\n    getCompanyWithStats(companyId: number): Promise<{\n        company: Company;\n        userCount: number;\n        adminCount: number;\n        memberCount: number;\n        taskCount: number;\n        totalPayments: number;\n        totalRevenue: number;\n    } | null>;\n\n    getAllCompaniesWithStats(): Promise<\n        Array<{\n            company: Company;\n            userCount: number;\n            adminCount: number;\n            memberCount: number;\n        }>\n    >;\n\n    suspendCompany(companyId: number, performedBy: number): Promise<void>;\n    reactivateCompany(companyId: number, performedBy: number): Promise<void>;\n\n    // Enhanced payment tracking\n    getPaymentsByDateRange(\n        startDate: Date,\n        endDate: Date\n    ): Promise<CompanyPayment[]>;\n    getPaymentsByStatus(status: string): Promise<CompanyPayment[]>;\n\n    // Badge operations\n    createBadge(badge: InsertBadge): Promise<Badge>;\n    getAllBadges(): Promise<Badge[]>;\n    getBadgeById(id: number): Promise<Badge | null>;\n\n    // Auto task operations\n    createAutoTask(task: InsertAutoTask): Promise<AutoTask>;\n    getRecentAutoTasks(limit: number): Promise<AutoTask[]>;\n\n    // Leave operations\n    createLeave(leave: InsertLeave): Promise<Leave>;\n    getLeavesByUserId(userId: number): Promise<Leave[]>;\n    getLeavesByCompanyId(companyId: number): Promise<Leave[]>;\n    getLeavesByUserIds(userIds: number[]): Promise<Leave[]>;\n    getPendingLeaves(companyId: number): Promise<Leave[]>;\n    updateLeaveStatus(\n        leaveId: number,\n        status: string,\n        approvedBy: number,\n        remarks?: string\n    ): Promise<void>;\n    getLeaveById(id: number): Promise<Leave | null>;\n\n    // Holiday operations\n    createHoliday(holiday: InsertHoliday): Promise<Holiday>;\n    getHolidaysByCompanyId(companyId: number): Promise<Holiday[]>;\n    getHolidayByDate(companyId: number, date: string): Promise<Holiday | null>;\n    deleteHoliday(id: number): Promise<void>;\n    updateHoliday(id: number, updates: Partial<InsertHoliday>): Promise<void>;\n\n    // Tasks report operations\n    createTasksReport(report: InsertTasksReport): Promise<TasksReport>;\n    getTasksReportByDate(\n        userId: number,\n        date: string\n    ): Promise<TasksReport | null>;\n    getTasksReportsByUserId(userId: number): Promise<TasksReport[]>;\n\n    // NEW ATTENDANCE SYSTEM - Shift Management\n    createShift(shift: InsertShift): Promise<Shift>;\n    getShiftsByCompany(companyId: number): Promise<Shift[]>;\n    getShiftById(id: number): Promise<Shift | null>;\n\n    // NEW ATTENDANCE SYSTEM - Policy Management\n    createOrUpdateAttendancePolicy(\n        policy: InsertAttendancePolicy\n    ): Promise<AttendancePolicy>;\n    getAttendancePolicyByCompany(\n        companyId: number\n    ): Promise<AttendancePolicy | null>;\n\n    // NEW ATTENDANCE SYSTEM - Attendance Records\n    createAttendanceRecord(\n        record: InsertAttendanceRecord\n    ): Promise<AttendanceRecord>;\n    updateAttendanceRecord(\n        id: number,\n        updates: Partial<InsertAttendanceRecord>\n    ): Promise<AttendanceRecord>;\n    getAttendanceById(id: number): Promise<AttendanceRecord | null>;\n    getAttendanceByUserAndDate(\n        userId: number,\n        date: string\n    ): Promise<AttendanceRecord | null>;\n    getAttendanceHistory(\n        userId: number,\n        startDate: string,\n        endDate: string\n    ): Promise<AttendanceRecord[]>;\n    getDailyAttendance(\n        companyId: number,\n        date: string\n    ): Promise<DailyAttendanceRecord[]>;\n    getMonthlyAttendanceSummary(\n        userId: number,\n        month: number,\n        year: number\n    ): Promise<{\n        totalDays: number;\n        presentDays: number;\n        lateDays: number;\n        absentDays: number;\n        totalHours: number;\n    }>;\n    getAttendanceReport(\n        companyId: number,\n        startDate: string,\n        endDate: string,\n        type: string\n    ): Promise<any>;\n\n    // NEW ATTENDANCE SYSTEM - Correction Requests\n    createCorrectionRequest(\n        request: InsertCorrectionRequest\n    ): Promise<CorrectionRequest>;\n    updateCorrectionRequest(\n        id: number,\n        updates: Partial<InsertCorrectionRequest>\n    ): Promise<CorrectionRequest>;\n    getCorrectionRequestById(id: number): Promise<CorrectionRequest | null>;\n    getCorrectionRequestsByUser(userId: number): Promise<CorrectionRequest[]>;\n    getPendingCorrectionRequests(\n        companyId: number\n    ): Promise<CorrectionRequest[]>;\n\n    // NEW ATTENDANCE SYSTEM - Rewards\n    createReward(reward: InsertReward): Promise<Reward>;\n    getRewardsByUser(userId: number): Promise<Reward[]>;\n\n    // NEW ATTENDANCE SYSTEM - Attendance Logs (Audit Trail)\n    createAttendanceLog(log: InsertAttendanceLog): Promise<AttendanceLog>;\n\n    // NEW ATTENDANCE SYSTEM - Badges\n    createAttendanceBadge(badge: InsertAttendanceBadge): Promise<AttendanceBadge>;\n    getAttendanceBadgesByUser(userId: number): Promise<AttendanceBadge[]>;\n    getAttendanceBadgesByCompany(companyId: number): Promise<AttendanceBadge[]>;\n\n    // NEW ATTENDANCE SYSTEM - Streaks\n    createOrUpdateAttendanceStreak(streak: InsertAttendanceStreak): Promise<AttendanceStreak>;\n    getAttendanceStreakByUser(userId: number): Promise<AttendanceStreak | null>;\n    getAttendanceStreaksByCompany(companyId: number): Promise<AttendanceStreak[]>;\n\n    // Team Assignment operations\n    createTeamAssignment(\n        assignment: InsertTeamAssignment\n    ): Promise<TeamAssignment>;\n    removeTeamAssignment(teamLeaderId: number, memberId: number): Promise<void>;\n    removeAllTeamAssignmentsByLeader(teamLeaderId: number): Promise<void>;\n    getTeamMembersByLeader(teamLeaderId: number): Promise<User[]>;\n    getTeamLeaderByMember(memberId: number): Promise<User | null>;\n    getAllTeamAssignments(companyId: number): Promise<TeamAssignment[]>;\n    getTeamAssignmentsByMemberId(memberId: number): Promise<TeamAssignment[]>;\n\n    // CRM - Enquiry operations\n    createEnquiry(enquiry: InsertEnquiry): Promise<Enquiry>;\n    getEnquiryById(id: number): Promise<Enquiry | null>;\n    getEnquiriesByCompanyId(companyId: number): Promise<Enquiry[]>;\n    updateEnquiry(id: number, updates: Partial<InsertEnquiry>): Promise<void>;\n    deleteEnquiry(id: number): Promise<void>;\n    getEnquiryStats(companyId: number): Promise<{\n        totalEnquiries: number;\n        monthEnquiries: number;\n        totalSales: number;\n        monthSales: number;\n        todayFollowups: number;\n        totalDrops: number;\n    }>;\n\n    // CRM - Followup operations\n    createFollowup(followup: InsertFollowup): Promise<Followup>;\n    getFollowupsByEnquiryId(enquiryId: number): Promise<Followup[]>;\n    getFollowupsByCompanyId(companyId: number): Promise<Followup[]>;\n    updateFollowup(id: number, updates: Partial<InsertFollowup>): Promise<void>;\n    deleteFollowup(id: number): Promise<void>;\n}\n\nexport class DbStorage implements IStorage {\n    async createCompany(company: InsertCompany): Promise<Company> {\n        const maxAttempts = 10;\n\n        for (let attempt = 0; attempt < maxAttempts; attempt++) {\n            try {\n                return await db.transaction(async (tx) => {\n                    const latestCompany = await tx\n                        .select({ serverId: companies.serverId })\n                        .from(companies)\n                        .orderBy(desc(companies.id))\n                        .limit(1);\n\n                    let nextNumber = 10001;\n\n                    if (latestCompany.length > 0 && latestCompany[0].serverId) {\n                        const match =\n                            latestCompany[0].serverId.match(/CMP-(\\d+)/);\n                        if (match) {\n                            nextNumber = parseInt(match[1], 10) + 1;\n                        }\n                    }\n\n                    const serverId = `CMP-${(nextNumber + attempt)\n                        .toString()\n                        .padStart(5, \"0\")}`;\n\n                    const result = await tx\n                        .insert(companies)\n                        .values({ ...company, serverId })\n                        .returning();\n\n                    return result[0];\n                });\n            } catch (error: any) {\n                if (error.code === \"23505\" && attempt < maxAttempts - 1) {\n                    continue;\n                }\n                throw error;\n            }\n        }\n\n        throw new Error(\n            \"Failed to generate unique company server ID after multiple attempts\"\n        );\n    }\n\n    async getCompanyById(id: number): Promise<Company | null> {\n        const result = await db\n            .select()\n            .from(companies)\n            .where(eq(companies.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getCompanyByServerId(serverId: string): Promise<Company | null> {\n        const result = await db\n            .select()\n            .from(companies)\n            .where(eq(companies.serverId, serverId))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getCompanyByEmail(email: string): Promise<Company | null> {\n        const result = await db\n            .select()\n            .from(companies)\n            .where(eq(companies.email, email))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getCompanyByVerificationToken(\n        token: string\n    ): Promise<Company | null> {\n        console.log(\n            `[STORAGE] Looking up company by verification token: ${token.substring(\n                0,\n                20\n            )}...`\n        );\n        const result = await db\n            .select()\n            .from(companies)\n            .where(eq(companies.verificationToken, token))\n            .limit(1);\n        console.log(\n            `[STORAGE] Found ${result.length} company(ies) with this token`\n        );\n        if (result[0]) {\n            console.log(\n                `[STORAGE] Company found: ${result[0].serverId}, emailVerified: ${result[0].emailVerified}`\n            );\n        }\n        return result[0] || null;\n    }\n\n    async verifyCompanyEmail(token: string): Promise<Company | null> {\n        const company = await this.getCompanyByVerificationToken(token);\n        if (!company) {\n            console.log(\"[STORAGE] No company found with verification token\");\n            return null;\n        }\n\n        console.log(\n            `[STORAGE] Token expiry: ${\n                company.verificationTokenExpiry\n            }, Current time: ${new Date()}`\n        );\n        if (\n            company.verificationTokenExpiry &&\n            company.verificationTokenExpiry < new Date()\n        ) {\n            console.log(\"[STORAGE] Verification token has expired\");\n            return null;\n        }\n\n        console.log(\n            `[STORAGE] Updating company ${company.serverId} to verified`\n        );\n        await db\n            .update(companies)\n            .set({\n                emailVerified: true,\n                verificationToken: null,\n                verificationTokenExpiry: null,\n                updatedAt: new Date(),\n            })\n            .where(eq(companies.id, company.id));\n\n        return await this.getCompanyById(company.id);\n    }\n\n    async getAllCompanies(): Promise<Company[]> {\n        return await db\n            .select()\n            .from(companies)\n            .where(eq(companies.isActive, true));\n    }\n\n    async updateCompany(\n        id: number,\n        updates: Partial<InsertCompany>\n    ): Promise<void> {\n        await db.update(companies).set(updates).where(eq(companies.id, id));\n    }\n\n    async incrementCompanySlots(\n        id: number,\n        updates: { maxAdmins?: number; maxMembers?: number }\n    ): Promise<void> {\n        const company = await this.getCompanyById(id);\n        if (!company) {\n            throw new Error(\"Company not found\");\n        }\n\n        const newMaxAdmins = updates.maxAdmins\n            ? company.maxAdmins + updates.maxAdmins\n            : company.maxAdmins;\n        const newMaxMembers = updates.maxMembers\n            ? company.maxMembers + updates.maxMembers\n            : company.maxMembers;\n\n        await db\n            .update(companies)\n            .set({\n                maxAdmins: newMaxAdmins,\n                maxMembers: newMaxMembers,\n                updatedAt: new Date(),\n            })\n            .where(eq(companies.id, id));\n    }\n\n    async deleteCompany(id: number): Promise<void> {\n        const companyUsers = await db\n            .select()\n            .from(users)\n            .where(eq(users.companyId, id));\n        const userIds = companyUsers.map((u) => u.id);\n        const companyTasks = await db\n            .select()\n            .from(tasks)\n            .where(eq(tasks.companyId, id));\n        const taskIds = companyTasks.map((t) => t.id);\n\n        if (taskIds.length > 0) {\n            await db\n                .delete(taskTimeLogs)\n                .where(inArray(taskTimeLogs.taskId, taskIds));\n        }\n\n        if (userIds.length > 0) {\n            await db\n                .delete(messages)\n                .where(\n                    or(\n                        inArray(messages.senderId, userIds),\n                        inArray(messages.receiverId, userIds)\n                    )\n                );\n            await db\n                .delete(ratings)\n                .where(\n                    or(\n                        inArray(ratings.userId, userIds),\n                        inArray(ratings.ratedBy, userIds)\n                    )\n                );\n            await db\n                .delete(fileUploads)\n                .where(inArray(fileUploads.userId, userIds));\n            await db\n                .delete(feedbacks)\n                .where(inArray(feedbacks.submittedBy, userIds));\n            await db\n                .delete(archiveReports)\n                .where(inArray(archiveReports.userId, userIds));\n\n            const userEmails = companyUsers.map((u) => u.email);\n            if (userEmails.length > 0) {\n                await db\n                    .delete(passwordResetTokens)\n                    .where(inArray(passwordResetTokens.email, userEmails));\n            }\n        }\n\n        await db.delete(groupMessages).where(eq(groupMessages.companyId, id));\n        await db.delete(reports).where(eq(reports.companyId, id));\n        await db.delete(tasks).where(eq(tasks.companyId, id));\n        await db\n            .delete(companyPayments)\n            .where(eq(companyPayments.companyId, id));\n        await db.delete(users).where(eq(users.companyId, id));\n        await db.delete(companies).where(eq(companies.id, id));\n    }\n\n    async getUsersByCompanyId(companyId: number): Promise<User[]> {\n        return await db\n            .select()\n            .from(users)\n            .where(\n                and(eq(users.companyId, companyId), eq(users.isActive, true))\n            );\n    }\n\n    async getUserByEmail(email: string): Promise<User | null> {\n        const result = await db\n            .select()\n            .from(users)\n            .where(eq(users.email, email))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getUserById(id: number): Promise<User | null> {\n        const result = await db\n            .select()\n            .from(users)\n            .where(eq(users.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getUserByFirebaseUid(uid: string): Promise<User | null> {\n        const result = await db\n            .select()\n            .from(users)\n            .where(eq(users.firebaseUid, uid))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getUserByUniqueUserId(uniqueUserId: string): Promise<User | null> {\n        const result = await db\n            .select()\n            .from(users)\n            .where(eq(users.uniqueUserId, uniqueUserId))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getUserByDisplayName(displayName: string): Promise<User | null> {\n        const result = await db\n            .select()\n            .from(users)\n            .where(eq(users.displayName, displayName))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async createUser(user: InsertUser): Promise<User> {\n        const prefix = user.role === \"team_leader\" ? \"TEAM\" : \"USER\";\n        const uniqueUserId = generateUniqueId(prefix);\n        const result = await db\n            .insert(users)\n            .values({ ...user, uniqueUserId })\n            .returning();\n        return result[0];\n    }\n\n    async updateUserRole(id: number, role: string): Promise<void> {\n        await db.update(users).set({ role }).where(eq(users.id, id));\n    }\n\n    async updateUserPassword(id: number, password: string): Promise<void> {\n        await db.update(users).set({ password }).where(eq(users.id, id));\n    }\n\n    async toggleUserStatus(id: number, isActive: boolean): Promise<void> {\n        await db.update(users).set({ isActive }).where(eq(users.id, id));\n    }\n\n    async getAllUsers(includeDeleted: boolean = false): Promise<User[]> {\n        if (includeDeleted) {\n            return await db.select().from(users);\n        }\n        return await db.select().from(users).where(eq(users.isActive, true));\n    }\n\n    async deleteUser(id: number): Promise<void> {\n        await db.delete(users).where(eq(users.id, id));\n    }\n\n    async softDeleteUser(id: number): Promise<void> {\n        await db\n            .update(users)\n            .set({\n                isActive: false,\n                deletedAt: new Date(),\n            })\n            .where(eq(users.id, id));\n    }\n\n    async deleteAllUserData(id: number): Promise<void> {\n        // Delete all user-related data from all tables in proper FK order\n        \n        // First: Nullify nullable references, delete non-nullable ones\n        await db.update(adminActivityLogs).set({ targetUserId: null }).where(eq(adminActivityLogs.targetUserId, id));\n        await db.delete(adminActivityLogs).where(eq(adminActivityLogs.performedBy, id));\n        await db.update(leaves).set({ approvedBy: null }).where(eq(leaves.approvedBy, id));\n        await db.update(correctionRequests).set({ reviewedBy: null }).where(eq(correctionRequests.reviewedBy, id));\n        \n        // Delete device tokens\n        await db.delete(deviceTokens).where(eq(deviceTokens.userId, id));\n        \n        // Delete rewards\n        await db.delete(rewards).where(eq(rewards.userId, id));\n        \n        // Delete attendance logs first (references attendanceRecords)\n        const userAttendanceRecords = await db.select({ id: attendanceRecords.id }).from(attendanceRecords).where(eq(attendanceRecords.userId, id));\n        for (const record of userAttendanceRecords) {\n            await db.delete(attendanceLogs).where(eq(attendanceLogs.attendanceId, record.id));\n        }\n        await db.delete(attendanceLogs).where(eq(attendanceLogs.performedBy, id));\n        \n        // Delete correction requests (must be after attendanceRecords dependency check)\n        await db.delete(correctionRequests).where(eq(correctionRequests.userId, id));\n        \n        // Delete attendance records\n        await db.delete(attendanceRecords).where(eq(attendanceRecords.userId, id));\n        \n        // Delete task time logs\n        await db.delete(taskTimeLogs).where(eq(taskTimeLogs.userId, id));\n        \n        // Delete tasks reports\n        await db.delete(tasksReports).where(eq(tasksReports.userId, id));\n        \n        // Delete leaves\n        await db.delete(leaves).where(eq(leaves.userId, id));\n        \n        // Delete archive reports\n        await db.delete(archiveReports).where(eq(archiveReports.userId, id));\n        \n        // Delete file uploads\n        await db.delete(fileUploads).where(eq(fileUploads.userId, id));\n        \n        // Delete ratings (both as rater and rated)\n        await db.delete(ratings).where(eq(ratings.userId, id));\n        await db.delete(ratings).where(eq(ratings.ratedBy, id));\n        \n        // Delete team assignments where user is either leader or member\n        await db.delete(teamAssignments).where(eq(teamAssignments.teamLeaderId, id));\n        await db.delete(teamAssignments).where(eq(teamAssignments.memberId, id));\n        \n        // Delete reports by this user\n        await db.delete(reports).where(eq(reports.userId, id));\n        \n        // Delete group message replies first (references groupMessages)\n        await db.delete(groupMessageReplies).where(eq(groupMessageReplies.senderId, id));\n        \n        // Delete group messages\n        await db.delete(groupMessages).where(eq(groupMessages.senderId, id));\n        \n        // Delete messages where user is either sender or receiver\n        await db.delete(messages).where(eq(messages.senderId, id));\n        await db.delete(messages).where(eq(messages.receiverId, id));\n        \n        // Delete feedbacks\n        await db.delete(feedbacks).where(eq(feedbacks.submittedBy, id));\n        \n        // Delete followups created by user\n        await db.delete(followups).where(eq(followups.createdBy, id));\n        \n        // Delete enquiries created by user\n        await db.delete(enquiries).where(eq(enquiries.createdBy, id));\n        \n        // Delete tasks - need to handle all task-related FKs first\n        // Get tasks assigned to this user to clean up their dependencies\n        const userTasks = await db.select({ id: tasks.id }).from(tasks).where(eq(tasks.assignedTo, id));\n        for (const task of userTasks) {\n            // Delete task time logs for this task (from any user)\n            await db.delete(taskTimeLogs).where(eq(taskTimeLogs.taskId, task.id));\n            // Nullify message references to this task\n            await db.update(messages).set({ relatedTaskId: null }).where(eq(messages.relatedTaskId, task.id));\n        }\n        \n        // Null out assignedBy references, then delete assigned tasks\n        await db.update(tasks).set({ assignedBy: null }).where(eq(tasks.assignedBy, id));\n        await db.delete(tasks).where(eq(tasks.assignedTo, id));\n        \n        // Finally delete the user\n        await db.delete(users).where(eq(users.id, id));\n    }\n\n    async createTask(task: InsertTask): Promise<Task> {\n        const result = await db.insert(tasks).values(task).returning();\n        return result[0];\n    }\n\n    async getTaskById(id: number): Promise<Task | null> {\n        const result = await db\n            .select()\n            .from(tasks)\n            .where(eq(tasks.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getTasksByUserId(userId: number): Promise<Task[]> {\n        return await db\n            .select()\n            .from(tasks)\n            .where(eq(tasks.assignedTo, userId))\n            .orderBy(desc(tasks.createdAt));\n    }\n\n    async getTasksByAssignedBy(assignedBy: number): Promise<Task[]> {\n        return await db\n            .select()\n            .from(tasks)\n            .where(eq(tasks.assignedBy, assignedBy))\n            .orderBy(desc(tasks.createdAt));\n    }\n\n    async getTasksByCompanyId(companyId: number): Promise<Task[]> {\n        return await db\n            .select()\n            .from(tasks)\n            .where(eq(tasks.companyId, companyId))\n            .orderBy(desc(tasks.createdAt));\n    }\n\n    async getAllTasks(): Promise<Task[]> {\n        return await db.select().from(tasks).orderBy(desc(tasks.createdAt));\n    }\n\n    async updateTaskStatus(id: number, status: string): Promise<void> {\n        await db\n            .update(tasks)\n            .set({ status, updatedAt: new Date() })\n            .where(eq(tasks.id, id));\n    }\n\n    async updateTask(id: number, updates: Partial<InsertTask>): Promise<void> {\n        await db\n            .update(tasks)\n            .set({ ...updates, updatedAt: new Date() })\n            .where(eq(tasks.id, id));\n    }\n\n    async deleteTask(id: number): Promise<void> {\n        // Clear any messages that reference this task first\n        await db\n            .update(messages)\n            .set({ relatedTaskId: null })\n            .where(eq(messages.relatedTaskId, id));\n\n        // Delete any task time logs for this task\n        await db.delete(taskTimeLogs).where(eq(taskTimeLogs.taskId, id));\n\n        await db.delete(tasks).where(eq(tasks.id, id));\n    }\n\n    async createReport(report: InsertReport): Promise<Report> {\n        const result = await db.insert(reports).values(report).returning();\n        return result[0];\n    }\n\n    async getReportsByUserId(userId: number): Promise<Report[]> {\n        return await db\n            .select()\n            .from(reports)\n            .where(eq(reports.userId, userId))\n            .orderBy(desc(reports.createdAt));\n    }\n\n    async getReportsByUserAndDate(\n        userId: number,\n        startDate: Date,\n        endDate: Date\n    ): Promise<Report[]> {\n        return await db\n            .select()\n            .from(reports)\n            .where(\n                and(\n                    eq(reports.userId, userId),\n                    gte(reports.createdAt, startDate),\n                    lte(reports.createdAt, endDate)\n                )\n            )\n            .orderBy(desc(reports.createdAt));\n    }\n\n    async getReportsByCompanyId(companyId: number): Promise<Report[]> {\n        return await db\n            .select()\n            .from(reports)\n            .where(eq(reports.companyId, companyId))\n            .orderBy(desc(reports.createdAt));\n    }\n\n    async getAllReports(): Promise<Report[]> {\n        return await db.select().from(reports).orderBy(desc(reports.createdAt));\n    }\n\n    async getReportsByDate(startDate: Date, endDate: Date): Promise<Report[]> {\n        return await db\n            .select()\n            .from(reports)\n            .where(\n                and(\n                    gte(reports.createdAt, startDate),\n                    lte(reports.createdAt, endDate)\n                )\n            )\n            .orderBy(desc(reports.createdAt));\n    }\n\n    async createMessage(message: InsertMessage): Promise<Message> {\n        const result = await db.insert(messages).values(message).returning();\n        return result[0];\n    }\n\n    async getMessagesByReceiverId(receiverId: number): Promise<Message[]> {\n        return await db\n            .select()\n            .from(messages)\n            .where(eq(messages.receiverId, receiverId))\n            .orderBy(desc(messages.createdAt));\n    }\n\n    async getUnreadMessagesByReceiverId(\n        receiverId: number\n    ): Promise<Message[]> {\n        return await db\n            .select()\n            .from(messages)\n            .where(\n                and(\n                    eq(messages.receiverId, receiverId),\n                    eq(messages.readStatus, false)\n                )\n            )\n            .orderBy(desc(messages.createdAt));\n    }\n\n    async markMessageAsRead(id: number): Promise<void> {\n        await db\n            .update(messages)\n            .set({ readStatus: true })\n            .where(eq(messages.id, id));\n    }\n\n    async getAllMessages(): Promise<Message[]> {\n        return await db\n            .select()\n            .from(messages)\n            .orderBy(desc(messages.createdAt));\n    }\n\n    async createOrUpdateDeviceToken(\n        tokenData: InsertDeviceToken\n    ): Promise<DeviceToken> {\n        const existing = await db\n            .select()\n            .from(deviceTokens)\n            .where(eq(deviceTokens.token, tokenData.token))\n            .limit(1);\n\n        if (existing.length > 0) {\n            await db\n                .update(deviceTokens)\n                .set({ ...tokenData, updatedAt: new Date() })\n                .where(eq(deviceTokens.token, tokenData.token));\n\n            const result = await db\n                .select()\n                .from(deviceTokens)\n                .where(eq(deviceTokens.token, tokenData.token))\n                .limit(1);\n            return result[0];\n        }\n\n        const result = await db\n            .insert(deviceTokens)\n            .values(tokenData)\n            .returning();\n        return result[0];\n    }\n\n    async getDeviceTokensByUserId(userId: number): Promise<DeviceToken[]> {\n        return await db\n            .select()\n            .from(deviceTokens)\n            .where(eq(deviceTokens.userId, userId));\n    }\n\n    async deleteDeviceToken(token: string): Promise<void> {\n        await db.delete(deviceTokens).where(eq(deviceTokens.token, token));\n    }\n\n    async createRating(rating: InsertRating): Promise<Rating> {\n        const result = await db.insert(ratings).values(rating).returning();\n        return result[0];\n    }\n\n    async getRatingsByUserId(userId: number): Promise<Rating[]> {\n        return await db\n            .select()\n            .from(ratings)\n            .where(eq(ratings.userId, userId))\n            .orderBy(desc(ratings.createdAt));\n    }\n\n    async getLatestRatingByUserId(userId: number): Promise<Rating | null> {\n        const result = await db\n            .select()\n            .from(ratings)\n            .where(eq(ratings.userId, userId))\n            .orderBy(desc(ratings.createdAt))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getAllRatings(): Promise<Rating[]> {\n        return await db.select().from(ratings).orderBy(desc(ratings.createdAt));\n    }\n\n    async createFileUpload(file: InsertFileUpload): Promise<FileUpload> {\n        const result = await db.insert(fileUploads).values(file).returning();\n        return result[0];\n    }\n\n    async getFilesByUserId(userId: number): Promise<FileUpload[]> {\n        return await db\n            .select()\n            .from(fileUploads)\n            .where(eq(fileUploads.userId, userId))\n            .orderBy(desc(fileUploads.uploadedAt));\n    }\n\n    async getFilesByReportId(reportId: number): Promise<FileUpload[]> {\n        return await db\n            .select()\n            .from(fileUploads)\n            .where(eq(fileUploads.reportId, reportId))\n            .orderBy(desc(fileUploads.uploadedAt));\n    }\n\n    async getAllFiles(): Promise<FileUpload[]> {\n        return await db\n            .select()\n            .from(fileUploads)\n            .orderBy(desc(fileUploads.uploadedAt));\n    }\n\n    async archiveReports(month: number, year: number): Promise<void> {\n        const startDate = new Date(year, month - 1, 1);\n        const endDate = new Date(year, month, 0, 23, 59, 59);\n\n        const reportsToArchive = await db\n            .select()\n            .from(reports)\n            .where(\n                and(\n                    gte(reports.createdAt, startDate),\n                    lte(reports.createdAt, endDate)\n                )\n            );\n\n        if (reportsToArchive.length > 0) {\n            const archiveData = reportsToArchive.map((report) => ({\n                userId: report.userId,\n                reportType: report.reportType,\n                plannedTasks: report.plannedTasks,\n                completedTasks: report.completedTasks,\n                pendingTasks: report.pendingTasks,\n                notes: report.notes,\n                originalDate: report.createdAt,\n            }));\n\n            await db.insert(archiveReports).values(archiveData);\n            await db\n                .delete(reports)\n                .where(\n                    and(\n                        gte(reports.createdAt, startDate),\n                        lte(reports.createdAt, endDate)\n                    )\n                );\n        }\n    }\n\n    async getArchivedReports(userId?: number): Promise<ArchiveReport[]> {\n        if (userId) {\n            return await db\n                .select()\n                .from(archiveReports)\n                .where(eq(archiveReports.userId, userId))\n                .orderBy(desc(archiveReports.originalDate));\n        }\n        return await db\n            .select()\n            .from(archiveReports)\n            .orderBy(desc(archiveReports.originalDate));\n    }\n\n    async createGroupMessage(\n        message: InsertGroupMessage\n    ): Promise<GroupMessage> {\n        const result = await db\n            .insert(groupMessages)\n            .values(message)\n            .returning();\n        return result[0];\n    }\n\n    async getGroupMessageById(id: number): Promise<GroupMessage | null> {\n        const result = await db\n            .select()\n            .from(groupMessages)\n            .where(eq(groupMessages.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getAllGroupMessages(): Promise<GroupMessage[]> {\n        return await db\n            .select()\n            .from(groupMessages)\n            .orderBy(desc(groupMessages.createdAt));\n    }\n\n    async getGroupMessagesByCompanyId(\n        companyId: number\n    ): Promise<GroupMessage[]> {\n        return await db\n            .select()\n            .from(groupMessages)\n            .where(eq(groupMessages.companyId, companyId))\n            .orderBy(desc(groupMessages.createdAt));\n    }\n\n    async getRecentGroupMessages(limit: number): Promise<GroupMessage[]> {\n        return await db\n            .select()\n            .from(groupMessages)\n            .orderBy(desc(groupMessages.createdAt))\n            .limit(limit);\n    }\n\n    async createGroupMessageReply(\n        reply: InsertGroupMessageReply\n    ): Promise<GroupMessageReply> {\n        const result = await db\n            .insert(groupMessageReplies)\n            .values(reply)\n            .returning();\n        return result[0];\n    }\n\n    async getGroupMessageReplies(\n        groupMessageId: number\n    ): Promise<GroupMessageReply[]> {\n        return await db\n            .select()\n            .from(groupMessageReplies)\n            .where(eq(groupMessageReplies.groupMessageId, groupMessageId))\n            .orderBy(groupMessageReplies.createdAt);\n    }\n\n    async getTaskTimeLog(\n        taskId: number,\n        userId: number,\n        date: string\n    ): Promise<TaskTimeLog | null> {\n        const result = await db\n            .select()\n            .from(taskTimeLogs)\n            .where(\n                and(\n                    eq(taskTimeLogs.taskId, taskId),\n                    eq(taskTimeLogs.userId, userId),\n                    eq(taskTimeLogs.date, date)\n                )\n            )\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async createOrUpdateTaskTimeLog(\n        log: InsertTaskTimeLog\n    ): Promise<TaskTimeLog> {\n        const existing = await this.getTaskTimeLog(\n            log.taskId,\n            log.userId,\n            log.date\n        );\n\n        if (existing) {\n            const result = await db\n                .update(taskTimeLogs)\n                .set({\n                    totalSeconds: log.totalSeconds,\n                    timerStartedAt: log.timerStartedAt,\n                    timerStatus: log.timerStatus,\n                    updatedAt: new Date(),\n                })\n                .where(\n                    and(\n                        eq(taskTimeLogs.taskId, log.taskId),\n                        eq(taskTimeLogs.userId, log.userId),\n                        eq(taskTimeLogs.date, log.date)\n                    )\n                )\n                .returning();\n            return result[0];\n        } else {\n            const result = await db\n                .insert(taskTimeLogs)\n                .values(log)\n                .returning();\n            return result[0];\n        }\n    }\n\n    async startTaskTimer(\n        taskId: number,\n        userId: number,\n        date: string\n    ): Promise<TaskTimeLog> {\n        const existing = await this.getTaskTimeLog(taskId, userId, date);\n\n        const log: InsertTaskTimeLog = {\n            taskId,\n            userId,\n            date,\n            totalSeconds: existing?.totalSeconds || 0,\n            timerStartedAt: new Date(),\n            timerStatus: \"running\",\n        };\n\n        return await this.createOrUpdateTaskTimeLog(log);\n    }\n\n    async pauseTaskTimer(\n        taskId: number,\n        userId: number,\n        date: string\n    ): Promise<TaskTimeLog> {\n        const existing = await this.getTaskTimeLog(taskId, userId, date);\n\n        if (!existing || !existing.timerStartedAt) {\n            throw new Error(\"Timer not running\");\n        }\n\n        const elapsedSeconds = Math.floor(\n            (Date.now() - new Date(existing.timerStartedAt).getTime()) / 1000\n        );\n\n        const log: InsertTaskTimeLog = {\n            taskId,\n            userId,\n            date,\n            totalSeconds: existing.totalSeconds + elapsedSeconds,\n            timerStartedAt: null,\n            timerStatus: \"paused\",\n        };\n\n        return await this.createOrUpdateTaskTimeLog(log);\n    }\n\n    async completeTaskTimer(\n        taskId: number,\n        userId: number,\n        date: string\n    ): Promise<TaskTimeLog> {\n        const existing = await this.getTaskTimeLog(taskId, userId, date);\n\n        let totalSeconds = existing?.totalSeconds || 0;\n\n        if (existing?.timerStartedAt) {\n            const elapsedSeconds = Math.floor(\n                (Date.now() - new Date(existing.timerStartedAt).getTime()) /\n                    1000\n            );\n            totalSeconds += elapsedSeconds;\n        }\n\n        const log: InsertTaskTimeLog = {\n            taskId,\n            userId,\n            date,\n            totalSeconds,\n            timerStartedAt: null,\n            timerStatus: \"completed\",\n        };\n\n        return await this.createOrUpdateTaskTimeLog(log);\n    }\n\n    async getTaskTimeLogs(\n        taskId: number,\n        userId: number\n    ): Promise<TaskTimeLog[]> {\n        return await db\n            .select()\n            .from(taskTimeLogs)\n            .where(\n                and(\n                    eq(taskTimeLogs.taskId, taskId),\n                    eq(taskTimeLogs.userId, userId)\n                )\n            )\n            .orderBy(desc(taskTimeLogs.date));\n    }\n\n    async createFeedback(feedback: InsertFeedback): Promise<Feedback> {\n        const result = await db.insert(feedbacks).values(feedback).returning();\n        return result[0];\n    }\n\n    async getAllFeedbacks(): Promise<Feedback[]> {\n        return await db\n            .select()\n            .from(feedbacks)\n            .orderBy(desc(feedbacks.createdAt));\n    }\n\n    async getFeedbacksByUserId(userId: number): Promise<Feedback[]> {\n        return await db\n            .select()\n            .from(feedbacks)\n            .where(eq(feedbacks.submittedBy, userId))\n            .orderBy(desc(feedbacks.createdAt));\n    }\n\n    async getFeedbacksByCompanyId(companyId: number): Promise<Feedback[]> {\n        return await db\n            .select()\n            .from(feedbacks)\n            .where(eq(feedbacks.companyId, companyId))\n            .orderBy(desc(feedbacks.createdAt));\n    }\n\n    async getFeedbackById(id: number): Promise<Feedback | null> {\n        const result = await db\n            .select()\n            .from(feedbacks)\n            .where(eq(feedbacks.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async respondToFeedback(id: number, adminResponse: string): Promise<void> {\n        await db\n            .update(feedbacks)\n            .set({ adminResponse, respondedAt: new Date() })\n            .where(eq(feedbacks.id, id));\n    }\n\n    async createOrUpdateSlotPricing(\n        pricing: InsertSlotPricing\n    ): Promise<SlotPricing> {\n        const existing = await this.getSlotPricingByType(pricing.slotType);\n\n        if (existing) {\n            await db\n                .update(slotPricing)\n                .set({ ...pricing, updatedAt: new Date() })\n                .where(eq(slotPricing.slotType, pricing.slotType));\n\n            return (await this.getSlotPricingByType(pricing.slotType))!;\n        } else {\n            const result = await db\n                .insert(slotPricing)\n                .values(pricing)\n                .returning();\n            return result[0];\n        }\n    }\n\n    async getAllSlotPricing(): Promise<SlotPricing[]> {\n        return await db.select().from(slotPricing);\n    }\n\n    async getSlotPricingByType(slotType: string): Promise<SlotPricing | null> {\n        const result = await db\n            .select()\n            .from(slotPricing)\n            .where(eq(slotPricing.slotType, slotType))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async createCompanyPayment(\n        payment: InsertCompanyPayment\n    ): Promise<CompanyPayment> {\n        const result = await db\n            .insert(companyPayments)\n            .values(payment)\n            .returning();\n        return result[0];\n    }\n\n    async getPaymentsByCompanyId(companyId: number): Promise<CompanyPayment[]> {\n        return await db\n            .select()\n            .from(companyPayments)\n            .where(eq(companyPayments.companyId, companyId))\n            .orderBy(desc(companyPayments.createdAt));\n    }\n\n    async getAllCompanyPayments(): Promise<CompanyPayment[]> {\n        return await db\n            .select()\n            .from(companyPayments)\n            .orderBy(desc(companyPayments.createdAt));\n    }\n\n    async getPaymentById(id: number): Promise<CompanyPayment | null> {\n        const result = await db\n            .select()\n            .from(companyPayments)\n            .where(eq(companyPayments.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async updatePaymentStatus(\n        id: number,\n        updates: { paymentStatus: string; transactionId?: string }\n    ): Promise<void> {\n        await db\n            .update(companyPayments)\n            .set(updates)\n            .where(eq(companyPayments.id, id));\n    }\n\n    async updatePaymentStripeId(\n        id: number,\n        stripePaymentIntentId: string\n    ): Promise<void> {\n        await db\n            .update(companyPayments)\n            .set({ stripePaymentIntentId })\n            .where(eq(companyPayments.id, id));\n    }\n\n    async completePaymentWithSlots(\n        paymentId: number,\n        companyId: number,\n        receiptNumber: string,\n        transactionId: string,\n        slotUpdates: { maxAdmins?: number; maxMembers?: number }\n    ): Promise<CompanyPayment | null> {\n        return await db.transaction(async (tx) => {\n            // Step 1: Mark payment as paid ONLY if still pending (gate check first!)\n            const result = await tx\n                .update(companyPayments)\n                .set({\n                    paymentStatus: \"paid\",\n                    receiptNumber,\n                    transactionId,\n                    emailSent: false,\n                })\n                .where(\n                    and(\n                        eq(companyPayments.id, paymentId),\n                        eq(companyPayments.paymentStatus, \"pending\")\n                    )\n                )\n                .returning();\n\n            // If payment already processed, return null immediately (don't touch slots)\n            if (result.length === 0) {\n                return null;\n            }\n\n            // Step 2: Increment company slots ONLY if payment update succeeded\n            if (slotUpdates.maxAdmins) {\n                await tx\n                    .update(companies)\n                    .set({\n                        maxAdmins: sql`${companies.maxAdmins} + ${slotUpdates.maxAdmins}`,\n                    })\n                    .where(eq(companies.id, companyId));\n            }\n            if (slotUpdates.maxMembers) {\n                await tx\n                    .update(companies)\n                    .set({\n                        maxMembers: sql`${companies.maxMembers} + ${slotUpdates.maxMembers}`,\n                    })\n                    .where(eq(companies.id, companyId));\n            }\n\n            return result[0];\n        });\n    }\n\n    async updatePaymentEmailStatus(\n        id: number,\n        emailSent: boolean\n    ): Promise<void> {\n        await db\n            .update(companyPayments)\n            .set({ emailSent })\n            .where(eq(companyPayments.id, id));\n    }\n\n    async createPasswordResetToken(\n        email: string,\n        token: string,\n        expiresAt: Date\n    ): Promise<PasswordResetToken> {\n        const result = await db\n            .insert(passwordResetTokens)\n            .values({ email, token, expiresAt })\n            .returning();\n        return result[0];\n    }\n\n    async getPasswordResetToken(\n        token: string\n    ): Promise<PasswordResetToken | null> {\n        const result = await db\n            .select()\n            .from(passwordResetTokens)\n            .where(eq(passwordResetTokens.token, token))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async markTokenAsUsed(token: string): Promise<void> {\n        await db\n            .update(passwordResetTokens)\n            .set({ used: true })\n            .where(eq(passwordResetTokens.token, token));\n    }\n\n    async getDashboardStats(companyId?: number): Promise<{\n        totalUsers: number;\n        todayReports: number;\n        pendingTasks: number;\n        completedTasks: number;\n        totalFiles: number;\n    }> {\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const tomorrow = new Date(today);\n        tomorrow.setDate(tomorrow.getDate() + 1);\n\n        const [userCount] = companyId\n            ? await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(users)\n                  .where(\n                      and(\n                          eq(users.companyId, companyId),\n                          eq(users.isActive, true)\n                      )\n                  )\n            : await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(users)\n                  .where(eq(users.isActive, true));\n\n        const [todayReportCount] = companyId\n            ? await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(reports)\n                  .where(\n                      and(\n                          gte(reports.createdAt, today),\n                          eq(reports.companyId, companyId)\n                      )\n                  )\n            : await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(reports)\n                  .where(gte(reports.createdAt, today));\n\n        const [pendingTaskCount] = companyId\n            ? await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(tasks)\n                  .where(\n                      and(\n                          eq(tasks.status, \"pending\"),\n                          eq(tasks.companyId, companyId)\n                      )\n                  )\n            : await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(tasks)\n                  .where(eq(tasks.status, \"pending\"));\n\n        const [completedTaskCount] = companyId\n            ? await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(tasks)\n                  .where(\n                      and(\n                          eq(tasks.status, \"completed\"),\n                          eq(tasks.companyId, companyId)\n                      )\n                  )\n            : await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(tasks)\n                  .where(eq(tasks.status, \"completed\"));\n\n        const [fileCount] = companyId\n            ? await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(fileUploads)\n                  .innerJoin(users, eq(fileUploads.userId, users.id))\n                  .where(eq(users.companyId, companyId))\n            : await db\n                  .select({ count: sql<number>`count(*)` })\n                  .from(fileUploads);\n\n        return {\n            totalUsers: Number(userCount.count),\n            todayReports: Number(todayReportCount.count),\n            pendingTasks: Number(pendingTaskCount.count),\n            completedTasks: Number(completedTaskCount.count),\n            totalFiles: Number(fileCount.count),\n        };\n    }\n\n    async createAdminActivityLog(\n        log: InsertAdminActivityLog\n    ): Promise<AdminActivityLog> {\n        const result = await db\n            .insert(adminActivityLogs)\n            .values(log)\n            .returning();\n        return result[0];\n    }\n\n    async getAllAdminActivityLogs(limit?: number): Promise<AdminActivityLog[]> {\n        const query = db\n            .select()\n            .from(adminActivityLogs)\n            .orderBy(desc(adminActivityLogs.createdAt));\n        if (limit) {\n            return await query.limit(limit);\n        }\n        return await query;\n    }\n\n    async getAdminActivityLogsByCompany(\n        companyId: number\n    ): Promise<AdminActivityLog[]> {\n        return await db\n            .select()\n            .from(adminActivityLogs)\n            .where(eq(adminActivityLogs.targetCompanyId, companyId))\n            .orderBy(desc(adminActivityLogs.createdAt));\n    }\n\n    async getAdminActivityLogsByUser(\n        userId: number\n    ): Promise<AdminActivityLog[]> {\n        return await db\n            .select()\n            .from(adminActivityLogs)\n            .where(\n                or(\n                    eq(adminActivityLogs.performedBy, userId),\n                    eq(adminActivityLogs.targetUserId, userId)\n                )\n            )\n            .orderBy(desc(adminActivityLogs.createdAt));\n    }\n\n    async getSuperAdminAnalytics(): Promise<{\n        totalCompanies: number;\n        activeCompanies: number;\n        suspendedCompanies: number;\n        totalUsers: number;\n        totalAdmins: number;\n        totalMembers: number;\n        totalTasks: number;\n        totalPayments: number;\n        totalRevenue: number;\n        recentPayments: CompanyPayment[];\n    }> {\n        const [totalCompaniesResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(companies);\n        const [activeCompaniesResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(companies)\n            .where(eq(companies.isActive, true));\n        const [suspendedCompaniesResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(companies)\n            .where(eq(companies.isActive, false));\n        const [totalUsersResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(users)\n            .where(eq(users.isActive, true));\n        const [totalAdminsResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(users)\n            .where(\n                and(eq(users.isActive, true), eq(users.role, \"company_admin\"))\n            );\n        const [totalMembersResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(users)\n            .where(\n                and(\n                    eq(users.isActive, true),\n                    or(\n                        eq(users.role, \"company_member\"),\n                        eq(users.role, \"team_leader\")\n                    )\n                )\n            );\n        const [totalTasksResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(tasks);\n        const [totalPaymentsResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(companyPayments);\n        const [totalRevenueResult] = await db\n            .select({ total: sql<number>`COALESCE(SUM(amount), 0)` })\n            .from(companyPayments)\n            .where(eq(companyPayments.paymentStatus, \"paid\"));\n\n        const recentPayments = await db\n            .select()\n            .from(companyPayments)\n            .orderBy(desc(companyPayments.createdAt))\n            .limit(10);\n\n        return {\n            totalCompanies: Number(totalCompaniesResult.count),\n            activeCompanies: Number(activeCompaniesResult.count),\n            suspendedCompanies: Number(suspendedCompaniesResult.count),\n            totalUsers: Number(totalUsersResult.count),\n            totalAdmins: Number(totalAdminsResult.count),\n            totalMembers: Number(totalMembersResult.count),\n            totalTasks: Number(totalTasksResult.count),\n            totalPayments: Number(totalPaymentsResult.count),\n            totalRevenue: Number(totalRevenueResult.total),\n            recentPayments,\n        };\n    }\n\n    async getCompanyWithStats(companyId: number): Promise<{\n        company: Company;\n        userCount: number;\n        adminCount: number;\n        memberCount: number;\n        taskCount: number;\n        totalPayments: number;\n        totalRevenue: number;\n    } | null> {\n        const company = await this.getCompanyById(companyId);\n        if (!company) {\n            return null;\n        }\n\n        const [userCountResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(users)\n            .where(\n                and(eq(users.companyId, companyId), eq(users.isActive, true))\n            );\n        const [adminCountResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(users)\n            .where(\n                and(\n                    eq(users.companyId, companyId),\n                    eq(users.isActive, true),\n                    eq(users.role, \"company_admin\")\n                )\n            );\n        const [memberCountResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(users)\n            .where(\n                and(\n                    eq(users.companyId, companyId),\n                    eq(users.isActive, true),\n                    or(\n                        eq(users.role, \"company_member\"),\n                        eq(users.role, \"team_leader\")\n                    )\n                )\n            );\n        const [taskCountResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(tasks)\n            .where(eq(tasks.companyId, companyId));\n        const [paymentCountResult] = await db\n            .select({ count: sql<number>`count(*)` })\n            .from(companyPayments)\n            .where(eq(companyPayments.companyId, companyId));\n        const [revenueResult] = await db\n            .select({ total: sql<number>`COALESCE(SUM(amount), 0)` })\n            .from(companyPayments)\n            .where(\n                and(\n                    eq(companyPayments.companyId, companyId),\n                    eq(companyPayments.paymentStatus, \"paid\")\n                )\n            );\n\n        return {\n            company,\n            userCount: Number(userCountResult.count),\n            adminCount: Number(adminCountResult.count),\n            memberCount: Number(memberCountResult.count),\n            taskCount: Number(taskCountResult.count),\n            totalPayments: Number(paymentCountResult.count),\n            totalRevenue: Number(revenueResult.total),\n        };\n    }\n\n    async getAllCompaniesWithStats(): Promise<\n        Array<{\n            company: Company;\n            userCount: number;\n            adminCount: number;\n            memberCount: number;\n        }>\n    > {\n        const allCompanies = await db\n            .select()\n            .from(companies)\n            .orderBy(desc(companies.createdAt));\n\n        const companiesWithStats = await Promise.all(\n            allCompanies.map(async (company) => {\n                const [userCountResult] = await db\n                    .select({ count: sql<number>`count(*)` })\n                    .from(users)\n                    .where(\n                        and(\n                            eq(users.companyId, company.id),\n                            eq(users.isActive, true)\n                        )\n                    );\n                const [adminCountResult] = await db\n                    .select({ count: sql<number>`count(*)` })\n                    .from(users)\n                    .where(\n                        and(\n                            eq(users.companyId, company.id),\n                            eq(users.isActive, true),\n                            eq(users.role, \"company_admin\")\n                        )\n                    );\n                const [memberCountResult] = await db\n                    .select({ count: sql<number>`count(*)` })\n                    .from(users)\n                    .where(\n                        and(\n                            eq(users.companyId, company.id),\n                            eq(users.isActive, true),\n                            or(\n                                eq(users.role, \"company_member\"),\n                                eq(users.role, \"team_leader\")\n                            )\n                        )\n                    );\n\n                return {\n                    company,\n                    userCount: Number(userCountResult.count),\n                    adminCount: Number(adminCountResult.count),\n                    memberCount: Number(memberCountResult.count),\n                };\n            })\n        );\n\n        return companiesWithStats;\n    }\n\n    async suspendCompany(\n        companyId: number,\n        performedBy: number\n    ): Promise<void> {\n        await db\n            .update(companies)\n            .set({ isActive: false, updatedAt: new Date() })\n            .where(eq(companies.id, companyId));\n\n        await this.createAdminActivityLog({\n            actionType: \"suspend_company\",\n            performedBy,\n            targetCompanyId: companyId,\n            details: \"Company suspended by Super Admin\",\n        });\n    }\n\n    async reactivateCompany(\n        companyId: number,\n        performedBy: number\n    ): Promise<void> {\n        await db\n            .update(companies)\n            .set({ isActive: true, updatedAt: new Date() })\n            .where(eq(companies.id, companyId));\n\n        await this.createAdminActivityLog({\n            actionType: \"reactivate_company\",\n            performedBy,\n            targetCompanyId: companyId,\n            details: \"Company reactivated by Super Admin\",\n        });\n    }\n\n    async getPaymentsByDateRange(\n        startDate: Date,\n        endDate: Date\n    ): Promise<CompanyPayment[]> {\n        return await db\n            .select()\n            .from(companyPayments)\n            .where(\n                and(\n                    gte(companyPayments.createdAt, startDate),\n                    lte(companyPayments.createdAt, endDate)\n                )\n            )\n            .orderBy(desc(companyPayments.createdAt));\n    }\n\n    async getPaymentsByStatus(status: string): Promise<CompanyPayment[]> {\n        return await db\n            .select()\n            .from(companyPayments)\n            .where(eq(companyPayments.paymentStatus, status))\n            .orderBy(desc(companyPayments.createdAt));\n    }\n\n    async createBadge(badge: InsertBadge): Promise<Badge> {\n        const result = await db.insert(badges).values(badge).returning();\n        return result[0];\n    }\n\n    async getAllBadges(): Promise<Badge[]> {\n        return await db.select().from(badges).orderBy(badges.name);\n    }\n\n    async getBadgeById(id: number): Promise<Badge | null> {\n        const result = await db\n            .select()\n            .from(badges)\n            .where(eq(badges.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async createLeave(leave: InsertLeave): Promise<Leave> {\n        const result = await db.insert(leaves).values(leave).returning();\n        return result[0];\n    }\n\n    async getLeavesByUserId(userId: number): Promise<any[]> {\n        const results = await db\n            .select()\n            .from(leaves)\n            .where(eq(leaves.userId, userId))\n            .orderBy(desc(leaves.createdAt));\n\n        return results.map((r) => ({\n            ...r,\n            appliedDate: r.createdAt,\n        }));\n    }\n\n    async getLeavesByCompanyId(companyId: number): Promise<any[]> {\n        const results = await db\n            .select({\n                id: leaves.id,\n                userId: leaves.userId,\n                companyId: leaves.companyId,\n                leaveType: leaves.leaveType,\n                startDate: leaves.startDate,\n                endDate: leaves.endDate,\n                reason: leaves.reason,\n                status: leaves.status,\n                approvedBy: leaves.approvedBy,\n                remarks: leaves.remarks,\n                createdAt: leaves.createdAt,\n                updatedAt: leaves.updatedAt,\n                userName: users.displayName,\n            })\n            .from(leaves)\n            .leftJoin(users, eq(leaves.userId, users.id))\n            .where(eq(leaves.companyId, companyId))\n            .orderBy(desc(leaves.createdAt));\n\n        return results.map((r) => ({\n            ...r,\n            appliedDate: r.createdAt,\n        }));\n    }\n\n    async getLeavesByUserIds(userIds: number[]): Promise<any[]> {\n        if (userIds.length === 0) {\n            return [];\n        }\n\n        const results = await db\n            .select({\n                id: leaves.id,\n                userId: leaves.userId,\n                companyId: leaves.companyId,\n                leaveType: leaves.leaveType,\n                startDate: leaves.startDate,\n                endDate: leaves.endDate,\n                reason: leaves.reason,\n                status: leaves.status,\n                approvedBy: leaves.approvedBy,\n                remarks: leaves.remarks,\n                createdAt: leaves.createdAt,\n                updatedAt: leaves.updatedAt,\n                userName: users.displayName,\n            })\n            .from(leaves)\n            .leftJoin(users, eq(leaves.userId, users.id))\n            .where(inArray(leaves.userId, userIds))\n            .orderBy(desc(leaves.createdAt));\n\n        return results.map((r) => ({\n            ...r,\n            appliedDate: r.createdAt,\n        }));\n    }\n\n    async updateLeaveStatus(\n        leaveId: number,\n        status: string,\n        approvedBy: number,\n        remarks?: string\n    ): Promise<void> {\n        await db\n            .update(leaves)\n            .set({\n                status,\n                approvedBy,\n                remarks,\n                updatedAt: new Date(),\n            })\n            .where(eq(leaves.id, leaveId));\n    }\n\n    async getLeaveById(id: number): Promise<Leave | null> {\n        const result = await db\n            .select()\n            .from(leaves)\n            .where(eq(leaves.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async createHoliday(holiday: InsertHoliday): Promise<Holiday> {\n        const result = await db.insert(holidays).values(holiday).returning();\n        return result[0];\n    }\n\n    async getHolidaysByCompanyId(companyId: number): Promise<Holiday[]> {\n        return await db\n            .select()\n            .from(holidays)\n            .where(eq(holidays.companyId, companyId))\n            .orderBy(desc(holidays.date));\n    }\n\n    async getHolidayByDate(\n        companyId: number,\n        date: string\n    ): Promise<Holiday | null> {\n        const result = await db\n            .select()\n            .from(holidays)\n            .where(\n                and(eq(holidays.companyId, companyId), eq(holidays.date, date))\n            )\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async deleteHoliday(id: number): Promise<void> {\n        await db.delete(holidays).where(eq(holidays.id, id));\n    }\n\n    async updateHoliday(\n        id: number,\n        updates: Partial<InsertHoliday>\n    ): Promise<void> {\n        await db.update(holidays).set(updates).where(eq(holidays.id, id));\n    }\n\n    async createTasksReport(report: InsertTasksReport): Promise<TasksReport> {\n        const result = await db.insert(tasksReports).values(report).returning();\n        return result[0];\n    }\n\n    async getTasksReportByDate(\n        userId: number,\n        date: string\n    ): Promise<TasksReport | null> {\n        const result = await db\n            .select()\n            .from(tasksReports)\n            .where(\n                and(\n                    eq(tasksReports.userId, userId),\n                    eq(tasksReports.date, date)\n                )\n            )\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getTasksReportsByUserId(userId: number): Promise<TasksReport[]> {\n        return await db\n            .select()\n            .from(tasksReports)\n            .where(eq(tasksReports.userId, userId))\n            .orderBy(desc(tasksReports.date));\n    }\n\n    async getHolidayById(id: number): Promise<Holiday | null> {\n        const result = await db\n            .select()\n            .from(holidays)\n            .where(eq(holidays.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    // Auto Task operations (stub)\n    async createAutoTask(task: InsertAutoTask): Promise<AutoTask> {\n        const result = await db.insert(autoTasks).values(task).returning();\n        return result[0];\n    }\n\n    async getRecentAutoTasks(limit: number): Promise<AutoTask[]> {\n        return await db\n            .select()\n            .from(autoTasks)\n            .orderBy(desc(autoTasks.executedAt))\n            .limit(limit);\n    }\n\n    async getPendingLeaves(companyId: number): Promise<Leave[]> {\n        return await db\n            .select()\n            .from(leaves)\n            .where(\n                and(\n                    eq(leaves.companyId, companyId),\n                    eq(leaves.status, \"pending\")\n                )\n            )\n            .orderBy(desc(leaves.createdAt));\n    }\n\n    // ==================== NEW ATTENDANCE SYSTEM IMPLEMENTATIONS ====================\n\n    // Shift Management\n    async createShift(shift: InsertShift): Promise<Shift> {\n        const result = await db.insert(shifts).values(shift).returning();\n        return result[0];\n    }\n\n    async getShiftsByCompany(companyId: number): Promise<Shift[]> {\n        return await db\n            .select()\n            .from(shifts)\n            .where(eq(shifts.companyId, companyId))\n            .orderBy(desc(shifts.createdAt));\n    }\n\n    async getShiftById(id: number): Promise<Shift | null> {\n        const result = await db\n            .select()\n            .from(shifts)\n            .where(eq(shifts.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    // Attendance Policy Management\n    async createOrUpdateAttendancePolicy(\n        policy: InsertAttendancePolicy\n    ): Promise<AttendancePolicy> {\n        const existing = await db\n            .select()\n            .from(attendancePolicies)\n            .where(eq(attendancePolicies.companyId, policy.companyId))\n            .limit(1);\n\n        if (existing.length > 0) {\n            const updated = await db\n                .update(attendancePolicies)\n                .set({ ...policy, updatedAt: new Date() })\n                .where(eq(attendancePolicies.companyId, policy.companyId))\n                .returning();\n            return updated[0];\n        } else {\n            const result = await db\n                .insert(attendancePolicies)\n                .values(policy)\n                .returning();\n            return result[0];\n        }\n    }\n\n    async getAttendancePolicyByCompany(\n        companyId: number\n    ): Promise<AttendancePolicy | null> {\n        const result = await db\n            .select()\n            .from(attendancePolicies)\n            .where(eq(attendancePolicies.companyId, companyId))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    // Attendance Record Management\n    async createAttendanceRecord(\n        record: InsertAttendanceRecord\n    ): Promise<AttendanceRecord> {\n        const result = await db\n            .insert(attendanceRecords)\n            .values(record)\n            .returning();\n        return result[0];\n    }\n\n    async updateAttendanceRecord(\n        id: number,\n        updates: Partial<InsertAttendanceRecord>\n    ): Promise<AttendanceRecord> {\n        const result = await db\n            .update(attendanceRecords)\n            .set({ ...updates, updatedAt: new Date() })\n            .where(eq(attendanceRecords.id, id))\n            .returning();\n        return result[0];\n    }\n\n    async getAttendanceById(id: number): Promise<AttendanceRecord | null> {\n        const result = await db\n            .select()\n            .from(attendanceRecords)\n            .where(eq(attendanceRecords.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getAttendanceByUserAndDate(\n        userId: number,\n        date: string\n    ): Promise<AttendanceRecord | null> {\n        const result = await db\n            .select()\n            .from(attendanceRecords)\n            .where(\n                and(\n                    eq(attendanceRecords.userId, userId),\n                    eq(attendanceRecords.date, date)\n                )\n            )\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getAttendanceHistory(\n        userId: number,\n        startDate: string,\n        endDate: string\n    ): Promise<AttendanceRecord[]> {\n        return await db\n            .select()\n            .from(attendanceRecords)\n            .where(\n                and(\n                    eq(attendanceRecords.userId, userId),\n                    gte(attendanceRecords.date, startDate),\n                    lte(attendanceRecords.date, endDate)\n                )\n            )\n            .orderBy(desc(attendanceRecords.date));\n    }\n\n    async getDailyAttendance(\n        companyId: number,\n        date: string\n    ): Promise<DailyAttendanceRecord[]> {\n        const results = await db\n            .select({\n                id: attendanceRecords.id,\n                userId: attendanceRecords.userId,\n                companyId: attendanceRecords.companyId,\n                shiftId: attendanceRecords.shiftId,\n                date: attendanceRecords.date,\n                checkIn: attendanceRecords.checkIn,\n                checkOut: attendanceRecords.checkOut,\n                workDuration: attendanceRecords.workDuration,\n                status: attendanceRecords.status,\n                gpsLocation: attendanceRecords.gpsLocation,\n                ipAddress: attendanceRecords.ipAddress,\n                deviceId: attendanceRecords.deviceId,\n                remarks: attendanceRecords.remarks,\n                createdAt: attendanceRecords.createdAt,\n                updatedAt: attendanceRecords.updatedAt,\n                userName: users.displayName,\n                userEmail: users.email,\n                userPhotoURL: users.photoURL,\n            })\n            .from(attendanceRecords)\n            .leftJoin(users, eq(attendanceRecords.userId, users.id))\n            .where(\n                and(\n                    eq(attendanceRecords.companyId, companyId),\n                    eq(attendanceRecords.date, date)\n                )\n            )\n            .orderBy(attendanceRecords.userId);\n\n        return results;\n    }\n\n    async getMonthlyAttendanceSummary(\n        userId: number,\n        month: number,\n        year: number\n    ): Promise<{\n        totalDays: number;\n        presentDays: number;\n        lateDays: number;\n        absentDays: number;\n        totalHours: number;\n    }> {\n        const startDate = `${year}-${month.toString().padStart(2, \"0\")}-01`;\n        const lastDay = new Date(year, month, 0).getDate();\n        const endDate = `${year}-${month\n            .toString()\n            .padStart(2, \"0\")}-${lastDay}`;\n\n        const records = await this.getAttendanceHistory(\n            userId,\n            startDate,\n            endDate\n        );\n\n        const presentDays = records.filter(\n            (r) => r.status === \"present\"\n        ).length;\n        const lateDays = records.filter((r) => r.status === \"late\").length;\n        const absentDays = records.filter((r) => r.status === \"absent\").length;\n        const totalHours =\n            records.reduce((sum, r) => sum + (r.workDuration || 0), 0) / 60;\n\n        return {\n            totalDays: records.length,\n            presentDays,\n            lateDays,\n            absentDays,\n            totalHours: Math.round(totalHours * 10) / 10,\n        };\n    }\n\n    async getAttendanceReport(\n        companyId: number,\n        startDate: string,\n        endDate: string,\n        type: string\n    ): Promise<any> {\n        const records = await db\n            .select()\n            .from(attendanceRecords)\n            .where(\n                and(\n                    eq(attendanceRecords.companyId, companyId),\n                    gte(attendanceRecords.date, startDate),\n                    lte(attendanceRecords.date, endDate)\n                )\n            )\n            .orderBy(attendanceRecords.date);\n\n        if (type === \"summary\") {\n            const totalRecords = records.length;\n            const presentCount = records.filter(\n                (r) => r.status === \"present\"\n            ).length;\n            const lateCount = records.filter((r) => r.status === \"late\").length;\n            const absentCount = records.filter(\n                (r) => r.status === \"absent\"\n            ).length;\n\n            return {\n                totalRecords,\n                presentCount,\n                lateCount,\n                absentCount,\n                presentPercentage:\n                    totalRecords > 0\n                        ? Math.round((presentCount / totalRecords) * 100)\n                        : 0,\n            };\n        }\n\n        return records;\n    }\n\n    // Correction Request Management\n    async createCorrectionRequest(\n        request: InsertCorrectionRequest\n    ): Promise<CorrectionRequest> {\n        const result = await db\n            .insert(correctionRequests)\n            .values(request)\n            .returning();\n        return result[0];\n    }\n\n    async updateCorrectionRequest(\n        id: number,\n        updates: Partial<InsertCorrectionRequest>\n    ): Promise<CorrectionRequest> {\n        const result = await db\n            .update(correctionRequests)\n            .set({ ...updates, updatedAt: new Date() })\n            .where(eq(correctionRequests.id, id))\n            .returning();\n        return result[0];\n    }\n\n    async getCorrectionRequestById(\n        id: number\n    ): Promise<CorrectionRequest | null> {\n        const result = await db\n            .select()\n            .from(correctionRequests)\n            .where(eq(correctionRequests.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getCorrectionRequestsByUser(\n        userId: number\n    ): Promise<CorrectionRequest[]> {\n        return await db\n            .select()\n            .from(correctionRequests)\n            .where(eq(correctionRequests.userId, userId))\n            .orderBy(desc(correctionRequests.createdAt));\n    }\n\n    async getPendingCorrectionRequests(\n        companyId: number\n    ): Promise<CorrectionRequest[]> {\n        return await db\n            .select()\n            .from(correctionRequests)\n            .where(\n                and(\n                    eq(correctionRequests.companyId, companyId),\n                    eq(correctionRequests.status, \"pending\")\n                )\n            )\n            .orderBy(desc(correctionRequests.createdAt));\n    }\n\n    // Reward Management\n    async createReward(reward: InsertReward): Promise<Reward> {\n        const result = await db.insert(rewards).values(reward).returning();\n        return result[0];\n    }\n\n    async getRewardsByUser(userId: number): Promise<Reward[]> {\n        return await db\n            .select()\n            .from(rewards)\n            .where(eq(rewards.userId, userId))\n            .orderBy(desc(rewards.createdAt));\n    }\n\n    // Attendance Log (Audit Trail)\n    async createAttendanceLog(\n        log: InsertAttendanceLog\n    ): Promise<AttendanceLog> {\n        const result = await db.insert(attendanceLogs).values(log).returning();\n        return result[0];\n    }\n\n    // Mark users as absent if they haven't checked in\n    async markAbsentUsers(date: string): Promise<number> {\n        const allActiveUsers = await this.getAllUsers(false);\n        let markedCount = 0;\n\n        for (const user of allActiveUsers) {\n            if (!user.companyId) continue;\n\n            const existingRecord = await this.getAttendanceByUserAndDate(\n                user.id,\n                date\n            );\n\n            if (!existingRecord) {\n                const absentRecord = {\n                    userId: user.id,\n                    companyId: user.companyId,\n                    date: date,\n                    status: \"absent\" as const,\n                    checkIn: null,\n                    checkOut: null,\n                    workDuration: null,\n                    remarks: \"Auto-marked absent - no check-in\",\n                };\n\n                await this.createAttendanceRecord(absentRecord);\n                markedCount++;\n            }\n        }\n\n        return markedCount;\n    }\n\n    // Attendance Badge Management\n    async createAttendanceBadge(badge: InsertAttendanceBadge): Promise<AttendanceBadge> {\n        const result = await db.insert(attendanceBadges).values(badge).returning();\n        return result[0];\n    }\n\n    async getAttendanceBadgesByUser(userId: number): Promise<AttendanceBadge[]> {\n        return await db\n            .select()\n            .from(attendanceBadges)\n            .where(eq(attendanceBadges.userId, userId))\n            .orderBy(desc(attendanceBadges.createdAt));\n    }\n\n    async getAttendanceBadgesByCompany(companyId: number): Promise<AttendanceBadge[]> {\n        return await db\n            .select()\n            .from(attendanceBadges)\n            .where(eq(attendanceBadges.companyId, companyId))\n            .orderBy(desc(attendanceBadges.createdAt));\n    }\n\n    // Attendance Streak Management\n    async createOrUpdateAttendanceStreak(streak: InsertAttendanceStreak): Promise<AttendanceStreak> {\n        const existing = await db\n            .select()\n            .from(attendanceStreaks)\n            .where(\n                and(\n                    eq(attendanceStreaks.userId, streak.userId),\n                    eq(attendanceStreaks.companyId, streak.companyId)\n                )\n            )\n            .limit(1);\n\n        if (existing.length > 0) {\n            const updated = await db\n                .update(attendanceStreaks)\n                .set({ ...streak, updatedAt: new Date() })\n                .where(eq(attendanceStreaks.id, existing[0].id))\n                .returning();\n            return updated[0];\n        } else {\n            const result = await db\n                .insert(attendanceStreaks)\n                .values(streak)\n                .returning();\n            return result[0];\n        }\n    }\n\n    async getAttendanceStreakByUser(userId: number): Promise<AttendanceStreak | null> {\n        const result = await db\n            .select()\n            .from(attendanceStreaks)\n            .where(eq(attendanceStreaks.userId, userId))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getAttendanceStreaksByCompany(companyId: number): Promise<AttendanceStreak[]> {\n        return await db\n            .select()\n            .from(attendanceStreaks)\n            .where(eq(attendanceStreaks.companyId, companyId))\n            .orderBy(desc(attendanceStreaks.currentStreak));\n    }\n\n    // Team Assignment Management\n    async createTeamAssignment(\n        assignment: InsertTeamAssignment\n    ): Promise<TeamAssignment> {\n        const result = await db\n            .insert(teamAssignments)\n            .values(assignment)\n            .returning();\n        return result[0];\n    }\n\n    async removeTeamAssignment(\n        teamLeaderId: number,\n        memberId: number\n    ): Promise<void> {\n        await db\n            .update(teamAssignments)\n            .set({ removedAt: new Date() })\n            .where(\n                and(\n                    eq(teamAssignments.teamLeaderId, teamLeaderId),\n                    eq(teamAssignments.memberId, memberId),\n                    sql`${teamAssignments.removedAt} IS NULL`\n                )\n            );\n    }\n\n    async removeAllTeamAssignmentsByLeader(teamLeaderId: number): Promise<void> {\n        await db\n            .update(teamAssignments)\n            .set({ removedAt: new Date() })\n            .where(\n                and(\n                    eq(teamAssignments.teamLeaderId, teamLeaderId),\n                    sql`${teamAssignments.removedAt} IS NULL`\n                )\n            );\n    }\n\n    async getTeamMembersByLeader(teamLeaderId: number): Promise<User[]> {\n        const assignments = await db\n            .select({\n                user: users,\n            })\n            .from(teamAssignments)\n            .innerJoin(users, eq(teamAssignments.memberId, users.id))\n            .where(\n                and(\n                    eq(teamAssignments.teamLeaderId, teamLeaderId),\n                    sql`${teamAssignments.removedAt} IS NULL`,\n                    eq(users.isActive, true)\n                )\n            );\n\n        return assignments.map((a) => a.user);\n    }\n\n    async getTeamLeaderByMember(memberId: number): Promise<User | null> {\n        const assignment = await db\n            .select({\n                leader: users,\n            })\n            .from(teamAssignments)\n            .innerJoin(users, eq(teamAssignments.teamLeaderId, users.id))\n            .where(\n                and(\n                    eq(teamAssignments.memberId, memberId),\n                    sql`${teamAssignments.removedAt} IS NULL`,\n                    eq(users.isActive, true)\n                )\n            )\n            .limit(1);\n\n        return assignment[0]?.leader || null;\n    }\n\n    async getAllTeamAssignments(companyId: number): Promise<TeamAssignment[]> {\n        // Join with users table to filter out assignments with inactive members or leaders\n        return await db\n            .select({\n                id: teamAssignments.id,\n                companyId: teamAssignments.companyId,\n                teamLeaderId: teamAssignments.teamLeaderId,\n                memberId: teamAssignments.memberId,\n                assignedAt: teamAssignments.assignedAt,\n                removedAt: teamAssignments.removedAt,\n            })\n            .from(teamAssignments)\n            .innerJoin(users, eq(teamAssignments.memberId, users.id))\n            .where(\n                and(\n                    eq(teamAssignments.companyId, companyId),\n                    sql`${teamAssignments.removedAt} IS NULL`,\n                    eq(users.isActive, true)\n                )\n            )\n            .orderBy(desc(teamAssignments.assignedAt));\n    }\n\n    async getTeamAssignmentsByMemberId(\n        memberId: number\n    ): Promise<TeamAssignment[]> {\n        return await db\n            .select()\n            .from(teamAssignments)\n            .where(\n                and(\n                    eq(teamAssignments.memberId, memberId),\n                    sql`${teamAssignments.removedAt} IS NULL`\n                )\n            )\n            .orderBy(desc(teamAssignments.assignedAt));\n    }\n\n    // CRM - Enquiry operations\n    async createEnquiry(enquiry: InsertEnquiry): Promise<Enquiry> {\n        const result = await db.insert(enquiries).values(enquiry).returning();\n        return result[0];\n    }\n\n    async getEnquiryById(id: number): Promise<Enquiry | null> {\n        const result = await db\n            .select()\n            .from(enquiries)\n            .where(eq(enquiries.id, id))\n            .limit(1);\n        return result[0] || null;\n    }\n\n    async getEnquiriesByCompanyId(companyId: number): Promise<Enquiry[]> {\n        return await db\n            .select()\n            .from(enquiries)\n            .where(eq(enquiries.companyId, companyId))\n            .orderBy(desc(enquiries.createdAt));\n    }\n\n    async updateEnquiry(\n        id: number,\n        updates: Partial<InsertEnquiry>\n    ): Promise<void> {\n        await db\n            .update(enquiries)\n            .set({ ...updates, updatedAt: new Date() })\n            .where(eq(enquiries.id, id));\n    }\n\n    async deleteEnquiry(id: number): Promise<void> {\n        await db.delete(enquiries).where(eq(enquiries.id, id));\n    }\n\n    async getEnquiryStats(companyId: number): Promise<{\n        totalEnquiries: number;\n        monthEnquiries: number;\n        totalSales: number;\n        monthSales: number;\n        todayFollowups: number;\n        totalDrops: number;\n        monthDrops: number;\n    }> {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, \"0\");\n        const day = String(now.getDate()).padStart(2, \"0\");\n        const currentMonth = `${year}-${month}`;\n        const today = `${year}-${month}-${day}`;\n\n        const allEnquiries = await this.getEnquiriesByCompanyId(companyId);\n\n        const totalEnquiries = allEnquiries.length;\n        const monthEnquiries = allEnquiries.filter((e) =>\n            e.enquiryDate.startsWith(currentMonth)\n        ).length;\n        const totalSales = allEnquiries.filter(\n            (e) => e.status === \"sales_closed\"\n        ).length;\n        const monthSales = allEnquiries.filter(\n            (e) =>\n                e.status === \"sales_closed\" &&\n                e.enquiryDate.startsWith(currentMonth)\n        ).length;\n        const totalDrops = allEnquiries.filter(\n            (e) => e.status === \"dropped\"\n        ).length;\n        const monthDrops = allEnquiries.filter(\n            (e) =>\n                e.status === \"dropped\" && e.enquiryDate.startsWith(currentMonth)\n        ).length;\n\n        const allFollowups = await this.getFollowupsByCompanyId(companyId);\n        const todayFollowups = allFollowups.filter(\n            (f) => f.nextFollowupDate === today\n        ).length;\n\n        return {\n            totalEnquiries,\n            monthEnquiries,\n            totalSales,\n            monthSales,\n            todayFollowups,\n            totalDrops,\n            monthDrops,\n        };\n    }\n\n    // CRM - Followup operations\n    async createFollowup(followup: InsertFollowup): Promise<Followup> {\n        const result = await db.insert(followups).values(followup).returning();\n\n        await this.updateEnquiry(followup.enquiryId, {\n            status: followup.enquiryStatus,\n        });\n\n        return result[0];\n    }\n\n    async getFollowupsByEnquiryId(enquiryId: number): Promise<Followup[]> {\n        return await db\n            .select()\n            .from(followups)\n            .where(eq(followups.enquiryId, enquiryId))\n            .orderBy(desc(followups.createdAt));\n    }\n\n    async getFollowupsByCompanyId(companyId: number): Promise<Followup[]> {\n        return await db\n            .select()\n            .from(followups)\n            .where(eq(followups.companyId, companyId))\n            .orderBy(desc(followups.createdAt));\n    }\n\n    async updateFollowup(\n        id: number,\n        updates: Partial<InsertFollowup>\n    ): Promise<void> {\n        await db.update(followups).set(updates).where(eq(followups.id, id));\n    }\n\n    async deleteFollowup(id: number): Promise<void> {\n        await db.delete(followups).where(eq(followups.id, id));\n    }\n}\n\nexport const storage = new DbStorage();\n","path":null,"size_bytes":97673,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/SummaryCards.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface SummaryCard {\n  title: string;\n  value: number | string;\n  icon: LucideIcon;\n  color?: string;\n}\n\ninterface SummaryCardsProps {\n  cards: SummaryCard[];\n}\n\nexport function SummaryCards({ cards }: SummaryCardsProps) {\n  return (\n    <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 mb-6\">\n      {cards.map((card, index) => (\n        <Card key={index} data-testid={`card-summary-${index}`}>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">\n              {card.title}\n            </CardTitle>\n            <card.icon className={`h-4 w-4 ${card.color || \"text-muted-foreground\"}`} />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid={`value-summary-${index}`}>\n              {card.value}\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":1090,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/admin/CompanyManagement.tsx":{"content":"import {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n    Building2,\n    Users,\n    UserCog,\n    Plus,\n    Save,\n    ShoppingCart,\n    Loader2,\n    CheckCircle2,\n    XCircle,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport type { SlotPricing } from \"@shared/schema\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport StripeCheckoutForm from \"@/components/StripeCheckoutForm\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface CompanyData {\n    id: number;\n    name: string;\n    maxAdmins: number;\n    maxMembers: number;\n    currentAdmins: number;\n    currentMembers: number;\n    isActive: boolean;\n}\n\nconst publicKey = import.meta.env.VITE_STRIPE_PUBLIC_KEY || \"\";\nconst stripePromise = loadStripe(publicKey);\n\nexport default function CompanyManagement() {\n    const { dbUserId, userRole } = useAuth();\n    const { toast } = useToast();\n    const [isEditing, setIsEditing] = useState(false);\n    const [formData, setFormData] = useState({\n        name: \"\",\n        maxAdmins: 1,\n        maxMembers: 10,\n    });\n    const [purchaseDialogOpen, setPurchaseDialogOpen] = useState(false);\n    const [purchaseForm, setPurchaseForm] = useState({\n        slotType: \"admin\" as \"admin\" | \"member\",\n        quantity: 1,\n    });\n    const [confirmDialogOpen, setConfirmDialogOpen] = useState(false);\n    const [paymentStatus, setPaymentStatus] = useState<\n        \"idle\" | \"confirming\" | \"creating\" | \"processing\" | \"success\" | \"failed\"\n    >(\"idle\");\n    const [clientSecret, setClientSecret] = useState<string>(\"\");\n    const [paymentId, setPaymentId] = useState<number | null>(null);\n\n    const { data: company, isLoading } = useQuery<CompanyData>({\n        queryKey: [\"/api/my-company\"],\n        enabled: !!dbUserId,\n    });\n\n    const { data: slotPricing } = useQuery<SlotPricing[]>({\n        queryKey: [\"/api/slot-pricing\"],\n    });\n\n    const updateCompanyMutation = useMutation({\n        mutationFn: async (updates: {\n            name?: string;\n            maxAdmins?: number;\n            maxMembers?: number;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/my-company`,\n                \"PATCH\",\n                updates\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/my-company\"],\n            });\n            toast({\n                title: \"Success\",\n                description: \"Company settings updated successfully\",\n            });\n            setIsEditing(false);\n        },\n        onError: (error: any) => {\n            toast({\n                variant: \"destructive\",\n                title: \"Error\",\n                description:\n                    error.message || \"Failed to update company settings\",\n            });\n        },\n    });\n\n    const createPaymentIntentMutation = useMutation({\n        mutationFn: async (data: {\n            slotType: \"admin\" | \"member\";\n            quantity: number;\n        }) => {\n            setPaymentStatus(\"creating\");\n            const response = await apiRequest(\n                `${API_BASE_URL}/api/create-payment-intent`,\n                \"POST\",\n                data\n            );\n            return await response.json();\n        },\n        onSuccess: (data: any) => {\n            console.log(\"Payment intent created:\", data);\n            setClientSecret(data.clientSecret);\n            setPaymentId(data.paymentId);\n            setPaymentStatus(\"processing\");\n            setConfirmDialogOpen(false);\n            console.log(\n                \"Payment status set to processing, clientSecret:\",\n                data.clientSecret ? \"exists\" : \"missing\"\n            );\n            toast({\n                title: \"Payment form ready\",\n                description:\n                    \"Please enter your card details to complete the purchase\",\n            });\n        },\n        onError: (error: any) => {\n            setPaymentStatus(\"failed\");\n            toast({\n                variant: \"destructive\",\n                title: \"Error\",\n                description: error.message || \"Failed to create payment\",\n            });\n        },\n    });\n\n    const verifyPaymentMutation = useMutation({\n        mutationFn: async (paymentIntentId: string) => {\n            const response = await apiRequest(\n                `${API_BASE_URL}/api/verify-payment`,\n                \"POST\",\n                { paymentIntentId, paymentId }\n            );\n            return await response.json();\n        },\n        onSuccess: (data: any) => {\n            setPaymentStatus(\"success\");\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/my-company\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/my-company-payments\"],\n            });\n\n            const emailStatus = data.emailSent\n                ? \"✅ Receipt emailed to your company email\"\n                : \"⚠️ Email sending in progress\";\n\n            toast({\n                title: \"🎉 Payment Successful!\",\n                description: `Receipt: ${data.receiptNumber}. ${emailStatus}. Slots have been added to your account.`,\n                duration: 5000,\n            });\n            setTimeout(() => {\n                setPurchaseDialogOpen(false);\n                setPaymentStatus(\"idle\");\n                setClientSecret(\"\");\n                setPaymentId(null);\n                setPurchaseForm({ slotType: \"admin\", quantity: 1 });\n            }, 2000);\n        },\n        onError: (error: any) => {\n            setPaymentStatus(\"failed\");\n            toast({\n                variant: \"destructive\",\n                title: \"Payment Verification Failed\",\n                description: error.message || \"Please contact support\",\n            });\n        },\n    });\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    if (!company) {\n        return (\n            <div className=\"flex items-center justify-center h-64\">\n                <p className=\"text-muted-foreground\">\n                    No company data available\n                </p>\n            </div>\n        );\n    }\n\n    const handleEdit = () => {\n        setFormData({\n            name: company.name,\n            maxAdmins: company.maxAdmins,\n            maxMembers: company.maxMembers,\n        });\n        setIsEditing(true);\n    };\n\n    const handleSave = () => {\n        updateCompanyMutation.mutate(formData);\n    };\n\n    const handleCancel = () => {\n        setIsEditing(false);\n    };\n\n    const handleOpenPurchaseDialog = (slotType: \"admin\" | \"member\") => {\n        setPurchaseForm({ slotType, quantity: 1 });\n        setPurchaseDialogOpen(true);\n    };\n\n    const handleInitiatePurchase = () => {\n        setConfirmDialogOpen(true);\n    };\n\n    const handleConfirmPurchase = () => {\n        createPaymentIntentMutation.mutate(purchaseForm);\n    };\n\n    const handlePaymentSuccess = (paymentIntentId: string) => {\n        verifyPaymentMutation.mutate(paymentIntentId);\n    };\n\n    const handlePaymentFailure = () => {\n        setPaymentStatus(\"failed\");\n    };\n\n    const handleRetryPayment = () => {\n        setPaymentStatus(\"idle\");\n        setClientSecret(\"\");\n        setConfirmDialogOpen(true);\n    };\n\n    const getTotalPrice = () => {\n        const pricing = slotPricing?.find(\n            (p) => p.slotType === purchaseForm.slotType\n        );\n        return (pricing?.pricePerSlot || 0) * purchaseForm.quantity;\n    };\n\n    const adminSlotUsage = (company.currentAdmins / company.maxAdmins) * 100;\n    const memberSlotUsage = (company.currentMembers / company.maxMembers) * 100;\n\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h2 className=\"text-3xl font-bold\">Company Management</h2>\n                <p className=\"text-muted-foreground mt-1\">\n                    Manage your company settings and member slots\n                </p>\n            </div>\n\n            <div className=\"grid gap-6 md:grid-cols-2\">\n                {/* Company Info Card */}\n                <Card data-testid=\"card-company-info\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Building2 className=\"h-5 w-5\" />\n                            Company Information\n                        </CardTitle>\n                        <CardDescription>Basic company details</CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        {isEditing ? (\n                            <>\n                                <div>\n                                    <Label htmlFor=\"company-name\">\n                                        Company Name\n                                    </Label>\n                                    <Input\n                                        id=\"company-name\"\n                                        data-testid=\"input-company-name\"\n                                        value={formData.name}\n                                        onChange={(e) =>\n                                            setFormData({\n                                                ...formData,\n                                                name: e.target.value,\n                                            })\n                                        }\n                                        placeholder=\"Enter company name\"\n                                    />\n                                </div>\n                                <div className=\"flex gap-4 mt-4\">\n                                    <Button\n                                        onClick={handleSave}\n                                        disabled={\n                                            updateCompanyMutation.isPending\n                                        }\n                                        data-testid=\"button-save-company\">\n                                        <Save className=\"h-4 w-4 mr-2\" />\n                                        Save Changes\n                                    </Button>\n                                    <Button\n                                        variant=\"outline\"\n                                        onClick={handleCancel}\n                                        disabled={\n                                            updateCompanyMutation.isPending\n                                        }\n                                        data-testid=\"button-cancel-edit\">\n                                        Cancel\n                                    </Button>\n                                </div>\n                            </>\n                        ) : (\n                            <>\n                                <div>\n                                    <Label className=\"text-muted-foreground\">\n                                        Company Name\n                                    </Label>\n                                    <p\n                                        className=\"text-lg font-medium\"\n                                        data-testid=\"text-company-name\">\n                                        {company.name}\n                                    </p>\n                                </div>\n                                <div>\n                                    <Label className=\"text-muted-foreground\">\n                                        Status\n                                    </Label>\n                                    <p\n                                        className=\"text-lg font-medium\"\n                                        data-testid=\"text-company-status\">\n                                        {company.isActive\n                                            ? \"Active\"\n                                            : \"Inactive\"}\n                                    </p>\n                                </div>\n                                {userRole === \"company_admin\" && (\n                                    <Button\n                                        onClick={handleEdit}\n                                        variant=\"outline\"\n                                        className=\"mt-4\"\n                                        data-testid=\"button-edit-company\">\n                                        Edit Company\n                                    </Button>\n                                )}\n                            </>\n                        )}\n                    </CardContent>\n                </Card>\n\n                {/* Admin Slots Card */}\n                <Card data-testid=\"card-admin-slots\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <UserCog className=\"h-5 w-5\" />\n                            Admin Slots\n                        </CardTitle>\n                        <CardDescription>\n                            Manage administrator slots\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div>\n                            <div className=\"flex justify-between items-center mb-2\">\n                                <Label>Current Usage</Label>\n                                <span\n                                    className=\"text-sm font-medium\"\n                                    data-testid=\"text-admin-usage\">\n                                    {company.currentAdmins} /{\" \"}\n                                    {company.maxAdmins}\n                                </span>\n                            </div>\n                            <div className=\"w-full bg-secondary rounded-full h-2\">\n                                <div\n                                    className=\"bg-primary h-2 rounded-full transition-all\"\n                                    style={{\n                                        width: `${Math.min(\n                                            adminSlotUsage,\n                                            100\n                                        )}%`,\n                                    }}\n                                />\n                            </div>\n                        </div>\n                        {isEditing && (\n                            <div>\n                                <Label htmlFor=\"max-admins\">\n                                    Maximum Admins\n                                </Label>\n                                <Input\n                                    id=\"max-admins\"\n                                    type=\"number\"\n                                    min=\"1\"\n                                    data-testid=\"input-max-admins\"\n                                    value={formData.maxAdmins}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            maxAdmins:\n                                                parseInt(e.target.value) || 1,\n                                        })\n                                    }\n                                />\n                            </div>\n                        )}\n                        {!isEditing && (\n                            <Button\n                                variant=\"outline\"\n                                className=\"w-full\"\n                                onClick={() =>\n                                    handleOpenPurchaseDialog(\"admin\")\n                                }\n                                data-testid=\"button-buy-admin-slots\">\n                                <Plus className=\"h-4 w-4 mr-2\" />\n                                Buy More Admin Slots\n                            </Button>\n                        )}\n                    </CardContent>\n                </Card>\n\n                {/* Member Slots Card */}\n                <Card data-testid=\"card-member-slots\">\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Users className=\"h-5 w-5\" />\n                            Member Slots\n                        </CardTitle>\n                        <CardDescription>Manage member slots</CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div>\n                            <div className=\"flex justify-between items-center mb-2\">\n                                <Label>Current Usage</Label>\n                                <span\n                                    className=\"text-sm font-medium\"\n                                    data-testid=\"text-member-usage\">\n                                    {company.currentMembers} /{\" \"}\n                                    {company.maxMembers}\n                                </span>\n                            </div>\n                            <div className=\"w-full bg-secondary rounded-full h-2\">\n                                <div\n                                    className=\"bg-primary h-2 rounded-full transition-all\"\n                                    style={{\n                                        width: `${Math.min(\n                                            memberSlotUsage,\n                                            100\n                                        )}%`,\n                                    }}\n                                />\n                            </div>\n                        </div>\n                        {isEditing && (\n                            <div>\n                                <Label htmlFor=\"max-members\">\n                                    Maximum Members\n                                </Label>\n                                <Input\n                                    id=\"max-members\"\n                                    type=\"number\"\n                                    min=\"1\"\n                                    data-testid=\"input-max-members\"\n                                    value={formData.maxMembers}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            maxMembers:\n                                                parseInt(e.target.value) || 1,\n                                        })\n                                    }\n                                />\n                            </div>\n                        )}\n                        {!isEditing && (\n                            <Button\n                                variant=\"outline\"\n                                className=\"w-full\"\n                                onClick={() =>\n                                    handleOpenPurchaseDialog(\"member\")\n                                }\n                                data-testid=\"button-buy-member-slots\">\n                                <Plus className=\"h-4 w-4 mr-2\" />\n                                Buy More Member Slots\n                            </Button>\n                        )}\n                    </CardContent>\n                </Card>\n\n                {/* Summary Card */}\n                <Card data-testid=\"card-summary\">\n                    <CardHeader>\n                        <CardTitle>Summary</CardTitle>\n                        <CardDescription>\n                            Overall slot availability\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                        <div className=\"flex justify-between items-center p-3 bg-secondary/50 rounded-lg\">\n                            <span className=\"text-sm\">\n                                Available Admin Slots\n                            </span>\n                            <span\n                                className=\"font-semibold\"\n                                data-testid=\"text-available-admin-slots\">\n                                {company.maxAdmins - company.currentAdmins}\n                            </span>\n                        </div>\n                        <div className=\"flex justify-between items-center p-3 bg-secondary/50 rounded-lg\">\n                            <span className=\"text-sm\">\n                                Available Member Slots\n                            </span>\n                            <span\n                                className=\"font-semibold\"\n                                data-testid=\"text-available-member-slots\">\n                                {company.maxMembers - company.currentMembers}\n                            </span>\n                        </div>\n                        <div className=\"flex justify-between items-center p-3 bg-primary/10 rounded-lg\">\n                            <span className=\"text-sm font-medium\">\n                                Total Capacity\n                            </span>\n                            <span\n                                className=\"font-bold\"\n                                data-testid=\"text-total-capacity\">\n                                {company.currentAdmins + company.currentMembers}{\" \"}\n                                / {company.maxAdmins + company.maxMembers}\n                            </span>\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n\n            {/* Slot Purchase Dialog */}\n            <Dialog\n                open={purchaseDialogOpen}\n                onOpenChange={setPurchaseDialogOpen}>\n                <DialogContent\n                    data-testid=\"dialog-purchase-slots\"\n                    className=\"max-w-md max-h-[90vh] flex flex-col\">\n                    <DialogHeader>\n                        <DialogTitle className=\"flex items-center gap-2\">\n                            <ShoppingCart className=\"h-5 w-5\" />\n                            Purchase Slots\n                        </DialogTitle>\n                        <DialogDescription>\n                            Buy additional slots for your company\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 overflow-y-auto flex-1 pr-2\">\n                        {/* Pricing Info */}\n                        {slotPricing && slotPricing.length > 0 && (\n                            <div className=\"bg-primary/5 border border-primary/20 rounded-lg p-3 space-y-2\">\n                                <p className=\"text-sm font-medium text-primary\">\n                                    Current Slot Rates:\n                                </p>\n                                <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                                    <div>\n                                        <span className=\"text-muted-foreground\">\n                                            Admin Slot:\n                                        </span>\n                                        <span\n                                            className=\"font-semibold ml-1\"\n                                            data-testid=\"text-admin-rate\">\n                                            ₹\n                                            {slotPricing.find(\n                                                (p) => p.slotType === \"admin\"\n                                            )?.pricePerSlot || 0}\n                                            /slot\n                                        </span>\n                                    </div>\n                                    <div>\n                                        <span className=\"text-muted-foreground\">\n                                            Member Slot:\n                                        </span>\n                                        <span\n                                            className=\"font-semibold ml-1\"\n                                            data-testid=\"text-member-rate\">\n                                            ₹\n                                            {slotPricing.find(\n                                                (p) => p.slotType === \"member\"\n                                            )?.pricePerSlot || 0}\n                                            /slot\n                                        </span>\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"slot-type\">Slot Type</Label>\n                            <Select\n                                value={purchaseForm.slotType}\n                                onValueChange={(value: \"admin\" | \"member\") =>\n                                    setPurchaseForm({\n                                        ...purchaseForm,\n                                        slotType: value,\n                                    })\n                                }>\n                                <SelectTrigger data-testid=\"select-slot-type\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"admin\">\n                                        Admin Slots\n                                    </SelectItem>\n                                    <SelectItem value=\"member\">\n                                        Member Slots\n                                    </SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"quantity\">Quantity</Label>\n                            <Input\n                                id=\"quantity\"\n                                type=\"number\"\n                                min=\"1\"\n                                value={purchaseForm.quantity}\n                                onChange={(e) =>\n                                    setPurchaseForm({\n                                        ...purchaseForm,\n                                        quantity: parseInt(e.target.value) || 1,\n                                    })\n                                }\n                                data-testid=\"input-slot-quantity\"\n                            />\n                        </div>\n                        <div className=\"border rounded-lg p-4 bg-secondary/50\">\n                            <div className=\"flex justify-between items-center mb-2\">\n                                <span className=\"text-sm text-muted-foreground\">\n                                    Price per slot\n                                </span>\n                                <span\n                                    className=\"font-medium\"\n                                    data-testid=\"text-price-per-slot\">\n                                    ₹\n                                    {slotPricing?.find(\n                                        (p) =>\n                                            p.slotType === purchaseForm.slotType\n                                    )?.pricePerSlot || 0}\n                                </span>\n                            </div>\n                            <div className=\"flex justify-between items-center mb-2\">\n                                <span className=\"text-sm text-muted-foreground\">\n                                    Quantity\n                                </span>\n                                <span\n                                    className=\"font-medium\"\n                                    data-testid=\"text-quantity\">\n                                    {purchaseForm.quantity}\n                                </span>\n                            </div>\n                            <div className=\"border-t pt-2 mt-2\">\n                                <div className=\"flex justify-between items-center\">\n                                    <span className=\"font-semibold\">\n                                        Total Amount\n                                    </span>\n                                    <span\n                                        className=\"text-2xl font-bold text-primary\"\n                                        data-testid=\"text-total-amount\">\n                                        ₹{getTotalPrice()}\n                                    </span>\n                                </div>\n                            </div>\n                        </div>\n                        {/* Payment Status Display */}\n                        {paymentStatus === \"idle\" && (\n                            <Button\n                                className=\"w-full\"\n                                onClick={handleInitiatePurchase}\n                                disabled={\n                                    !slotPricing || slotPricing.length === 0\n                                }\n                                data-testid=\"button-confirm-purchase\">\n                                Proceed to Payment\n                            </Button>\n                        )}\n\n                        {paymentStatus === \"processing\" && clientSecret && (\n                            <div data-testid=\"stripe-payment-container\">\n                                <Elements\n                                    stripe={stripePromise}\n                                    options={{ clientSecret }}>\n                                    <StripeCheckoutForm\n                                        onSuccess={handlePaymentSuccess}\n                                        onFailure={handlePaymentFailure}\n                                        amount={getTotalPrice()}\n                                        clientSecret={clientSecret}\n                                    />\n                                </Elements>\n                            </div>\n                        )}\n\n                        {paymentStatus === \"creating\" && (\n                            <div className=\"flex items-center justify-center py-8\">\n                                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                                <span className=\"ml-3\">\n                                    Generating secure payment link...\n                                </span>\n                            </div>\n                        )}\n\n                        {paymentStatus === \"success\" && (\n                            <div className=\"text-center py-8 space-y-4\">\n                                <CheckCircle2 className=\"h-16 w-16 text-green-500 mx-auto\" />\n                                <div>\n                                    <h3 className=\"text-lg font-semibold\">\n                                        🎉 Payment Successful!\n                                    </h3>\n                                    <p className=\"text-sm text-muted-foreground mt-2\">\n                                        Transaction ID: {paymentId}\n                                        <br />\n                                        Amount: ₹{getTotalPrice()}\n                                    </p>\n                                </div>\n                            </div>\n                        )}\n\n                        {paymentStatus === \"failed\" && (\n                            <div className=\"text-center py-8 space-y-4\">\n                                <XCircle className=\"h-16 w-16 text-red-500 mx-auto\" />\n                                <div>\n                                    <h3 className=\"text-lg font-semibold\">\n                                        ⚠️ Payment Failed or Cancelled\n                                    </h3>\n                                    <p className=\"text-sm text-muted-foreground mt-2\">\n                                        Your payment could not be processed.\n                                    </p>\n                                </div>\n                                <Button\n                                    onClick={handleRetryPayment}\n                                    variant=\"outline\"\n                                    className=\"w-full\">\n                                    🔁 Retry Payment\n                                </Button>\n                            </div>\n                        )}\n                    </div>\n                </DialogContent>\n            </Dialog>\n\n            {/* Confirmation Dialog */}\n            <AlertDialog\n                open={confirmDialogOpen}\n                onOpenChange={setConfirmDialogOpen}>\n                <AlertDialogContent data-testid=\"dialog-payment-confirmation\">\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Confirm Payment</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Are you sure you want to proceed with the payment of{\" \"}\n                            <span className=\"font-bold text-primary\">\n                                ₹{getTotalPrice()}\n                            </span>\n                            ?\n                            <div className=\"mt-4 p-3 bg-muted rounded-lg text-sm\">\n                                <div className=\"flex justify-between mb-1\">\n                                    <span>Slot Type:</span>\n                                    <span className=\"font-medium capitalize\">\n                                        {purchaseForm.slotType}\n                                    </span>\n                                </div>\n                                <div className=\"flex justify-between\">\n                                    <span>Quantity:</span>\n                                    <span className=\"font-medium\">\n                                        {purchaseForm.quantity} slots\n                                    </span>\n                                </div>\n                            </div>\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel data-testid=\"button-cancel-payment\">\n                            ❌ Cancel\n                        </AlertDialogCancel>\n                        <AlertDialogAction\n                            onClick={handleConfirmPurchase}\n                            disabled={createPaymentIntentMutation.isPending}\n                            data-testid=\"button-proceed-payment\">\n                            {createPaymentIntentMutation.isPending ? (\n                                <>\n                                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                                    Creating Order...\n                                </>\n                            ) : (\n                                \"✅ Yes, Proceed\"\n                            )}\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":36281,"size_tokens":null},"client/src/lib/firebase.ts":{"content":"import { initializeApp, type FirebaseApp } from \"firebase/app\";\nimport { getAuth, GoogleAuthProvider, type Auth } from \"firebase/auth\";\nimport { getMessaging, getToken, onMessage, type Messaging } from \"firebase/messaging\";\n\nconst firebaseConfig = {\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n  authDomain: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebaseapp.com`,\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n  appId: import.meta.env.VITE_FIREBASE_APP_ID,\n  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\n};\n\n// Check if Firebase config is complete\nconst isFirebaseConfigured = !!(\n  firebaseConfig.apiKey && \n  firebaseConfig.projectId && \n  firebaseConfig.appId\n);\n\n// Check if FCM is configured (requires vapidKey in addition to base config)\nconst isFCMConfigured = !!(\n  isFirebaseConfigured &&\n  firebaseConfig.messagingSenderId &&\n  import.meta.env.VITE_FIREBASE_VAPID_KEY\n);\n\nlet app: FirebaseApp | null = null;\nlet auth: Auth | null = null;\nlet googleProvider: GoogleAuthProvider | null = null;\nlet messaging: Messaging | null = null;\n\nif (isFirebaseConfigured) {\n  app = initializeApp(firebaseConfig);\n  auth = getAuth(app);\n  googleProvider = new GoogleAuthProvider();\n  \n  if (isFCMConfigured && typeof window !== \"undefined\" && \"serviceWorker\" in navigator) {\n    try {\n      messaging = getMessaging(app);\n      \n      // Register service worker for push notifications\n      const registerSW = async () => {\n        try {\n          const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js', { \n            scope: '/',\n          });\n          console.log('Service worker registered for push notifications');\n          \n          // Send Firebase config to all service worker clients\n          const clients = await registration.clients.getAll();\n          clients.forEach(client => {\n            client.postMessage({\n              type: 'FIREBASE_CONFIG',\n              config: firebaseConfig,\n            });\n          });\n          \n          // Also send to controller\n          if (navigator.serviceWorker.controller) {\n            navigator.serviceWorker.controller.postMessage({\n              type: 'FIREBASE_CONFIG',\n              config: firebaseConfig,\n            });\n          }\n          \n          // Listen for updates and send config again\n          navigator.serviceWorker.addEventListener('controllerchange', () => {\n            if (navigator.serviceWorker.controller) {\n              navigator.serviceWorker.controller.postMessage({\n                type: 'FIREBASE_CONFIG',\n                config: firebaseConfig,\n              });\n            }\n          });\n        } catch (error) {\n          console.warn('Service worker registration error (non-critical):', error);\n        }\n      };\n      \n      if (document.readyState === 'loading') {\n        window.addEventListener('load', registerSW);\n      } else {\n        registerSW();\n      }\n    } catch (error) {\n      console.error(\"Failed to initialize Firebase Messaging:\", error);\n    }\n  }\n}\n\nexport async function requestNotificationPermission(): Promise<string | null> {\n  if (!messaging || !isFCMConfigured) {\n    console.warn(\"Firebase Messaging not configured\");\n    return null;\n  }\n\n  try {\n    const permission = await Notification.requestPermission();\n    \n    if (permission === \"granted\") {\n      const token = await getToken(messaging, {\n        vapidKey: import.meta.env.VITE_FIREBASE_VAPID_KEY,\n      });\n      \n      return token;\n    }\n    \n    return null;\n  } catch (error) {\n    console.error(\"Error getting notification permission:\", error);\n    return null;\n  }\n}\n\nexport function setupForegroundMessageListener(callback: (payload: any) => void) {\n  if (!messaging) {\n    return () => {};\n  }\n  \n  return onMessage(messaging, callback);\n}\n\nexport { auth, googleProvider, messaging, isFirebaseConfigured, isFCMConfigured };\n","path":null,"size_bytes":3904,"size_tokens":null},"client/src/pages/team-leader/TeamLeaderAnnouncements.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { format } from \"date-fns\";\nimport { Megaphone, MessageCircle, Send } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\nimport type { GroupMessage, GroupMessageReply } from \"@shared/schema\";\n\nfunction AnnouncementCard({ announcement }: { announcement: GroupMessage }) {\n    const [showReplies, setShowReplies] = useState(false);\n    const [replyText, setReplyText] = useState(\"\");\n    const { toast } = useToast();\n\n    const user = localStorage.getItem(\"user\");\n    const userId = user ? JSON.parse(user).id : null;\n\n    const { data: replies = [], isLoading: repliesLoading } = useQuery<\n        GroupMessageReply[]\n    >({\n        queryKey: [`/api/group-messages/${announcement.id}/replies`, userId],\n        queryFn: async () => {\n            const headers: Record<string, string> = {};\n            if (userId) {\n                headers[\"x-user-id\"] = userId.toString();\n            }\n\n            const res = await fetch(\n                `${API_BASE_URL}/api/group-messages/${announcement.id}/replies`,\n                { headers, credentials: \"include\" }\n            );\n            if (!res.ok) throw new Error(\"Failed to fetch replies\");\n            return res.json();\n        },\n        enabled: showReplies,\n    });\n\n    const replyMutation = useMutation({\n        mutationFn: async (message: string) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/group-messages/${announcement.id}/replies`,\n                \"POST\",\n                { message }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [`/api/group-messages/${announcement.id}/replies`],\n            });\n            setReplyText(\"\");\n            toast({\n                title: \"Reply sent\",\n                description: \"Your reply has been posted successfully\",\n            });\n        },\n        onError: (error: Error) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to post reply\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleReplySubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!replyText.trim()) return;\n        replyMutation.mutate(replyText);\n    };\n\n    return (\n        <Card data-testid={`card-announcement-${announcement.id}`}>\n            <CardHeader>\n                <div className=\"flex items-start gap-3\">\n                    <Megaphone className=\"h-5 w-5 text-primary mt-0.5\" />\n                    <div className=\"flex-1 space-y-1 min-w-0\">\n                        {announcement.title && (\n                            <CardTitle className=\"text-base sm:text-lg break-words\">\n                                {announcement.title}\n                            </CardTitle>\n                        )}\n                        <p className=\"text-xs sm:text-sm text-muted-foreground font-mono\">\n                            {format(\n                                new Date(announcement.createdAt),\n                                \"MMMM dd, yyyy 'at' h:mm a\"\n                            )}\n                        </p>\n                    </div>\n                </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n                <p className=\"text-sm sm:text-base text-foreground whitespace-pre-wrap break-words\">\n                    {announcement.message}\n                </p>\n\n                <div className=\"flex items-center gap-2 pt-2 border-t flex-wrap\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => setShowReplies(!showReplies)}\n                        data-testid={`button-toggle-replies-${announcement.id}`}\n                        className=\"gap-2\">\n                        <MessageCircle className=\"h-4 w-4\" />\n                        {showReplies ? \"Hide\" : \"Show\"} Replies (\n                        {replies.length})\n                    </Button>\n                </div>\n\n                {showReplies && (\n                    <div className=\"space-y-3 pt-2\">\n                        {repliesLoading ? (\n                            <div className=\"text-sm text-muted-foreground text-center py-4\">\n                                Loading replies...\n                            </div>\n                        ) : (\n                            <>\n                                {replies.length > 0 && (\n                                    <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                                        {replies.map((reply) => (\n                                            <div\n                                                key={reply.id}\n                                                className=\"bg-muted/50 rounded-lg p-3\"\n                                                data-testid={`reply-${reply.id}`}>\n                                                <p className=\"text-sm break-words\">\n                                                    {reply.message}\n                                                </p>\n                                                <p className=\"text-xs text-muted-foreground mt-1 font-mono\">\n                                                    {format(\n                                                        new Date(\n                                                            reply.createdAt\n                                                        ),\n                                                        \"MMM dd, h:mm a\"\n                                                    )}\n                                                </p>\n                                            </div>\n                                        ))}\n                                    </div>\n                                )}\n\n                                <form\n                                    onSubmit={handleReplySubmit}\n                                    className=\"space-y-2\">\n                                    <Textarea\n                                        placeholder=\"Write a reply...\"\n                                        value={replyText}\n                                        onChange={(e) =>\n                                            setReplyText(e.target.value)\n                                        }\n                                        data-testid={`textarea-reply-${announcement.id}`}\n                                        rows={2}\n                                    />\n                                    <Button\n                                        type=\"submit\"\n                                        size=\"sm\"\n                                        disabled={\n                                            !replyText.trim() ||\n                                            replyMutation.isPending\n                                        }\n                                        data-testid={`button-submit-reply-${announcement.id}`}\n                                        className=\"gap-2\">\n                                        <Send className=\"h-3 w-3\" />\n                                        {replyMutation.isPending\n                                            ? \"Sending...\"\n                                            : \"Reply\"}\n                                    </Button>\n                                </form>\n                            </>\n                        )}\n                    </div>\n                )}\n            </CardContent>\n        </Card>\n    );\n}\n\nexport default function TeamLeaderAnnouncements() {\n    const { toast } = useToast();\n\n    const {\n        data: announcements = [],\n        isLoading,\n        refetch,\n    } = useQuery<GroupMessage[]>({\n        queryKey: [\"/api/group-messages\"],\n    });\n\n    // Real-time updates via WebSocket\n    useWebSocket((data) => {\n        // New announcement\n        if (data.type === \"NEW_GROUP_MESSAGE\") {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/group-messages\"],\n            });\n            toast({\n                title: \"New Announcement\",\n                description:\n                    data.data?.title || \"A new announcement has been posted\",\n            });\n        }\n\n        // Reply to announcement\n        if (data.type === \"GROUP_MESSAGE_REPLY\") {\n            queryClient.invalidateQueries({\n                queryKey: [\n                    `/api/group-messages/${data.groupMessageId}/replies`,\n                ],\n            });\n            // Also refresh the main announcements list to update reply counts\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/group-messages\"],\n            });\n        }\n    });\n\n    const sortedAnnouncements = [...announcements].sort(\n        (a, b) =>\n            new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n\n    if (isLoading) {\n        return (\n            <div className=\"space-y-4\">\n                <div className=\"h-8 w-48 bg-muted animate-pulse rounded\" />\n                <div className=\"h-32 w-full bg-muted animate-pulse rounded\" />\n                <div className=\"h-32 w-full bg-muted animate-pulse rounded\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold flex items-center gap-2\">\n                    <Megaphone className=\"h-6 w-6 sm:h-8 sm:w-8\" />\n                    Announcements\n                </h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    Company-wide announcements and updates\n                </p>\n            </div>\n\n            <div className=\"space-y-4\">\n                {sortedAnnouncements.map((announcement) => (\n                    <AnnouncementCard\n                        key={announcement.id}\n                        announcement={announcement}\n                    />\n                ))}\n\n                {sortedAnnouncements.length === 0 && (\n                    <Card>\n                        <CardContent className=\"p-12\">\n                            <div className=\"text-center\">\n                                <Megaphone className=\"h-12 w-12 mx-auto text-muted-foreground mb-3\" />\n                                <h3 className=\"text-lg font-semibold mb-2\">\n                                    No Announcements\n                                </h3>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    There are no announcements to display at\n                                    this time.\n                                </p>\n                            </div>\n                        </CardContent>\n                    </Card>\n                )}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":11295,"size_tokens":null},"client/src/components/AdminDashboard.tsx":{"content":"import { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport AppSidebar from \"./AppSidebar\";\nimport MetricCard from \"./MetricCard\";\nimport ThemeToggle from \"./ThemeToggle\";\nimport {\n    Users,\n    FileText,\n    CheckCircle,\n    FolderOpen,\n    Plus,\n    Search,\n    LogOut,\n    MessageSquare,\n    Send,\n} from \"lucide-react\";\nimport { useState, useCallback } from \"react\";\nimport { format } from \"date-fns\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport type {\n    User,\n    Report,\n    Task,\n    Message,\n    GroupMessage,\n    Rating,\n} from \"@shared/schema\";\n\nexport default function AdminDashboard() {\n    const { user, signOut, dbUserId } = useAuth();\n    const { toast } = useToast();\n    const [, setLocation] = useLocation();\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    const [taskDialogOpen, setTaskDialogOpen] = useState(false);\n    const [reportDialogOpen, setReportDialogOpen] = useState(false);\n    const [selectedReport, setSelectedReport] = useState<Report | null>(null);\n    const [dateFilter, setDateFilter] = useState({\n        startDate: \"\",\n        endDate: \"\",\n    });\n    const [taskForm, setTaskForm] = useState({\n        title: \"\",\n        description: \"\",\n        assignedTo: \"\",\n        priority: \"medium\",\n        deadline: \"\",\n    });\n\n    const [privateMessageForm, setPrivateMessageForm] = useState({\n        receiverId: \"\",\n        message: \"\",\n    });\n\n    const [groupMessageForm, setGroupMessageForm] = useState({\n        title: \"\",\n        message: \"\",\n    });\n\n    const [ratingForm, setRatingForm] = useState({\n        userId: \"\",\n        rating: \"\",\n        feedback: \"\",\n        period: \"weekly\",\n    });\n\n    const [ratingDialogOpen, setRatingDialogOpen] = useState(false);\n\n    const handleWebSocketMessage = useCallback((data: any) => {\n        if (data.type === \"USERS_UPDATED\") {\n            queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/users`] });\n            queryClient.invalidateQueries({\n                queryKey: [`${API_BASE_URL}/api/dashboard/stats`],\n            });\n        }\n    }, []);\n\n    useWebSocket(handleWebSocketMessage);\n\n    const { data: stats } = useQuery<{\n        totalUsers: number;\n        todayReports: number;\n        pendingTasks: number;\n        completedTasks: number;\n        totalFiles: number;\n    }>({\n        queryKey: [`${API_BASE_URL}/api/dashboard/stats`],\n    });\n\n    const { data: users = [], isLoading: usersLoading } = useQuery<User[]>({\n        queryKey: [`${API_BASE_URL}/api/users`],\n    });\n\n    const { data: reports = [], isLoading: reportsLoading } = useQuery<\n        Report[]\n    >({\n        queryKey: [`${API_BASE_URL}/api/reports`, dateFilter.startDate, dateFilter.endDate],\n        queryFn: async () => {\n            let url = `${API_BASE_URL}/api/reports`;\n            const params = new URLSearchParams();\n            if (dateFilter.startDate)\n                params.append(\"startDate\", dateFilter.startDate);\n            if (dateFilter.endDate)\n                params.append(\"endDate\", dateFilter.endDate);\n            if (params.toString()) url += `?${params.toString()}`;\n\n            const res = await fetch(url);\n            if (!res.ok) throw new Error(\"Failed to fetch reports\");\n            return res.json();\n        },\n    });\n\n    const { data: allTasks = [], isLoading: tasksLoading } = useQuery<Task[]>({\n        queryKey: [`${API_BASE_URL}/api/tasks`],\n    });\n\n    const { data: privateMessages = [] } = useQuery<Message[]>({\n        queryKey: [`${API_BASE_URL}/api/messages`],\n    });\n\n    const { data: groupMessages = [] } = useQuery<GroupMessage[]>({\n        queryKey: [`${API_BASE_URL}/api/group-messages`],\n    });\n\n    const { data: allRatings = [] } = useQuery<Rating[]>({\n        queryKey: [`${API_BASE_URL}/api/ratings`],\n    });\n\n    const deleteUserMutation = useMutation({\n        mutationFn: async (userId: number) => {\n            return await apiRequest(`/api/users/${userId}`, \"DELETE\");\n        },\n        onSuccess: () => {\n            toast({\n                title: \"User removed successfully\",\n                description: \"The user has been deleted from the system.\",\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to remove user\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const sendPrivateMessageMutation = useMutation({\n        mutationFn: async (messageData: typeof privateMessageForm) => {\n            return await apiRequest(`${API_BASE_URL}/api/messages`, \"POST\", {\n                senderId: dbUserId,\n                receiverId: parseInt(messageData.receiverId),\n                message: messageData.message,\n                readStatus: false,\n            });\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Message sent successfully\",\n            });\n            setPrivateMessageForm({ receiverId: \"\", message: \"\" });\n            queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/messages`] });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to send message\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const sendGroupMessageMutation = useMutation({\n        mutationFn: async (messageData: typeof groupMessageForm) => {\n            return await apiRequest(`${API_BASE_URL}/api/group-messages`, \"POST\", {\n                title: messageData.title || null,\n                message: messageData.message,\n            });\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Announcement sent successfully\",\n            });\n            setGroupMessageForm({ title: \"\", message: \"\" });\n            queryClient.invalidateQueries({\n                queryKey: [`${API_BASE_URL}/api/group-messages`],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to send announcement\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const createRatingMutation = useMutation({\n        mutationFn: async (ratingData: typeof ratingForm) => {\n            return await apiRequest(`${API_BASE_URL}/api/ratings`, \"POST\", {\n                userId: parseInt(ratingData.userId),\n                rating: ratingData.rating,\n                feedback: ratingData.feedback || null,\n                period: ratingData.period,\n            });\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Rating submitted successfully\",\n            });\n            setRatingForm({\n                userId: \"\",\n                rating: \"\",\n                feedback: \"\",\n                period: \"weekly\",\n            });\n            setRatingDialogOpen(false);\n            queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/ratings`] });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to submit rating\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const createTaskMutation = useMutation({\n        mutationFn: async (taskData: typeof taskForm) => {\n            const payload = {\n                assignedBy: dbUserId,\n                assignedTo: parseInt(taskData.assignedTo),\n                title: taskData.title,\n                description: taskData.description || null,\n                priority: taskData.priority,\n                deadline: taskData.deadline\n                    ? new Date(taskData.deadline).toISOString()\n                    : null,\n                status: \"pending\",\n            };\n            return await apiRequest(`${API_BASE_URL}/api/tasks`, \"POST\", payload);\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Task created successfully\",\n                description: \"The task has been assigned to the user.\",\n            });\n            setTaskDialogOpen(false);\n            setTaskForm({\n                title: \"\",\n                description: \"\",\n                assignedTo: \"\",\n                priority: \"medium\",\n                deadline: \"\",\n            });\n            queryClient.invalidateQueries({ queryKey: [`${API_BASE_URL}/api/tasks`] });\n            queryClient.invalidateQueries({\n                queryKey: [`${API_BASE_URL}/api/dashboard/stats`],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to create task\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleCreateTask = () => {\n        if (!taskForm.title || !taskForm.assignedTo) {\n            toast({\n                title: \"Missing required fields\",\n                description: \"Please fill in task title and assign to a user.\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n        createTaskMutation.mutate(taskForm);\n    };\n\n    const handleLogout = async () => {\n        try {\n            await signOut();\n            setLocation(\"/\");\n        } catch (error) {\n            console.error(\"Logout failed:\", error);\n        }\n    };\n\n    const style = {\n        \"--sidebar-width\": \"20rem\",\n        \"--sidebar-width-icon\": \"4rem\",\n    };\n\n    const getUserNameById = (userId: number) => {\n        const user = users.find((u) => u.id === userId);\n        return user?.displayName || \"Unknown User\";\n    };\n\n    const filteredReports = reports.filter((report) => {\n        const userName = getUserNameById(report.userId);\n        return userName.toLowerCase().includes(searchTerm.toLowerCase());\n    });\n\n    const handleViewReport = (report: Report) => {\n        setSelectedReport(report);\n        setReportDialogOpen(true);\n    };\n\n    const adminName = user?.displayName || \"Admin\";\n    const adminAvatar = user?.photoURL || \"\";\n    const adminInitials = adminName\n        .split(\" \")\n        .map((n) => n[0])\n        .join(\"\")\n        .toUpperCase();\n\n    return (\n        <SidebarProvider style={style as React.CSSProperties}>\n            <div className=\"flex h-screen w-full\">\n                <AppSidebar />\n\n                <div className=\"flex flex-col flex-1\">\n                    {/* Header */}\n                    <header className=\"sticky top-0 z-40 bg-card border-b border-card-border shadow-sm\">\n                        <div className=\"flex items-center justify-between p-3 sm:p-4\">\n                            <div className=\"flex items-center gap-2 sm:gap-4\">\n                                <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n                                <h1 className=\"text-lg sm:text-2xl font-bold\">\n                                    Admin Dashboard\n                                </h1>\n                            </div>\n                            <div className=\"flex items-center gap-2 sm:gap-3\">\n                                <ThemeToggle />\n                                <div className=\"flex items-center gap-2 sm:gap-3 pl-2 sm:pl-3 border-l\">\n                                    <Avatar\n                                        className=\"h-8 w-8 sm:h-10 sm:w-10\"\n                                        data-testid=\"avatar-admin\">\n                                        <AvatarImage src={adminAvatar} />\n                                        <AvatarFallback className=\"bg-primary text-primary-foreground text-xs sm:text-sm\">\n                                            {adminInitials}\n                                        </AvatarFallback>\n                                    </Avatar>\n                                    <Button\n                                        variant=\"ghost\"\n                                        size=\"icon\"\n                                        onClick={handleLogout}\n                                        data-testid=\"button-logout\"\n                                        className=\"h-8 w-8 sm:h-10 sm:w-10\">\n                                        <LogOut className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                                    </Button>\n                                </div>\n                            </div>\n                        </div>\n                    </header>\n\n                    {/* Main Content */}\n                    <main className=\"flex-1 overflow-auto p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 md:space-y-8\">\n                        {/* Metrics */}\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 sm:gap-4 md:gap-6\">\n                            <MetricCard\n                                title=\"Total Users\"\n                                value={stats?.totalUsers?.toString() || \"0\"}\n                                icon={Users}\n                                trend=\"\"\n                            />\n                            <MetricCard\n                                title=\"Today's Reports\"\n                                value={stats?.todayReports?.toString() || \"0\"}\n                                icon={FileText}\n                                trend=\"\"\n                            />\n                            <MetricCard\n                                title=\"Pending Tasks\"\n                                value={stats?.pendingTasks?.toString() || \"0\"}\n                                icon={CheckCircle}\n                                trend=\"\"\n                            />\n                            <MetricCard\n                                title=\"Completed Tasks\"\n                                value={stats?.completedTasks?.toString() || \"0\"}\n                                icon={CheckCircle}\n                                trend=\"\"\n                            />\n                            <MetricCard\n                                title=\"Uploaded Files\"\n                                value={stats?.totalFiles?.toString() || \"0\"}\n                                icon={FolderOpen}\n                                trend=\"\"\n                            />\n                        </div>\n\n                        {/* Quick Actions */}\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 md:gap-6\">\n                            <Dialog\n                                open={taskDialogOpen}\n                                onOpenChange={setTaskDialogOpen}>\n                                <DialogTrigger asChild>\n                                    <Card\n                                        className=\"cursor-pointer hover-elevate active-elevate-2\"\n                                        data-testid=\"card-create-task\">\n                                        <CardContent className=\"p-6 flex items-center gap-4\">\n                                            <div className=\"p-3 bg-primary/10 rounded-lg\">\n                                                <Plus className=\"h-6 w-6 text-primary\" />\n                                            </div>\n                                            <div>\n                                                <h3 className=\"font-semibold\">\n                                                    Create New Task\n                                                </h3>\n                                                <p className=\"text-sm text-muted-foreground\">\n                                                    Assign tasks to users\n                                                </p>\n                                            </div>\n                                        </CardContent>\n                                    </Card>\n                                </DialogTrigger>\n                                <DialogContent>\n                                    <DialogHeader>\n                                        <DialogTitle>\n                                            Create New Task\n                                        </DialogTitle>\n                                        <DialogDescription>\n                                            Assign a new task to one or more\n                                            users\n                                        </DialogDescription>\n                                    </DialogHeader>\n                                    <div className=\"space-y-4\">\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"task-title\">\n                                                Task Title *\n                                            </Label>\n                                            <Input\n                                                id=\"task-title\"\n                                                placeholder=\"Enter task title\"\n                                                value={taskForm.title}\n                                                onChange={(e) =>\n                                                    setTaskForm({\n                                                        ...taskForm,\n                                                        title: e.target.value,\n                                                    })\n                                                }\n                                                data-testid=\"input-task-title\"\n                                            />\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"task-description\">\n                                                Description\n                                            </Label>\n                                            <Textarea\n                                                id=\"task-description\"\n                                                placeholder=\"Enter task description\"\n                                                value={taskForm.description}\n                                                onChange={(e) =>\n                                                    setTaskForm({\n                                                        ...taskForm,\n                                                        description:\n                                                            e.target.value,\n                                                    })\n                                                }\n                                                data-testid=\"input-task-description\"\n                                            />\n                                        </div>\n                                        <div className=\"grid grid-cols-2 gap-4\">\n                                            <div className=\"space-y-2\">\n                                                <Label htmlFor=\"assign-to\">\n                                                    Assign To *\n                                                </Label>\n                                                <Select\n                                                    value={taskForm.assignedTo}\n                                                    onValueChange={(value) =>\n                                                        setTaskForm({\n                                                            ...taskForm,\n                                                            assignedTo: value,\n                                                        })\n                                                    }>\n                                                    <SelectTrigger data-testid=\"select-assign-to\">\n                                                        <SelectValue placeholder=\"Select user\" />\n                                                    </SelectTrigger>\n                                                    <SelectContent>\n                                                        {users\n                                                            .filter(\n                                                                (u) =>\n                                                                    u.role ===\n                                                                    \"user\"\n                                                            )\n                                                            .map((user) => (\n                                                                <SelectItem\n                                                                    key={\n                                                                        user.id\n                                                                    }\n                                                                    value={user.id.toString()}>\n                                                                    {\n                                                                        user.displayName\n                                                                    }\n                                                                </SelectItem>\n                                                            ))}\n                                                    </SelectContent>\n                                                </Select>\n                                            </div>\n                                            <div className=\"space-y-2\">\n                                                <Label htmlFor=\"priority\">\n                                                    Priority\n                                                </Label>\n                                                <Select\n                                                    value={taskForm.priority}\n                                                    onValueChange={(value) =>\n                                                        setTaskForm({\n                                                            ...taskForm,\n                                                            priority: value,\n                                                        })\n                                                    }>\n                                                    <SelectTrigger data-testid=\"select-priority\">\n                                                        <SelectValue />\n                                                    </SelectTrigger>\n                                                    <SelectContent>\n                                                        <SelectItem value=\"low\">\n                                                            Low\n                                                        </SelectItem>\n                                                        <SelectItem value=\"medium\">\n                                                            Medium\n                                                        </SelectItem>\n                                                        <SelectItem value=\"high\">\n                                                            High\n                                                        </SelectItem>\n                                                    </SelectContent>\n                                                </Select>\n                                            </div>\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                            <Label htmlFor=\"deadline\">\n                                                Deadline (Optional)\n                                            </Label>\n                                            <Input\n                                                id=\"deadline\"\n                                                type=\"date\"\n                                                value={taskForm.deadline}\n                                                onChange={(e) =>\n                                                    setTaskForm({\n                                                        ...taskForm,\n                                                        deadline:\n                                                            e.target.value,\n                                                    })\n                                                }\n                                                data-testid=\"input-deadline\"\n                                            />\n                                        </div>\n                                        <Button\n                                            onClick={handleCreateTask}\n                                            className=\"w-full\"\n                                            data-testid=\"button-create-task\"\n                                            disabled={\n                                                createTaskMutation.isPending\n                                            }>\n                                            {createTaskMutation.isPending\n                                                ? \"Creating...\"\n                                                : \"Create Task\"}\n                                        </Button>\n                                    </div>\n                                </DialogContent>\n                            </Dialog>\n\n                            <Card\n                                className=\"cursor-pointer hover-elevate active-elevate-2\"\n                                onClick={() =>\n                                    document\n                                        .querySelector(\"#reports-section\")\n                                        ?.scrollIntoView({ behavior: \"smooth\" })\n                                }\n                                data-testid=\"card-view-reports\">\n                                <CardContent className=\"p-6 flex items-center gap-4\">\n                                    <div className=\"p-3 bg-primary/10 rounded-lg\">\n                                        <FileText className=\"h-6 w-6 text-primary\" />\n                                    </div>\n                                    <div>\n                                        <h3 className=\"font-semibold\">\n                                            View All Reports\n                                        </h3>\n                                        <p className=\"text-sm text-muted-foreground\">\n                                            Access submitted reports\n                                        </p>\n                                    </div>\n                                </CardContent>\n                            </Card>\n\n                            <a href=\"#users\" className=\"block\">\n                                <Card\n                                    className=\"cursor-pointer hover-elevate active-elevate-2\"\n                                    data-testid=\"card-manage-users\">\n                                    <CardContent className=\"p-6 flex items-center gap-4\">\n                                        <div className=\"p-3 bg-primary/10 rounded-lg\">\n                                            <Users className=\"h-6 w-6 text-primary\" />\n                                        </div>\n                                        <div>\n                                            <h3 className=\"font-semibold\">\n                                                Manage Users\n                                            </h3>\n                                            <p className=\"text-sm text-muted-foreground\">\n                                                View and rate users\n                                            </p>\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            </a>\n                        </div>\n\n                        {/* Tasks Section */}\n                        <Card id=\"tasks\">\n                            <CardHeader>\n                                <CardTitle>All Tasks</CardTitle>\n                            </CardHeader>\n                            <CardContent>\n                                {tasksLoading ? (\n                                    <div className=\"flex items-center justify-center py-8\">\n                                        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                                    </div>\n                                ) : allTasks.length > 0 ? (\n                                    <div className=\"overflow-x-auto\">\n                                        <table className=\"w-full\">\n                                            <thead>\n                                                <tr className=\"border-b\">\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        Task\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        Assigned To\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        Priority\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        Status\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        Deadline\n                                                    </th>\n                                                    <th className=\"text-right py-3 px-4 text-sm font-semibold\">\n                                                        Actions\n                                                    </th>\n                                                </tr>\n                                            </thead>\n                                            <tbody>\n                                                {allTasks.map(\n                                                    (\n                                                        task: any,\n                                                        index: number\n                                                    ) => (\n                                                        <tr\n                                                            key={task.id}\n                                                            className={`border-b ${\n                                                                index % 2 === 0\n                                                                    ? \"bg-card\"\n                                                                    : \"bg-muted/20\"\n                                                            } hover-elevate`}\n                                                            data-testid={`row-task-${task.id}`}>\n                                                            <td className=\"py-3 px-4\">\n                                                                <div className=\"font-medium\">\n                                                                    {task.title}\n                                                                </div>\n                                                                <div className=\"text-sm text-muted-foreground\">\n                                                                    {task.description ||\n                                                                        \"—\"}\n                                                                </div>\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-sm\">\n                                                                {getUserNameById(\n                                                                    task.assignedTo\n                                                                )}\n                                                            </td>\n                                                            <td className=\"py-3 px-4\">\n                                                                <Badge\n                                                                    variant={\n                                                                        task.priority ===\n                                                                        \"high\"\n                                                                            ? \"destructive\"\n                                                                            : task.priority ===\n                                                                              \"medium\"\n                                                                            ? \"default\"\n                                                                            : \"secondary\"\n                                                                    }>\n                                                                    {\n                                                                        task.priority\n                                                                    }\n                                                                </Badge>\n                                                            </td>\n                                                            <td className=\"py-3 px-4\">\n                                                                <Badge\n                                                                    variant={\n                                                                        task.status ===\n                                                                        \"completed\"\n                                                                            ? \"default\"\n                                                                            : \"outline\"\n                                                                    }>\n                                                                    {\n                                                                        task.status\n                                                                    }\n                                                                </Badge>\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-sm font-mono text-xs\">\n                                                                {task.deadline\n                                                                    ? format(\n                                                                          new Date(\n                                                                              task.deadline\n                                                                          ),\n                                                                          \"MMM dd, yyyy\"\n                                                                      )\n                                                                    : \"—\"}\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-right\">\n                                                                <Button\n                                                                    variant=\"ghost\"\n                                                                    size=\"sm\"\n                                                                    data-testid={`button-view-task-${task.id}`}>\n                                                                    View\n                                                                </Button>\n                                                            </td>\n                                                        </tr>\n                                                    )\n                                                )}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                ) : (\n                                    <div className=\"text-center py-8 text-muted-foreground\">\n                                        No tasks created yet\n                                    </div>\n                                )}\n                            </CardContent>\n                        </Card>\n\n                        {/* Users Section */}\n                        <Card id=\"users\">\n                            <CardHeader>\n                                <CardTitle>All Users</CardTitle>\n                            </CardHeader>\n                            <CardContent>\n                                {usersLoading ? (\n                                    <div className=\"flex items-center justify-center py-8\">\n                                        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                                    </div>\n                                ) : users.length > 0 ? (\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                                        {users.map((user) => (\n                                            <Card\n                                                key={user.id}\n                                                data-testid={`card-user-${user.id}`}>\n                                                <CardContent className=\"p-4\">\n                                                    <div className=\"flex items-center gap-3 mb-3\">\n                                                        <Avatar>\n                                                            <AvatarImage\n                                                                src={\n                                                                    user.photoURL ||\n                                                                    \"\"\n                                                                }\n                                                            />\n                                                            <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                                                                {user.displayName\n                                                                    .split(\" \")\n                                                                    .map(\n                                                                        (n) =>\n                                                                            n[0]\n                                                                    )\n                                                                    .join(\"\")\n                                                                    .toUpperCase()}\n                                                            </AvatarFallback>\n                                                        </Avatar>\n                                                        <div className=\"flex-1\">\n                                                            <h4 className=\"font-semibold\">\n                                                                {\n                                                                    user.displayName\n                                                                }\n                                                            </h4>\n                                                            <p className=\"text-sm text-muted-foreground\">\n                                                                {user.email}\n                                                            </p>\n                                                        </div>\n                                                    </div>\n                                                    <div className=\"flex items-center justify-between\">\n                                                        <Badge\n                                                            variant={\n                                                                user.role ===\n                                                                \"admin\"\n                                                                    ? \"default\"\n                                                                    : \"secondary\"\n                                                            }>\n                                                            {user.role}\n                                                        </Badge>\n                                                        {user.role !==\n                                                            \"admin\" && (\n                                                            <div className=\"flex gap-2\">\n                                                                <Button\n                                                                    variant=\"outline\"\n                                                                    size=\"sm\"\n                                                                    data-testid={`button-rate-user-${user.id}`}\n                                                                    onClick={() => {\n                                                                        setRatingForm(\n                                                                            {\n                                                                                ...ratingForm,\n                                                                                userId: user.id.toString(),\n                                                                            }\n                                                                        );\n                                                                        setRatingDialogOpen(\n                                                                            true\n                                                                        );\n                                                                    }}>\n                                                                    Rate\n                                                                </Button>\n                                                                <Button\n                                                                    variant=\"ghost\"\n                                                                    size=\"sm\"\n                                                                    className=\"text-destructive hover:text-destructive\"\n                                                                    data-testid={`button-remove-user-${user.id}`}\n                                                                    onClick={() =>\n                                                                        deleteUserMutation.mutate(\n                                                                            user.id\n                                                                        )\n                                                                    }\n                                                                    disabled={\n                                                                        deleteUserMutation.isPending\n                                                                    }>\n                                                                    Remove\n                                                                </Button>\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                </CardContent>\n                                            </Card>\n                                        ))}\n                                    </div>\n                                ) : (\n                                    <div className=\"text-center py-8 text-muted-foreground\">\n                                        No users found\n                                    </div>\n                                )}\n                            </CardContent>\n                        </Card>\n\n                        {/* Recent Reports Table */}\n                        <Card id=\"reports-section\">\n                            <CardHeader>\n                                <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4\">\n                                    <CardTitle>User Reports</CardTitle>\n                                    <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto\">\n                                        <Input\n                                            type=\"date\"\n                                            value={dateFilter.startDate}\n                                            onChange={(e) =>\n                                                setDateFilter({\n                                                    ...dateFilter,\n                                                    startDate: e.target.value,\n                                                })\n                                            }\n                                            className=\"w-full sm:w-40\"\n                                            placeholder=\"Start date\"\n                                            data-testid=\"input-start-date\"\n                                        />\n                                        <Input\n                                            type=\"date\"\n                                            value={dateFilter.endDate}\n                                            onChange={(e) =>\n                                                setDateFilter({\n                                                    ...dateFilter,\n                                                    endDate: e.target.value,\n                                                })\n                                            }\n                                            className=\"w-full sm:w-40\"\n                                            placeholder=\"End date\"\n                                            data-testid=\"input-end-date\"\n                                        />\n                                        <div className=\"relative w-full sm:w-auto\">\n                                            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                                            <Input\n                                                placeholder=\"Search by user...\"\n                                                className=\"pl-9 w-full sm:w-64\"\n                                                value={searchTerm}\n                                                onChange={(e) =>\n                                                    setSearchTerm(\n                                                        e.target.value\n                                                    )\n                                                }\n                                                data-testid=\"input-search-reports\"\n                                            />\n                                        </div>\n                                    </div>\n                                </div>\n                            </CardHeader>\n                            <CardContent>\n                                {reportsLoading ? (\n                                    <div className=\"flex items-center justify-center py-8\">\n                                        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                                    </div>\n                                ) : filteredReports.length > 0 ? (\n                                    <div className=\"overflow-x-auto\">\n                                        <table className=\"w-full\">\n                                            <thead>\n                                                <tr className=\"border-b\">\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        User\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        Type\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        Date\n                                                    </th>\n                                                    <th className=\"text-left py-3 px-4 text-sm font-semibold\">\n                                                        Tasks\n                                                    </th>\n                                                    <th className=\"text-right py-3 px-4 text-sm font-semibold\">\n                                                        Actions\n                                                    </th>\n                                                </tr>\n                                            </thead>\n                                            <tbody>\n                                                {filteredReports.map(\n                                                    (report, index) => (\n                                                        <tr\n                                                            key={report.id}\n                                                            className={`border-b ${\n                                                                index % 2 === 0\n                                                                    ? \"bg-card\"\n                                                                    : \"bg-muted/20\"\n                                                            } hover-elevate`}\n                                                            data-testid={`row-report-${report.id}`}>\n                                                            <td className=\"py-3 px-4 text-sm\">\n                                                                {getUserNameById(\n                                                                    report.userId\n                                                                )}\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-sm capitalize\">\n                                                                {\n                                                                    report.reportType\n                                                                }\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-sm font-mono text-xs\">\n                                                                {format(\n                                                                    new Date(\n                                                                        report.createdAt\n                                                                    ),\n                                                                    \"MMM dd, yyyy\"\n                                                                )}\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-sm text-muted-foreground truncate max-w-xs\">\n                                                                {report.plannedTasks ||\n                                                                    report.completedTasks ||\n                                                                    \"—\"}\n                                                            </td>\n                                                            <td className=\"py-3 px-4 text-right\">\n                                                                <Button\n                                                                    variant=\"ghost\"\n                                                                    size=\"sm\"\n                                                                    onClick={() =>\n                                                                        handleViewReport(\n                                                                            report\n                                                                        )\n                                                                    }\n                                                                    data-testid={`button-view-report-${report.id}`}>\n                                                                    View\n                                                                </Button>\n                                                            </td>\n                                                        </tr>\n                                                    )\n                                                )}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                ) : (\n                                    <div className=\"text-center py-8 text-muted-foreground\">\n                                        No reports found\n                                    </div>\n                                )}\n                            </CardContent>\n                        </Card>\n\n                        {/* Messaging Section */}\n                        <Card id=\"messages\">\n                            <CardHeader>\n                                <CardTitle className=\"flex items-center gap-2\">\n                                    <MessageSquare className=\"h-5 w-5\" />\n                                    Communication Center\n                                </CardTitle>\n                            </CardHeader>\n                            <CardContent>\n                                <Tabs defaultValue=\"private\" className=\"w-full\">\n                                    <TabsList className=\"grid w-full grid-cols-2\">\n                                        <TabsTrigger\n                                            value=\"private\"\n                                            data-testid=\"tab-private-messages\">\n                                            Private Messages\n                                        </TabsTrigger>\n                                        <TabsTrigger\n                                            value=\"announcements\"\n                                            data-testid=\"tab-announcements\">\n                                            Announcements\n                                        </TabsTrigger>\n                                    </TabsList>\n\n                                    <TabsContent\n                                        value=\"private\"\n                                        className=\"space-y-4 mt-4\">\n                                        <div className=\"bg-muted/50 p-4 rounded-lg space-y-4\">\n                                            <h3 className=\"font-semibold\">\n                                                Send Private Message\n                                            </h3>\n                                            <div className=\"space-y-3\">\n                                                <div>\n                                                    <Label htmlFor=\"message-user\">\n                                                        Select User\n                                                    </Label>\n                                                    <Select\n                                                        value={\n                                                            privateMessageForm.receiverId\n                                                        }\n                                                        onValueChange={(\n                                                            value\n                                                        ) =>\n                                                            setPrivateMessageForm(\n                                                                {\n                                                                    ...privateMessageForm,\n                                                                    receiverId:\n                                                                        value,\n                                                                }\n                                                            )\n                                                        }>\n                                                        <SelectTrigger\n                                                            id=\"message-user\"\n                                                            data-testid=\"select-message-user\">\n                                                            <SelectValue placeholder=\"Choose a user\" />\n                                                        </SelectTrigger>\n                                                        <SelectContent>\n                                                            {users\n                                                                .filter(\n                                                                    (u) =>\n                                                                        u.role ===\n                                                                        \"user\"\n                                                                )\n                                                                .map((user) => (\n                                                                    <SelectItem\n                                                                        key={\n                                                                            user.id\n                                                                        }\n                                                                        value={user.id.toString()}>\n                                                                        {\n                                                                            user.displayName\n                                                                        }\n                                                                    </SelectItem>\n                                                                ))}\n                                                        </SelectContent>\n                                                    </Select>\n                                                </div>\n                                                <div>\n                                                    <Label htmlFor=\"private-message\">\n                                                        Message\n                                                    </Label>\n                                                    <Textarea\n                                                        id=\"private-message\"\n                                                        placeholder=\"Type your message...\"\n                                                        value={\n                                                            privateMessageForm.message\n                                                        }\n                                                        onChange={(e) =>\n                                                            setPrivateMessageForm(\n                                                                {\n                                                                    ...privateMessageForm,\n                                                                    message:\n                                                                        e.target\n                                                                            .value,\n                                                                }\n                                                            )\n                                                        }\n                                                        data-testid=\"textarea-private-message\"\n                                                        rows={4}\n                                                    />\n                                                </div>\n                                                <Button\n                                                    onClick={() =>\n                                                        sendPrivateMessageMutation.mutate(\n                                                            privateMessageForm\n                                                        )\n                                                    }\n                                                    disabled={\n                                                        !privateMessageForm.receiverId ||\n                                                        !privateMessageForm.message ||\n                                                        sendPrivateMessageMutation.isPending\n                                                    }\n                                                    data-testid=\"button-send-private-message\"\n                                                    className=\"w-full\">\n                                                    <Send className=\"h-4 w-4 mr-2\" />\n                                                    {sendPrivateMessageMutation.isPending\n                                                        ? \"Sending...\"\n                                                        : \"Send Message\"}\n                                                </Button>\n                                            </div>\n                                        </div>\n\n                                        <div className=\"space-y-2\">\n                                            <h3 className=\"font-semibold\">\n                                                Recent Messages\n                                            </h3>\n                                            <div className=\"space-y-2\">\n                                                {privateMessages\n                                                    .slice(0, 5)\n                                                    .map((msg) => (\n                                                        <div\n                                                            key={msg.id}\n                                                            className=\"bg-card border rounded-lg p-3\"\n                                                            data-testid={`message-${msg.id}`}>\n                                                            <div className=\"flex items-start justify-between\">\n                                                                <div className=\"flex-1\">\n                                                                    <div className=\"flex items-center gap-2 mb-1\">\n                                                                        <span className=\"text-sm font-medium\">\n                                                                            {getUserNameById(\n                                                                                msg.senderId\n                                                                            )}\n                                                                        </span>\n                                                                        <span className=\"text-xs text-muted-foreground\">\n                                                                            →\n                                                                        </span>\n                                                                        <span className=\"text-sm font-medium\">\n                                                                            {getUserNameById(\n                                                                                msg.receiverId\n                                                                            )}\n                                                                        </span>\n                                                                    </div>\n                                                                    <p className=\"text-sm text-muted-foreground\">\n                                                                        {\n                                                                            msg.message\n                                                                        }\n                                                                    </p>\n                                                                </div>\n                                                                <span className=\"text-xs text-muted-foreground font-mono\">\n                                                                    {format(\n                                                                        new Date(\n                                                                            msg.createdAt\n                                                                        ),\n                                                                        \"MMM dd, HH:mm\"\n                                                                    )}\n                                                                </span>\n                                                            </div>\n                                                        </div>\n                                                    ))}\n                                                {privateMessages.length ===\n                                                    0 && (\n                                                    <div className=\"text-center py-8 text-muted-foreground\">\n                                                        No messages yet\n                                                    </div>\n                                                )}\n                                            </div>\n                                        </div>\n                                    </TabsContent>\n\n                                    <TabsContent\n                                        value=\"announcements\"\n                                        className=\"space-y-4 mt-4\">\n                                        <div className=\"bg-muted/50 p-4 rounded-lg space-y-4\">\n                                            <h3 className=\"font-semibold\">\n                                                Send Announcement (All Users)\n                                            </h3>\n                                            <div className=\"space-y-3\">\n                                                <div>\n                                                    <Label htmlFor=\"announcement-title\">\n                                                        Title (Optional)\n                                                    </Label>\n                                                    <Input\n                                                        id=\"announcement-title\"\n                                                        placeholder=\"Announcement title...\"\n                                                        value={\n                                                            groupMessageForm.title\n                                                        }\n                                                        onChange={(e) =>\n                                                            setGroupMessageForm(\n                                                                {\n                                                                    ...groupMessageForm,\n                                                                    title: e\n                                                                        .target\n                                                                        .value,\n                                                                }\n                                                            )\n                                                        }\n                                                        data-testid=\"input-announcement-title\"\n                                                    />\n                                                </div>\n                                                <div>\n                                                    <Label htmlFor=\"announcement-message\">\n                                                        Message\n                                                    </Label>\n                                                    <Textarea\n                                                        id=\"announcement-message\"\n                                                        placeholder=\"Type your announcement...\"\n                                                        value={\n                                                            groupMessageForm.message\n                                                        }\n                                                        onChange={(e) =>\n                                                            setGroupMessageForm(\n                                                                {\n                                                                    ...groupMessageForm,\n                                                                    message:\n                                                                        e.target\n                                                                            .value,\n                                                                }\n                                                            )\n                                                        }\n                                                        data-testid=\"textarea-announcement-message\"\n                                                        rows={4}\n                                                    />\n                                                </div>\n                                                <Button\n                                                    onClick={() =>\n                                                        sendGroupMessageMutation.mutate(\n                                                            groupMessageForm\n                                                        )\n                                                    }\n                                                    disabled={\n                                                        !groupMessageForm.message ||\n                                                        sendGroupMessageMutation.isPending\n                                                    }\n                                                    data-testid=\"button-send-announcement\"\n                                                    className=\"w-full\">\n                                                    <Send className=\"h-4 w-4 mr-2\" />\n                                                    {sendGroupMessageMutation.isPending\n                                                        ? \"Sending...\"\n                                                        : \"Send to All Users\"}\n                                                </Button>\n                                            </div>\n                                        </div>\n\n                                        <div className=\"space-y-2\">\n                                            <h3 className=\"font-semibold\">\n                                                Recent Announcements\n                                            </h3>\n                                            <div className=\"space-y-2\">\n                                                {groupMessages\n                                                    .slice(0, 5)\n                                                    .map((msg) => (\n                                                        <div\n                                                            key={msg.id}\n                                                            className=\"bg-card border rounded-lg p-4\"\n                                                            data-testid={`announcement-${msg.id}`}>\n                                                            {msg.title && (\n                                                                <h4 className=\"font-semibold mb-2\">\n                                                                    {msg.title}\n                                                                </h4>\n                                                            )}\n                                                            <p className=\"text-sm text-muted-foreground mb-2\">\n                                                                {msg.message}\n                                                            </p>\n                                                            <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                                                                <span>\n                                                                    From:{\" \"}\n                                                                    {getUserNameById(\n                                                                        msg.senderId\n                                                                    )}\n                                                                </span>\n                                                                <span className=\"font-mono\">\n                                                                    {format(\n                                                                        new Date(\n                                                                            msg.createdAt\n                                                                        ),\n                                                                        \"MMM dd, yyyy HH:mm\"\n                                                                    )}\n                                                                </span>\n                                                            </div>\n                                                        </div>\n                                                    ))}\n                                                {groupMessages.length === 0 && (\n                                                    <div className=\"text-center py-8 text-muted-foreground\">\n                                                        No announcements yet\n                                                    </div>\n                                                )}\n                                            </div>\n                                        </div>\n                                    </TabsContent>\n                                </Tabs>\n                            </CardContent>\n                        </Card>\n                    </main>\n                </div>\n            </div>\n\n            {/* Report Detail Dialog */}\n            <Dialog open={reportDialogOpen} onOpenChange={setReportDialogOpen}>\n                <DialogContent className=\"max-w-3xl max-h-[80vh] overflow-y-auto\">\n                    <DialogHeader>\n                        <DialogTitle>Report Details</DialogTitle>\n                        <DialogDescription>\n                            {selectedReport &&\n                                `${\n                                    selectedReport.reportType\n                                        .charAt(0)\n                                        .toUpperCase() +\n                                    selectedReport.reportType.slice(1)\n                                } report by ${getUserNameById(\n                                    selectedReport.userId\n                                )}`}\n                        </DialogDescription>\n                    </DialogHeader>\n                    {selectedReport && (\n                        <div className=\"space-y-6\">\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div>\n                                    <Label className=\"text-sm font-semibold text-muted-foreground\">\n                                        User\n                                    </Label>\n                                    <div className=\"flex items-center gap-2 mt-1\">\n                                        <Avatar className=\"h-8 w-8\">\n                                            <AvatarImage\n                                                src={\n                                                    users.find(\n                                                        (u) =>\n                                                            u.id ===\n                                                            selectedReport.userId\n                                                    )?.photoURL || \"\"\n                                                }\n                                            />\n                                            <AvatarFallback className=\"bg-primary text-primary-foreground text-xs\">\n                                                {getUserNameById(\n                                                    selectedReport.userId\n                                                )\n                                                    .split(\" \")\n                                                    .map((n) => n[0])\n                                                    .join(\"\")\n                                                    .toUpperCase()}\n                                            </AvatarFallback>\n                                        </Avatar>\n                                        <span className=\"text-sm font-medium\">\n                                            {getUserNameById(\n                                                selectedReport.userId\n                                            )}\n                                        </span>\n                                    </div>\n                                </div>\n                                <div>\n                                    <Label className=\"text-sm font-semibold text-muted-foreground\">\n                                        Report Type\n                                    </Label>\n                                    <p className=\"mt-1 capitalize\">\n                                        <Badge variant=\"outline\">\n                                            {selectedReport.reportType}\n                                        </Badge>\n                                    </p>\n                                </div>\n                                <div>\n                                    <Label className=\"text-sm font-semibold text-muted-foreground\">\n                                        Submitted Date\n                                    </Label>\n                                    <p className=\"mt-1 text-sm font-mono\">\n                                        {format(\n                                            new Date(selectedReport.createdAt),\n                                            \"PPP 'at' p\"\n                                        )}\n                                    </p>\n                                </div>\n                                <div>\n                                    <Label className=\"text-sm font-semibold text-muted-foreground\">\n                                        Report ID\n                                    </Label>\n                                    <p className=\"mt-1 text-sm font-mono\">\n                                        #{selectedReport.id}\n                                    </p>\n                                </div>\n                            </div>\n\n                            <div className=\"border-t pt-4\">\n                                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                                    {selectedReport.plannedTasks && (\n                                        <div className=\"space-y-2\">\n                                            <Label className=\"text-sm font-semibold text-muted-foreground\">\n                                                Planned Tasks\n                                            </Label>\n                                            <div className=\"bg-muted/50 p-3 rounded-lg\">\n                                                <p className=\"text-sm whitespace-pre-wrap\">\n                                                    {\n                                                        selectedReport.plannedTasks\n                                                    }\n                                                </p>\n                                            </div>\n                                        </div>\n                                    )}\n                                    {selectedReport.completedTasks && (\n                                        <div className=\"space-y-2\">\n                                            <Label className=\"text-sm font-semibold text-muted-foreground\">\n                                                Completed Tasks\n                                            </Label>\n                                            <div className=\"bg-muted/50 p-3 rounded-lg\">\n                                                <p className=\"text-sm whitespace-pre-wrap\">\n                                                    {\n                                                        selectedReport.completedTasks\n                                                    }\n                                                </p>\n                                            </div>\n                                        </div>\n                                    )}\n                                    {selectedReport.pendingTasks && (\n                                        <div className=\"space-y-2\">\n                                            <Label className=\"text-sm font-semibold text-muted-foreground\">\n                                                Pending Tasks\n                                            </Label>\n                                            <div className=\"bg-muted/50 p-3 rounded-lg\">\n                                                <p className=\"text-sm whitespace-pre-wrap\">\n                                                    {\n                                                        selectedReport.pendingTasks\n                                                    }\n                                                </p>\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n\n                            {selectedReport.notes && (\n                                <div className=\"border-t pt-4\">\n                                    <Label className=\"text-sm font-semibold text-muted-foreground\">\n                                        Additional Notes\n                                    </Label>\n                                    <div className=\"mt-2 bg-muted/50 p-4 rounded-lg\">\n                                        <p className=\"text-sm whitespace-pre-wrap\">\n                                            {selectedReport.notes}\n                                        </p>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    )}\n                </DialogContent>\n            </Dialog>\n\n            {/* Rating Dialog */}\n            <Dialog open={ratingDialogOpen} onOpenChange={setRatingDialogOpen}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>Rate User</DialogTitle>\n                        <DialogDescription>\n                            Provide feedback and rating for the selected user\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"rating-period\">Period</Label>\n                            <Select\n                                value={ratingForm.period}\n                                onValueChange={(value) =>\n                                    setRatingForm({\n                                        ...ratingForm,\n                                        period: value,\n                                    })\n                                }>\n                                <SelectTrigger\n                                    id=\"rating-period\"\n                                    data-testid=\"select-rating-period\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"daily\">Daily</SelectItem>\n                                    <SelectItem value=\"weekly\">\n                                        Weekly\n                                    </SelectItem>\n                                    <SelectItem value=\"monthly\">\n                                        Monthly\n                                    </SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"rating-value\">Rating</Label>\n                            <Select\n                                value={ratingForm.rating}\n                                onValueChange={(value) =>\n                                    setRatingForm({\n                                        ...ratingForm,\n                                        rating: value,\n                                    })\n                                }>\n                                <SelectTrigger\n                                    id=\"rating-value\"\n                                    data-testid=\"select-rating-value\">\n                                    <SelectValue placeholder=\"Select rating\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"Excellent\">\n                                        ⭐⭐⭐⭐⭐ Excellent\n                                    </SelectItem>\n                                    <SelectItem value=\"Very Good\">\n                                        ⭐⭐⭐⭐ Very Good\n                                    </SelectItem>\n                                    <SelectItem value=\"Good\">\n                                        ⭐⭐⭐ Good\n                                    </SelectItem>\n                                    <SelectItem value=\"Average\">\n                                        ⭐⭐ Average\n                                    </SelectItem>\n                                    <SelectItem value=\"Needs Improvement\">\n                                        ⭐ Needs Improvement\n                                    </SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"rating-feedback\">\n                                Feedback (Optional)\n                            </Label>\n                            <Textarea\n                                id=\"rating-feedback\"\n                                placeholder=\"Provide additional feedback...\"\n                                value={ratingForm.feedback}\n                                onChange={(e) =>\n                                    setRatingForm({\n                                        ...ratingForm,\n                                        feedback: e.target.value,\n                                    })\n                                }\n                                data-testid=\"textarea-rating-feedback\"\n                                rows={4}\n                            />\n                        </div>\n                        <Button\n                            onClick={() =>\n                                createRatingMutation.mutate(ratingForm)\n                            }\n                            disabled={\n                                !ratingForm.userId ||\n                                !ratingForm.rating ||\n                                createRatingMutation.isPending\n                            }\n                            data-testid=\"button-submit-rating\"\n                            className=\"w-full\">\n                            {createRatingMutation.isPending\n                                ? \"Submitting...\"\n                                : \"Submit Rating\"}\n                        </Button>\n                    </div>\n                </DialogContent>\n            </Dialog>\n        </SidebarProvider>\n    );\n}\n","path":null,"size_bytes":91002,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/examples/AppSidebar.tsx":{"content":"import { SidebarProvider } from \"@/components/ui/sidebar\";\nimport AppSidebar from '../AppSidebar'\n\nexport default function AppSidebarExample() {\n  const style = {\n    \"--sidebar-width\": \"20rem\",\n    \"--sidebar-width-icon\": \"4rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n      </div>\n    </SidebarProvider>\n  )\n}\n","path":null,"size_bytes":417,"size_tokens":null},"client/src/pages/team-leader/TeamTasks.tsx":{"content":"import {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n    Plus,\n    Calendar,\n    User,\n    Edit,\n    Trash2,\n    ClipboardList,\n    Users,\n    Play,\n    Pause,\n    CheckCircle2,\n} from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useState, useEffect } from \"react\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTaskUpdates } from \"@/hooks/useTaskUpdates\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\ninterface Task {\n    id: number;\n    title: string;\n    description?: string;\n    assignedTo: number;\n    assignedBy: number;\n    deadline: string | null;\n    priority: string;\n    status: string;\n    companyId: number;\n}\n\ninterface TeamMember {\n    id: number;\n    displayName: string;\n    uniqueUserId: string;\n}\n\nexport default function TeamTasks() {\n    const { dbUserId } = useAuth();\n    const { toast } = useToast();\n    const [isCreateOpen, setIsCreateOpen] = useState(false);\n    const [isEditOpen, setIsEditOpen] = useState(false);\n    const [selectedTask, setSelectedTask] = useState<Task | null>(null);\n    const [taskForm, setTaskForm] = useState({\n        title: \"\",\n        description: \"\",\n        assignedTo: \"\",\n        deadline: \"\",\n        priority: \"medium\",\n        status: \"pending\",\n    });\n    const [timerStates, setTimerStates] = useState<\n        Record<number, { isRunning: boolean; elapsed: number }>\n    >({});\n    const [timerIntervals, setTimerIntervals] = useState<\n        Record<number, NodeJS.Timeout>\n    >({});\n    const [completedTaskIds, setCompletedTaskIds] = useState<Set<number>>(\n        new Set()\n    );\n\n    // Load timer state from localStorage on mount\n    useEffect(() => {\n        const savedTimers = localStorage.getItem(\"taskTimers\");\n        if (savedTimers) {\n            try {\n                setTimerStates(JSON.parse(savedTimers));\n            } catch (e) {\n                console.error(\"Failed to load timer state:\", e);\n            }\n        }\n\n        const savedCompletedIds = localStorage.getItem(\"completedTaskIds\");\n        if (savedCompletedIds) {\n            try {\n                setCompletedTaskIds(new Set(JSON.parse(savedCompletedIds)));\n            } catch (e) {\n                console.error(\"Failed to load completed task IDs:\", e);\n            }\n        }\n    }, []);\n\n    // Listen to WebSocket updates to handle status changes\n    useEffect(() => {\n        const ws = new WebSocket(\n            `${window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\"}//${\n                window.location.host\n            }/ws`\n        );\n\n        ws.onopen = () => {\n            console.log(\"[WebSocket] Connected for task updates\");\n        };\n\n        ws.onmessage = (event) => {\n            try {\n                const message = JSON.parse(event.data);\n\n                if (message.type === \"task_updated\") {\n                    console.log(\"[WebSocket] Task update received:\", message);\n                    // If task was reverted to pending, clear it from completed\n                    if (message.status === \"pending\") {\n                        setCompletedTaskIds((prev) => {\n                            const updated = new Set(prev);\n                            updated.delete(message.taskId);\n                            // Update localStorage immediately\n                            localStorage.setItem(\n                                \"completedTaskIds\",\n                                JSON.stringify(Array.from(updated))\n                            );\n                            return updated;\n                        });\n                        // Also reset timer for this task\n                        setTimerStates((prev) => ({\n                            ...prev,\n                            [message.taskId]: { isRunning: false, elapsed: 0 },\n                        }));\n                        // Clear from localStorage\n                        localStorage.setItem(\n                            \"taskTimers\",\n                            JSON.stringify({\n                                ...JSON.parse(\n                                    localStorage.getItem(\"taskTimers\") || \"{}\"\n                                ),\n                                [message.taskId]: {\n                                    isRunning: false,\n                                    elapsed: 0,\n                                },\n                            })\n                        );\n                    }\n                    // Invalidate queries to force refetch\n                    queryClient.invalidateQueries({ queryKey: [\"/api/tasks\"] });\n                    queryClient.invalidateQueries({\n                        queryKey: [\"/api/dashboard/stats\"],\n                    });\n                }\n            } catch (error) {\n                console.error(\"[WebSocket] Error parsing message:\", error);\n            }\n        };\n\n        ws.onerror = (error) => {\n            console.error(\"[WebSocket] Error:\", error);\n        };\n\n        return () => {\n            ws.close();\n        };\n    }, []);\n\n    // Save timer state to localStorage whenever it changes\n    useEffect(() => {\n        localStorage.setItem(\"taskTimers\", JSON.stringify(timerStates));\n    }, [timerStates]);\n\n    // Save completed task IDs to localStorage whenever they change\n    useEffect(() => {\n        localStorage.setItem(\n            \"completedTaskIds\",\n            JSON.stringify(Array.from(completedTaskIds))\n        );\n    }, [completedTaskIds]);\n\n    const { data: teamMembers = [] } = useQuery<TeamMember[]>({\n        queryKey: [`/api/team-assignments/${dbUserId}/members`],\n        enabled: !!dbUserId,\n    });\n\n    const { data: allTasks = [], isLoading } = useQuery<Task[]>({\n        queryKey: [\"/api/tasks\"],\n    });\n\n    const teamMemberIds = teamMembers.map((m) => m.id);\n    const leaderTasks = allTasks.filter((task) => task.assignedTo === dbUserId);\n    const teamMemberTasks = allTasks.filter((task) =>\n        teamMemberIds.includes(task.assignedTo)\n    );\n\n    const createTaskMutation = useMutation({\n        mutationFn: async (data: any) => {\n            return apiRequest(`${API_BASE_URL}/api/tasks`, \"POST\", {\n                ...data,\n                assignedBy: dbUserId,\n            });\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/tasks\"],\n            });\n            setIsCreateOpen(false);\n            resetForm();\n            toast({\n                title: \"Success\",\n                description: \"Task created successfully\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to create task\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const updateTaskMutation = useMutation({\n        mutationFn: async ({ id, ...data }: any) => {\n            return apiRequest(`${API_BASE_URL}/api/tasks/${id}`, \"PATCH\", data);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/tasks\"],\n            });\n            setIsEditOpen(false);\n            setSelectedTask(null);\n            toast({\n                title: \"Success\",\n                description: \"Task updated successfully\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to update task\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const deleteTaskMutation = useMutation({\n        mutationFn: async (taskId: number) => {\n            return apiRequest(`${API_BASE_URL}/api/tasks/${taskId}`, \"DELETE\");\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/tasks\"],\n            });\n            toast({\n                title: \"Success\",\n                description: \"Task deleted successfully\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to delete task\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const resetForm = () => {\n        setTaskForm({\n            title: \"\",\n            description: \"\",\n            assignedTo: \"\",\n            deadline: \"\",\n            priority: \"medium\",\n            status: \"pending\",\n        });\n    };\n\n    const handleCreate = () => {\n        if (!taskForm.title || !taskForm.assignedTo || !taskForm.deadline) {\n            toast({\n                title: \"Error\",\n                description: \"Please fill in all required fields\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n        createTaskMutation.mutate({\n            ...taskForm,\n            assignedTo: parseInt(taskForm.assignedTo),\n            deadline: taskForm.deadline\n                ? new Date(taskForm.deadline).toISOString()\n                : null,\n        });\n    };\n\n    const handleEdit = (task: Task) => {\n        setSelectedTask(task);\n        setTaskForm({\n            title: task.title,\n            description: task.description || \"\",\n            assignedTo: task.assignedTo.toString(),\n            deadline: task.deadline ? task.deadline.split(\"T\")[0] : \"\",\n            priority: task.priority,\n            status: task.status,\n        });\n        setIsEditOpen(true);\n    };\n\n    const handleUpdate = () => {\n        if (!selectedTask) return;\n        updateTaskMutation.mutate({\n            id: selectedTask.id,\n            ...taskForm,\n            assignedTo: parseInt(taskForm.assignedTo),\n            deadline: taskForm.deadline\n                ? new Date(taskForm.deadline).toISOString()\n                : null,\n        });\n    };\n\n    const getPriorityColor = (priority: string) => {\n        switch (priority) {\n            case \"high\":\n                return \"destructive\";\n            case \"medium\":\n                return \"default\";\n            case \"low\":\n                return \"secondary\";\n            default:\n                return \"secondary\";\n        }\n    };\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case \"completed\":\n                return \"default\";\n            case \"in_progress\":\n                return \"default\";\n            case \"pending\":\n                return \"secondary\";\n            default:\n                return \"secondary\";\n        }\n    };\n\n    const formatTime = (seconds: number) => {\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n        return `${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(\n            2,\n            \"0\"\n        )}:${String(secs).padStart(2, \"0\")}`;\n    };\n\n    const startTimer = (taskId: number) => {\n        setTimerStates((prev) => ({\n            ...prev,\n            [taskId]: { isRunning: true, elapsed: prev[taskId]?.elapsed || 0 },\n        }));\n\n        const interval = setInterval(() => {\n            setTimerStates((prev) => ({\n                ...prev,\n                [taskId]: {\n                    isRunning: true,\n                    elapsed: (prev[taskId]?.elapsed || 0) + 1,\n                },\n            }));\n        }, 1000);\n\n        setTimerIntervals((prev) => ({\n            ...prev,\n            [taskId]: interval,\n        }));\n    };\n\n    const pauseTimer = (taskId: number) => {\n        setTimerStates((prev) => ({\n            ...prev,\n            [taskId]: { ...prev[taskId], isRunning: false },\n        }));\n        if (timerIntervals[taskId]) {\n            clearInterval(timerIntervals[taskId]);\n        }\n    };\n\n    const completeTask = async (taskId: number) => {\n        try {\n            pauseTimer(taskId);\n            const timer = timerStates[taskId];\n            console.log(\"Completing task:\", taskId);\n\n            await apiRequest(\n                `${API_BASE_URL}/api/tasks/${taskId}/timer/complete`,\n                \"POST\",\n                {\n                    userId: dbUserId,\n                    date: new Date().toISOString().split(\"T\")[0],\n                    duration: timer?.elapsed || 0,\n                }\n            );\n            console.log(\"Timer completed\");\n\n            // Use the status endpoint to update task status\n            console.log(\"Updating status for task:\", taskId);\n            await apiRequest(\n                `${API_BASE_URL}/api/tasks/${taskId}/status`,\n                \"PATCH\",\n                {\n                    status: \"completed\",\n                }\n            );\n            console.log(\"Status updated\");\n\n            // Invalidate queries to refresh data\n            await queryClient.invalidateQueries({\n                queryKey: [\"/api/tasks\"],\n            });\n            await queryClient.invalidateQueries({\n                queryKey: [\"/api/dashboard/stats\"],\n            });\n            console.log(\"Queries invalidated\");\n\n            const newCompleted = new Set(completedTaskIds);\n            newCompleted.add(taskId);\n            setCompletedTaskIds(newCompleted);\n            toast({\n                title: \"Success\",\n                description: \"Task completed successfully\",\n            });\n        } catch (error: any) {\n            console.error(\"Error completing task:\", error);\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to complete task\",\n                variant: \"destructive\",\n            });\n        }\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                    <div>\n                        <Skeleton className=\"h-10 w-48 mb-2\" />\n                        <Skeleton className=\"h-5 w-72\" />\n                    </div>\n                    <Skeleton className=\"h-10 w-32\" />\n                </div>\n                <div className=\"space-y-4\">\n                    {[...Array(3)].map((_, i) => (\n                        <Skeleton key={i} className=\"h-40 w-full\" />\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\">Tasks</h1>\n                    <p className=\"text-muted-foreground\">\n                        View your assigned tasks and manage team tasks\n                    </p>\n                </div>\n                <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n                    <DialogTrigger asChild>\n                        <Button\n                            data-testid=\"button-create-task\"\n                            onClick={resetForm}>\n                            <Plus className=\"h-4 w-4 mr-2\" />\n                            Create Task for Team\n                        </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>Create New Task</DialogTitle>\n                            <DialogDescription>\n                                Assign a new task to one of your team members\n                            </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"space-y-4\">\n                            <div>\n                                <Label htmlFor=\"title\">Task Title *</Label>\n                                <Input\n                                    id=\"title\"\n                                    value={taskForm.title}\n                                    onChange={(e) =>\n                                        setTaskForm({\n                                            ...taskForm,\n                                            title: e.target.value,\n                                        })\n                                    }\n                                    placeholder=\"Enter task title\"\n                                />\n                            </div>\n                            <div>\n                                <Label htmlFor=\"description\">Description</Label>\n                                <Textarea\n                                    id=\"description\"\n                                    value={taskForm.description}\n                                    onChange={(e) =>\n                                        setTaskForm({\n                                            ...taskForm,\n                                            description: e.target.value,\n                                        })\n                                    }\n                                    placeholder=\"Enter task description\"\n                                />\n                            </div>\n                            <div>\n                                <Label htmlFor=\"assignedTo\">Assign To *</Label>\n                                <Select\n                                    value={taskForm.assignedTo}\n                                    onValueChange={(value) =>\n                                        setTaskForm({\n                                            ...taskForm,\n                                            assignedTo: value,\n                                        })\n                                    }>\n                                    <SelectTrigger>\n                                        <SelectValue placeholder=\"Select team member\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {teamMembers.map((member) => (\n                                            <SelectItem\n                                                key={member.id}\n                                                value={member.id.toString()}>\n                                                {member.displayName} (\n                                                {member.uniqueUserId})\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div>\n                                    <Label htmlFor=\"deadline\">Deadline *</Label>\n                                    <Input\n                                        id=\"deadline\"\n                                        type=\"date\"\n                                        value={taskForm.deadline}\n                                        onChange={(e) =>\n                                            setTaskForm({\n                                                ...taskForm,\n                                                deadline: e.target.value,\n                                            })\n                                        }\n                                    />\n                                </div>\n                                <div>\n                                    <Label htmlFor=\"priority\">Priority</Label>\n                                    <Select\n                                        value={taskForm.priority}\n                                        onValueChange={(value) =>\n                                            setTaskForm({\n                                                ...taskForm,\n                                                priority: value,\n                                            })\n                                        }>\n                                        <SelectTrigger>\n                                            <SelectValue />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            <SelectItem value=\"low\">\n                                                Low\n                                            </SelectItem>\n                                            <SelectItem value=\"medium\">\n                                                Medium\n                                            </SelectItem>\n                                            <SelectItem value=\"high\">\n                                                High\n                                            </SelectItem>\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                            </div>\n                        </div>\n                        <DialogFooter>\n                            <Button\n                                variant=\"outline\"\n                                onClick={() => setIsCreateOpen(false)}>\n                                Cancel\n                            </Button>\n                            <Button\n                                onClick={handleCreate}\n                                disabled={createTaskMutation.isPending}>\n                                {createTaskMutation.isPending\n                                    ? \"Creating...\"\n                                    : \"Create Task\"}\n                            </Button>\n                        </DialogFooter>\n                    </DialogContent>\n                </Dialog>\n            </div>\n\n            <Tabs defaultValue=\"my-tasks\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n                    <TabsTrigger\n                        value=\"my-tasks\"\n                        className=\"flex items-center gap-2\"\n                        data-testid=\"tab-my-tasks\">\n                        <ClipboardList className=\"h-4 w-4\" />\n                        My Assigned Tasks ({leaderTasks.length})\n                    </TabsTrigger>\n                    <TabsTrigger\n                        value=\"team-tasks\"\n                        className=\"flex items-center gap-2\"\n                        data-testid=\"tab-team-tasks\">\n                        <Users className=\"h-4 w-4\" />\n                        Team Member Tasks ({teamMemberTasks.length})\n                    </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"my-tasks\">\n                    <div className=\"grid gap-4\">\n                        {leaderTasks.map((task) => {\n                            const timer = timerStates[task.id] || {\n                                isRunning: false,\n                                elapsed: 0,\n                            };\n                            return (\n                                <Card\n                                    key={task.id}\n                                    data-testid={`card-leader-task-${task.id}`}>\n                                    <CardHeader>\n                                        <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                                            <div className=\"flex-1 min-w-0\">\n                                                <CardTitle className=\"text-lg\">\n                                                    {task.title}\n                                                </CardTitle>\n                                                {task.description && (\n                                                    <p className=\"text-sm text-muted-foreground mt-2\">\n                                                        {task.description}\n                                                    </p>\n                                                )}\n                                                <CardDescription className=\"flex flex-wrap items-center gap-2 mt-2\">\n                                                    <Calendar className=\"h-4 w-4\" />\n                                                    <span>\n                                                        {task.deadline\n                                                            ? new Date(\n                                                                  task.deadline\n                                                              ).toLocaleDateString()\n                                                            : \"No deadline\"}\n                                                    </span>\n                                                </CardDescription>\n                                            </div>\n                                            <div className=\"flex flex-wrap gap-2\">\n                                                <Badge\n                                                    variant={getPriorityColor(\n                                                        task.priority\n                                                    )}>\n                                                    {task.priority}\n                                                </Badge>\n                                                <Badge\n                                                    variant={getStatusColor(\n                                                        task.status\n                                                    )}>\n                                                    {task.status.replace(\n                                                        \"_\",\n                                                        \" \"\n                                                    )}\n                                                </Badge>\n                                            </div>\n                                        </div>\n                                    </CardHeader>\n                                    <CardContent>\n                                        <div className=\"flex flex-col gap-4\">\n                                            {completedTaskIds.has(task.id) ? (\n                                                <div className=\"flex items-center gap-2 p-3 bg-green-100 dark:bg-green-900 rounded-md\">\n                                                    <CheckCircle2 className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                                                    <span className=\"text-green-800 dark:text-green-200 font-semibold\">\n                                                        Task Completed\n                                                    </span>\n                                                </div>\n                                            ) : (\n                                                <div className=\"flex items-center justify-between\">\n                                                    <span className=\"text-2xl font-mono font-semibold\">\n                                                        {formatTime(\n                                                            timer.elapsed\n                                                        )}\n                                                    </span>\n                                                    <div className=\"flex gap-2\">\n                                                        {!timer.isRunning ? (\n                                                            <Button\n                                                                size=\"sm\"\n                                                                onClick={() =>\n                                                                    startTimer(\n                                                                        task.id\n                                                                    )\n                                                                }\n                                                                data-testid={`button-start-timer-${task.id}`}>\n                                                                <Play className=\"h-4 w-4 mr-2\" />\n                                                                Start\n                                                            </Button>\n                                                        ) : (\n                                                            <Button\n                                                                size=\"sm\"\n                                                                variant=\"secondary\"\n                                                                onClick={() =>\n                                                                    pauseTimer(\n                                                                        task.id\n                                                                    )\n                                                                }\n                                                                data-testid={`button-pause-timer-${task.id}`}>\n                                                                <Pause className=\"h-4 w-4 mr-2\" />\n                                                                Pause\n                                                            </Button>\n                                                        )}\n                                                        <Button\n                                                            size=\"sm\"\n                                                            onClick={() =>\n                                                                completeTask(\n                                                                    task.id\n                                                                )\n                                                            }\n                                                            disabled={\n                                                                updateTaskMutation.isPending\n                                                            }\n                                                            data-testid={`button-complete-task-${task.id}`}>\n                                                            <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                                                            Complete\n                                                        </Button>\n                                                    </div>\n                                                </div>\n                                            )}\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            );\n                        })}\n                    </div>\n\n                    {leaderTasks.length === 0 && (\n                        <Card>\n                            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                                <p className=\"text-muted-foreground\">\n                                    No tasks assigned to you yet\n                                </p>\n                                <p className=\"text-sm text-muted-foreground mt-2\">\n                                    Tasks assigned by admin will appear here\n                                </p>\n                            </CardContent>\n                        </Card>\n                    )}\n                </TabsContent>\n\n                <TabsContent value=\"team-tasks\">\n                    <div className=\"grid gap-4\">\n                        {teamMemberTasks.map((task) => {\n                            const assignedMember = teamMembers.find(\n                                (m) => m.id === task.assignedTo\n                            );\n                            return (\n                                <Card\n                                    key={task.id}\n                                    data-testid={`card-team-task-${task.id}`}>\n                                    <CardHeader>\n                                        <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                                            <div className=\"flex-1 min-w-0\">\n                                                <CardTitle className=\"text-lg\">\n                                                    {task.title}\n                                                </CardTitle>\n                                                {task.description && (\n                                                    <p className=\"text-sm text-muted-foreground mt-2\">\n                                                        {task.description}\n                                                    </p>\n                                                )}\n                                                <CardDescription className=\"flex flex-wrap items-center gap-2 mt-2\">\n                                                    <User className=\"h-4 w-4\" />\n                                                    <span>\n                                                        {assignedMember?.displayName ||\n                                                            \"Unknown\"}\n                                                    </span>\n                                                    <span className=\"text-muted-foreground\">\n                                                        •\n                                                    </span>\n                                                    <Calendar className=\"h-4 w-4\" />\n                                                    <span>\n                                                        {task.deadline\n                                                            ? new Date(\n                                                                  task.deadline\n                                                              ).toLocaleDateString()\n                                                            : \"No deadline\"}\n                                                    </span>\n                                                </CardDescription>\n                                            </div>\n                                            <div className=\"flex flex-wrap gap-2\">\n                                                <Badge\n                                                    variant={getPriorityColor(\n                                                        task.priority\n                                                    )}>\n                                                    {task.priority}\n                                                </Badge>\n                                                <Badge\n                                                    variant={getStatusColor(\n                                                        task.status\n                                                    )}>\n                                                    {task.status.replace(\n                                                        \"_\",\n                                                        \" \"\n                                                    )}\n                                                </Badge>\n                                            </div>\n                                        </div>\n                                    </CardHeader>\n                                    <CardContent>\n                                        <div className=\"flex gap-2\">\n                                            <Button\n                                                variant=\"outline\"\n                                                size=\"sm\"\n                                                onClick={() => handleEdit(task)}\n                                                data-testid={`button-edit-task-${task.id}`}>\n                                                <Edit className=\"h-4 w-4 mr-2\" />\n                                                Edit\n                                            </Button>\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            );\n                        })}\n                    </div>\n\n                    {teamMemberTasks.length === 0 && (\n                        <Card>\n                            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                                <p className=\"text-muted-foreground\">\n                                    No team member tasks yet\n                                </p>\n                                <p className=\"text-sm text-muted-foreground mt-2\">\n                                    Create a task to assign to your team members\n                                </p>\n                            </CardContent>\n                        </Card>\n                    )}\n                </TabsContent>\n            </Tabs>\n\n            <Dialog open={isEditOpen} onOpenChange={setIsEditOpen}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>Edit Task</DialogTitle>\n                        <DialogDescription>\n                            Update task details\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <Label htmlFor=\"edit-title\">Task Title *</Label>\n                            <Input\n                                id=\"edit-title\"\n                                value={taskForm.title}\n                                onChange={(e) =>\n                                    setTaskForm({\n                                        ...taskForm,\n                                        title: e.target.value,\n                                    })\n                                }\n                            />\n                        </div>\n                        <div>\n                            <Label htmlFor=\"edit-description\">\n                                Description\n                            </Label>\n                            <Textarea\n                                id=\"edit-description\"\n                                value={taskForm.description}\n                                onChange={(e) =>\n                                    setTaskForm({\n                                        ...taskForm,\n                                        description: e.target.value,\n                                    })\n                                }\n                            />\n                        </div>\n                        <div>\n                            <Label htmlFor=\"edit-status\">Status</Label>\n                            <Select\n                                value={taskForm.status}\n                                onValueChange={(value) =>\n                                    setTaskForm({ ...taskForm, status: value })\n                                }>\n                                <SelectTrigger>\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"pending\">\n                                        Pending\n                                    </SelectItem>\n                                    <SelectItem value=\"in_progress\">\n                                        In Progress\n                                    </SelectItem>\n                                    <SelectItem value=\"completed\">\n                                        Completed\n                                    </SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div>\n                                <Label htmlFor=\"edit-deadline\">Deadline</Label>\n                                <Input\n                                    id=\"edit-deadline\"\n                                    type=\"date\"\n                                    value={taskForm.deadline}\n                                    onChange={(e) =>\n                                        setTaskForm({\n                                            ...taskForm,\n                                            deadline: e.target.value,\n                                        })\n                                    }\n                                />\n                            </div>\n                            <div>\n                                <Label htmlFor=\"edit-priority\">Priority</Label>\n                                <Select\n                                    value={taskForm.priority}\n                                    onValueChange={(value) =>\n                                        setTaskForm({\n                                            ...taskForm,\n                                            priority: value,\n                                        })\n                                    }>\n                                    <SelectTrigger>\n                                        <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        <SelectItem value=\"low\">Low</SelectItem>\n                                        <SelectItem value=\"medium\">\n                                            Medium\n                                        </SelectItem>\n                                        <SelectItem value=\"high\">\n                                            High\n                                        </SelectItem>\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => setIsEditOpen(false)}>\n                            Cancel\n                        </Button>\n                        <Button\n                            onClick={handleUpdate}\n                            disabled={updateTaskMutation.isPending}>\n                            {updateTaskMutation.isPending\n                                ? \"Updating...\"\n                                : \"Update Task\"}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":43244,"size_tokens":null},"client/src/pages/user/Reports.tsx":{"content":"import { useAuth } from \"@/contexts/AuthContext\";\nimport TimeBasedForm from \"@/components/TimeBasedForm\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Sunrise, Moon, Clock, Calendar } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\nexport default function Reports() {\n  const { user, dbUserId } = useAuth();\n  const currentDate = new Date();\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight\">Daily Reports</h2>\n          <p className=\"text-muted-foreground mt-1\">\n            Submit your morning and evening work reports\n          </p>\n        </div>\n        <Card className=\"sm:w-auto\">\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <Calendar className=\"h-5 w-5 text-muted-foreground\" />\n            <div>\n              <p className=\"text-sm font-medium\">{format(currentDate, 'EEEE')}</p>\n              <p className=\"text-xs text-muted-foreground\">{format(currentDate, 'MMM dd, yyyy')}</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {user && dbUserId && (\n        <Tabs defaultValue=\"morning\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2 h-auto p-1 bg-muted\">\n            <TabsTrigger \n              value=\"morning\" \n              className=\"flex items-center gap-2 py-3 data-[state=active]:bg-background data-[state=active]:shadow-sm\"\n            >\n              <div className=\"flex items-center gap-2\">\n                <div className=\"p-2 rounded-full bg-amber-500/10\">\n                  <Sunrise className=\"h-4 w-4 text-amber-500\" />\n                </div>\n                <div className=\"text-left\">\n                  <p className=\"font-semibold text-sm\">Morning Report</p>\n                  <p className=\"text-xs text-muted-foreground hidden sm:block\">9:30 - 11:30 AM</p>\n                </div>\n              </div>\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"evening\" \n              className=\"flex items-center gap-2 py-3 data-[state=active]:bg-background data-[state=active]:shadow-sm\"\n            >\n              <div className=\"flex items-center gap-2\">\n                <div className=\"p-2 rounded-full bg-blue-500/10\">\n                  <Moon className=\"h-4 w-4 text-blue-500\" />\n                </div>\n                <div className=\"text-left\">\n                  <p className=\"font-semibold text-sm\">Evening Report</p>\n                  <p className=\"text-xs text-muted-foreground hidden sm:block\">6:30 - 11:30 PM</p>\n                </div>\n              </div>\n            </TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"morning\" className=\"mt-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"p-2 rounded-lg bg-amber-500/10\">\n                    <Sunrise className=\"h-5 w-5 text-amber-500\" />\n                  </div>\n                  <div>\n                    <CardTitle>Morning Report</CardTitle>\n                    <CardDescription className=\"flex items-center gap-1 mt-1\">\n                      <Clock className=\"h-3 w-3\" />\n                      Submit between 9:30 AM - 11:30 AM\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <TimeBasedForm \n                  type=\"morning\"\n                  userName={user.displayName || \"\"}\n                  userId={dbUserId}\n                />\n              </CardContent>\n            </Card>\n          </TabsContent>\n          \n          <TabsContent value=\"evening\" className=\"mt-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"p-2 rounded-lg bg-blue-500/10\">\n                    <Moon className=\"h-5 w-5 text-blue-500\" />\n                  </div>\n                  <div>\n                    <CardTitle>Evening Report</CardTitle>\n                    <CardDescription className=\"flex items-center gap-1 mt-1\">\n                      <Clock className=\"h-3 w-3\" />\n                      Submit between 6:30 PM - 11:30 PM\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <TimeBasedForm \n                  type=\"evening\"\n                  userName={user.displayName || \"\"}\n                  userId={dbUserId}\n                />\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":4880,"size_tokens":null},"client/src/pages/admin/AttendancePolicy.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n    CardDescription,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Settings, Clock, MapPin, Smartphone, Save } from \"lucide-react\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport type { AttendancePolicy } from \"@shared/schema\";\n\nexport default function AttendancePolicy() {\n    const { toast } = useToast();\n    const [formData, setFormData] = useState({\n        halfDayHours: 4,\n        fullDayHours: 8,\n        lateMarkThreshold: 3,\n        autoAbsentHours: 2,\n        allowSelfCheckIn: true,\n        requireGPS: false,\n        requireDeviceBinding: false,\n    });\n\n    const { data: policy, isLoading } = useQuery<AttendancePolicy>({\n        queryKey: [\"/api/admin/attendance-policy\"],\n    });\n\n    useEffect(() => {\n        if (policy) {\n            setFormData({\n                halfDayHours: policy.halfDayHours,\n                fullDayHours: policy.fullDayHours,\n                lateMarkThreshold: policy.lateMarkThreshold,\n                autoAbsentHours: policy.autoAbsentHours,\n                allowSelfCheckIn: policy.allowSelfCheckIn,\n                requireGPS: policy.requireGPS,\n                requireDeviceBinding: policy.requireDeviceBinding,\n            });\n        }\n    }, [policy]);\n\n    const updatePolicyMutation = useMutation({\n        mutationFn: async (data: typeof formData) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/admin/attendance-policy`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/admin/attendance-policy\"],\n            });\n            toast({\n                title: \"Policy Updated\",\n                description: \"Attendance policy has been successfully updated.\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Update Failed\",\n                description:\n                    error.message ||\n                    \"Unable to update policy. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        updatePolicyMutation.mutate(formData);\n    };\n\n    const handleReset = () => {\n        if (policy) {\n            setFormData({\n                halfDayHours: policy.halfDayHours,\n                fullDayHours: policy.fullDayHours,\n                lateMarkThreshold: policy.lateMarkThreshold,\n                autoAbsentHours: policy.autoAbsentHours,\n                allowSelfCheckIn: policy.allowSelfCheckIn,\n                requireGPS: policy.requireGPS,\n                requireDeviceBinding: policy.requireDeviceBinding,\n            });\n        }\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center h-screen\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex flex-col gap-6 p-6\">\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                <div>\n                    <h1 className=\"text-2xl font-semibold\">\n                        Attendance Policy Management\n                    </h1>\n                    <p className=\"text-sm text-muted-foreground\">\n                        Configure company-wide attendance rules and settings\n                    </p>\n                </div>\n            </div>\n\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Clock className=\"w-5 h-5\" />\n                            Work Hours Configuration\n                        </CardTitle>\n                        <CardDescription>\n                            Define the standard working hours for your company\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"halfDayHours\">\n                                    Half Day Hours\n                                </Label>\n                                <Input\n                                    id=\"halfDayHours\"\n                                    type=\"number\"\n                                    min=\"1\"\n                                    max=\"12\"\n                                    value={formData.halfDayHours}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            halfDayHours: parseInt(\n                                                e.target.value\n                                            ),\n                                        })\n                                    }\n                                    data-testid=\"input-half-day-hours\"\n                                />\n                                <p className=\"text-xs text-muted-foreground\">\n                                    Minimum hours required for half-day\n                                    attendance\n                                </p>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"fullDayHours\">\n                                    Full Day Hours\n                                </Label>\n                                <Input\n                                    id=\"fullDayHours\"\n                                    type=\"number\"\n                                    min=\"1\"\n                                    max=\"24\"\n                                    value={formData.fullDayHours}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            fullDayHours: parseInt(\n                                                e.target.value\n                                            ),\n                                        })\n                                    }\n                                    data-testid=\"input-full-day-hours\"\n                                />\n                                <p className=\"text-xs text-muted-foreground\">\n                                    Minimum hours required for full-day\n                                    attendance\n                                </p>\n                            </div>\n                        </div>\n\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"lateMarkThreshold\">\n                                    Late Mark Threshold (minutes)\n                                </Label>\n                                <Input\n                                    id=\"lateMarkThreshold\"\n                                    type=\"number\"\n                                    min=\"0\"\n                                    max=\"120\"\n                                    value={formData.lateMarkThreshold}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            lateMarkThreshold: parseInt(\n                                                e.target.value\n                                            ),\n                                        })\n                                    }\n                                    data-testid=\"input-late-threshold\"\n                                />\n                                <p className=\"text-xs text-muted-foreground\">\n                                    Grace period before marking as late (in\n                                    minutes)\n                                </p>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"autoAbsentHours\">\n                                    Auto Absent After (hours)\n                                </Label>\n                                <Input\n                                    id=\"autoAbsentHours\"\n                                    type=\"number\"\n                                    min=\"1\"\n                                    max=\"12\"\n                                    value={formData.autoAbsentHours}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            autoAbsentHours: parseInt(\n                                                e.target.value\n                                            ),\n                                        })\n                                    }\n                                    data-testid=\"input-auto-absent-hours\"\n                                />\n                                <p className=\"text-xs text-muted-foreground\">\n                                    Mark as absent if work hours are less than\n                                    this threshold\n                                </p>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <Settings className=\"w-5 h-5\" />\n                            Attendance Settings\n                        </CardTitle>\n                        <CardDescription>\n                            Configure check-in/out behavior and security\n                            settings\n                        </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-6\">\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"space-y-1\">\n                                <div className=\"flex items-center gap-2\">\n                                    <Clock className=\"w-4 h-4 text-muted-foreground\" />\n                                    <Label htmlFor=\"allowSelfCheckIn\">\n                                        Allow Self Check-In\n                                    </Label>\n                                </div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Enable employees to mark their own\n                                    attendance\n                                </p>\n                            </div>\n                            <Switch\n                                id=\"allowSelfCheckIn\"\n                                checked={formData.allowSelfCheckIn}\n                                onCheckedChange={(checked) =>\n                                    setFormData({\n                                        ...formData,\n                                        allowSelfCheckIn: checked,\n                                    })\n                                }\n                                data-testid=\"switch-self-checkin\"\n                            />\n                        </div>\n\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"space-y-1\">\n                                <div className=\"flex items-center gap-2\">\n                                    <MapPin className=\"w-4 h-4 text-muted-foreground\" />\n                                    <Label htmlFor=\"requireGPS\">\n                                        Require GPS Location\n                                    </Label>\n                                </div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Mandate GPS location when checking in/out\n                                </p>\n                            </div>\n                            <Switch\n                                id=\"requireGPS\"\n                                checked={formData.requireGPS}\n                                onCheckedChange={(checked) =>\n                                    setFormData({\n                                        ...formData,\n                                        requireGPS: checked,\n                                    })\n                                }\n                                data-testid=\"switch-require-gps\"\n                            />\n                        </div>\n\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"space-y-1\">\n                                <div className=\"flex items-center gap-2\">\n                                    <Smartphone className=\"w-4 h-4 text-muted-foreground\" />\n                                    <Label htmlFor=\"requireDeviceBinding\">\n                                        Require Device Binding\n                                    </Label>\n                                </div>\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Restrict attendance to registered devices\n                                    only\n                                </p>\n                            </div>\n                            <Switch\n                                id=\"requireDeviceBinding\"\n                                checked={formData.requireDeviceBinding}\n                                onCheckedChange={(checked) =>\n                                    setFormData({\n                                        ...formData,\n                                        requireDeviceBinding: checked,\n                                    })\n                                }\n                                data-testid=\"switch-device-binding\"\n                            />\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <div className=\"flex gap-3 justify-end flex-wrap\">\n                    <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={handleReset}\n                        data-testid=\"button-reset\">\n                        Reset Changes\n                    </Button>\n                    <Button\n                        type=\"submit\"\n                        disabled={updatePolicyMutation.isPending}\n                        data-testid=\"button-save-policy\">\n                        <Save className=\"w-4 h-4 mr-2\" />\n                        {updatePolicyMutation.isPending\n                            ? \"Saving...\"\n                            : \"Save Policy\"}\n                    </Button>\n                </div>\n            </form>\n\n            <Card className=\"bg-muted/50\">\n                <CardHeader>\n                    <CardTitle className=\"text-base\">\n                        Policy Information\n                    </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">\n                            Last Updated:\n                        </span>\n                        <span className=\"font-medium\">\n                            {policy?.updatedAt\n                                ? new Date(policy.updatedAt).toLocaleString()\n                                : \"Never\"}\n                        </span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                        <span className=\"text-muted-foreground\">\n                            Policy ID:\n                        </span>\n                        <span className=\"font-medium\">\n                            #{policy?.id || \"N/A\"}\n                        </span>\n                    </div>\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":16830,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/pages/admin/Dashboard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport MetricCard from \"@/components/MetricCard\";\nimport {\n    Users,\n    FileText,\n    CheckCircle,\n    FolderOpen,\n    Plus,\n    MessageSquare,\n    Building2,\n    DollarSign,\n    CreditCard,\n    Edit,\n    Trash2,\n} from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTaskUpdates } from \"@/hooks/useTaskUpdates\";\nimport { useState } from \"react\";\nimport type { SlotPricing, CompanyPayment, Company } from \"@shared/schema\";\n\ninterface CompanyData {\n    id: number;\n    name: string;\n    maxAdmins: number;\n    maxMembers: number;\n    currentAdmins: number;\n    currentMembers: number;\n    isActive: boolean;\n}\n\nexport default function Dashboard() {\n    useTaskUpdates();\n    const [, setLocation] = useLocation();\n    const { dbUserId, companyId, userRole } = useAuth();\n    const { toast } = useToast();\n    const [editingPricing, setEditingPricing] = useState<{\n        slotType: string;\n        price: string;\n    } | null>(null);\n    const [companyToDelete, setCompanyToDelete] = useState<Company | null>(\n        null\n    );\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n\n    const isSuperAdmin = userRole === \"super_admin\";\n\n    const { data: stats } = useQuery<{\n        totalUsers: number;\n        todayReports: number;\n        pendingTasks: number;\n        completedTasks: number;\n        totalFiles: number;\n        pendingCompletedTasks?: number;\n    }>({\n        queryKey: [\"/api/dashboard/stats\"],\n    });\n\n    const { data: company } = useQuery<CompanyData>({\n        queryKey: [\"/api/my-company\"],\n        enabled: !!companyId && !!dbUserId && !isSuperAdmin,\n    });\n\n    const { data: slotPricing } = useQuery<SlotPricing[]>({\n        queryKey: [\"/api/slot-pricing\"],\n        enabled: isSuperAdmin,\n    });\n\n    const { data: allCompanies } = useQuery<Company[]>({\n        queryKey: [\"/api/companies\"],\n        enabled: isSuperAdmin,\n    });\n\n    const { data: allPayments } = useQuery<CompanyPayment[]>({\n        queryKey: [\"/api/company-payments\"],\n        enabled: isSuperAdmin,\n    });\n\n    const updatePricingMutation = useMutation({\n        mutationFn: async (data: {\n            slotType: string;\n            pricePerSlot: number;\n            currency: string;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/slot-pricing`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/slot-pricing\"] });\n            toast({\n                title: \"Success\",\n                description: \"Pricing updated successfully\",\n            });\n            setEditingPricing(null);\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description: \"Failed to update pricing\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const deleteCompanyMutation = useMutation({\n        mutationFn: async (companyId: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/companies/${companyId}`,\n                \"DELETE\"\n            );\n        },\n        onMutate: async (companyId: number) => {\n            await queryClient.cancelQueries({\n                queryKey: [`${API_BASE_URL}/api/companies`],\n            });\n\n            const previousCompanies = queryClient.getQueryData<Company[]>([\n                `${API_BASE_URL}/api/companies`,\n            ]);\n\n            queryClient.setQueryData<Company[]>(\n                [`${API_BASE_URL}/api/companies`],\n                (old) => (old ? old.filter((c) => c.id !== companyId) : [])\n            );\n\n            return { previousCompanies };\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/companies\"] });\n            toast({\n                title: \"Success\",\n                description: \"Company removed successfully\",\n            });\n            setDeleteDialogOpen(false);\n            setCompanyToDelete(null);\n        },\n        onError: (error: any, companyId, context) => {\n            if (context?.previousCompanies) {\n                queryClient.setQueryData(\n                    [`${API_BASE_URL}/api/companies`],\n                    context.previousCompanies\n                );\n            }\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to remove company\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleSavePricing = () => {\n        if (editingPricing) {\n            updatePricingMutation.mutate({\n                slotType: editingPricing.slotType,\n                pricePerSlot: parseInt(editingPricing.price),\n                currency: \"INR\",\n            });\n        }\n    };\n\n    const handleDeleteCompany = (company: Company) => {\n        setCompanyToDelete(company);\n        setDeleteDialogOpen(true);\n    };\n\n    const confirmDeleteCompany = () => {\n        if (companyToDelete) {\n            deleteCompanyMutation.mutate(companyToDelete.id);\n        }\n    };\n\n    const quickActions = [\n        {\n            icon: Plus,\n            label: \"Create Task\",\n            onClick: () => setLocation(\"/admin/tasks\"),\n        },\n        {\n            icon: MessageSquare,\n            label: \"Send Message\",\n            onClick: () => setLocation(\"/admin/messages\"),\n        },\n        {\n            icon: FileText,\n            label: \"View Reports\",\n            onClick: () => setLocation(\"/admin/reports\"),\n        },\n    ];\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold\">\n                    Dashboard Overview\n                </h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    Monitor your team's performance and activity\n                </p>\n            </div>\n\n            {/* Company Info Banner - Company Admin Only */}\n            {company && !isSuperAdmin && (\n                <Card data-testid=\"card-company-banner\">\n                    <CardContent className=\"p-4 sm:p-6\">\n                        <div className=\"flex items-start gap-4\">\n                            <div className=\"p-3 bg-primary/10 rounded-lg\">\n                                <Building2 className=\"h-6 w-6 text-primary\" />\n                            </div>\n                            <div className=\"flex-1\">\n                                <h3\n                                    className=\"font-semibold text-lg\"\n                                    data-testid=\"text-dashboard-company-name\">\n                                    {company.name}\n                                </h3>\n                                <div className=\"mt-2 flex flex-wrap gap-4 text-sm\">\n                                    <div>\n                                        <span className=\"text-muted-foreground\">\n                                            Admins:{\" \"}\n                                        </span>\n                                        <span\n                                            className=\"font-medium\"\n                                            data-testid=\"text-dashboard-admin-count\">\n                                            {company.currentAdmins}/\n                                            {company.maxAdmins}\n                                        </span>\n                                    </div>\n                                    <div>\n                                        <span className=\"text-muted-foreground\">\n                                            Members:{\" \"}\n                                        </span>\n                                        <span\n                                            className=\"font-medium\"\n                                            data-testid=\"text-dashboard-member-count\">\n                                            {company.currentMembers}/\n                                            {company.maxMembers}\n                                        </span>\n                                    </div>\n                                    <div>\n                                        <span className=\"text-muted-foreground\">\n                                            Total Capacity:{\" \"}\n                                        </span>\n                                        <span\n                                            className=\"font-medium\"\n                                            data-testid=\"text-dashboard-total-capacity\">\n                                            {company.currentAdmins +\n                                                company.currentMembers}\n                                            /\n                                            {company.maxAdmins +\n                                                company.maxMembers}\n                                        </span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n\n            {/* Super Admin: Slot Pricing Management */}\n            {isSuperAdmin && (\n                <Card data-testid=\"card-slot-pricing\">\n                    <CardHeader>\n                        <CardTitle className=\"text-lg sm:text-xl flex items-center gap-2\">\n                            <DollarSign className=\"h-5 w-5\" />\n                            Slot Pricing Management\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"grid gap-4 sm:grid-cols-2\">\n                            {[\"admin\", \"member\"].map((slotType) => {\n                                const pricing = slotPricing?.find(\n                                    (p) => p.slotType === slotType\n                                );\n                                const isEditing =\n                                    editingPricing?.slotType === slotType;\n\n                                return (\n                                    <div\n                                        key={slotType}\n                                        className=\"border rounded-lg p-4\">\n                                        <div className=\"flex items-center justify-between mb-3\">\n                                            <h4 className=\"font-semibold capitalize\">\n                                                {slotType} Slot\n                                            </h4>\n                                            {!isEditing && (\n                                                <Button\n                                                    size=\"sm\"\n                                                    variant=\"outline\"\n                                                    onClick={() =>\n                                                        setEditingPricing({\n                                                            slotType,\n                                                            price:\n                                                                pricing?.pricePerSlot?.toString() ||\n                                                                \"0\",\n                                                        })\n                                                    }\n                                                    data-testid={`button-edit-${slotType}-pricing`}>\n                                                    <Edit className=\"h-4 w-4\" />\n                                                </Button>\n                                            )}\n                                        </div>\n                                        {isEditing ? (\n                                            <div className=\"space-y-3\">\n                                                <div>\n                                                    <Label>\n                                                        Price per Slot (INR)\n                                                    </Label>\n                                                    <Input\n                                                        type=\"number\"\n                                                        value={\n                                                            editingPricing.price\n                                                        }\n                                                        onChange={(e) =>\n                                                            setEditingPricing({\n                                                                ...editingPricing,\n                                                                price: e.target\n                                                                    .value,\n                                                            })\n                                                        }\n                                                        data-testid={`input-${slotType}-price`}\n                                                    />\n                                                </div>\n                                                <div className=\"flex gap-2\">\n                                                    <Button\n                                                        size=\"sm\"\n                                                        onClick={\n                                                            handleSavePricing\n                                                        }\n                                                        disabled={\n                                                            updatePricingMutation.isPending\n                                                        }\n                                                        data-testid={`button-save-${slotType}-pricing`}>\n                                                        Save\n                                                    </Button>\n                                                    <Button\n                                                        size=\"sm\"\n                                                        variant=\"outline\"\n                                                        onClick={() =>\n                                                            setEditingPricing(\n                                                                null\n                                                            )\n                                                        }\n                                                        data-testid={`button-cancel-${slotType}-pricing`}>\n                                                        Cancel\n                                                    </Button>\n                                                </div>\n                                            </div>\n                                        ) : (\n                                            <div\n                                                className=\"text-2xl font-bold text-primary\"\n                                                data-testid={`text-${slotType}-price`}>\n                                                ₹{pricing?.pricePerSlot || 0}\n                                                <span className=\"text-sm text-muted-foreground font-normal\">\n                                                    /slot\n                                                </span>\n                                            </div>\n                                        )}\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n\n            {/* Super Admin: Company Overview */}\n            {isSuperAdmin && allCompanies && (\n                <Card data-testid=\"card-companies-overview\">\n                    <CardHeader>\n                        <CardTitle className=\"text-lg sm:text-xl flex items-center gap-2\">\n                            <Building2 className=\"h-5 w-5\" />\n                            Companies Overview\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"space-y-2\">\n                            {allCompanies.slice(0, 5).map((comp) => {\n                                const companyPayments =\n                                    allPayments?.filter(\n                                        (p) =>\n                                            p.companyId === comp.id &&\n                                            p.paymentStatus === \"paid\"\n                                    ) || [];\n                                const adminSlotsPurchased = companyPayments\n                                    .filter((p) => p.slotType === \"admin\")\n                                    .reduce(\n                                        (sum, p) => sum + (p.slotQuantity || 0),\n                                        0\n                                    );\n                                const memberSlotsPurchased = companyPayments\n                                    .filter((p) => p.slotType === \"member\")\n                                    .reduce(\n                                        (sum, p) => sum + (p.slotQuantity || 0),\n                                        0\n                                    );\n                                const totalPaid = companyPayments.reduce(\n                                    (sum, p) => sum + p.amount,\n                                    0\n                                );\n                                const lastPurchaseDate =\n                                    companyPayments.length > 0\n                                        ? new Date(\n                                              Math.max(\n                                                  ...companyPayments.map((p) =>\n                                                      new Date(\n                                                          p.createdAt\n                                                      ).getTime()\n                                                  )\n                                              )\n                                          )\n                                        : null;\n\n                                return (\n                                    <div\n                                        key={comp.id}\n                                        className=\"flex items-center justify-between p-3 border rounded-lg gap-3\"\n                                        data-testid={`company-${comp.id}`}>\n                                        <div className=\"flex-1\">\n                                            <p className=\"font-medium\">\n                                                {comp.name}\n                                            </p>\n                                            <p className=\"text-sm text-muted-foreground\">\n                                                {comp.serverId}\n                                            </p>\n                                            {companyPayments.length > 0 && (\n                                                <div className=\"mt-2 space-y-1\">\n                                                    <p className=\"text-xs text-muted-foreground\">\n                                                        Purchased:{\" \"}\n                                                        {adminSlotsPurchased}{\" \"}\n                                                        admin,{\" \"}\n                                                        {memberSlotsPurchased}{\" \"}\n                                                        member slots\n                                                    </p>\n                                                    <p className=\"text-xs text-muted-foreground\">\n                                                        Total Paid: ₹{totalPaid}{\" \"}\n                                                        | Last:{\" \"}\n                                                        {lastPurchaseDate?.toLocaleDateString()}\n                                                    </p>\n                                                </div>\n                                            )}\n                                        </div>\n                                        <div className=\"text-right\">\n                                            <p className=\"text-sm\">\n                                                <span className=\"font-medium\">\n                                                    {comp.maxAdmins +\n                                                        comp.maxMembers}\n                                                </span>{\" \"}\n                                                slots\n                                            </p>\n                                            <p\n                                                className={`text-xs ${\n                                                    comp.isActive\n                                                        ? \"text-green-600\"\n                                                        : \"text-red-600\"\n                                                }`}>\n                                                {comp.isActive\n                                                    ? \"Active\"\n                                                    : \"Inactive\"}\n                                            </p>\n                                        </div>\n                                        <Button\n                                            variant=\"ghost\"\n                                            size=\"icon\"\n                                            onClick={() =>\n                                                handleDeleteCompany(comp)\n                                            }\n                                            disabled={\n                                                deleteCompanyMutation.isPending\n                                            }\n                                            className=\"text-destructive hover:text-destructive hover:bg-destructive/10 disabled:opacity-50\"\n                                            data-testid={`button-delete-company-${comp.id}`}>\n                                            <Trash2 className=\"h-4 w-4\" />\n                                        </Button>\n                                    </div>\n                                );\n                            })}\n                            {allCompanies.length > 5 && (\n                                <Button\n                                    variant=\"outline\"\n                                    className=\"w-full\"\n                                    onClick={() =>\n                                        setLocation(\"/admin/company\")\n                                    }\n                                    data-testid=\"button-view-all-companies\">\n                                    View All {allCompanies.length} Companies\n                                </Button>\n                            )}\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n\n            {/* Super Admin: Recent Payments */}\n            {isSuperAdmin && allPayments && (\n                <Card data-testid=\"card-recent-payments\">\n                    <CardHeader>\n                        <CardTitle className=\"text-lg sm:text-xl flex items-center gap-2\">\n                            <CreditCard className=\"h-5 w-5\" />\n                            Recent Payments\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"space-y-2\">\n                            {allPayments.slice(0, 5).map((payment) => {\n                                const company = allCompanies?.find(\n                                    (c) => c.id === payment.companyId\n                                );\n                                return (\n                                    <div\n                                        key={payment.id}\n                                        className=\"flex items-center justify-between p-3 border rounded-lg\"\n                                        data-testid={`payment-${payment.id}`}>\n                                        <div className=\"flex-1\">\n                                            <p className=\"font-medium\">\n                                                {company?.name ||\n                                                    `Company #${payment.companyId}`}\n                                            </p>\n                                            <p className=\"text-sm text-muted-foreground\">\n                                                {new Date(\n                                                    payment.createdAt\n                                                ).toLocaleDateString()}\n                                            </p>\n                                            {payment.slotType &&\n                                                payment.slotQuantity && (\n                                                    <p className=\"text-xs text-muted-foreground mt-1\">\n                                                        {payment.slotQuantity}{\" \"}\n                                                        {payment.slotType} slot\n                                                        {payment.slotQuantity >\n                                                        1\n                                                            ? \"s\"\n                                                            : \"\"}\n                                                    </p>\n                                                )}\n                                        </div>\n                                        <div className=\"text-right\">\n                                            <p className=\"font-medium\">\n                                                ${payment.amount}{\" \"}\n                                                {payment.currency}\n                                            </p>\n                                            <p\n                                                className={`text-xs capitalize ${\n                                                    payment.paymentStatus ===\n                                                    \"paid\"\n                                                        ? \"text-green-600\"\n                                                        : payment.paymentStatus ===\n                                                          \"pending\"\n                                                        ? \"text-yellow-600\"\n                                                        : \"text-red-600\"\n                                                }`}>\n                                                {payment.paymentStatus}\n                                            </p>\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                            {allPayments.length === 0 && (\n                                <p className=\"text-center text-muted-foreground py-4\">\n                                    No payments yet\n                                </p>\n                            )}\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n\n            {/* Metrics - Company Admin Only */}\n            {!isSuperAdmin && (\n                <div className=\"grid gap-3 sm:gap-4 grid-cols-2 lg:grid-cols-4\">\n                    <MetricCard\n                        title=\"Total Users\"\n                        value={stats?.totalUsers || 0}\n                        icon={Users}\n                        trend=\"+12%\"\n                        data-testid=\"metric-total-users\"\n                    />\n                    <MetricCard\n                        title=\"Today's Reports\"\n                        value={stats?.todayReports || 0}\n                        icon={FileText}\n                        trend=\"+8%\"\n                        data-testid=\"metric-today-reports\"\n                    />\n                    <MetricCard\n                        title=\"Pending Tasks\"\n                        value={stats?.pendingTasks || 0}\n                        icon={FolderOpen}\n                        trend=\"-3%\"\n                        data-testid=\"metric-pending-tasks\"\n                    />\n                    <MetricCard\n                        title=\"Completed Tasks\"\n                        value={stats?.completedTasks || 0}\n                        icon={CheckCircle}\n                        trend=\"+15%\"\n                        data-testid=\"metric-completed-tasks\"\n                    />\n                </div>\n            )}\n\n            {/* Quick Actions - Company Admin Only */}\n            {!isSuperAdmin && (\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"text-lg sm:text-xl\">\n                            Quick Actions\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-3\">\n                            {quickActions.map((action, index) => (\n                                <Button\n                                    key={index}\n                                    variant=\"outline\"\n                                    className=\"justify-start gap-3 h-auto py-3 sm:py-4\"\n                                    onClick={action.onClick}>\n                                    <action.icon className=\"h-5 w-5\" />\n                                    <span className=\"text-sm sm:text-base\">\n                                        {action.label}\n                                    </span>\n                                </Button>\n                            ))}\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n\n            {/* Delete Company Confirmation Dialog */}\n            <AlertDialog\n                open={deleteDialogOpen}\n                onOpenChange={setDeleteDialogOpen}>\n                <AlertDialogContent data-testid=\"dialog-delete-company\">\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Remove Company</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Are you sure you want to remove{\" \"}\n                            <span className=\"font-semibold\">\n                                {companyToDelete?.name}\n                            </span>\n                            ? This will deactivate the company and all\n                            associated data.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel data-testid=\"button-cancel-delete\">\n                            Cancel\n                        </AlertDialogCancel>\n                        <AlertDialogAction\n                            onClick={confirmDeleteCompany}\n                            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                            disabled={deleteCompanyMutation.isPending}\n                            data-testid=\"button-confirm-delete\">\n                            {deleteCompanyMutation.isPending\n                                ? \"Removing...\"\n                                : \"Remove Company\"}\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":32593,"size_tokens":null},"client/src/pages/admin/TeamMembersManagement.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport {\n    ArrowLeft,\n    Search,\n    UserMinus,\n    Mail,\n    Loader2,\n    AlertCircle,\n} from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport { useState } from \"react\";\nimport type { User } from \"@shared/schema\";\n\ninterface TeamMembersManagementProps {\n    params: {\n        teamLeaderId: string;\n    };\n}\n\nexport default function TeamMembersManagement({\n    params,\n}: TeamMembersManagementProps) {\n    const { toast } = useToast();\n    const { userRole } = useAuth();\n    const [, setLocation] = useLocation();\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    const teamLeaderId = parseInt(params.teamLeaderId);\n\n    const { data: teamLeader, isLoading: loadingLeader } = useQuery<User>({\n        queryKey: [\"/api/users\", teamLeaderId.toString()],\n        enabled: !!teamLeaderId && userRole === \"company_admin\",\n    });\n\n    const { data: teamMembers = [], isLoading: loadingMembers } = useQuery<\n        User[]\n    >({\n        queryKey: [\"/api/team-assignments\", teamLeaderId.toString(), \"members\"],\n        enabled: !!teamLeaderId && userRole === \"company_admin\",\n    });\n\n    const removeTeamMemberMutation = useMutation({\n        mutationFn: async (memberId: number) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/team-assignments/${teamLeaderId}/members/${memberId}`,\n                \"DELETE\"\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Success\",\n                description:\n                    \"Team member removed successfully. They are now unallocated.\",\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\n                    \"/api/team-assignments\",\n                    teamLeaderId.toString(),\n                    \"members\",\n                ],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/team-assignments\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/users\"],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to remove team member\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const filteredMembers = teamMembers.filter(\n        (member) =>\n            member.displayName\n                .toLowerCase()\n                .includes(searchTerm.toLowerCase()) ||\n            member.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n            member.uniqueUserId.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n\n    const getInitials = (name: string) => {\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    if (userRole !== \"company_admin\") {\n        return (\n            <div className=\"flex items-center justify-center h-full\">\n                <Alert variant=\"destructive\" className=\"max-w-md\">\n                    <AlertCircle className=\"h-4 w-4\" />\n                    <AlertDescription>\n                        Access denied. Only company admins can manage team\n                        members.\n                    </AlertDescription>\n                </Alert>\n            </div>\n        );\n    }\n\n    if (loadingLeader || loadingMembers) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex items-center gap-4\">\n                    <Button variant=\"ghost\" size=\"icon\" disabled>\n                        <ArrowLeft className=\"h-5 w-5\" />\n                    </Button>\n                    <div className=\"animate-pulse\">\n                        <div className=\"h-8 w-48 bg-muted rounded mb-2\"></div>\n                        <div className=\"h-4 w-96 bg-muted rounded\"></div>\n                    </div>\n                </div>\n                <div className=\"flex items-center justify-center py-12\">\n                    <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n            </div>\n        );\n    }\n\n    if (!teamLeader) {\n        return (\n            <div className=\"space-y-6\">\n                <div className=\"flex items-center gap-4\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => setLocation(\"/admin/users\")}\n                        data-testid=\"button-back\">\n                        <ArrowLeft className=\"h-5 w-5\" />\n                    </Button>\n                    <div>\n                        <h1 className=\"text-3xl font-bold\">Team Not Found</h1>\n                    </div>\n                </div>\n                <Alert variant=\"destructive\">\n                    <AlertCircle className=\"h-4 w-4\" />\n                    <AlertDescription>\n                        Team leader not found or you don't have permission to\n                        view this team.\n                    </AlertDescription>\n                </Alert>\n                <Button onClick={() => setLocation(\"/admin/users\")}>\n                    Back to Users\n                </Button>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center gap-4\">\n                <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => setLocation(\"/admin/users\")}\n                    data-testid=\"button-back\">\n                    <ArrowLeft className=\"h-5 w-5\" />\n                </Button>\n                <div className=\"flex-1\">\n                    <h1 className=\"text-3xl font-bold\">Team Members</h1>\n                    <div className=\"flex items-center gap-2 mt-1\">\n                        <p className=\"text-muted-foreground\">Team Leader:</p>\n                        <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-5 w-5\">\n                                <AvatarImage src={teamLeader.photoURL || \"\"} />\n                                <AvatarFallback className=\"text-xs\">\n                                    {getInitials(teamLeader.displayName)}\n                                </AvatarFallback>\n                            </Avatar>\n                            <span className=\"font-medium\">\n                                {teamLeader.displayName}\n                            </span>\n                            <Badge variant=\"default\" className=\"text-xs\">\n                                Team Leader\n                            </Badge>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"flex items-center gap-4\">\n                <div className=\"relative flex-1 max-w-md\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                        placeholder=\"Search team members...\"\n                        className=\"pl-9\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                        data-testid=\"input-search-members\"\n                    />\n                </div>\n                <div className=\"text-sm text-muted-foreground\">\n                    {teamMembers.length}{\" \"}\n                    {teamMembers.length === 1 ? \"member\" : \"members\"}\n                </div>\n            </div>\n\n            {filteredMembers.length > 0 ? (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    {filteredMembers.map((member) => (\n                        <Card\n                            key={member.id}\n                            data-testid={`card-member-${member.id}`}\n                            className=\"hover:shadow-md transition-shadow\">\n                            <CardHeader className=\"pb-3\">\n                                <div className=\"flex items-start gap-3\">\n                                    <Avatar className=\"h-12 w-12 ring-2 ring-background\">\n                                        <AvatarImage\n                                            src={member.photoURL || \"\"}\n                                        />\n                                        <AvatarFallback className=\"bg-primary text-primary-foreground font-semibold\">\n                                            {getInitials(member.displayName)}\n                                        </AvatarFallback>\n                                    </Avatar>\n                                    <div className=\"flex-1 min-w-0\">\n                                        <CardTitle className=\"text-base truncate\">\n                                            {member.displayName}\n                                        </CardTitle>\n                                        <p className=\"text-xs text-muted-foreground truncate\">\n                                            {member.email}\n                                        </p>\n                                        <Badge\n                                            variant=\"secondary\"\n                                            className=\"text-xs mt-1\">\n                                            {member.uniqueUserId}\n                                        </Badge>\n                                    </div>\n                                </div>\n                            </CardHeader>\n                            <CardContent className=\"pt-0\">\n                                <div className=\"flex items-center gap-2 text-xs text-muted-foreground mb-3\">\n                                    <Mail className=\"h-3 w-3\" />\n                                    <span className=\"truncate\">\n                                        {member.email}\n                                    </span>\n                                </div>\n                                <Button\n                                    variant=\"destructive\"\n                                    size=\"sm\"\n                                    className=\"w-full\"\n                                    onClick={() =>\n                                        removeTeamMemberMutation.mutate(\n                                            member.id\n                                        )\n                                    }\n                                    disabled={\n                                        removeTeamMemberMutation.isPending\n                                    }\n                                    data-testid={`button-remove-member-${member.id}`}>\n                                    {removeTeamMemberMutation.isPending ? (\n                                        <>\n                                            <Loader2 className=\"h-3 w-3 mr-2 animate-spin\" />\n                                            Removing...\n                                        </>\n                                    ) : (\n                                        <>\n                                            <UserMinus className=\"h-3 w-3 mr-2\" />\n                                            Remove Member\n                                        </>\n                                    )}\n                                </Button>\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            ) : (\n                <Card>\n                    <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                        {searchTerm ? (\n                            <>\n                                <Search className=\"h-12 w-12 text-muted-foreground mb-3\" />\n                                <p className=\"text-muted-foreground\">\n                                    No members match your search\n                                </p>\n                                <Button\n                                    variant=\"outline\"\n                                    className=\"mt-4\"\n                                    onClick={() => setSearchTerm(\"\")}>\n                                    Clear Search\n                                </Button>\n                            </>\n                        ) : (\n                            <>\n                                <AlertCircle className=\"h-12 w-12 text-muted-foreground mb-3\" />\n                                <p className=\"text-muted-foreground\">\n                                    No team members assigned yet\n                                </p>\n                                <p className=\"text-sm text-muted-foreground mt-1\">\n                                    Go back to Users page to assign members to\n                                    this team\n                                </p>\n                                <Button\n                                    variant=\"outline\"\n                                    className=\"mt-4\"\n                                    onClick={() => setLocation(\"/admin/users\")}>\n                                    Manage Users\n                                </Button>\n                            </>\n                        )}\n                    </CardContent>\n                </Card>\n            )}\n\n            {teamMembers.length > 0 && (\n                <Alert>\n                    <AlertDescription className=\"text-sm\">\n                        <strong>Note:</strong> When you remove a member from\n                        this team, they become unallocated and will appear in\n                        the \"Allocate Members\" list for other team leaders.\n                    </AlertDescription>\n                </Alert>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":14299,"size_tokens":null},"client/src/pages/team-leader/TeamLeaderMessages.tsx":{"content":"import { useAuth } from \"@/contexts/AuthContext\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest, API_BASE_URL } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Input } from \"@/components/ui/input\";\nimport { Send, MessageSquare, Search, ArrowLeft } from \"lucide-react\";\nimport { useState, useMemo, useRef, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useWebSocket } from \"@/contexts/WebSocketContext\";\nimport { format } from \"date-fns\";\n\ninterface Message {\n    id: number;\n    senderId: number;\n    receiverId: number;\n    message: string;\n    messageType: string;\n    readStatus: boolean;\n    createdAt: string;\n    senderName?: string;\n    receiverName?: string;\n}\n\ninterface User {\n    id: number;\n    displayName: string;\n    email: string;\n    photoURL?: string;\n    role: string;\n}\n\ninterface Conversation {\n    id: string;\n    type: \"admin\" | \"team_member\";\n    userId?: number;\n    userName: string;\n    userRole?: string;\n    userPhoto?: string;\n    lastMessage: string;\n    lastMessageTime?: Date;\n}\n\nexport default function TeamLeaderMessages() {\n    const { dbUserId } = useAuth();\n    const { toast } = useToast();\n    const messagesEndRef = useRef<HTMLDivElement>(null);\n    const [messageText, setMessageText] = useState(\"\");\n    const [searchText, setSearchText] = useState(\"\");\n    const [selectedConversation, setSelectedConversation] =\n        useState<Conversation | null>(null);\n    const [showConversationList, setShowConversationList] = useState(true);\n\n    // Fetch all messages\n    const { data: allMessages = [], isLoading: loadingMessages } = useQuery<\n        Message[]\n    >({\n        queryKey: [\"/api/messages\"],\n        enabled: !!dbUserId,\n    });\n\n    // Fetch all users to identify roles\n    const { data: users = [] } = useQuery<User[]>({\n        queryKey: [\"/api/users\"],\n    });\n\n    // Fetch team members assigned to this team leader\n    const { data: teamMembers = [] } = useQuery<User[]>({\n        queryKey: [`${API_BASE_URL}/api/team-assignments/${dbUserId}/members`],\n        enabled: !!dbUserId,\n        retry: false,\n    });\n\n    useWebSocket((data) => {\n        if (data.type === \"NEW_MESSAGE\") {\n            const messageData = data.data;\n            if (\n                messageData.senderId === dbUserId ||\n                messageData.receiverId === dbUserId\n            ) {\n                queryClient.invalidateQueries({ queryKey: [\"/api/messages\"] });\n\n                if (messageData.receiverId === dbUserId) {\n                    toast({\n                        title: \"New Message\",\n                        description: `${\n                            messageData.senderName\n                        }: ${messageData.message.substring(0, 50)}${\n                            messageData.message.length > 50 ? \"...\" : \"\"\n                        }`,\n                    });\n                }\n            }\n        }\n    });\n\n    const sendMessageMutation = useMutation({\n        mutationFn: async (data: {\n            receiverId: number;\n            message: string;\n            messageType?: string;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/messages`,\n                \"POST\",\n                data\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/messages\"] });\n            setMessageText(\"\");\n            toast({\n                title: \"Success\",\n                description: \"Message sent successfully\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to send message\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    // Get admin messages (from admin to team leader)\n    const adminMessages = useMemo(() => {\n        return allMessages\n            .filter(\n                (msg) =>\n                    (msg.receiverId === dbUserId &&\n                        msg.messageType === \"admin_to_team_leader\") ||\n                    (msg.senderId === dbUserId &&\n                        msg.messageType === \"team_leader_to_admin\")\n            )\n            .sort(\n                (a, b) =>\n                    new Date(a.createdAt).getTime() -\n                    new Date(b.createdAt).getTime()\n            );\n    }, [allMessages, dbUserId]);\n\n    // Get team member messages\n    const teamMemberMessages = useMemo(() => {\n        const memberIds = teamMembers.map((m) => m.id);\n        return allMessages\n            .filter(\n                (msg) =>\n                    memberIds.includes(msg.senderId) ||\n                    memberIds.includes(msg.receiverId)\n            )\n            .sort(\n                (a, b) =>\n                    new Date(a.createdAt).getTime() -\n                    new Date(b.createdAt).getTime()\n            );\n    }, [allMessages, teamMembers]);\n\n    // Build conversation list\n    const conversations: Conversation[] = useMemo(() => {\n        const convs: Conversation[] = [];\n\n        // Add admin section if there are admin messages\n        if (adminMessages.length > 0) {\n            const lastAdmin = adminMessages[adminMessages.length - 1];\n            const senderOrReceiver =\n                lastAdmin.senderId === dbUserId\n                    ? lastAdmin.receiverId\n                    : lastAdmin.senderId;\n            const adminUser = users.find(\n                (u) =>\n                    u.id === senderOrReceiver &&\n                    (u.role === \"company_admin\" || u.role === \"super_admin\")\n            );\n\n            convs.push({\n                id: \"admin-all\",\n                type: \"admin\",\n                userId: adminUser?.id,\n                userName: adminUser?.displayName || \"Administrator\",\n                userRole:\n                    adminUser?.role === \"company_admin\"\n                        ? \"Admin\"\n                        : \"Super Admin\",\n                userPhoto: adminUser?.photoURL,\n                lastMessage: lastAdmin.message,\n                lastMessageTime: new Date(lastAdmin.createdAt),\n            });\n        }\n\n        // Add team member conversations\n        const memberConvMap = new Map<number, Conversation>();\n        teamMemberMessages.forEach((msg) => {\n            const otherUserId =\n                msg.senderId === dbUserId ? msg.receiverId : msg.senderId;\n            const otherUser = teamMembers.find((tm) => tm.id === otherUserId);\n\n            if (otherUser && !memberConvMap.has(otherUserId)) {\n                memberConvMap.set(otherUserId, {\n                    id: `team-member-${otherUserId}`,\n                    type: \"team_member\",\n                    userId: otherUserId,\n                    userName: otherUser.displayName,\n                    userPhoto: otherUser.photoURL,\n                    lastMessage: msg.message,\n                    lastMessageTime: new Date(msg.createdAt),\n                });\n            } else if (otherUser && memberConvMap.has(otherUserId)) {\n                const existing = memberConvMap.get(otherUserId)!;\n                const msgTime = new Date(msg.createdAt).getTime();\n                const existingTime = existing.lastMessageTime?.getTime() || 0;\n                if (msgTime > existingTime) {\n                    memberConvMap.set(otherUserId, {\n                        ...existing,\n                        lastMessage: msg.message,\n                        lastMessageTime: new Date(msg.createdAt),\n                    });\n                }\n            }\n        });\n\n        convs.push(\n            ...Array.from(memberConvMap.values()).sort(\n                (a, b) =>\n                    (b.lastMessageTime?.getTime() || 0) -\n                    (a.lastMessageTime?.getTime() || 0)\n            )\n        );\n\n        return convs;\n    }, [adminMessages, teamMemberMessages, teamMembers, users, dbUserId]);\n\n    const filteredConversations = conversations.filter(\n        (conv) =>\n            conv.userName.toLowerCase().includes(searchText.toLowerCase()) ||\n            conv.lastMessage.toLowerCase().includes(searchText.toLowerCase())\n    );\n\n    const getConversationMessages = () => {\n        if (!selectedConversation) return [];\n\n        if (selectedConversation.type === \"admin\") {\n            return adminMessages;\n        } else if (selectedConversation.userId) {\n            return teamMemberMessages.filter(\n                (msg) =>\n                    (msg.senderId === selectedConversation.userId &&\n                        msg.receiverId === dbUserId) ||\n                    (msg.senderId === dbUserId &&\n                        msg.receiverId === selectedConversation.userId)\n            );\n        }\n        return [];\n    };\n\n    const handleSendMessage = () => {\n        if (!messageText.trim() || !selectedConversation) return;\n\n        let receiverId: number | null = null;\n\n        if (\n            selectedConversation.type === \"admin\" &&\n            selectedConversation.userId\n        ) {\n            receiverId = selectedConversation.userId;\n        } else if (\n            selectedConversation.type === \"team_member\" &&\n            selectedConversation.userId\n        ) {\n            receiverId = selectedConversation.userId;\n        }\n\n        if (receiverId) {\n            sendMessageMutation.mutate({\n                receiverId,\n                message: messageText.trim(),\n            });\n        }\n    };\n\n    const getInitials = (name: string) => {\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    const conversationMessages = getConversationMessages();\n\n    useEffect(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [conversationMessages]);\n\n    if (loadingMessages) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"h-[80vh] md:h-[90vh] w-full flex flex-col overflow-hidden\">\n            <div className=\"flex-1 flex flex-col md:flex-row gap-0 bg-background overflow-hidden min-w-0 w-full\">\n                {/* LEFT SIDEBAR - Conversations List */}\n                <div\n                    className={`${\n                        showConversationList ? \"flex\" : \"hidden\"\n                    } md:flex w-full md:w-72 lg:w-80 border-b md:border-b-0 md:border-r border-border flex-col min-h-0`}>\n                    <div className=\"flex-shrink-0 p-3 sm:p-4 border-b border-border space-y-3\">\n                        <h3 className=\"font-semibold text-sm\">Messages</h3>\n                        <div className=\"relative\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                            <Input\n                                placeholder=\"Search conversations...\"\n                                className=\"pl-9 h-9 text-sm\"\n                                value={searchText}\n                                onChange={(e) => setSearchText(e.target.value)}\n                                data-testid=\"input-search-messages\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto space-y-1 p-2 hide-scrollbar\">\n                        {filteredConversations.length === 0 ? (\n                            <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                                <p className=\"text-sm\">No conversations</p>\n                            </div>\n                        ) : (\n                            filteredConversations.map((conv) => (\n                                <button\n                                    key={conv.id}\n                                    onClick={() => {\n                                        setSelectedConversation(conv);\n                                        setShowConversationList(false);\n                                    }}\n                                    className={`w-full p-2 sm:p-3 rounded-lg text-left transition-colors ${\n                                        selectedConversation?.id === conv.id\n                                            ? \"bg-primary/10 border border-primary\"\n                                            : \"hover:bg-accent\"\n                                    }`}\n                                    data-testid={`button-conversation-${conv.id}`}>\n                                    <div className=\"flex items-start gap-2\">\n                                        <Avatar className=\"h-10 w-10 shrink-0\">\n                                            <AvatarImage src={conv.userPhoto} />\n                                            <AvatarFallback className=\"text-xs\">\n                                                {getInitials(conv.userName)}\n                                            </AvatarFallback>\n                                        </Avatar>\n                                        <div className=\"flex-1 min-w-0\">\n                                            <div className=\"flex items-center gap-1\">\n                                                <p className=\"font-medium text-sm truncate\">\n                                                    {conv.userName}\n                                                </p>\n                                                {conv.userRole && (\n                                                    <span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                                                        ({conv.userRole})\n                                                    </span>\n                                                )}\n                                            </div>\n                                            <p className=\"text-xs text-muted-foreground truncate mt-1\">\n                                                {conv.lastMessage}\n                                            </p>\n                                            {conv.lastMessageTime && (\n                                                <p className=\"text-xs text-muted-foreground mt-1\">\n                                                    {format(\n                                                        conv.lastMessageTime,\n                                                        \"MMM dd, HH:mm\"\n                                                    )}\n                                                </p>\n                                            )}\n                                        </div>\n                                    </div>\n                                </button>\n                            ))\n                        )}\n                    </div>\n                </div>\n\n                {/* RIGHT SIDE - Chat Area - Full Height */}\n                <div className=\"flex-1 flex flex-col min-w-0 min-h-0 overflow-hidden\">\n                    {selectedConversation ? (\n                        <div className=\"flex flex-col h-full min-h-0 overflow-hidden\">\n                            {/* Header - Fixed */}\n                            <div className=\"flex-shrink-0 sticky top-0 z-50 px-3 sm:px-4 lg:px-5 py-2 sm:py-2 border-b border-border flex items-center gap-3 bg-background shadow-sm\">\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    className=\"md:hidden h-8 w-8\"\n                                    onClick={() => {\n                                        setShowConversationList(true);\n                                        setSelectedConversation(null);\n                                    }}\n                                    data-testid=\"button-back-conversations\">\n                                    <ArrowLeft className=\"h-3 w-3\" />\n                                </Button>\n                                <Avatar className=\"h-8 w-8 shrink-0\">\n                                    <AvatarImage\n                                        src={selectedConversation.userPhoto}\n                                    />\n                                    <AvatarFallback className=\"text-xs\">\n                                        {getInitials(\n                                            selectedConversation.userName\n                                        )}\n                                    </AvatarFallback>\n                                </Avatar>\n                                <div className=\"flex-1 min-w-0\">\n                                    <h3 className=\"font-semibold text-xs sm:text-sm truncate\">\n                                        {selectedConversation.userName}\n                                    </h3>\n                                    {selectedConversation.userRole && (\n                                        <p className=\"text-xs text-muted-foreground leading-tight\">\n                                            {selectedConversation.userRole}\n                                        </p>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Messages - Scrollable */}\n                            <div className=\"flex-1 overflow-y-auto min-h-0 px-3 sm:px-4 lg:px-5 py-0 sm:py-1 space-y-0 sm:space-y-1 hide-scrollbar\">\n                                {conversationMessages.length === 0 ? (\n                                    <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n                                        <p className=\"text-sm\">\n                                            No messages yet. Start a\n                                            conversation!\n                                        </p>\n                                    </div>\n                                ) : (\n                                    conversationMessages.map((msg) => (\n                                        <div\n                                            key={msg.id}\n                                            className={`flex ${\n                                                msg.senderId === dbUserId\n                                                    ? \"justify-end\"\n                                                    : \"justify-start\"\n                                            }`}\n                                            data-testid={`message-${msg.id}`}>\n                                            <div\n                                                className={`rounded-lg p-2 sm:p-3 max-w-xs sm:max-w-md lg:max-w-lg text-sm break-words ${\n                                                    msg.senderId === dbUserId\n                                                        ? \"bg-primary text-primary-foreground\"\n                                                        : \"bg-muted\"\n                                                }`}>\n                                                <p className=\"break-words whitespace-pre-wrap\">\n                                                    {msg.message}\n                                                </p>\n                                                <p\n                                                    className={`text-xs mt-2 ${\n                                                        msg.senderId ===\n                                                        dbUserId\n                                                            ? \"text-primary-foreground/70\"\n                                                            : \"text-muted-foreground\"\n                                                    }`}>\n                                                    {format(\n                                                        new Date(msg.createdAt),\n                                                        \"HH:mm\"\n                                                    )}\n                                                </p>\n                                            </div>\n                                        </div>\n                                    ))\n                                )}\n                                <div ref={messagesEndRef} />\n                            </div>\n\n                            {/* Input - Fixed */}\n                            <div className=\"flex-shrink-0 px-3 sm:px-4 lg:px-5 pt-2 sm:pt-3 pb-0 border-t border-border flex gap-2 items-center bg-background flex-nowrap\">\n                                <div className=\"flex-1 flex items-center gap-2 bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-3xl px-3 py-2 shadow-sm\">\n                                    <Textarea\n                                        placeholder=\"Type a message\"\n                                        className=\"resize-none text-xs sm:text-sm flex-1 bg-transparent border-0 focus-visible:ring-0 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus-visible:outline-none min-h-4\"\n                                        rows={1}\n                                        value={messageText}\n                                        onChange={(e) =>\n                                            setMessageText(e.target.value)\n                                        }\n                                        onKeyDown={(e) => {\n                                            if (\n                                                e.key === \"Enter\" &&\n                                                !e.shiftKey\n                                            ) {\n                                                e.preventDefault();\n                                                handleSendMessage();\n                                            }\n                                        }}\n                                        data-testid=\"input-message\"\n                                    />\n                                </div>\n                                <Button\n                                    size=\"icon\"\n                                    onClick={handleSendMessage}\n                                    disabled={\n                                        !messageText.trim() ||\n                                        sendMessageMutation.isPending\n                                    }\n                                    data-testid=\"button-send-message\"\n                                    className=\"flex-shrink-0 h-8 w-8 sm:h-9 sm:w-9 rounded-full shadow-sm hover:shadow-md transition-shadow\">\n                                    <Send className=\"h-4 w-4\" />\n                                </Button>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"flex-1 flex items-center justify-center\">\n                            <div className=\"text-center\">\n                                <MessageSquare className=\"h-12 w-12 text-muted-foreground mx-auto mb-3\" />\n                                <p className=\"text-sm text-muted-foreground\">\n                                    Select a conversation to start messaging\n                                </p>\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":23696,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\n\nexport default function ThemeToggle() {\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\n\n  useEffect(() => {\n    const savedTheme = localStorage.getItem(\"theme\") as \"light\" | \"dark\" | null;\n    const initialTheme = savedTheme || \"light\";\n    setTheme(initialTheme);\n    document.documentElement.classList.toggle(\"dark\", initialTheme === \"dark\");\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = theme === \"light\" ? \"dark\" : \"light\";\n    setTheme(newTheme);\n    localStorage.setItem(\"theme\", newTheme);\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":1032,"size_tokens":null},"client/src/pages/user/CorrectionRequests.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n    CardDescription,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n    DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n    FileEdit,\n    Clock,\n    CheckCircle,\n    XCircle,\n    AlertCircle,\n} from \"lucide-react\";\nimport { format, parseISO } from \"date-fns\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport type { CorrectionRequest } from \"@shared/schema\";\n\nexport default function CorrectionRequests() {\n    const { toast } = useToast();\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\n    const [formData, setFormData] = useState({\n        date: \"\",\n        requestedCheckIn: \"\",\n        requestedCheckOut: \"\",\n        reason: \"\",\n    });\n\n    const { data: corrections, isLoading } = useQuery<CorrectionRequest[]>({\n        queryKey: [\"/api/attendance/my-corrections\"],\n    });\n\n    const createCorrectionMutation = useMutation({\n        mutationFn: async (data: typeof formData) => {\n            const checkInDateTime = data.requestedCheckIn\n                ? new Date(\n                      `${data.date}T${data.requestedCheckIn}:00`\n                  ).toISOString()\n                : null;\n            const checkOutDateTime = data.requestedCheckOut\n                ? new Date(\n                      `${data.date}T${data.requestedCheckOut}:00`\n                  ).toISOString()\n                : null;\n\n            return await apiRequest(\n                `${API_BASE_URL}/api/attendance/correction-request`,\n                \"POST\",\n                {\n                    date: data.date,\n                    requestedCheckIn: checkInDateTime,\n                    requestedCheckOut: checkOutDateTime,\n                    reason: data.reason,\n                }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/attendance/my-corrections\"],\n            });\n            setIsDialogOpen(false);\n            setFormData({\n                date: \"\",\n                requestedCheckIn: \"\",\n                requestedCheckOut: \"\",\n                reason: \"\",\n            });\n            toast({\n                title: \"Request Submitted\",\n                description:\n                    \"Your correction request has been submitted for review.\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Submission Failed\",\n                description:\n                    error.message ||\n                    \"Unable to submit request. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!formData.date || !formData.reason) {\n            toast({\n                title: \"Validation Error\",\n                description: \"Please fill in all required fields.\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n        createCorrectionMutation.mutate(formData);\n    };\n\n    const getStatusIcon = (status: string) => {\n        switch (status) {\n            case \"pending\":\n                return <Clock className=\"w-4 h-4 text-yellow-600\" />;\n            case \"approved\":\n                return <CheckCircle className=\"w-4 h-4 text-green-600\" />;\n            case \"rejected\":\n                return <XCircle className=\"w-4 h-4 text-red-600\" />;\n            default:\n                return (\n                    <AlertCircle className=\"w-4 h-4 text-muted-foreground\" />\n                );\n        }\n    };\n\n    const getStatusBadge = (status: string) => {\n        const variants: Record<string, { variant: any; label: string }> = {\n            pending: { variant: \"secondary\", label: \"Pending\" },\n            approved: { variant: \"default\", label: \"Approved\" },\n            rejected: { variant: \"destructive\", label: \"Rejected\" },\n        };\n        const config = variants[status] || {\n            variant: \"outline\",\n            label: status,\n        };\n        return <Badge variant={config.variant}>{config.label}</Badge>;\n    };\n\n    const formatTime = (time: string | Date | null) => {\n        if (!time) return \"-\";\n        const date = typeof time === \"string\" ? new Date(time) : time;\n        return format(date, \"hh:mm a\");\n    };\n\n    const pendingCount =\n        corrections?.filter((c) => c.status === \"pending\").length || 0;\n    const approvedCount =\n        corrections?.filter((c) => c.status === \"approved\").length || 0;\n    const rejectedCount =\n        corrections?.filter((c) => c.status === \"rejected\").length || 0;\n\n    return (\n        <div className=\"flex flex-col gap-6 p-6\">\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                <div>\n                    <h1 className=\"text-2xl font-semibold\">\n                        Correction Requests\n                    </h1>\n                    <p className=\"text-sm text-muted-foreground\">\n                        Request corrections for your attendance records\n                    </p>\n                </div>\n\n                <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n                    <DialogTrigger asChild>\n                        <Button data-testid=\"button-new-request\">\n                            <FileEdit className=\"w-4 h-4 mr-2\" />\n                            New Request\n                        </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                        <DialogHeader>\n                            <DialogTitle>Submit Correction Request</DialogTitle>\n                        </DialogHeader>\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"date\">Date *</Label>\n                                <Input\n                                    id=\"date\"\n                                    type=\"date\"\n                                    value={formData.date}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            date: e.target.value,\n                                        })\n                                    }\n                                    max={new Date().toISOString().split(\"T\")[0]}\n                                    required\n                                    data-testid=\"input-correction-date\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"checkIn\">\n                                    Requested Check-In Time\n                                </Label>\n                                <Input\n                                    id=\"checkIn\"\n                                    type=\"time\"\n                                    value={formData.requestedCheckIn}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            requestedCheckIn: e.target.value,\n                                        })\n                                    }\n                                    data-testid=\"input-check-in-time\"\n                                />\n                                <p className=\"text-xs text-muted-foreground\">\n                                    Leave empty if no change needed\n                                </p>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"checkOut\">\n                                    Requested Check-Out Time\n                                </Label>\n                                <Input\n                                    id=\"checkOut\"\n                                    type=\"time\"\n                                    value={formData.requestedCheckOut}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            requestedCheckOut: e.target.value,\n                                        })\n                                    }\n                                    data-testid=\"input-check-out-time\"\n                                />\n                                <p className=\"text-xs text-muted-foreground\">\n                                    Leave empty if no change needed\n                                </p>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"reason\">Reason *</Label>\n                                <Textarea\n                                    id=\"reason\"\n                                    value={formData.reason}\n                                    onChange={(e) =>\n                                        setFormData({\n                                            ...formData,\n                                            reason: e.target.value,\n                                        })\n                                    }\n                                    placeholder=\"Please explain why you need this correction...\"\n                                    rows={4}\n                                    required\n                                    data-testid=\"input-correction-reason\"\n                                />\n                            </div>\n\n                            <DialogFooter>\n                                <Button\n                                    type=\"button\"\n                                    variant=\"outline\"\n                                    onClick={() => setIsDialogOpen(false)}\n                                    data-testid=\"button-cancel\">\n                                    Cancel\n                                </Button>\n                                <Button\n                                    type=\"submit\"\n                                    disabled={\n                                        createCorrectionMutation.isPending\n                                    }\n                                    data-testid=\"button-submit-request\">\n                                    {createCorrectionMutation.isPending\n                                        ? \"Submitting...\"\n                                        : \"Submit Request\"}\n                                </Button>\n                            </DialogFooter>\n                        </form>\n                    </DialogContent>\n                </Dialog>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <Card>\n                    <CardContent className=\"p-6\">\n                        <div className=\"flex items-center justify-between\">\n                            <div>\n                                <div className=\"text-sm text-muted-foreground\">\n                                    Pending\n                                </div>\n                                <div\n                                    className=\"text-2xl font-semibold\"\n                                    data-testid=\"text-pending-count\">\n                                    {pendingCount}\n                                </div>\n                            </div>\n                            <Clock className=\"w-8 h-8 text-yellow-600\" />\n                        </div>\n                    </CardContent>\n                </Card>\n                <Card>\n                    <CardContent className=\"p-6\">\n                        <div className=\"flex items-center justify-between\">\n                            <div>\n                                <div className=\"text-sm text-muted-foreground\">\n                                    Approved\n                                </div>\n                                <div\n                                    className=\"text-2xl font-semibold\"\n                                    data-testid=\"text-approved-count\">\n                                    {approvedCount}\n                                </div>\n                            </div>\n                            <CheckCircle className=\"w-8 h-8 text-green-600\" />\n                        </div>\n                    </CardContent>\n                </Card>\n                <Card>\n                    <CardContent className=\"p-6\">\n                        <div className=\"flex items-center justify-between\">\n                            <div>\n                                <div className=\"text-sm text-muted-foreground\">\n                                    Rejected\n                                </div>\n                                <div\n                                    className=\"text-2xl font-semibold\"\n                                    data-testid=\"text-rejected-count\">\n                                    {rejectedCount}\n                                </div>\n                            </div>\n                            <XCircle className=\"w-8 h-8 text-red-600\" />\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>All Requests</CardTitle>\n                    <CardDescription>\n                        View and track all your correction requests\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    {isLoading ? (\n                        <div className=\"flex items-center justify-center h-32\">\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                        </div>\n                    ) : !corrections || corrections.length === 0 ? (\n                        <div className=\"text-center py-12\">\n                            <FileEdit className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground\" />\n                            <p className=\"text-muted-foreground\">\n                                No correction requests found\n                            </p>\n                            <p className=\"text-sm text-muted-foreground mt-2\">\n                                Submit a request if you need to correct your\n                                attendance\n                            </p>\n                        </div>\n                    ) : (\n                        <div className=\"space-y-4\">\n                            {corrections.map((correction) => (\n                                <Card\n                                    key={correction.id}\n                                    className=\"overflow-hidden\"\n                                    data-testid={`correction-${correction.id}`}>\n                                    <CardContent className=\"p-4\">\n                                        <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                                            <div className=\"flex-1 min-w-0 space-y-3\">\n                                                <div className=\"flex items-center gap-3 flex-wrap\">\n                                                    <div className=\"flex items-center gap-2\">\n                                                        {getStatusIcon(\n                                                            correction.status\n                                                        )}\n                                                        <span className=\"font-semibold\">\n                                                            {format(\n                                                                parseISO(\n                                                                    correction.date\n                                                                ),\n                                                                \"MMM dd, yyyy\"\n                                                            )}\n                                                        </span>\n                                                    </div>\n                                                    {getStatusBadge(\n                                                        correction.status\n                                                    )}\n                                                </div>\n\n                                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                    {correction.requestedCheckIn && (\n                                                        <div className=\"text-sm\">\n                                                            <span className=\"text-muted-foreground\">\n                                                                Requested\n                                                                Check-In:{\" \"}\n                                                            </span>\n                                                            <span className=\"font-medium\">\n                                                                {formatTime(\n                                                                    correction.requestedCheckIn\n                                                                )}\n                                                            </span>\n                                                        </div>\n                                                    )}\n                                                    {correction.requestedCheckOut && (\n                                                        <div className=\"text-sm\">\n                                                            <span className=\"text-muted-foreground\">\n                                                                Requested\n                                                                Check-Out:{\" \"}\n                                                            </span>\n                                                            <span className=\"font-medium\">\n                                                                {formatTime(\n                                                                    correction.requestedCheckOut\n                                                                )}\n                                                            </span>\n                                                        </div>\n                                                    )}\n                                                </div>\n\n                                                <div className=\"text-sm\">\n                                                    <span className=\"text-muted-foreground\">\n                                                        Reason:{\" \"}\n                                                    </span>\n                                                    <p className=\"mt-1\">\n                                                        {correction.reason}\n                                                    </p>\n                                                </div>\n\n                                                {correction.reviewComments && (\n                                                    <div className=\"text-sm bg-muted p-3 rounded-md\">\n                                                        <span className=\"font-medium\">\n                                                            Review Comments:{\" \"}\n                                                        </span>\n                                                        <p className=\"mt-1\">\n                                                            {\n                                                                correction.reviewComments\n                                                            }\n                                                        </p>\n                                                    </div>\n                                                )}\n\n                                                <div className=\"text-xs text-muted-foreground\">\n                                                    Submitted on{\" \"}\n                                                    {format(\n                                                        new Date(\n                                                            correction.createdAt\n                                                        ),\n                                                        \"MMM dd, yyyy 'at' hh:mm a\"\n                                                    )}\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            ))}\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","path":null,"size_bytes":21610,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/examples/RatingBadge.tsx":{"content":"import RatingBadge from '../RatingBadge'\n\nexport default function RatingBadgeExample() {\n  return (\n    <div className=\"space-y-4 max-w-2xl\">\n      <RatingBadge\n        rating=\"Excellent\"\n        feedback=\"Outstanding performance this month! Your reports are always thorough and submitted on time.\"\n        timestamp={new Date()}\n        period=\"November 2024\"\n      />\n      <RatingBadge\n        rating=\"Good\"\n        feedback=\"Solid work overall. Focus on improving task completion speed.\"\n        timestamp={new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)}\n        period=\"October 2024\"\n      />\n    </div>\n  )\n}\n","path":null,"size_bytes":616,"size_tokens":null},"client/src/pages/super-admin/SuperAdminDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport {\n    Card,\n    CardContent,\n    CardDescription,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n    Building2,\n    Users,\n    DollarSign,\n    TrendingUp,\n    Search,\n    Ban,\n    CheckCircle,\n    MoreVertical,\n    Eye,\n    Trash2,\n    Copy,\n    Check,\n} from \"lucide-react\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { queryClient, apiRequest, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Company } from \"@shared/schema\";\nimport CompanyDetailsModal from \"@/components/CompanyDetailsModal\";\n\ninterface CompanyWithStats {\n    company: Company;\n    userCount: number;\n    adminCount: number;\n    memberCount: number;\n}\n\ninterface AnalyticsData {\n    totalCompanies: number;\n    activeCompanies: number;\n    suspendedCompanies: number;\n    totalUsers: number;\n    totalAdmins: number;\n    totalMembers: number;\n    totalTasks: number;\n    totalPayments: number;\n    totalRevenue: number;\n}\n\nexport default function SuperAdminDashboard() {\n    const [searchQuery, setSearchQuery] = useState(\"\");\n    const [filterStatus, setFilterStatus] = useState<\n        \"all\" | \"active\" | \"suspended\"\n    >(\"all\");\n    const [selectedCompany, setSelectedCompany] = useState<number | null>(null);\n    const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n    const [showDetailsModal, setShowDetailsModal] = useState(false);\n    const [selectedCompanyForDetails, setSelectedCompanyForDetails] =\n        useState<any>(null);\n    const [copiedServerId, setCopiedServerId] = useState<string | null>(null);\n    const { toast } = useToast();\n\n    const handleCopyServerId = async (serverId: string) => {\n        try {\n            await navigator.clipboard.writeText(serverId);\n            setCopiedServerId(serverId);\n            toast({\n                title: \"Copied!\",\n                description: `Server ID ${serverId} copied to clipboard`,\n            });\n            setTimeout(() => setCopiedServerId(null), 2000);\n        } catch (err) {\n            toast({\n                title: \"Failed to copy\",\n                description: \"Please try again\",\n                variant: \"destructive\",\n            });\n        }\n    };\n\n    const handleViewDetails = (companyData: CompanyWithStats) => {\n        const fullCompanyData = {\n            ...companyData.company,\n            currentAdmins: companyData.adminCount,\n            currentMembers: companyData.memberCount,\n        };\n        setSelectedCompanyForDetails(fullCompanyData);\n        setShowDetailsModal(true);\n    };\n\n    const { data: companiesWithStats = [], isLoading: loadingCompanies } =\n        useQuery<CompanyWithStats[]>({\n            queryKey: [\"/api/super-admin/companies-with-stats\"],\n        });\n\n    const { data: analytics, isLoading: loadingAnalytics } =\n        useQuery<AnalyticsData>({\n            queryKey: [\"/api/super-admin/analytics\"],\n        });\n\n    const suspendMutation = useMutation({\n        mutationFn: (companyId: number) =>\n            apiRequest(\n                `${API_BASE_URL}/api/super-admin/companies/${companyId}/suspend`,\n                \"POST\"\n            ),\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/super-admin/companies-with-stats\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/super-admin/analytics\"],\n            });\n            toast({\n                title: \"Success\",\n                description: \"Company suspended successfully\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description: \"Failed to suspend company\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const reactivateMutation = useMutation({\n        mutationFn: (companyId: number) =>\n            apiRequest(\n                `${API_BASE_URL}/api/super-admin/companies/${companyId}/reactivate`,\n                \"POST\"\n            ),\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/super-admin/companies-with-stats\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/super-admin/analytics\"],\n            });\n            toast({\n                title: \"Success\",\n                description: \"Company reactivated successfully\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description: \"Failed to reactivate company\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const deleteMutation = useMutation({\n        mutationFn: (companyId: number) =>\n            apiRequest(`${API_BASE_URL}/api/companies/${companyId}`, \"DELETE\"),\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/super-admin/companies-with-stats\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/super-admin/analytics\"],\n            });\n            setShowDeleteDialog(false);\n            setSelectedCompany(null);\n            toast({\n                title: \"Success\",\n                description: \"Company deleted successfully\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description: \"Failed to delete company\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const filteredCompanies = companiesWithStats.filter((item) => {\n        const matchesSearch =\n            item.company.name\n                .toLowerCase()\n                .includes(searchQuery.toLowerCase()) ||\n            item.company.email\n                .toLowerCase()\n                .includes(searchQuery.toLowerCase()) ||\n            item.company.serverId\n                .toLowerCase()\n                .includes(searchQuery.toLowerCase());\n\n        const matchesStatus =\n            filterStatus === \"all\" ||\n            (filterStatus === \"active\" && item.company.isActive) ||\n            (filterStatus === \"suspended\" && !item.company.isActive);\n\n        return matchesSearch && matchesStatus;\n    });\n\n    if (loadingCompanies || loadingAnalytics) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            className=\"container mx-auto p-6 space-y-6\"\n            data-testid=\"super-admin-dashboard\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\" data-testid=\"page-title\">\n                        Super Admin Dashboard\n                    </h1>\n                    <p className=\"text-muted-foreground\">\n                        Manage companies, users, and view analytics\n                    </p>\n                </div>\n            </div>\n\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                <Card data-testid=\"card-total-companies\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Total Companies\n                        </CardTitle>\n                        <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-total-companies\">\n                            {analytics?.totalCompanies || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            {analytics?.activeCompanies || 0} active,{\" \"}\n                            {analytics?.suspendedCompanies || 0} suspended\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-total-users\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Total Users\n                        </CardTitle>\n                        <Users className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-total-users\">\n                            {analytics?.totalUsers || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            {analytics?.totalAdmins || 0} admins,{\" \"}\n                            {analytics?.totalMembers || 0} members\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-total-payments\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Total Payments\n                        </CardTitle>\n                        <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-total-payments\">\n                            {analytics?.totalPayments || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            Payment transactions\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-total-revenue\">\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Total Revenue\n                        </CardTitle>\n                        <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-total-revenue\">\n                            ₹{analytics?.totalRevenue || 0}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            From slot purchases\n                        </p>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Company Management</CardTitle>\n                    <CardDescription>\n                        View and manage all registered companies\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"flex flex-col md:flex-row gap-4 mb-6\">\n                        <div className=\"relative flex-1\">\n                            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                            <Input\n                                placeholder=\"Search by name, email, or server ID...\"\n                                value={searchQuery}\n                                onChange={(e) => setSearchQuery(e.target.value)}\n                                className=\"pl-10\"\n                                data-testid=\"input-search-companies\"\n                            />\n                        </div>\n                        <Tabs\n                            value={filterStatus}\n                            onValueChange={(v) =>\n                                setFilterStatus(v as typeof filterStatus)\n                            }\n                            data-testid=\"tabs-company-filter\">\n                            <TabsList data-testid=\"tabs-list-company-status\">\n                                <TabsTrigger\n                                    value=\"all\"\n                                    data-testid=\"filter-all\">\n                                    All\n                                </TabsTrigger>\n                                <TabsTrigger\n                                    value=\"active\"\n                                    data-testid=\"filter-active\">\n                                    Active\n                                </TabsTrigger>\n                                <TabsTrigger\n                                    value=\"suspended\"\n                                    data-testid=\"filter-suspended\">\n                                    Suspended\n                                </TabsTrigger>\n                            </TabsList>\n                        </Tabs>\n                    </div>\n\n                    <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                        {filteredCompanies.map(\n                            ({\n                                company,\n                                userCount,\n                                adminCount,\n                                memberCount,\n                            }) => (\n                                <Card\n                                    key={company.id}\n                                    data-testid={`card-company-${company.id}`}\n                                    className=\"hover:shadow-lg transition-shadow\">\n                                    <CardHeader className=\"pb-3\">\n                                        <div className=\"flex justify-between items-start\">\n                                            <div className=\"space-y-1 flex-1\">\n                                                <CardTitle\n                                                    className=\"text-lg\"\n                                                    data-testid={`text-company-name-${company.id}`}>\n                                                    {company.name}\n                                                </CardTitle>\n                                                <CardDescription className=\"text-sm\">\n                                                    {company.email}\n                                                </CardDescription>\n                                                <div className=\"flex gap-2 mt-2 flex-wrap items-center\">\n                                                    <Badge\n                                                        variant={\n                                                            company.isActive\n                                                                ? \"default\"\n                                                                : \"destructive\"\n                                                        }\n                                                        data-testid={`badge-status-${company.id}`}>\n                                                        {company.isActive\n                                                            ? \"Active\"\n                                                            : \"Suspended\"}\n                                                    </Badge>\n                                                    <div className=\"flex items-center gap-1\">\n                                                        <Badge\n                                                            variant=\"outline\"\n                                                            data-testid={`badge-server-id-${company.id}`}>\n                                                            {company.serverId}\n                                                        </Badge>\n                                                        <Button\n                                                            variant=\"ghost\"\n                                                            size=\"icon\"\n                                                            className=\"h-6 w-6\"\n                                                            onClick={() =>\n                                                                handleCopyServerId(\n                                                                    company.serverId\n                                                                )\n                                                            }\n                                                            data-testid={`button-copy-server-id-${company.id}`}>\n                                                            {copiedServerId ===\n                                                            company.serverId ? (\n                                                                <Check className=\"h-3 w-3 text-green-600\" />\n                                                            ) : (\n                                                                <Copy className=\"h-3 w-3\" />\n                                                            )}\n                                                        </Button>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <DropdownMenu>\n                                                <DropdownMenuTrigger asChild>\n                                                    <Button\n                                                        variant=\"ghost\"\n                                                        size=\"icon\"\n                                                        data-testid={`button-menu-${company.id}`}>\n                                                        <MoreVertical className=\"h-4 w-4\" />\n                                                    </Button>\n                                                </DropdownMenuTrigger>\n                                                <DropdownMenuContent align=\"end\">\n                                                    <DropdownMenuItem\n                                                        onClick={() =>\n                                                            handleViewDetails({\n                                                                company,\n                                                                userCount,\n                                                                adminCount,\n                                                                memberCount,\n                                                            })\n                                                        }\n                                                        data-testid={`menu-view-${company.id}`}>\n                                                        <Eye className=\"mr-2 h-4 w-4\" />\n                                                        View Details\n                                                    </DropdownMenuItem>\n                                                    {company.isActive ? (\n                                                        <DropdownMenuItem\n                                                            onClick={() =>\n                                                                suspendMutation.mutate(\n                                                                    company.id\n                                                                )\n                                                            }\n                                                            disabled={\n                                                                suspendMutation.isPending\n                                                            }\n                                                            data-testid={`menu-suspend-${company.id}`}>\n                                                            <Ban className=\"mr-2 h-4 w-4\" />\n                                                            Suspend\n                                                        </DropdownMenuItem>\n                                                    ) : (\n                                                        <DropdownMenuItem\n                                                            onClick={() =>\n                                                                reactivateMutation.mutate(\n                                                                    company.id\n                                                                )\n                                                            }\n                                                            disabled={\n                                                                reactivateMutation.isPending\n                                                            }\n                                                            data-testid={`menu-reactivate-${company.id}`}>\n                                                            <CheckCircle className=\"mr-2 h-4 w-4\" />\n                                                            Reactivate\n                                                        </DropdownMenuItem>\n                                                    )}\n                                                    <DropdownMenuItem\n                                                        onClick={() => {\n                                                            setSelectedCompany(\n                                                                company.id\n                                                            );\n                                                            setShowDeleteDialog(\n                                                                true\n                                                            );\n                                                        }}\n                                                        className=\"text-destructive\"\n                                                        data-testid={`menu-delete-${company.id}`}>\n                                                        <Trash2 className=\"mr-2 h-4 w-4\" />\n                                                        Delete Company\n                                                    </DropdownMenuItem>\n                                                </DropdownMenuContent>\n                                            </DropdownMenu>\n                                        </div>\n                                    </CardHeader>\n                                    <CardContent>\n                                        <div className=\"space-y-2 text-sm\">\n                                            <div className=\"flex justify-between\">\n                                                <span className=\"text-muted-foreground\">\n                                                    Total Users:\n                                                </span>\n                                                <span\n                                                    className=\"font-medium\"\n                                                    data-testid={`text-user-count-${company.id}`}>\n                                                    {userCount}\n                                                </span>\n                                            </div>\n                                            <div className=\"flex justify-between\">\n                                                <span className=\"text-muted-foreground\">\n                                                    Admins:\n                                                </span>\n                                                <span\n                                                    className=\"font-medium\"\n                                                    data-testid={`text-admin-count-${company.id}`}>\n                                                    {adminCount} /{\" \"}\n                                                    {company.maxAdmins}\n                                                </span>\n                                            </div>\n                                            <div className=\"flex justify-between\">\n                                                <span className=\"text-muted-foreground\">\n                                                    Members:\n                                                </span>\n                                                <span\n                                                    className=\"font-medium\"\n                                                    data-testid={`text-member-count-${company.id}`}>\n                                                    {memberCount} /{\" \"}\n                                                    {company.maxMembers}\n                                                </span>\n                                            </div>\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            )\n                        )}\n                    </div>\n\n                    {filteredCompanies.length === 0 && (\n                        <div className=\"text-center py-12\">\n                            <p\n                                className=\"text-muted-foreground\"\n                                data-testid=\"text-no-companies\">\n                                No companies found matching your search\n                            </p>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n\n            <Dialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n                <DialogContent data-testid=\"dialog-delete-company\">\n                    <DialogHeader>\n                        <DialogTitle>Delete Company</DialogTitle>\n                        <DialogDescription>\n                            Are you sure you want to delete this company? This\n                            action cannot be undone and will permanently delete\n                            all company data, users, tasks, and reports.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <DialogFooter>\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => setShowDeleteDialog(false)}\n                            data-testid=\"button-cancel-delete\">\n                            Cancel\n                        </Button>\n                        <Button\n                            variant=\"destructive\"\n                            onClick={() =>\n                                selectedCompany &&\n                                deleteMutation.mutate(selectedCompany)\n                            }\n                            disabled={deleteMutation.isPending}\n                            data-testid=\"button-confirm-delete\">\n                            {deleteMutation.isPending\n                                ? \"Deleting...\"\n                                : \"Delete Company\"}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            <CompanyDetailsModal\n                company={selectedCompanyForDetails}\n                open={showDetailsModal}\n                onClose={() => setShowDetailsModal(false)}\n                onSuspend={(companyId) => suspendMutation.mutate(companyId)}\n                onReactivate={(companyId) =>\n                    reactivateMutation.mutate(companyId)\n                }\n                onDelete={(companyId) => {\n                    setSelectedCompany(companyId);\n                    setShowDeleteDialog(true);\n                }}\n            />\n        </div>\n    );\n}\n","path":null,"size_bytes":28574,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/TaskDetailsModal.tsx":{"content":"import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { format } from \"date-fns\";\nimport { Clock, Repeat2, Calendar, CheckCircle2, AlertCircle } from \"lucide-react\";\nimport type { Task } from \"@shared/schema\";\n\ninterface TaskDetailsModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  task: Task | null;\n  timeLogs: {\n    totalSeconds: number;\n    oldTimeSeconds: number;\n    newTimeSeconds: number;\n  } | null;\n  returnCount: number;\n  reworkHistory?: Array<{\n    date: string;\n    message: string;\n  }>;\n}\n\nexport default function TaskDetailsModal({\n  open,\n  onOpenChange,\n  task,\n  timeLogs,\n  returnCount,\n  reworkHistory = [],\n}: TaskDetailsModalProps) {\n  if (!task) return null;\n\n  const formatTime = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    return `${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}:${String(secs).padStart(2, \"0\")}`;\n  };\n\n  const createdDate = new Date(task.createdAt);\n  const completedDate = task.completedAt ? new Date(task.completedAt) : null;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle className=\"text-lg\">Task Details & History</DialogTitle>\n          <DialogDescription>{task.title}</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 max-h-[60vh] overflow-y-auto\">\n          {/* Task Info */}\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base\">Task Information</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <p className=\"text-sm text-secondary-foreground\">Priority</p>\n                  <Badge variant={task.priority === \"high\" ? \"destructive\" : task.priority === \"medium\" ? \"default\" : \"secondary\"}>\n                    {task.priority}\n                  </Badge>\n                </div>\n                <div>\n                  <p className=\"text-sm text-secondary-foreground\">Status</p>\n                  <Badge variant={task.status === \"completed\" ? \"default\" : task.status === \"returned\" ? \"destructive\" : \"outline\"}>\n                    {task.status}\n                  </Badge>\n                </div>\n              </div>\n              {task.description && (\n                <div>\n                  <p className=\"text-sm text-secondary-foreground\">Description</p>\n                  <p className=\"text-sm\">{task.description}</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Time Tracking */}\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Clock className=\"w-4 h-4\" />\n                Time Tracking\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              {timeLogs ? (\n                <>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between items-center p-2 bg-muted rounded\">\n                      <span className=\"text-sm\">Total Time</span>\n                      <span className=\"font-semibold\">{formatTime(timeLogs.totalSeconds)}</span>\n                    </div>\n                    {timeLogs.oldTimeSeconds > 0 && (\n                      <div className=\"flex justify-between items-center p-2 bg-orange-50 dark:bg-orange-950/20 rounded\">\n                        <span className=\"text-sm\">Previous Attempt</span>\n                        <span className=\"font-semibold text-orange-700 dark:text-orange-300\">{formatTime(timeLogs.oldTimeSeconds)}</span>\n                      </div>\n                    )}\n                    {timeLogs.newTimeSeconds > 0 && (\n                      <div className=\"flex justify-between items-center p-2 bg-blue-50 dark:bg-blue-950/20 rounded\">\n                        <span className=\"text-sm\">Rework Time</span>\n                        <span className=\"font-semibold text-blue-700 dark:text-blue-300\">{formatTime(timeLogs.newTimeSeconds)}</span>\n                      </div>\n                    )}\n                  </div>\n                </>\n              ) : (\n                <p className=\"text-sm text-secondary-foreground\">No time logged</p>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Rework History */}\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Repeat2 className=\"w-4 h-4\" />\n                Rework History\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {reworkHistory && reworkHistory.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {reworkHistory.map((rework, index) => {\n                    const reworkDate = new Date(rework.date);\n                    return (\n                      <div key={index} className=\"p-3 bg-orange-50 dark:bg-orange-950/20 rounded border border-orange-200 dark:border-orange-900/50\">\n                        <div className=\"flex items-start gap-3\">\n                          <AlertCircle className=\"w-4 h-4 text-orange-600 dark:text-orange-400 mt-0.5 flex-shrink-0\" />\n                          <div className=\"flex-1\">\n                            <p className=\"text-sm font-medium\">Return to Pending</p>\n                            <p className=\"text-xs text-secondary-foreground mt-1\">\n                              {format(reworkDate, \"MMM dd, yyyy\")} at {format(reworkDate, \"hh:mm a\")}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                  <p className=\"text-xs text-secondary-foreground mt-3\">\n                    Task returned {reworkHistory.length} time{reworkHistory.length > 1 ? \"s\" : \"\"}\n                  </p>\n                </div>\n              ) : (\n                <p className=\"text-sm text-secondary-foreground\">No rework requests</p>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Timeline */}\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Calendar className=\"w-4 h-4\" />\n                Timeline\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between items-start\">\n                  <div>\n                    <p className=\"text-sm text-secondary-foreground\">Created</p>\n                    <p className=\"text-sm font-medium\">{format(createdDate, \"MMM dd, yyyy\")}</p>\n                    <p className=\"text-xs text-secondary-foreground\">{format(createdDate, \"hh:mm a\")}</p>\n                  </div>\n                </div>\n\n                {task.deadline && (\n                  <div className=\"flex justify-between items-start border-t pt-3\">\n                    <div>\n                      <p className=\"text-sm text-secondary-foreground\">Deadline</p>\n                      <p className=\"text-sm font-medium\">{format(new Date(task.deadline), \"MMM dd, yyyy\")}</p>\n                      <p className=\"text-xs text-secondary-foreground\">{format(new Date(task.deadline), \"hh:mm a\")}</p>\n                    </div>\n                  </div>\n                )}\n\n                {completedDate && (\n                  <div className=\"flex justify-between items-start border-t pt-3\">\n                    <div>\n                      <p className=\"text-sm text-secondary-foreground flex items-center gap-2\">\n                        <CheckCircle2 className=\"w-3 h-3\" />\n                        Completed\n                      </p>\n                      <p className=\"text-sm font-medium text-green-700 dark:text-green-300\">{format(completedDate, \"MMM dd, yyyy\")}</p>\n                      <p className=\"text-xs text-secondary-foreground\">{format(completedDate, \"hh:mm a\")}</p>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":8651,"size_tokens":null},"client/src/pages/team-leader/TeamRatings.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Star, UserX } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport RatingDialog from \"@/components/RatingDialog\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface TeamMember {\n    id: number;\n    displayName: string;\n    email: string;\n    photoURL?: string;\n    uniqueUserId: string;\n}\n\ninterface Rating {\n    id: number;\n    userId: number;\n    ratedBy: number;\n    rating: string;\n    feedback?: string;\n    period: string;\n    createdAt: string;\n}\n\ninterface TeamMemberRating {\n    member: TeamMember;\n    latestRating?: Rating;\n}\n\nexport default function TeamRatings() {\n    const { dbUserId } = useAuth();\n\n    const { data: teamMembers = [], isLoading: loadingMembers } = useQuery<\n        TeamMember[]\n    >({\n        queryKey: [`/api/team-assignments/${dbUserId}/members`],\n        enabled: !!dbUserId,\n    });\n\n    const { data: allRatings = [], isLoading: loadingRatings } = useQuery<\n        Rating[]\n    >({\n        queryKey: [\"/api/ratings\"],\n        enabled: !!dbUserId,\n    });\n\n    const teamMemberRatings: TeamMemberRating[] = teamMembers.map((member) => {\n        const memberRatings = allRatings.filter((r) => r.userId === member.id);\n        const latestRating = memberRatings.sort(\n            (a, b) =>\n                new Date(b.createdAt).getTime() -\n                new Date(a.createdAt).getTime()\n        )[0];\n\n        return {\n            member,\n            latestRating,\n        };\n    });\n\n    const getRatingValue = (ratingStr: string): number => {\n        const ratingMap: Record<string, number> = {\n            excellent: 5,\n            very_good: 4,\n            good: 3,\n            average: 2,\n            poor: 1,\n        };\n        return ratingMap[ratingStr.toLowerCase()] || 3;\n    };\n\n    const getRatingLabel = (ratingStr: string): string => {\n        return ratingStr\n            .split(\"_\")\n            .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n            .join(\" \");\n    };\n\n    const renderStars = (rating: number) => {\n        return (\n            <div className=\"flex gap-1\">\n                {[1, 2, 3, 4, 5].map((star) => (\n                    <Star\n                        key={star}\n                        className={`h-4 w-4 ${\n                            star <= rating\n                                ? \"fill-yellow-400 text-yellow-400\"\n                                : \"text-muted-foreground\"\n                        }`}\n                    />\n                ))}\n            </div>\n        );\n    };\n\n    const getInitials = (name: string) => {\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    if (loadingMembers || loadingRatings) {\n        return (\n            <div className=\"space-y-6\">\n                <Skeleton className=\"h-10 w-48\" />\n                <div className=\"grid gap-4\">\n                    {[...Array(3)].map((_, i) => (\n                        <Card key={i}>\n                            <CardHeader>\n                                <Skeleton className=\"h-12 w-full\" />\n                            </CardHeader>\n                            <CardContent>\n                                <Skeleton className=\"h-20 w-full\" />\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold\">Team Ratings</h1>\n                    <p className=\"text-muted-foreground\">\n                        Review team member performance ratings\n                    </p>\n                </div>\n            </div>\n\n            {teamMemberRatings.length === 0 ? (\n                <Card>\n                    <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                        <UserX className=\"h-12 w-12 text-muted-foreground mb-3\" />\n                        <p className=\"text-sm text-muted-foreground text-center\">\n                            No team members assigned yet\n                        </p>\n                    </CardContent>\n                </Card>\n            ) : (\n                <div className=\"grid gap-4\">\n                    {teamMemberRatings.map(({ member, latestRating }) => (\n                        <Card\n                            key={member.id}\n                            data-testid={`card-rating-${member.id}`}>\n                            <CardHeader>\n                                <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                                    <div className=\"flex items-center gap-3\">\n                                        <Avatar className=\"h-12 w-12\">\n                                            <AvatarImage\n                                                src={member.photoURL}\n                                            />\n                                            <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                                                {getInitials(\n                                                    member.displayName\n                                                )}\n                                            </AvatarFallback>\n                                        </Avatar>\n                                        <div>\n                                            <CardTitle className=\"text-lg\">\n                                                {member.displayName}\n                                            </CardTitle>\n                                            {latestRating ? (\n                                                <div className=\"flex items-center gap-2 mt-1\">\n                                                    {renderStars(\n                                                        getRatingValue(\n                                                            latestRating.rating\n                                                        )\n                                                    )}\n                                                    <span className=\"text-sm font-semibold\">\n                                                        {getRatingLabel(\n                                                            latestRating.rating\n                                                        )}\n                                                    </span>\n                                                </div>\n                                            ) : (\n                                                <p className=\"text-sm text-muted-foreground mt-1\">\n                                                    No ratings yet\n                                                </p>\n                                            )}\n                                        </div>\n                                    </div>\n                                    <RatingDialog\n                                        userId={member.id}\n                                        userName={member.displayName}\n                                        trigger={\n                                            <Button\n                                                variant=\"outline\"\n                                                size=\"sm\"\n                                                data-testid={`button-rate-${member.id}`}>\n                                                <Star className=\"h-4 w-4 mr-2\" />\n                                                Rate Member\n                                            </Button>\n                                        }\n                                    />\n                                </div>\n                            </CardHeader>\n                            <CardContent>\n                                {latestRating ? (\n                                    <div className=\"space-y-3\">\n                                        <div className=\"space-y-1\">\n                                            <p className=\"text-sm text-muted-foreground\">\n                                                Rating Period\n                                            </p>\n                                            <p className=\"text-sm font-medium\">\n                                                {getRatingLabel(\n                                                    latestRating.period\n                                                )}\n                                            </p>\n                                        </div>\n                                        {latestRating.feedback && (\n                                            <div className=\"space-y-1\">\n                                                <p className=\"text-sm text-muted-foreground\">\n                                                    Feedback\n                                                </p>\n                                                <p className=\"text-sm\">\n                                                    {latestRating.feedback}\n                                                </p>\n                                            </div>\n                                        )}\n                                        <div className=\"space-y-1\">\n                                            <p className=\"text-sm text-muted-foreground\">\n                                                Rated On\n                                            </p>\n                                            <p className=\"text-sm\">\n                                                {new Date(\n                                                    latestRating.createdAt\n                                                ).toLocaleDateString(\"en-US\", {\n                                                    year: \"numeric\",\n                                                    month: \"long\",\n                                                    day: \"numeric\",\n                                                })}\n                                            </p>\n                                        </div>\n                                    </div>\n                                ) : (\n                                    <div className=\"text-center py-6\">\n                                        <Star className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n                                        <p className=\"text-sm text-muted-foreground\">\n                                            This team member hasn't been rated\n                                            yet\n                                        </p>\n                                    </div>\n                                )}\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":11307,"size_tokens":null},"client/src/components/BottomNav.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface BottomNavItem {\n  path: string;\n  label: string;\n  icon: React.ComponentType<{ className?: string }>;\n}\n\ninterface BottomNavProps {\n  items: BottomNavItem[];\n  className?: string;\n}\n\nexport default function BottomNav({ items, className }: BottomNavProps) {\n  const [location] = useLocation();\n\n  return (\n    <nav \n      className={cn(\n        \"fixed bottom-0 left-0 right-0 z-50 bg-card border-t md:hidden\",\n        \"safe-area-inset-bottom\",\n        className\n      )}\n      aria-label=\"Bottom navigation\"\n    >\n      <div className=\"flex items-center justify-around h-16 px-2\">\n        {items.map((item) => {\n          const isActive = location === item.path;\n          const Icon = item.icon;\n          \n          return (\n            <Link\n              key={item.path}\n              href={item.path}\n              className={cn(\n                \"flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg transition-all min-w-[60px]\",\n                \"active:scale-95\",\n                isActive\n                  ? \"text-primary\"\n                  : \"text-muted-foreground hover:text-foreground\"\n              )}\n              aria-label={item.label}\n              aria-current={isActive ? \"page\" : undefined}\n            >\n              <Icon className={cn(\n                \"h-6 w-6 transition-transform\",\n                isActive && \"scale-110\"\n              )} />\n              <span className={cn(\n                \"text-[10px] font-medium transition-all\",\n                isActive && \"font-semibold\"\n              )}>\n                {item.label}\n              </span>\n              {isActive && (\n                <div className=\"absolute bottom-0 left-1/2 -translate-x-1/2 w-1 h-1 bg-primary rounded-full\" />\n              )}\n            </Link>\n          );\n        })}\n      </div>\n    </nav>\n  );\n}\n","path":null,"size_bytes":1918,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"replit.md":{"content":"WorkLogix - Employee Work Tracking & Task Management System\nOverview\nWorkLogix is a comprehensive full-stack employee work tracking and task management application built with React, Express, PostgreSQL, and TypeScript. It provides features for task management, time-based reporting, performance monitoring, and team collaboration.\n\nProject Architecture\nTechnology Stack\nFrontend: React 18 + TypeScript + Vite\nBackend: Express.js + TypeScript\nDatabase: PostgreSQL (Drizzle ORM)\nSession Storage: PostgreSQL (connect-pg-simple)\nUI Components: Radix UI + Tailwind CSS\nAuthentication: Passport.js (Local & Google OAuth)\nReal-time: WebSocket (ws library)\nPayments: Stripe integration\nEmail: Nodemailer + Resend\nProject Structure\n├── client/ # Frontend React application\n│ ├── src/ # React components and pages\n│ └── index.html # Entry HTML file\n├── server/ # Backend Express application\n│ ├── index.ts # Main server entry point\n│ ├── routes.ts # API routes\n│ ├── db.ts # Database connection\n│ ├── passport.ts # Authentication configuration\n│ ├── storage.ts # Database operations\n│ └── vite.ts # Vite dev server setup\n├── shared/ # Shared types and schemas\n│ └── schema.ts # Drizzle database schema\n├── public/ # Static assets (service worker)\n├── dist/ # Production build output\n└── build.mjs # Custom esbuild script\n\nDevelopment Commands\nnpm install: Install dependencies\nnpm run dev: Start development server (port 5000)\nnpm run build: Build for production\nnpm start: Run production server\nnpm run db:push: Push database schema changes\nnpm run check: TypeScript type checking\nEnvironment Variables\nRequired\nVariable Description\nDATABASE_URL PostgreSQL connection string\nSESSION_SECRET Session encryption key (random string)\nSUPER_ADMIN_EMAIL Email for super admin account\nSUPER_ADMIN_PASSWORD Password for super admin account\nOptional Features\nVariable Description\nFIREBASE_SERVICE_ACCOUNT_KEY Firebase Admin SDK credentials\nGOOGLE_CLIENT_ID Google OAuth client ID\nGOOGLE_CLIENT_SECRET Google OAuth client secret\nSTRIPE_SECRET_KEY Stripe payment processing\nRESEND_API_KEY Email service API key\nFRONTEND_BASE_PATH Base path for frontend routes (e.g., /worklogix)\nFRONTEND_URL Full URL for frontend (e.g., https://neophrondev.in)\nDeploying to Render\nStep 1: Create a PostgreSQL Database\nGo to Render Dashboard → New → PostgreSQL\nChoose a name (e.g., worklogix-db)\nSelect the free or paid plan\nCopy the External Database URL\nStep 2: Create a Web Service\nGo to Render Dashboard → New → Web Service\nConnect your GitHub repository\nConfigure the service:\nSetting Value\nName worklogix (or your preferred name)\nRegion Choose nearest to your users\nBranch main (or your default branch)\nRoot Directory Leave empty (deploy from root)\nRuntime Node\nBuild Command npm install && npm run build\nStart Command npm start\nStep 3: Add Environment Variables\nIn Render, go to Environment and add:\n\nDATABASE_URL = <your-render-postgres-external-url>\nSESSION_SECRET = <generate-a-random-32-character-string>\nSUPER_ADMIN_EMAIL = your-admin@email.com\nSUPER_ADMIN_PASSWORD = <strong-password>\nNODE_ENV = production\n\nOptional (for full features):\n\nGOOGLE_CLIENT_ID = <from-google-cloud-console>\nGOOGLE_CLIENT_SECRET = <from-google-cloud-console>\nSTRIPE_SECRET_KEY = <from-stripe-dashboard>\nRESEND_API_KEY = <from-resend-dashboard>\n\nStep 4: Run Database Migrations\nAfter first deploy, open the Render Shell and run:\n\nnpm run db:push\n\nStep 5: Verify Deployment\nCheck the Render logs for \"serving on port\" message\nVisit your Render URL\nLogin with your super admin credentials\nKey Features\nMulti-tenant Company Management: Support for multiple companies with isolated data\nUser Roles: Super Admin, Company Admin, Team Leader, Company Member\nTask Management: Assign, track, and manage tasks with priorities and deadlines\nTime Tracking: Daily, weekly, and monthly reports\nPerformance Ratings: Feedback system for employee performance\nReal-time Updates: WebSocket support for live notifications\nFile Uploads: Support for document attachments\nAutomated Attendance: Cron job for marking absent users\nEmail Notifications: Company verification and user notifications\nSession Persistence: PostgreSQL-backed sessions (survive restarts)\nDatabase Schema\nThe application uses PostgreSQL with the following main tables:\n\ncompanies: Multi-tenant company data\nusers: User accounts with role-based access\ntasks: Task assignments and tracking\nreports: Daily/weekly/monthly work reports\nmessages: Internal messaging system\nratings: Performance reviews\nfileUploads: Document management\narchiveReports: Historical data\nuser_sessions: Session storage (auto-created)\nRecent Changes (December 3, 2024)\nBuild System Improvements\nFixed esbuild configuration: Created build.mjs for proper server bundling\n\nBundles all local server files together\nKeeps npm packages external for smaller bundle size\nHandles path aliases (@shared)\nDynamic Vite imports: Only loads Vite in development mode\n\nPrevents production build errors\nFaster startup in production\nPostgreSQL Session Storage: Added connect-pg-simple\n\nSessions persist across server restarts\nAuto-creates user_sessions table\nSecurity Improvements: Removed hardcoded credentials\n\nSuper admin credentials now via environment variables\nReplit Configuration\nHost: 0.0.0.0\nPort: 5000\nAllowed hosts: true (for iframe proxy)\nCache control headers enabled\nNotes\nSessions are stored in PostgreSQL for production reliability\nWebSocket connections work automatically on Render\nDaily cron job runs at 11:59 PM IST for attendance marking\n","path":null,"size_bytes":5628,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/pages/team-leader/TeamLeaderDashboard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport {\n    Users,\n    CheckSquare,\n    Calendar,\n    Clock,\n    Circle,\n    UserCheck,\n    UserX,\n    MessageSquare,\n} from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { format } from \"date-fns\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface TeamMember {\n    id: number;\n    displayName: string;\n    email: string;\n    photoURL?: string;\n    uniqueUserId: string;\n    isActive: boolean;\n}\n\ninterface Task {\n    id: number;\n    title: string;\n    status: string;\n    assignedTo: number;\n}\n\ninterface Leave {\n    id: number;\n    userId: number;\n    status: string;\n    startDate: string;\n    endDate: string;\n}\n\ninterface AttendanceRecord {\n    id: number;\n    userId: number;\n    date: string;\n    checkIn: string | null;\n    checkOut: string | null;\n    status: string;\n}\n\ninterface GroupMessage {\n    id: number;\n    companyId: number;\n    senderId: number;\n    title: string | null;\n    message: string;\n    createdAt: string;\n}\n\nexport default function TeamLeaderDashboard() {\n    const { user, dbUserId, companyId } = useAuth();\n\n    const { data: teamMembers = [], isLoading: loadingMembers } = useQuery<\n        TeamMember[]\n    >({\n        queryKey: [`/api/team-assignments/${dbUserId}/members`],\n        enabled: !!dbUserId,\n    });\n\n    const { data: allTasks = [], isLoading: loadingTasks } = useQuery<Task[]>({\n        queryKey: [\"/api/tasks\"],\n        enabled: !!companyId,\n    });\n\n    const { data: allLeaves = [], isLoading: loadingLeaves } = useQuery<\n        Leave[]\n    >({\n        queryKey: [`/api/leaves/company/${companyId}`],\n        enabled: !!companyId,\n    });\n\n    const { data: todayAttendance = [] } = useQuery<AttendanceRecord[]>({\n        queryKey: [`/api/team-assignments/${dbUserId}/attendance/today`],\n        enabled: !!dbUserId,\n    });\n\n    const { data: groupMessages = [] } = useQuery<GroupMessage[]>({\n        queryKey: [`/api/group-messages`],\n        enabled: !!companyId,\n    });\n\n    const teamMemberIds = teamMembers.map((m) => m.id);\n\n    const teamPendingTasks = allTasks.filter(\n        (task) =>\n            teamMemberIds.includes(task.assignedTo) &&\n            (task.status === \"pending\" || task.status === \"in_progress\")\n    );\n\n    const teamPendingLeaves = allLeaves.filter(\n        (leave) =>\n            teamMemberIds.includes(leave.userId) && leave.status === \"pending\"\n    );\n\n    const today = new Date().toISOString().split(\"T\")[0];\n    const teamTodayAttendance = todayAttendance.filter(\n        (record) =>\n            teamMemberIds.includes(record.userId) && record.date === today\n    );\n\n    const presentCount = teamTodayAttendance.filter(\n        (record) => record.checkIn !== null || record.status === \"present\"\n    ).length;\n\n    const attendanceRate =\n        teamMembers.length > 0\n            ? Math.round((presentCount / teamMembers.length) * 100)\n            : 0;\n\n    const getTodayStatus = (memberId: number) => {\n        const record = teamTodayAttendance.find((r) => r.userId === memberId);\n        if (!record)\n            return {\n                status: \"absent\",\n                label: \"Not Checked In\",\n                color: \"text-muted-foreground\",\n            };\n        if (record.status === \"leave\" || record.status === \"approved_leave\")\n            return {\n                status: \"leave\",\n                label: \"On Leave\",\n                color: \"text-blue-600 dark:text-blue-400\",\n            };\n        if (record.checkIn && !record.checkOut)\n            return {\n                status: \"present\",\n                label: \"Checked In\",\n                color: \"text-green-600 dark:text-green-400\",\n            };\n        if (record.checkIn && record.checkOut)\n            return {\n                status: \"completed\",\n                label: \"Checked Out\",\n                color: \"text-muted-foreground\",\n            };\n        return {\n            status: \"absent\",\n            label: \"Absent\",\n            color: \"text-red-600 dark:text-red-400\",\n        };\n    };\n\n    const getInitials = (name: string) => {\n        return name\n            .split(\" \")\n            .map((n) => n[0])\n            .join(\"\")\n            .toUpperCase()\n            .slice(0, 2);\n    };\n\n    if (loadingMembers) {\n        return (\n            <div className=\"space-y-6\">\n                <div>\n                    <Skeleton className=\"h-10 w-64 mb-2\" />\n                    <Skeleton className=\"h-5 w-96\" />\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                    {[...Array(4)].map((_, i) => (\n                        <Card key={i}>\n                            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                                <Skeleton className=\"h-4 w-24\" />\n                            </CardHeader>\n                            <CardContent>\n                                <Skeleton className=\"h-8 w-12 mb-2\" />\n                                <Skeleton className=\"h-3 w-32\" />\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h1\n                    className=\"text-3xl font-bold\"\n                    data-testid=\"text-dashboard-title\">\n                    Welcome, {user?.displayName}\n                </h1>\n                <p className=\"text-muted-foreground mt-2\">\n                    Manage your team and monitor their activities\n                </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Team Members\n                        </CardTitle>\n                        <Users className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-team-count\">\n                            {teamMembers.length}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            Active members under supervision\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Pending Tasks\n                        </CardTitle>\n                        <CheckSquare className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-pending-tasks\">\n                            {loadingTasks ? \"...\" : teamPendingTasks.length}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            Tasks awaiting completion\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Leave Requests\n                        </CardTitle>\n                        <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-leave-requests\">\n                            {loadingLeaves ? \"...\" : teamPendingLeaves.length}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            Pending your approval\n                        </p>\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                        <CardTitle className=\"text-sm font-medium\">\n                            Attendance Today\n                        </CardTitle>\n                        <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                    </CardHeader>\n                    <CardContent>\n                        <div\n                            className=\"text-2xl font-bold\"\n                            data-testid=\"text-attendance-rate\">\n                            {attendanceRate}%\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                            {presentCount} of {teamMembers.length} present\n                        </p>\n                    </CardContent>\n                </Card>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <UserCheck className=\"h-5 w-5\" />\n                            Team Members - Live Status\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        {teamMembers.length === 0 ? (\n                            <div className=\"text-center py-8\">\n                                <UserX className=\"h-12 w-12 text-muted-foreground mx-auto mb-3\" />\n                                <p className=\"text-sm text-muted-foreground\">\n                                    No team members assigned yet\n                                </p>\n                                <p className=\"text-xs text-muted-foreground mt-1\">\n                                    Contact your admin to assign team members\n                                </p>\n                            </div>\n                        ) : (\n                            <div className=\"space-y-3\">\n                                {teamMembers.map((member) => {\n                                    const statusInfo = getTodayStatus(\n                                        member.id\n                                    );\n                                    const memberTasks = teamPendingTasks.filter(\n                                        (t) => t.assignedTo === member.id\n                                    );\n\n                                    return (\n                                        <div\n                                            key={member.id}\n                                            className=\"flex items-center gap-3 p-3 rounded-md hover-elevate\"\n                                            data-testid={`member-card-${member.id}`}>\n                                            <Avatar className=\"h-10 w-10\">\n                                                <AvatarImage\n                                                    src={member.photoURL}\n                                                    alt={member.displayName}\n                                                />\n                                                <AvatarFallback>\n                                                    {getInitials(\n                                                        member.displayName\n                                                    )}\n                                                </AvatarFallback>\n                                            </Avatar>\n                                            <div className=\"flex-1 min-w-0\">\n                                                <div className=\"flex items-center gap-2\">\n                                                    <p className=\"text-sm font-medium truncate\">\n                                                        {member.displayName}\n                                                    </p>\n                                                    <Badge\n                                                        variant=\"secondary\"\n                                                        className=\"text-xs\"\n                                                        data-testid={`member-status-${member.id}`}>\n                                                        {member.uniqueUserId}\n                                                    </Badge>\n                                                </div>\n                                                <div className=\"flex items-center gap-3 mt-1\">\n                                                    <div className=\"flex items-center gap-1\">\n                                                        <Circle\n                                                            className={`h-2 w-2 fill-current ${statusInfo.color}`}\n                                                        />\n                                                        <span\n                                                            className={`text-xs ${statusInfo.color}`}>\n                                                            {statusInfo.label}\n                                                        </span>\n                                                    </div>\n                                                    {memberTasks.length > 0 && (\n                                                        <span className=\"text-xs text-muted-foreground\">\n                                                            {memberTasks.length}{\" \"}\n                                                            pending task\n                                                            {memberTasks.length !==\n                                                            1\n                                                                ? \"s\"\n                                                                : \"\"}\n                                                        </span>\n                                                    )}\n                                                </div>\n                                            </div>\n                                            {!member.isActive && (\n                                                <Badge\n                                                    variant=\"outline\"\n                                                    className=\"text-xs\">\n                                                    Inactive\n                                                </Badge>\n                                            )}\n                                        </div>\n                                    );\n                                })}\n                            </div>\n                        )}\n                    </CardContent>\n                </Card>\n\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                            <CheckSquare className=\"h-5 w-5\" />\n                            Recent Activity\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"space-y-4\">\n                            {teamPendingLeaves.length > 0 && (\n                                <div className=\"space-y-2\">\n                                    <h4 className=\"text-sm font-medium\">\n                                        Pending Leave Requests\n                                    </h4>\n                                    <div className=\"space-y-2\">\n                                        {teamPendingLeaves\n                                            .slice(0, 3)\n                                            .map((leave) => {\n                                                const member = teamMembers.find(\n                                                    (m) => m.id === leave.userId\n                                                );\n                                                return (\n                                                    <div\n                                                        key={leave.id}\n                                                        className=\"flex items-center justify-between p-2 rounded-md bg-muted/50\">\n                                                        <div className=\"flex-1\">\n                                                            <p className=\"text-sm font-medium\">\n                                                                {member?.displayName ||\n                                                                    \"Unknown\"}\n                                                            </p>\n                                                            <p className=\"text-xs text-muted-foreground\">\n                                                                {new Date(\n                                                                    leave.startDate\n                                                                ).toLocaleDateString()}{\" \"}\n                                                                -{\" \"}\n                                                                {new Date(\n                                                                    leave.endDate\n                                                                ).toLocaleDateString()}\n                                                            </p>\n                                                        </div>\n                                                        <Badge variant=\"outline\">\n                                                            Pending\n                                                        </Badge>\n                                                    </div>\n                                                );\n                                            })}\n                                    </div>\n                                </div>\n                            )}\n\n                            {teamPendingTasks.length > 0 && (\n                                <div className=\"space-y-2\">\n                                    <h4 className=\"text-sm font-medium\">\n                                        Active Tasks\n                                    </h4>\n                                    <div className=\"space-y-2\">\n                                        {teamPendingTasks\n                                            .slice(0, 3)\n                                            .map((task) => {\n                                                const member = teamMembers.find(\n                                                    (m) =>\n                                                        m.id === task.assignedTo\n                                                );\n                                                return (\n                                                    <div\n                                                        key={task.id}\n                                                        className=\"flex items-center justify-between p-2 rounded-md bg-muted/50\">\n                                                        <div className=\"flex-1 min-w-0\">\n                                                            <p className=\"text-sm font-medium truncate\">\n                                                                {task.title}\n                                                            </p>\n                                                            <p className=\"text-xs text-muted-foreground\">\n                                                                Assigned to:{\" \"}\n                                                                {member?.displayName ||\n                                                                    \"Unknown\"}\n                                                            </p>\n                                                        </div>\n                                                        <Badge\n                                                            variant={\n                                                                task.status ===\n                                                                \"in_progress\"\n                                                                    ? \"default\"\n                                                                    : \"secondary\"\n                                                            }>\n                                                            {task.status.replace(\n                                                                \"_\",\n                                                                \" \"\n                                                            )}\n                                                        </Badge>\n                                                    </div>\n                                                );\n                                            })}\n                                    </div>\n                                </div>\n                            )}\n\n                            {teamPendingLeaves.length === 0 &&\n                                teamPendingTasks.length === 0 && (\n                                    <div className=\"text-center py-8\">\n                                        <CheckSquare className=\"h-12 w-12 text-muted-foreground mx-auto mb-3\" />\n                                        <p className=\"text-sm text-muted-foreground\">\n                                            No pending activities\n                                        </p>\n                                        <p className=\"text-xs text-muted-foreground mt-1\">\n                                            All tasks and requests are up to\n                                            date\n                                        </p>\n                                    </div>\n                                )}\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":22668,"size_tokens":null},"client/src/hooks/use-websocket.ts":{"content":"import { useEffect, useRef } from 'react';\nimport { API_BASE_URL } from '@/lib/queryClient';\n\n// Helper to get WebSocket URL from API base URL or current host\nfunction getWebSocketUrl(): string {\n  if (API_BASE_URL) {\n    // Convert HTTP(S) URL to WS(S) URL\n    const wsUrl = API_BASE_URL.replace(/^http/, 'ws');\n    return `${wsUrl}/ws`;\n  }\n  // Default: use current host\n  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n  return `${protocol}//${window.location.host}/ws`;\n}\n\nexport function useWebSocket(onMessage: (data: any) => void) {\n  const wsRef = useRef<WebSocket | null>(null);\n\n  useEffect(() => {\n    const wsUrl = getWebSocketUrl();\n    console.log('[WebSocket] Connecting to:', wsUrl);\n    const ws = new WebSocket(wsUrl);\n\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n    };\n\n    ws.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        onMessage(data);\n      } catch (error) {\n        console.error('Failed to parse WebSocket message:', error);\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n    };\n\n    ws.onclose = () => {\n      console.log('WebSocket disconnected');\n    };\n\n    wsRef.current = ws;\n\n    return () => {\n      ws.close();\n    };\n  }, [onMessage]);\n\n  return wsRef.current;\n}\n","path":null,"size_bytes":1340,"size_tokens":null},"client/src/pages/admin/CorrectionApproval.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Calendar, Clock, Check, X, FileEdit } from \"lucide-react\";\nimport { format, parseISO } from \"date-fns\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport type { CorrectionRequest } from \"@shared/schema\";\n\ntype CorrectionWithUser = CorrectionRequest & { userName: string };\n\nexport default function CorrectionApproval() {\n    const { toast } = useToast();\n    const [reviewDialog, setReviewDialog] = useState<{\n        open: boolean;\n        request: CorrectionWithUser | null;\n        action: \"approve\" | \"reject\" | null;\n    }>({\n        open: false,\n        request: null,\n        action: null,\n    });\n    const [comments, setComments] = useState(\"\");\n\n    const { data: corrections = [], isLoading } = useQuery<\n        CorrectionWithUser[]\n    >({\n        queryKey: [\"/api/admin/attendance/corrections/pending\"],\n    });\n\n    const approveMutation = useMutation({\n        mutationFn: async ({\n            id,\n            comments,\n        }: {\n            id: number;\n            comments: string;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/admin/attendance/corrections/${id}/approve`,\n                \"PATCH\",\n                { comments }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/admin/attendance/corrections/pending\"],\n            });\n            setReviewDialog({ open: false, request: null, action: null });\n            setComments(\"\");\n            toast({\n                title: \"Request Approved\",\n                description:\n                    \"The correction request has been approved and applied.\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description:\n                    \"Failed to approve correction request. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const rejectMutation = useMutation({\n        mutationFn: async ({\n            id,\n            comments,\n        }: {\n            id: number;\n            comments: string;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/admin/attendance/corrections/${id}/reject`,\n                \"PATCH\",\n                { comments }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/admin/attendance/corrections/pending\"],\n            });\n            setReviewDialog({ open: false, request: null, action: null });\n            setComments(\"\");\n            toast({\n                title: \"Request Rejected\",\n                description: \"The correction request has been rejected.\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Error\",\n                description:\n                    \"Failed to reject correction request. Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const handleReview = () => {\n        if (!reviewDialog.request) return;\n\n        if (reviewDialog.action === \"reject\" && !comments.trim()) {\n            toast({\n                title: \"Validation Error\",\n                description: \"Please provide a reason for rejection.\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n\n        const mutationData = { id: reviewDialog.request.id, comments };\n\n        if (reviewDialog.action === \"approve\") {\n            approveMutation.mutate(mutationData);\n        } else if (reviewDialog.action === \"reject\") {\n            rejectMutation.mutate(mutationData);\n        }\n    };\n\n    const formatTime = (time: string | Date | null) => {\n        if (!time) return \"-\";\n        const date = typeof time === \"string\" ? new Date(time) : time;\n        return format(date, \"hh:mm a\");\n    };\n\n    return (\n        <div className=\"container mx-auto p-6 space-y-6\">\n            <div>\n                <h1 className=\"text-3xl font-bold\">\n                    Attendance Correction Requests\n                </h1>\n                <p className=\"text-muted-foreground mt-1\">\n                    Review and approve employee attendance correction requests\n                </p>\n            </div>\n\n            <div className=\"space-y-4\">\n                {isLoading && (\n                    <Card className=\"p-6\">\n                        <p className=\"text-center text-muted-foreground\">\n                            Loading...\n                        </p>\n                    </Card>\n                )}\n\n                {!isLoading && corrections.length === 0 && (\n                    <Card className=\"p-6\">\n                        <div className=\"text-center py-8\">\n                            <FileEdit className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground\" />\n                            <p\n                                className=\"text-muted-foreground\"\n                                data-testid=\"text-no-pending\">\n                                No pending correction requests.\n                            </p>\n                        </div>\n                    </Card>\n                )}\n\n                {corrections.map((correction) => (\n                    <Card\n                        key={correction.id}\n                        className=\"overflow-hidden\"\n                        data-testid={`card-correction-${correction.id}`}>\n                        <CardHeader>\n                            <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                                <div className=\"flex items-center gap-3\">\n                                    <FileEdit className=\"w-5 h-5 text-muted-foreground\" />\n                                    <CardTitle\n                                        className=\"text-lg\"\n                                        data-testid={`text-employee-${correction.id}`}>\n                                        {correction.userName}\n                                    </CardTitle>\n                                    <Badge\n                                        variant=\"secondary\"\n                                        data-testid={`status-correction-${correction.id}`}>\n                                        Pending Review\n                                    </Badge>\n                                </div>\n                                <div className=\"flex gap-2\">\n                                    <Button\n                                        onClick={() => {\n                                            setReviewDialog({\n                                                open: true,\n                                                request: correction,\n                                                action: \"approve\",\n                                            });\n                                            setComments(\"\");\n                                        }}\n                                        disabled={\n                                            approveMutation.isPending ||\n                                            rejectMutation.isPending\n                                        }\n                                        className=\"bg-green-600 hover:bg-green-700\"\n                                        data-testid={`button-approve-${correction.id}`}>\n                                        <Check className=\"h-4 w-4 mr-1\" />\n                                        Approve\n                                    </Button>\n                                    <Button\n                                        onClick={() => {\n                                            setReviewDialog({\n                                                open: true,\n                                                request: correction,\n                                                action: \"reject\",\n                                            });\n                                            setComments(\"\");\n                                        }}\n                                        disabled={\n                                            approveMutation.isPending ||\n                                            rejectMutation.isPending\n                                        }\n                                        variant=\"destructive\"\n                                        data-testid={`button-reject-${correction.id}`}>\n                                        <X className=\"h-4 w-4 mr-1\" />\n                                        Reject\n                                    </Button>\n                                </div>\n                            </div>\n                        </CardHeader>\n                        <CardContent className=\"space-y-3\">\n                            <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\n                                <div className=\"flex items-center gap-1\">\n                                    <Calendar className=\"h-4 w-4\" />\n                                    <span\n                                        data-testid={`text-date-${correction.id}`}>\n                                        {format(\n                                            parseISO(correction.date),\n                                            \"MMM dd, yyyy\"\n                                        )}\n                                    </span>\n                                </div>\n                                <div className=\"flex items-center gap-1\">\n                                    <Clock className=\"h-4 w-4\" />\n                                    <span\n                                        data-testid={`text-submitted-${correction.id}`}>\n                                        Submitted:{\" \"}\n                                        {format(\n                                            new Date(correction.createdAt),\n                                            \"MMM dd, yyyy 'at' hh:mm a\"\n                                        )}\n                                    </span>\n                                </div>\n                            </div>\n\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2\">\n                                {correction.requestedCheckIn && (\n                                    <div className=\"space-y-1\">\n                                        <p className=\"text-sm font-medium\">\n                                            Requested Check-In\n                                        </p>\n                                        <p\n                                            className=\"text-sm text-muted-foreground\"\n                                            data-testid={`text-check-in-${correction.id}`}>\n                                            {formatTime(\n                                                correction.requestedCheckIn\n                                            )}\n                                        </p>\n                                    </div>\n                                )}\n                                {correction.requestedCheckOut && (\n                                    <div className=\"space-y-1\">\n                                        <p className=\"text-sm font-medium\">\n                                            Requested Check-Out\n                                        </p>\n                                        <p\n                                            className=\"text-sm text-muted-foreground\"\n                                            data-testid={`text-check-out-${correction.id}`}>\n                                            {formatTime(\n                                                correction.requestedCheckOut\n                                            )}\n                                        </p>\n                                    </div>\n                                )}\n                            </div>\n\n                            <div className=\"pt-2\">\n                                <p className=\"text-sm font-medium mb-1\">\n                                    Reason for Correction\n                                </p>\n                                <p\n                                    className=\"text-sm text-muted-foreground\"\n                                    data-testid={`text-reason-${correction.id}`}>\n                                    {correction.reason}\n                                </p>\n                            </div>\n                        </CardContent>\n                    </Card>\n                ))}\n            </div>\n\n            <Dialog\n                open={reviewDialog.open}\n                onOpenChange={(open) => {\n                    if (\n                        !open &&\n                        !approveMutation.isPending &&\n                        !rejectMutation.isPending\n                    ) {\n                        setReviewDialog({\n                            open: false,\n                            request: null,\n                            action: null,\n                        });\n                        setComments(\"\");\n                    }\n                }}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>\n                            {reviewDialog.action === \"approve\"\n                                ? \"Approve\"\n                                : \"Reject\"}{\" \"}\n                            Correction Request\n                        </DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">\n                                {reviewDialog.action === \"approve\"\n                                    ? \"Add optional comments about this approval:\"\n                                    : \"Please provide a reason for rejection:\"}\n                            </p>\n                        </div>\n                        <Textarea\n                            placeholder={\n                                reviewDialog.action === \"approve\"\n                                    ? \"Optional comments...\"\n                                    : \"Reason for rejection...\"\n                            }\n                            value={comments}\n                            onChange={(e) => setComments(e.target.value)}\n                            rows={4}\n                            data-testid=\"input-review-comments\"\n                            disabled={\n                                approveMutation.isPending ||\n                                rejectMutation.isPending\n                            }\n                        />\n                    </div>\n                    <DialogFooter>\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => {\n                                setReviewDialog({\n                                    open: false,\n                                    request: null,\n                                    action: null,\n                                });\n                                setComments(\"\");\n                            }}\n                            disabled={\n                                approveMutation.isPending ||\n                                rejectMutation.isPending\n                            }\n                            data-testid=\"button-cancel-review\">\n                            Cancel\n                        </Button>\n                        <Button\n                            onClick={handleReview}\n                            disabled={\n                                approveMutation.isPending ||\n                                rejectMutation.isPending\n                            }\n                            variant={\n                                reviewDialog.action === \"approve\"\n                                    ? \"default\"\n                                    : \"destructive\"\n                            }\n                            data-testid=\"button-confirm-review\">\n                            {approveMutation.isPending ||\n                            rejectMutation.isPending\n                                ? \"Processing...\"\n                                : \"Confirm\"}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":16980,"size_tokens":null},"client/src/components/examples/LoginPage.tsx":{"content":"import LoginPage from '../LoginPage'\n\nexport default function LoginPageExample() {\n  return <LoginPage />\n}\n","path":null,"size_bytes":108,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"shared/schema.js":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, boolean, integer, serial, uniqueIndex } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nexport const companies = pgTable(\"companies\", {\n    id: serial(\"id\").primaryKey(),\n    serverId: varchar(\"server_id\", { length: 50 }).notNull().unique(),\n    name: varchar(\"name\", { length: 255 }).notNull(),\n    email: text(\"email\").notNull().unique(),\n    password: text(\"password\").notNull(),\n    phone: varchar(\"phone\", { length: 20 }),\n    website: text(\"website\"),\n    location: varchar(\"location\", { length: 100 }),\n    description: text(\"description\"),\n    companyType: varchar(\"company_type\", { length: 50 }),\n    contactPerson: varchar(\"contact_person\", { length: 255 }),\n    designation: varchar(\"designation\", { length: 100 }),\n    mobile: varchar(\"mobile\", { length: 20 }),\n    address: text(\"address\"),\n    pincode: varchar(\"pincode\", { length: 10 }),\n    city: varchar(\"city\", { length: 100 }),\n    state: varchar(\"state\", { length: 100 }),\n    country: varchar(\"country\", { length: 100 }),\n    employees: integer(\"employees\"),\n    annualTurnover: varchar(\"annual_turnover\", { length: 50 }),\n    yearEstablished: integer(\"year_established\"),\n    logo: text(\"logo\"),\n    verificationToken: varchar(\"verification_token\", { length: 255 }),\n    verificationTokenExpiry: timestamp(\"verification_token_expiry\"),\n    emailVerified: boolean(\"email_verified\").notNull().default(false),\n    maxAdmins: integer(\"max_admins\").notNull().default(1),\n    maxMembers: integer(\"max_members\").notNull().default(10),\n    isActive: boolean(\"is_active\").notNull().default(true),\n    createdBy: varchar(\"created_by\", { length: 255 }),\n    updatedBy: varchar(\"updated_by\", { length: 255 }),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const users = pgTable(\"users\", {\n    id: serial(\"id\").primaryKey(),\n    uniqueUserId: varchar(\"unique_user_id\", { length: 50 }).notNull().unique(),\n    email: text(\"email\").notNull().unique(),\n    displayName: text(\"display_name\").notNull(),\n    password: text(\"password\"),\n    photoURL: text(\"photo_url\"),\n    role: varchar(\"role\", { length: 20 }).notNull().default(\"company_member\"),\n    companyId: integer(\"company_id\").references(() => companies.id),\n    firebaseUid: text(\"firebase_uid\").unique(),\n    isActive: boolean(\"is_active\").notNull().default(true),\n    deletedAt: timestamp(\"deleted_at\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const tasks = pgTable(\"tasks\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    assignedBy: integer(\"assigned_by\").references(() => users.id),\n    assignedTo: integer(\"assigned_to\").references(() => users.id).notNull(),\n    title: varchar(\"title\", { length: 255 }).notNull(),\n    description: text(\"description\"),\n    priority: varchar(\"priority\", { length: 20 }).notNull().default(\"medium\"),\n    deadline: timestamp(\"deadline\"),\n    status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n    completedAt: timestamp(\"completed_at\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const reports = pgTable(\"reports\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    reportType: varchar(\"report_type\", { length: 20 }).notNull(),\n    plannedTasks: text(\"planned_tasks\"),\n    completedTasks: text(\"completed_tasks\"),\n    pendingTasks: text(\"pending_tasks\"),\n    notes: text(\"notes\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const messages = pgTable(\"messages\", {\n    id: serial(\"id\").primaryKey(),\n    senderId: integer(\"sender_id\").references(() => users.id).notNull(),\n    receiverId: integer(\"receiver_id\").references(() => users.id).notNull(),\n    message: text(\"message\").notNull(),\n    messageType: varchar(\"message_type\", { length: 30 }).notNull().default(\"team_leader_to_employee\"),\n    relatedTaskId: integer(\"related_task_id\").references(() => tasks.id),\n    readStatus: boolean(\"read_status\").notNull().default(false),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const ratings = pgTable(\"ratings\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    ratedBy: integer(\"rated_by\").references(() => users.id).notNull(),\n    rating: varchar(\"rating\", { length: 30 }).notNull(),\n    feedback: text(\"feedback\"),\n    period: varchar(\"period\", { length: 20 }).notNull(),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n    uniqueRatingPerPeriod: uniqueIndex(\"unique_rating_per_period\").on(table.userId, table.ratedBy, table.period),\n}));\nexport const fileUploads = pgTable(\"file_uploads\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    reportId: integer(\"report_id\").references(() => reports.id),\n    fileName: text(\"file_name\").notNull(),\n    fileUrl: text(\"file_url\").notNull(),\n    fileType: varchar(\"file_type\", { length: 20 }).notNull(),\n    uploadedAt: timestamp(\"uploaded_at\").defaultNow().notNull(),\n});\nexport const archiveReports = pgTable(\"archive_reports\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    reportType: varchar(\"report_type\", { length: 20 }).notNull(),\n    plannedTasks: text(\"planned_tasks\"),\n    completedTasks: text(\"completed_tasks\"),\n    pendingTasks: text(\"pending_tasks\"),\n    notes: text(\"notes\"),\n    originalDate: timestamp(\"original_date\").notNull(),\n    archivedAt: timestamp(\"archived_at\").defaultNow().notNull(),\n});\nexport const groupMessages = pgTable(\"group_messages\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    senderId: integer(\"sender_id\").references(() => users.id).notNull(),\n    message: text(\"message\").notNull(),\n    title: varchar(\"title\", { length: 255 }),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const groupMessageReplies = pgTable(\"group_message_replies\", {\n    id: serial(\"id\").primaryKey(),\n    groupMessageId: integer(\"group_message_id\").references(() => groupMessages.id).notNull(),\n    senderId: integer(\"sender_id\").references(() => users.id).notNull(),\n    message: text(\"message\").notNull(),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const taskTimeLogs = pgTable(\"task_time_logs\", {\n    id: serial(\"id\").primaryKey(),\n    taskId: integer(\"task_id\").references(() => tasks.id).notNull(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    date: varchar(\"date\", { length: 10 }).notNull(),\n    totalSeconds: integer(\"total_seconds\").notNull().default(0),\n    oldTimeSeconds: integer(\"old_time_seconds\").notNull().default(0),\n    newTimeSeconds: integer(\"new_time_seconds\").notNull().default(0),\n    timerStartedAt: timestamp(\"timer_started_at\"),\n    timerStatus: varchar(\"timer_status\", { length: 20 }).notNull().default(\"stopped\"),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const feedbacks = pgTable(\"feedbacks\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    submittedBy: integer(\"submitted_by\").references(() => users.id).notNull(),\n    recipientType: varchar(\"recipient_type\", { length: 20 }).notNull(),\n    message: text(\"message\").notNull(),\n    adminResponse: varchar(\"admin_response\", { length: 50 }),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n    respondedAt: timestamp(\"responded_at\"),\n});\nexport const slotPricing = pgTable(\"slot_pricing\", {\n    id: serial(\"id\").primaryKey(),\n    slotType: varchar(\"slot_type\", { length: 20 }).notNull(),\n    pricePerSlot: integer(\"price_per_slot\").notNull(),\n    currency: varchar(\"currency\", { length: 10 }).notNull().default(\"USD\"),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const companyPayments = pgTable(\"company_payments\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    slotType: varchar(\"slot_type\", { length: 20 }),\n    slotQuantity: integer(\"slot_quantity\"),\n    amount: integer(\"amount\").notNull(),\n    currency: varchar(\"currency\", { length: 10 }).notNull().default(\"INR\"),\n    paymentStatus: varchar(\"payment_status\", { length: 20 }).notNull().default(\"pending\"),\n    paymentMethod: varchar(\"payment_method\", { length: 50 }),\n    transactionId: varchar(\"transaction_id\", { length: 255 }),\n    stripePaymentIntentId: varchar(\"stripe_payment_intent_id\", { length: 255 }),\n    receiptNumber: varchar(\"receipt_number\", { length: 50 }).unique(),\n    invoiceUrl: text(\"invoice_url\"),\n    emailSent: boolean(\"email_sent\").notNull().default(false),\n    billingPeriodStart: timestamp(\"billing_period_start\"),\n    billingPeriodEnd: timestamp(\"billing_period_end\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const passwordResetTokens = pgTable(\"password_reset_tokens\", {\n    id: serial(\"id\").primaryKey(),\n    email: text(\"email\").notNull(),\n    token: varchar(\"token\", { length: 255 }).notNull().unique(),\n    expiresAt: timestamp(\"expires_at\").notNull(),\n    used: boolean(\"used\").notNull().default(false),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const adminActivityLogs = pgTable(\"admin_activity_logs\", {\n    id: serial(\"id\").primaryKey(),\n    actionType: varchar(\"action_type\", { length: 50 }).notNull(),\n    performedBy: integer(\"performed_by\").references(() => users.id).notNull(),\n    targetCompanyId: integer(\"target_company_id\").references(() => companies.id),\n    targetUserId: integer(\"target_user_id\").references(() => users.id),\n    details: text(\"details\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const badges = pgTable(\"badges\", {\n    id: serial(\"id\").primaryKey(),\n    name: varchar(\"name\", { length: 100 }).notNull(),\n    description: text(\"description\"),\n    icon: varchar(\"icon\", { length: 50 }),\n    criteria: text(\"criteria\"),\n    type: varchar(\"type\", { length: 50 }).notNull(),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const autoTasks = pgTable(\"auto_tasks\", {\n    id: serial(\"id\").primaryKey(),\n    taskName: varchar(\"task_name\", { length: 100 }).notNull(),\n    taskType: varchar(\"task_type\", { length: 50 }).notNull(),\n    status: varchar(\"status\", { length: 20 }).notNull(),\n    details: text(\"details\"),\n    executedAt: timestamp(\"executed_at\").defaultNow().notNull(),\n});\nexport const leaves = pgTable(\"leaves\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    leaveType: varchar(\"leave_type\", { length: 50 }).notNull(),\n    startDate: varchar(\"start_date\", { length: 10 }).notNull(),\n    endDate: varchar(\"end_date\", { length: 10 }).notNull(),\n    reason: text(\"reason\").notNull(),\n    status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n    approvedBy: integer(\"approved_by\").references(() => users.id),\n    remarks: text(\"remarks\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const holidays = pgTable(\"holidays\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    name: varchar(\"name\", { length: 255 }).notNull(),\n    date: varchar(\"date\", { length: 10 }).notNull(),\n    description: text(\"description\"),\n    isOptional: boolean(\"is_optional\").notNull().default(false),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const tasksReports = pgTable(\"tasks_reports\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    date: varchar(\"date\", { length: 10 }).notNull(),\n    tasksCompleted: text(\"tasks_completed\").notNull(),\n    notes: text(\"notes\"),\n    submitTime: timestamp(\"submit_time\").defaultNow().notNull(),\n    allowedEarlyLogout: boolean(\"allowed_early_logout\").notNull().default(true),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const shifts = pgTable(\"shifts\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    name: varchar(\"name\", { length: 100 }).notNull(),\n    startTime: varchar(\"start_time\", { length: 10 }).notNull(),\n    endTime: varchar(\"end_time\", { length: 10 }).notNull(),\n    gracePeriod: integer(\"grace_period\").notNull().default(15),\n    isActive: boolean(\"is_active\").notNull().default(true),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const attendancePolicies = pgTable(\"attendance_policies\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    halfDayHours: integer(\"half_day_hours\").notNull().default(4),\n    fullDayHours: integer(\"full_day_hours\").notNull().default(8),\n    lateMarkThreshold: integer(\"late_mark_threshold\").notNull().default(3),\n    autoAbsentHours: integer(\"auto_absent_hours\").notNull().default(2),\n    allowSelfCheckIn: boolean(\"allow_self_check_in\").notNull().default(true),\n    requireGPS: boolean(\"require_gps\").notNull().default(false),\n    requireDeviceBinding: boolean(\"require_device_binding\").notNull().default(false),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const attendanceRecords = pgTable(\"attendance_records\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    shiftId: integer(\"shift_id\").references(() => shifts.id),\n    date: varchar(\"date\", { length: 10 }).notNull(),\n    checkIn: timestamp(\"check_in\"),\n    checkOut: timestamp(\"check_out\"),\n    workDuration: integer(\"work_duration\"),\n    status: varchar(\"status\", { length: 20 }).notNull().default(\"absent\"),\n    gpsLocation: text(\"gps_location\"),\n    ipAddress: varchar(\"ip_address\", { length: 50 }),\n    deviceId: varchar(\"device_id\", { length: 255 }),\n    remarks: text(\"remarks\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const correctionRequests = pgTable(\"correction_requests\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    attendanceId: integer(\"attendance_id\").references(() => attendanceRecords.id),\n    date: varchar(\"date\", { length: 10 }).notNull(),\n    requestedCheckIn: timestamp(\"requested_check_in\"),\n    requestedCheckOut: timestamp(\"requested_check_out\"),\n    reason: text(\"reason\").notNull(),\n    attachment: text(\"attachment\"),\n    status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n    reviewedBy: integer(\"reviewed_by\").references(() => users.id),\n    reviewComments: text(\"review_comments\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const rewards = pgTable(\"rewards\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    points: integer(\"points\").notNull(),\n    reason: varchar(\"reason\", { length: 255 }).notNull(),\n    date: varchar(\"date\", { length: 10 }).notNull(),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const attendanceLogs = pgTable(\"attendance_logs\", {\n    id: serial(\"id\").primaryKey(),\n    attendanceId: integer(\"attendance_id\").references(() => attendanceRecords.id).notNull(),\n    action: varchar(\"action\", { length: 100 }).notNull(),\n    performedBy: integer(\"performed_by\").references(() => users.id).notNull(),\n    oldValue: text(\"old_value\"),\n    newValue: text(\"new_value\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const teamAssignments = pgTable(\"team_assignments\", {\n    id: serial(\"id\").primaryKey(),\n    teamLeaderId: integer(\"team_leader_id\").references(() => users.id).notNull(),\n    memberId: integer(\"member_id\").references(() => users.id).notNull(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    assignedAt: timestamp(\"assigned_at\").defaultNow().notNull(),\n    removedAt: timestamp(\"removed_at\"),\n}, (table) => ({\n    uniqueAssignment: sql `UNIQUE (team_leader_id, member_id, company_id, COALESCE(removed_at, '1970-01-01'))`,\n}));\nexport const enquiries = pgTable(\"enquiries\", {\n    id: serial(\"id\").primaryKey(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    customerName: varchar(\"customer_name\", { length: 255 }).notNull(),\n    address: text(\"address\"),\n    mobileNo: varchar(\"mobile_no\", { length: 20 }).notNull(),\n    productName: varchar(\"product_name\", { length: 255 }),\n    productVariant: varchar(\"product_variant\", { length: 255 }),\n    color: varchar(\"color\", { length: 100 }),\n    paymentMethod: varchar(\"payment_method\", { length: 50 }),\n    enquiryDate: varchar(\"enquiry_date\", { length: 10 }).notNull(),\n    leadSource: varchar(\"lead_source\", { length: 100 }),\n    status: varchar(\"status\", { length: 50 }).notNull().default(\"new\"),\n    createdBy: integer(\"created_by\").references(() => users.id).notNull(),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const followups = pgTable(\"followups\", {\n    id: serial(\"id\").primaryKey(),\n    enquiryId: integer(\"enquiry_id\").references(() => enquiries.id).notNull(),\n    companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n    followupDate: varchar(\"followup_date\", { length: 10 }).notNull(),\n    remark: text(\"remark\").notNull(),\n    enquiryStatus: varchar(\"enquiry_status\", { length: 50 }).notNull(),\n    nextFollowupDate: varchar(\"next_followup_date\", { length: 10 }),\n    payment: varchar(\"payment\", { length: 100 }),\n    expectedDeliveryDate: varchar(\"expected_delivery_date\", { length: 10 }),\n    createdBy: integer(\"created_by\").references(() => users.id).notNull(),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\nexport const insertCompanySchema = createInsertSchema(companies).omit({\n    id: true,\n    serverId: true,\n    createdAt: true,\n    updatedAt: true,\n});\nexport const insertUserSchema = createInsertSchema(users).omit({\n    id: true,\n    uniqueUserId: true,\n    createdAt: true,\n});\nexport const loginSchema = z.object({\n    email: z.string().email(\"Invalid email address\"),\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\nexport const signupSchema = z.object({\n    email: z.string().email(\"Invalid email address\"),\n    displayName: z.string().min(2, \"Name must be at least 2 characters\"),\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\nexport const firebaseSigninSchema = z.object({\n    email: z.string().email(\"Invalid email address\"),\n    displayName: z.string().min(1, \"Display name is required\"),\n    photoURL: z.string().optional(),\n    firebaseUid: z.string().min(1, \"Firebase UID is required\"),\n});\nconst strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/;\nexport const companyBasicRegistrationSchema = z.object({\n    companyName: z.string().min(2, \"Company name must be at least 2 characters\"),\n    email: z.string().email(\"Invalid email address\"),\n    password: z.string()\n        .min(8, \"Password must be at least 8 characters\")\n        .regex(strongPasswordRegex, \"Password must contain at least 1 uppercase, 1 lowercase, 1 number, and 1 special character (@$!%*?&)\"),\n    confirmPassword: z.string(),\n    acceptTerms: z.literal(true, {\n        errorMap: () => ({ message: \"You must accept the terms and conditions\" }),\n    }),\n}).refine((data) => data.password === data.confirmPassword, {\n    message: \"Passwords do not match\",\n    path: [\"confirmPassword\"],\n});\nexport const companyGoogleRegistrationSchema = z.object({\n    companyName: z.string().min(2, \"Company name must be at least 2 characters\"),\n    email: z.string().email(\"Invalid email address\"),\n    firebaseUid: z.string().min(1, \"Firebase UID is required\"),\n    photoURL: z.string().optional(),\n    acceptTerms: z.literal(true, {\n        errorMap: () => ({ message: \"You must accept the terms and conditions\" }),\n    }),\n});\nexport const companyRegistrationSchema = z.object({\n    fullName: z.string().min(2, \"Full name must be at least 2 characters\"),\n    email: z.string().email(\"Invalid email address\"),\n    password: z.string()\n        .min(8, \"Password must be at least 8 characters\")\n        .regex(strongPasswordRegex, \"Password must contain at least 1 uppercase, 1 lowercase, 1 number, and 1 special character (@$!%*?&)\"),\n    confirmPassword: z.string(),\n    name: z.string().min(2, \"Company name must be at least 2 characters\"),\n    companyType: z.string().min(1, \"Please select a company type\"),\n    contactPerson: z.string().min(2, \"Contact person name is required\"),\n    designation: z.string().min(1, \"Please select a designation\"),\n    mobile: z.string().regex(/^\\d{10}$/, \"Please enter a valid 10-digit mobile number\"),\n    website: z.string().url(\"Please enter a valid URL\").optional().or(z.literal(\"\")),\n    address: z.string().min(5, \"Please enter a complete address\"),\n    pincode: z.string().regex(/^\\d{6}$/, \"Please enter a valid 6-digit pincode\"),\n    city: z.string().min(2, \"City is required\"),\n    state: z.string().min(2, \"State is required\"),\n    country: z.string().min(2, \"Country is required\"),\n    employees: z.number().min(1, \"Number of employees must be at least 1\"),\n    annualTurnover: z.string().min(1, \"Please select annual turnover range\"),\n    yearEstablished: z.number()\n        .min(1800, \"Year must be valid\")\n        .max(new Date().getFullYear(), \"Year cannot be in the future\"),\n    description: z.string().optional(),\n    logo: z.string().optional(),\n    acceptTerms: z.literal(true, {\n        errorMap: () => ({ message: \"You must accept the terms and conditions\" }),\n    }),\n}).refine((data) => data.password === data.confirmPassword, {\n    message: \"Passwords do not match\",\n    path: [\"confirmPassword\"],\n});\nexport const superAdminLoginSchema = z.object({\n    email: z.string().email(\"Invalid email address\"),\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\nexport const companyAdminLoginSchema = z.object({\n    companyName: z.string().min(1, \"Company name is required\"),\n    email: z.string().email(\"Invalid email address\"),\n    serverId: z.string().min(1, \"Company Server ID is required\"),\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\nexport const companyUserLoginSchema = z.object({\n    username: z.string().min(1, \"Username is required\"),\n    userId: z.string().min(1, \"User ID is required\"),\n    password: z.string().min(6, \"Password must be at least 6 characters\"),\n});\nexport const insertTaskSchema = createInsertSchema(tasks).omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n}).extend({\n    deadline: z.string().nullable().optional().transform(val => val ? new Date(val) : null),\n});\nexport const insertReportSchema = createInsertSchema(reports).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n    id: true,\n    createdAt: true,\n}).extend({\n    messageType: z.enum(['admin_to_employee', 'admin_to_team_leader', 'team_leader_to_employee', 'employee_to_team_leader', 'team_leader_to_admin', 'employee_to_admin', 'admin_to_admin']),\n});\nexport const insertRatingSchema = createInsertSchema(ratings).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertFileUploadSchema = createInsertSchema(fileUploads).omit({\n    id: true,\n    uploadedAt: true,\n});\nexport const insertGroupMessageSchema = createInsertSchema(groupMessages).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertGroupMessageReplySchema = createInsertSchema(groupMessageReplies).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertTaskTimeLogSchema = createInsertSchema(taskTimeLogs).omit({\n    id: true,\n    updatedAt: true,\n});\nexport const insertFeedbackSchema = createInsertSchema(feedbacks).omit({\n    id: true,\n    createdAt: true,\n    respondedAt: true,\n}).extend({\n    recipientType: z.enum(['Admin', 'TeamLeader', 'Employee']),\n});\nexport const insertSlotPricingSchema = createInsertSchema(slotPricing).omit({\n    id: true,\n    updatedAt: true,\n}).extend({\n    slotType: z.enum(['admin', 'member']),\n    pricePerSlot: z.number().min(0, \"Price must be non-negative\"),\n});\nexport const insertCompanyPaymentSchema = createInsertSchema(companyPayments).omit({\n    id: true,\n    createdAt: true,\n}).extend({\n    slotType: z.enum(['admin', 'member']).optional(),\n    paymentStatus: z.enum(['pending', 'paid', 'failed', 'cancelled']),\n});\nexport const slotPurchaseSchema = z.object({\n    slotType: z.enum(['admin', 'member']),\n    quantity: z.number().min(1, \"Quantity must be at least 1\"),\n});\nexport const updatePaymentStatusSchema = z.object({\n    status: z.enum(['pending', 'paid', 'failed', 'cancelled']),\n});\nexport const passwordResetRequestSchema = z.object({\n    email: z.string().email(\"Invalid email address\"),\n});\nexport const passwordResetSchema = z.object({\n    token: z.string().min(1, \"Token is required\"),\n    newPassword: z.string().min(6, \"Password must be at least 6 characters\"),\n});\nexport const insertAdminActivityLogSchema = createInsertSchema(adminActivityLogs).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertBadgeSchema = createInsertSchema(badges).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertAutoTaskSchema = createInsertSchema(autoTasks).omit({\n    id: true,\n    executedAt: true,\n});\nexport const insertLeaveSchema = createInsertSchema(leaves).omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n});\nexport const insertHolidaySchema = createInsertSchema(holidays).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertTasksReportSchema = createInsertSchema(tasksReports).omit({\n    id: true,\n    createdAt: true,\n    submitTime: true,\n});\nexport const insertShiftSchema = createInsertSchema(shifts).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertAttendancePolicySchema = createInsertSchema(attendancePolicies).omit({\n    id: true,\n    updatedAt: true,\n});\nexport const insertAttendanceRecordSchema = createInsertSchema(attendanceRecords).omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n});\nexport const insertCorrectionRequestSchema = createInsertSchema(correctionRequests).omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n});\nexport const insertRewardSchema = createInsertSchema(rewards).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertAttendanceLogSchema = createInsertSchema(attendanceLogs).omit({\n    id: true,\n    createdAt: true,\n});\nexport const insertTeamAssignmentSchema = createInsertSchema(teamAssignments).omit({\n    id: true,\n    assignedAt: true,\n});\nexport const insertEnquirySchema = createInsertSchema(enquiries).omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n});\nexport const insertFollowupSchema = createInsertSchema(followups).omit({\n    id: true,\n    createdAt: true,\n});\nexport const deviceTokens = pgTable(\"device_tokens\", {\n    id: serial(\"id\").primaryKey(),\n    userId: integer(\"user_id\").references(() => users.id).notNull(),\n    token: text(\"token\").notNull().unique(),\n    deviceType: varchar(\"device_type\", { length: 20 }).notNull().default(\"web\"),\n    createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n    updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\nexport const insertDeviceTokenSchema = createInsertSchema(deviceTokens).omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n});\n","path":null,"size_bytes":28654,"size_tokens":null},"server/passport.ts":{"content":"import passport from 'passport';\nimport { Strategy as GoogleStrategy } from 'passport-google-oauth20';\nimport { storage } from './storage';\n\nconst callbackURL = process.env.REPLIT_DEV_DOMAIN \n  ? `${process.env.REPLIT_DEV_DOMAIN}/api/auth/google/callback`\n  : 'http://localhost:5000/api/auth/google/callback';\n\nif (process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET) {\n  passport.use(\n    new GoogleStrategy(\n      {\n        clientID: process.env.GOOGLE_CLIENT_ID,\n        clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n        callbackURL: callbackURL,\n      },\n      async (accessToken, refreshToken, profile, done) => {\n        try {\n          const email = profile.emails?.[0]?.value;\n          const displayName = profile.displayName || email?.split('@')[0] || 'User';\n          const photoURL = profile.photos?.[0]?.value;\n          const googleId = profile.id;\n\n          if (!email) {\n            return done(new Error('No email found in Google profile'), undefined);\n          }\n\n          done(null, {\n            email,\n            displayName,\n            photoURL,\n            googleId,\n          });\n        } catch (error) {\n          done(error as Error, undefined);\n        }\n      }\n    )\n  );\n} else {\n  console.warn('Google OAuth not configured - GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET environment variables not found');\n}\n\npassport.serializeUser((user, done) => {\n  done(null, user);\n});\n\npassport.deserializeUser((user: any, done) => {\n  done(null, user);\n});\n\nexport default passport;\n","path":null,"size_bytes":1526,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/MultiStepRegistrationForm.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { PasswordStrengthMeter } from \"@/components/ui/password-strength-meter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, ArrowRight, Building2, MapPin, Briefcase, UserCheck } from \"lucide-react\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface FormData {\n  fullName: string;\n  email: string;\n  password: string;\n  confirmPassword: string;\n  acceptTerms: boolean;\n  \n  name: string;\n  companyType: string;\n  contactPerson: string;\n  designation: string;\n  mobile: string;\n  website: string;\n  \n  address: string;\n  pincode: string;\n  city: string;\n  state: string;\n  country: string;\n  \n  employees: string;\n  annualTurnover: string;\n  yearEstablished: string;\n  description: string;\n  logo: string;\n}\n\nexport default function MultiStepRegistrationForm() {\n  const [currentStep, setCurrentStep] = useState(1);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n  \n  const [formData, setFormData] = useState<FormData>({\n    fullName: \"\",\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    acceptTerms: false,\n    \n    name: \"\",\n    companyType: \"\",\n    contactPerson: \"\",\n    designation: \"\",\n    mobile: \"\",\n    website: \"\",\n    \n    address: \"\",\n    pincode: \"\",\n    city: \"\",\n    state: \"\",\n    country: \"\",\n    \n    employees: \"\",\n    annualTurnover: \"\",\n    yearEstablished: \"\",\n    description: \"\",\n    logo: \"\",\n  });\n\n  const updateFormData = (field: keyof FormData, value: string | boolean) => {\n    setFormData((prev) => ({ ...prev, [field]: value }));\n  };\n\n  const validateStep1 = () => {\n    if (!formData.fullName || formData.fullName.length < 2) {\n      setError(\"Full name must be at least 2 characters\");\n      return false;\n    }\n    if (!formData.email || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n      setError(\"Please enter a valid email address\");\n      return false;\n    }\n    if (!formData.password || formData.password.length < 8) {\n      setError(\"Password must be at least 8 characters\");\n      return false;\n    }\n    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/;\n    if (!passwordRegex.test(formData.password)) {\n      setError(\"Password must contain uppercase, lowercase, number, and special character\");\n      return false;\n    }\n    if (formData.password !== formData.confirmPassword) {\n      setError(\"Passwords do not match\");\n      return false;\n    }\n    if (!formData.acceptTerms) {\n      setError(\"You must accept the terms and conditions\");\n      return false;\n    }\n    return true;\n  };\n\n  const validateStep2 = () => {\n    if (!formData.name || formData.name.length < 2) {\n      setError(\"Company name must be at least 2 characters\");\n      return false;\n    }\n    if (!formData.companyType) {\n      setError(\"Please select a company type\");\n      return false;\n    }\n    if (!formData.contactPerson || formData.contactPerson.length < 2) {\n      setError(\"Contact person name is required\");\n      return false;\n    }\n    if (!formData.designation) {\n      setError(\"Please select a designation\");\n      return false;\n    }\n    if (!formData.mobile || !/^\\d{10}$/.test(formData.mobile)) {\n      setError(\"Please enter a valid 10-digit mobile number\");\n      return false;\n    }\n    return true;\n  };\n\n  const validateStep3 = () => {\n    if (!formData.address || formData.address.length < 5) {\n      setError(\"Please enter a complete address\");\n      return false;\n    }\n    if (!formData.pincode || !/^\\d{6}$/.test(formData.pincode)) {\n      setError(\"Please enter a valid 6-digit pincode\");\n      return false;\n    }\n    if (!formData.city || formData.city.length < 2) {\n      setError(\"City is required\");\n      return false;\n    }\n    if (!formData.state || formData.state.length < 2) {\n      setError(\"State is required\");\n      return false;\n    }\n    if (!formData.country || formData.country.length < 2) {\n      setError(\"Country is required\");\n      return false;\n    }\n    return true;\n  };\n\n  const validateStep4 = () => {\n    if (!formData.employees || parseInt(formData.employees) < 1) {\n      setError(\"Number of employees must be at least 1\");\n      return false;\n    }\n    if (!formData.annualTurnover) {\n      setError(\"Please select annual turnover range\");\n      return false;\n    }\n    const year = parseInt(formData.yearEstablished);\n    if (!formData.yearEstablished || year < 1800 || year > new Date().getFullYear()) {\n      setError(\"Please enter a valid year established\");\n      return false;\n    }\n    return true;\n  };\n\n  const handleNext = () => {\n    setError(\"\");\n    let isValid = false;\n    \n    if (currentStep === 1) isValid = validateStep1();\n    else if (currentStep === 2) isValid = validateStep2();\n    else if (currentStep === 3) isValid = validateStep3();\n    else if (currentStep === 4) isValid = validateStep4();\n    \n    if (isValid && currentStep < 4) {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const handleBack = () => {\n    setError(\"\");\n    if (currentStep > 1) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!validateStep4()) {\n      return;\n    }\n    \n    setIsLoading(true);\n    setError(\"\");\n    \n    try {\n      const submitData = {\n        ...formData,\n        employees: parseInt(formData.employees),\n        yearEstablished: parseInt(formData.yearEstablished),\n      };\n      \n      const response = await fetch(`${API_BASE_URL}/api/auth/register-company`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(submitData),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Registration failed');\n      }\n      \n      const data = await response.json();\n      toast({\n        title: \"Success!\",\n        description: data.message,\n        duration: 10000,\n      });\n      \n      setCurrentStep(1);\n      setFormData({\n        fullName: \"\",\n        email: \"\",\n        password: \"\",\n        confirmPassword: \"\",\n        acceptTerms: false,\n        name: \"\",\n        companyType: \"\",\n        contactPerson: \"\",\n        designation: \"\",\n        mobile: \"\",\n        website: \"\",\n        address: \"\",\n        pincode: \"\",\n        city: \"\",\n        state: \"\",\n        country: \"\",\n        employees: \"\",\n        annualTurnover: \"\",\n        yearEstablished: \"\",\n        description: \"\",\n        logo: \"\",\n      });\n    } catch (error: any) {\n      setError(error.message || \"Registration failed\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const steps = [\n    { number: 1, title: \"Login Credentials\", icon: UserCheck },\n    { number: 2, title: \"Company Details\", icon: Building2 },\n    { number: 3, title: \"Location\", icon: MapPin },\n    { number: 4, title: \"Business Info\", icon: Briefcase },\n  ];\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Building2 className=\"h-6 w-6 text-primary\" />\n          Register Your Company\n        </CardTitle>\n        <CardDescription>\n          Get your unique Company Server ID and Admin Access\n        </CardDescription>\n        \n        <div className=\"flex justify-between items-center mt-6\">\n          {steps.map((step, index) => {\n            const Icon = step.icon;\n            const isActive = currentStep === step.number;\n            const isCompleted = currentStep > step.number;\n            \n            return (\n              <div key={step.number} className=\"flex items-center flex-1\">\n                <div className=\"flex flex-col items-center flex-1\">\n                  <div\n                    className={`flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all ${\n                      isCompleted\n                        ? \"bg-primary border-primary text-primary-foreground\"\n                        : isActive\n                        ? \"border-primary text-primary bg-primary/10\"\n                        : \"border-gray-300 dark:border-gray-600 text-gray-400\"\n                    }`}\n                    data-testid={`step-indicator-${step.number}`}\n                  >\n                    {isCompleted ? \"✓\" : <Icon className=\"h-5 w-5\" />}\n                  </div>\n                  <span className={`text-xs mt-1 hidden sm:block ${isActive ? \"text-primary font-medium\" : \"text-muted-foreground\"}`}>\n                    {step.title}\n                  </span>\n                </div>\n                {index < steps.length - 1 && (\n                  <div\n                    className={`h-0.5 flex-1 ${\n                      isCompleted ? \"bg-primary\" : \"bg-gray-300 dark:bg-gray-600\"\n                    }`}\n                  />\n                )}\n              </div>\n            );\n          })}\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          {currentStep === 1 && (\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"fullName\">Full Name</Label>\n                <Input\n                  id=\"fullName\"\n                  type=\"text\"\n                  placeholder=\"John Doe\"\n                  value={formData.fullName}\n                  onChange={(e) => updateFormData(\"fullName\", e.target.value)}\n                  data-testid=\"input-fullname\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email Address</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"admin@company.com\"\n                  value={formData.email}\n                  onChange={(e) => updateFormData(\"email\", e.target.value)}\n                  data-testid=\"input-email\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Password</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"Create a strong password\"\n                  value={formData.password}\n                  onChange={(e) => updateFormData(\"password\", e.target.value)}\n                  data-testid=\"input-password\"\n                />\n                <PasswordStrengthMeter password={formData.password} />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirmPassword\">Confirm Password</Label>\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  placeholder=\"Re-enter your password\"\n                  value={formData.confirmPassword}\n                  onChange={(e) => updateFormData(\"confirmPassword\", e.target.value)}\n                  data-testid=\"input-confirm-password\"\n                />\n              </div>\n              \n              <div className=\"flex items-start space-x-2\">\n                <Checkbox\n                  id=\"acceptTerms\"\n                  checked={formData.acceptTerms}\n                  onCheckedChange={(checked) => updateFormData(\"acceptTerms\", checked as boolean)}\n                  data-testid=\"checkbox-accept-terms\"\n                />\n                <Label htmlFor=\"acceptTerms\" className=\"text-sm leading-none\">\n                  I accept the{\" \"}\n                  <a href=\"#\" className=\"text-primary hover:underline\">\n                    Terms & Conditions\n                  </a>\n                </Label>\n              </div>\n            </div>\n          )}\n\n          {currentStep === 2 && (\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"name\">Company Name</Label>\n                <Input\n                  id=\"name\"\n                  type=\"text\"\n                  placeholder=\"Acme Tech Pvt Ltd\"\n                  value={formData.name}\n                  onChange={(e) => updateFormData(\"name\", e.target.value)}\n                  data-testid=\"input-company-name\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"companyType\">Company Type</Label>\n                <Select value={formData.companyType} onValueChange={(value) => updateFormData(\"companyType\", value)}>\n                  <SelectTrigger data-testid=\"select-company-type\">\n                    <SelectValue placeholder=\"Select company type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"contractor\">Contractor</SelectItem>\n                    <SelectItem value=\"builder\">Builder</SelectItem>\n                    <SelectItem value=\"developer\">Developer</SelectItem>\n                    <SelectItem value=\"supplier\">Supplier</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"contactPerson\">Contact Person</Label>\n                <Input\n                  id=\"contactPerson\"\n                  type=\"text\"\n                  placeholder=\"John Doe\"\n                  value={formData.contactPerson}\n                  onChange={(e) => updateFormData(\"contactPerson\", e.target.value)}\n                  data-testid=\"input-contact-person\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"designation\">Designation</Label>\n                <Select value={formData.designation} onValueChange={(value) => updateFormData(\"designation\", value)}>\n                  <SelectTrigger data-testid=\"select-designation\">\n                    <SelectValue placeholder=\"Select designation\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"owner\">Owner</SelectItem>\n                    <SelectItem value=\"manager\">Manager</SelectItem>\n                    <SelectItem value=\"engineer\">Engineer</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"mobile\">Mobile Number</Label>\n                <Input\n                  id=\"mobile\"\n                  type=\"tel\"\n                  placeholder=\"9876543210\"\n                  value={formData.mobile}\n                  onChange={(e) => updateFormData(\"mobile\", e.target.value.replace(/\\D/g, ''))}\n                  maxLength={10}\n                  data-testid=\"input-mobile\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"website\">Company Website <span className=\"text-muted-foreground text-xs\">(Optional)</span></Label>\n                <Input\n                  id=\"website\"\n                  type=\"url\"\n                  placeholder=\"https://yourcompany.com\"\n                  value={formData.website}\n                  onChange={(e) => updateFormData(\"website\", e.target.value)}\n                  data-testid=\"input-website\"\n                />\n              </div>\n            </div>\n          )}\n\n          {currentStep === 3 && (\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"address\">Address</Label>\n                <Textarea\n                  id=\"address\"\n                  placeholder=\"Full address\"\n                  value={formData.address}\n                  onChange={(e) => updateFormData(\"address\", e.target.value)}\n                  rows={3}\n                  data-testid=\"input-address\"\n                />\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"pincode\">Pincode</Label>\n                  <Input\n                    id=\"pincode\"\n                    type=\"text\"\n                    placeholder=\"638001\"\n                    value={formData.pincode}\n                    onChange={(e) => updateFormData(\"pincode\", e.target.value.replace(/\\D/g, ''))}\n                    maxLength={6}\n                    data-testid=\"input-pincode\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"city\">City</Label>\n                  <Input\n                    id=\"city\"\n                    type=\"text\"\n                    placeholder=\"Mumbai\"\n                    value={formData.city}\n                    onChange={(e) => updateFormData(\"city\", e.target.value)}\n                    data-testid=\"input-city\"\n                  />\n                </div>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"state\">State</Label>\n                  <Input\n                    id=\"state\"\n                    type=\"text\"\n                    placeholder=\"Maharashtra\"\n                    value={formData.state}\n                    onChange={(e) => updateFormData(\"state\", e.target.value)}\n                    data-testid=\"input-state\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"country\">Country</Label>\n                  <Input\n                    id=\"country\"\n                    type=\"text\"\n                    placeholder=\"India\"\n                    value={formData.country}\n                    onChange={(e) => updateFormData(\"country\", e.target.value)}\n                    data-testid=\"input-country\"\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n\n          {currentStep === 4 && (\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"employees\">Number of Employees</Label>\n                <Input\n                  id=\"employees\"\n                  type=\"number\"\n                  placeholder=\"25\"\n                  value={formData.employees}\n                  onChange={(e) => updateFormData(\"employees\", e.target.value)}\n                  min=\"1\"\n                  data-testid=\"input-employees\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"annualTurnover\">Average Annual Turnover</Label>\n                <Select value={formData.annualTurnover} onValueChange={(value) => updateFormData(\"annualTurnover\", value)}>\n                  <SelectTrigger data-testid=\"select-turnover\">\n                    <SelectValue placeholder=\"Select turnover range\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"< ₹1 Cr\">{'< ₹1 Cr'}</SelectItem>\n                    <SelectItem value=\"₹1-10 Cr\">₹1-10 Cr</SelectItem>\n                    <SelectItem value=\"₹10-50 Cr\">₹10-50 Cr</SelectItem>\n                    <SelectItem value=\"> ₹50 Cr\">{'>  ₹50 Cr'}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"yearEstablished\">Year Established</Label>\n                <Input\n                  id=\"yearEstablished\"\n                  type=\"number\"\n                  placeholder=\"2005\"\n                  value={formData.yearEstablished}\n                  onChange={(e) => updateFormData(\"yearEstablished\", e.target.value)}\n                  min=\"1800\"\n                  max={new Date().getFullYear()}\n                  data-testid=\"input-year-established\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">Company Description <span className=\"text-muted-foreground text-xs\">(Optional)</span></Label>\n                <Textarea\n                  id=\"description\"\n                  placeholder=\"Short company intro\"\n                  value={formData.description}\n                  onChange={(e) => updateFormData(\"description\", e.target.value)}\n                  rows={3}\n                  data-testid=\"input-description\"\n                />\n              </div>\n            </div>\n          )}\n\n          {error && (\n            <p className=\"text-sm text-red-500\" data-testid=\"error-message\">\n              {error}\n            </p>\n          )}\n\n          <div className=\"flex gap-3\">\n            {currentStep > 1 && (\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={handleBack}\n                className=\"flex-1\"\n                data-testid=\"button-back\"\n              >\n                <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                Back\n              </Button>\n            )}\n            \n            {currentStep < 4 ? (\n              <Button\n                type=\"button\"\n                onClick={handleNext}\n                className=\"flex-1\"\n                data-testid=\"button-next\"\n              >\n                Next\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            ) : (\n              <Button\n                type=\"submit\"\n                className=\"flex-1\"\n                disabled={isLoading}\n                data-testid=\"button-register-company\"\n              >\n                {isLoading ? \"Registering...\" : \"🚀 Register Company\"}\n              </Button>\n            )}\n          </div>\n\n          <div className=\"text-center text-sm text-muted-foreground\">\n            Already have an account?{\" \"}\n            <Link href=\"/login/admin\" className=\"text-primary hover:underline\" data-testid=\"link-to-admin-login\">\n              Company Admin Login\n            </Link>\n          </div>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":22578,"size_tokens":null},"client/src/pages/admin/Users.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuTrigger,\n    DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient, API_BASE_URL } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport type { User } from \"@shared/schema\";\nimport {\n    Plus,\n    Users as UsersIcon,\n    Copy,\n    CheckCircle,\n    Users2,\n    Search,\n    MoreVertical,\n    Eye,\n    Ban,\n    CheckCircle2,\n    UserCircle,\n    Crown,\n    UserMinus,\n    Trash2,\n} from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\ninterface CompanyData {\n    id: number;\n    name: string;\n    maxAdmins: number;\n    maxMembers: number;\n    currentAdmins: number;\n    currentMembers: number;\n    isActive: boolean;\n}\n\nexport default function Users() {\n    const { toast } = useToast();\n    const { dbUserId, companyId, userRole } = useAuth();\n    const [, setLocation] = useLocation();\n    const [addUserDialogOpen, setAddUserDialogOpen] = useState(false);\n    const [credentialsDialogOpen, setCredentialsDialogOpen] = useState(false);\n    const [teamAssignmentDialogOpen, setTeamAssignmentDialogOpen] =\n        useState(false);\n    const [userDetailsDialogOpen, setUserDetailsDialogOpen] = useState(false);\n    const [selectedTeamLeader, setSelectedTeamLeader] = useState<User | null>(\n        null\n    );\n    const [selectedUserForDetails, setSelectedUserForDetails] =\n        useState<User | null>(null);\n    const [memberSearchQuery, setMemberSearchQuery] = useState(\"\");\n    const [selectedMemberIds, setSelectedMemberIds] = useState<Set<number>>(\n        new Set()\n    );\n    const [createdUserCredentials, setCreatedUserCredentials] = useState<{\n        email: string;\n        password: string;\n        uniqueUserId: string;\n        displayName: string;\n    } | null>(null);\n    const [copiedField, setCopiedField] = useState<string | null>(null);\n    const [userForm, setUserForm] = useState({\n        email: \"\",\n        displayName: \"\",\n        password: \"\",\n        role: \"company_member\",\n    });\n\n    const { data: allUsers = [], isLoading: usersLoading } = useQuery<User[]>({\n        queryKey: [\"/api/users?includeDeleted=true\"],\n    });\n\n    const { data: company } = useQuery<CompanyData>({\n        queryKey: [\"/api/my-company\"],\n        enabled: !!companyId && !!dbUserId && userRole === \"company_admin\",\n    });\n\n    // Fetch all team assignments to show counts on team leader cards\n    const { data: allTeamAssignments = [] } = useQuery<\n        Array<{ teamLeaderId: number; memberId: number }>\n    >({\n        queryKey: [\"/api/team-assignments\"],\n        enabled: userRole === \"company_admin\",\n    });\n\n    const activeUsers = allUsers.filter((u) => u.isActive !== false);\n    const suspendedUsers = allUsers.filter((u) => u.isActive === false);\n\n    const adminSlots = company\n        ? {\n              current: company.currentAdmins,\n              max: company.maxAdmins,\n              available: company.maxAdmins - company.currentAdmins,\n          }\n        : null;\n    const memberSlots = company\n        ? {\n              current: company.currentMembers,\n              max: company.maxMembers,\n              available: company.maxMembers - company.currentMembers,\n          }\n        : null;\n\n    const toggleUserStatusMutation = useMutation({\n        mutationFn: async ({\n            userId,\n            isActive,\n        }: {\n            userId: number;\n            isActive: boolean;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/users/${userId}/status`,\n                \"PATCH\",\n                { isActive }\n            );\n        },\n        onSuccess: (_, variables) => {\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/users?includeDeleted=true\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/my-company\"],\n            });\n            toast({\n                title: `User ${\n                    variables.isActive ? \"activated\" : \"suspended\"\n                } successfully`,\n                description: `The user has been ${\n                    variables.isActive ? \"activated\" : \"suspended\"\n                }.`,\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to update user status\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const createUserMutation = useMutation({\n        mutationFn: async (userData: typeof userForm) => {\n            const response = await apiRequest(\n                `${API_BASE_URL}/api/users`,\n                \"POST\",\n                userData\n            );\n            return (await response.json()) as User;\n        },\n        onSuccess: (data: User) => {\n            setCreatedUserCredentials({\n                email: data.email,\n                password: userForm.password,\n                uniqueUserId: data.uniqueUserId,\n                displayName: data.displayName,\n            });\n            setUserForm({\n                email: \"\",\n                displayName: \"\",\n                password: \"\",\n                role: \"company_member\",\n            });\n            setAddUserDialogOpen(false);\n            setCredentialsDialogOpen(true);\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/users?includeDeleted=true\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/my-company\"],\n            });\n\n            // If team leader was created, open team assignment dialog\n            if (data.role === \"team_leader\") {\n                setSelectedTeamLeader(data);\n                setTimeout(() => {\n                    setCredentialsDialogOpen(false);\n                    setTeamAssignmentDialogOpen(true);\n                }, 2000);\n            }\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Failed to add user\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    // Lazy-load team assignments when dialog opens\n    const { data: teamAssignments = [], isLoading: teamAssignmentsLoading } =\n        useQuery<User[]>({\n            queryKey: [\n                \"/api/team-assignments\",\n                selectedTeamLeader?.id,\n                \"members\",\n            ],\n            queryFn: async () => {\n                if (!selectedTeamLeader) return [];\n                const response = await fetch(\n                    `${API_BASE_URL}/api/team-assignments/${selectedTeamLeader.id}/members`\n                );\n                if (!response.ok)\n                    throw new Error(\"Failed to fetch team assignments\");\n                return response.json();\n            },\n            enabled: !!selectedTeamLeader && teamAssignmentDialogOpen,\n        });\n\n    // Mutation to assign team members\n    const assignTeamMembersMutation = useMutation({\n        mutationFn: async ({\n            teamLeaderId,\n            memberIds,\n        }: {\n            teamLeaderId: number;\n            memberIds: number[];\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/team-assignments`,\n                \"POST\",\n                { teamLeaderId, memberIds }\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Team members assigned successfully\",\n            });\n            setSelectedMemberIds(new Set());\n            queryClient.invalidateQueries({\n                queryKey: [\n                    \"/api/team-assignments\",\n                    selectedTeamLeader?.id,\n                    \"members\",\n                ],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/team-assignments\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/users?includeDeleted=true\"],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to assign team members\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    // Mutation to remove team member\n    const removeTeamMemberMutation = useMutation({\n        mutationFn: async ({\n            teamLeaderId,\n            memberId,\n        }: {\n            teamLeaderId: number;\n            memberId: number;\n        }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/team-assignments/${teamLeaderId}/members/${memberId}`,\n                \"DELETE\"\n            );\n        },\n        onSuccess: () => {\n            toast({\n                title: \"Team member removed successfully\",\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\n                    \"/api/team-assignments\",\n                    selectedTeamLeader?.id,\n                    \"members\",\n                ],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/team-assignments\"],\n            });\n            queryClient.invalidateQueries({\n                queryKey: [\"/api/users?includeDeleted=true\"],\n            });\n        },\n        onError: (error) => {\n            toast({\n                title: \"Failed to remove team member\",\n                description: error.message,\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const promoteToTeamLeaderMutation = useMutation({\n        mutationFn: async ({ userId }: { userId: number }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/users/${userId}/role`,\n                \"PATCH\",\n                { role: \"team_leader\" }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/users?includeDeleted=true\"] });\n            queryClient.invalidateQueries({ queryKey: [\"/api/my-company\"] });\n            toast({\n                title: \"User promoted successfully\",\n                description: \"The user has been promoted to Team Leader.\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Failed to promote user\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const demoteToMemberMutation = useMutation({\n        mutationFn: async ({ userId }: { userId: number }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/users/${userId}/role`,\n                \"PATCH\",\n                { role: \"company_member\" }\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/users?includeDeleted=true\"] });\n            queryClient.invalidateQueries({ queryKey: [\"/api/team-assignments\"] });\n            queryClient.invalidateQueries({ queryKey: [\"/api/my-company\"] });\n            toast({\n                title: \"User demoted successfully\",\n                description: \"The user has been demoted to Company Member.\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Failed to demote user\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const permanentlyDeleteUserMutation = useMutation({\n        mutationFn: async ({ userId }: { userId: number }) => {\n            return await apiRequest(\n                `${API_BASE_URL}/api/users/${userId}/permanent`,\n                \"DELETE\"\n            );\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/users?includeDeleted=true\"] });\n            queryClient.invalidateQueries({ queryKey: [\"/api/team-assignments\"] });\n            queryClient.invalidateQueries({ queryKey: [\"/api/my-company\"] });\n            toast({\n                title: \"User permanently deleted\",\n                description: \"The user and all their data have been permanently removed.\",\n            });\n        },\n        onError: (error: any) => {\n            toast({\n                title: \"Failed to delete user\",\n                description: error.message || \"Please try again.\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const copyToClipboard = async (text: string, field: string) => {\n        try {\n            if (navigator.clipboard && window.isSecureContext) {\n                await navigator.clipboard.writeText(text);\n            } else {\n                // Fallback for HTTP / cPanel\n                const textarea = document.createElement(\"textarea\");\n                textarea.value = text;\n                textarea.style.position = \"fixed\";\n                textarea.style.opacity = \"0\";\n                document.body.appendChild(textarea);\n                textarea.focus();\n                textarea.select();\n                document.execCommand(\"copy\");\n                document.body.removeChild(textarea);\n            }\n\n            setCopiedField(field);\n            toast({\n                title: \"Copied to clipboard\",\n                description: `${field} has been copied`,\n            });\n\n            setTimeout(() => setCopiedField(null), 2000);\n        } catch {\n            toast({\n                title: \"Failed to copy\",\n                description: \"Please copy manually\",\n                variant: \"destructive\",\n            });\n        }\n    };\n\n    const canAddAdmin = !adminSlots || adminSlots.available > 0;\n    const canAddMember = !memberSlots || memberSlots.available > 0;\n\n    // Get all allocated member IDs across all team leaders\n    const allAllocatedMemberIds = useMemo(() => {\n        return new Set(allTeamAssignments.map((ta) => ta.memberId));\n    }, [allTeamAssignments]);\n\n    // Memoized list of assignable company members (excludes admins, team leaders, and already allocated members)\n    const assignableMembers = useMemo(() => {\n        return activeUsers.filter(\n            (u) =>\n                u.role === \"company_member\" && !allAllocatedMemberIds.has(u.id)\n        );\n    }, [activeUsers, allAllocatedMemberIds]);\n\n    // Memoized filtered list based on search query\n    const filteredAssignableMembers = useMemo(() => {\n        if (!memberSearchQuery.trim()) return assignableMembers;\n        const query = memberSearchQuery.toLowerCase();\n        return assignableMembers.filter(\n            (m) =>\n                m.displayName.toLowerCase().includes(query) ||\n                m.email.toLowerCase().includes(query)\n        );\n    }, [assignableMembers, memberSearchQuery]);\n\n    // Set of currently assigned member IDs for quick lookup\n    const assignedMemberIds = useMemo(() => {\n        return new Set(teamAssignments.map((m) => m.id));\n    }, [teamAssignments]);\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h2 className=\"text-2xl sm:text-3xl font-bold\">\n                        User Management\n                    </h2>\n                    <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                        Manage users and their roles\n                    </p>\n                </div>\n                {userRole === \"company_admin\" && (\n                    <Button\n                        onClick={() => setAddUserDialogOpen(true)}\n                        data-testid=\"button-add-user\">\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        Add User\n                    </Button>\n                )}\n            </div>\n\n            {/* Slot Availability (for company admins) */}\n            {company && userRole === \"company_admin\" && (\n                <Card data-testid=\"card-slot-availability\">\n                    <CardContent className=\"p-4\">\n                        <div className=\"flex items-center gap-4\">\n                            <UsersIcon className=\"h-8 w-8 text-muted-foreground\" />\n                            <div className=\"flex-1 grid grid-cols-2 gap-4\">\n                                <div>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                        Admin Slots\n                                    </p>\n                                    <p\n                                        className=\"text-lg font-semibold\"\n                                        data-testid=\"text-admin-slots-available\">\n                                        {adminSlots?.available} /{\" \"}\n                                        {adminSlots?.max} available\n                                    </p>\n                                </div>\n                                <div>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                        Member Slots\n                                    </p>\n                                    <p\n                                        className=\"text-lg font-semibold\"\n                                        data-testid=\"text-member-slots-available\">\n                                        {memberSlots?.available} /{\" \"}\n                                        {memberSlots?.max} available\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n\n            <Card>\n                <CardHeader>\n                    <CardTitle className=\"text-lg sm:text-xl\">\n                        Active Users ({activeUsers.length})\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    {usersLoading ? (\n                        <div className=\"flex items-center justify-center py-8\">\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                        </div>\n                    ) : activeUsers.length > 0 ? (\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4\">\n                            {activeUsers.map((user) => (\n                                <Card\n                                    key={user.id}\n                                    data-testid={`card-user-${user.id}`}\n                                    className=\"hover:shadow-md transition-shadow\">\n                                    <CardContent className=\"p-4\">\n                                        <div className=\"flex items-start gap-3\">\n                                            <Avatar className=\"h-12 w-12 ring-2 ring-background\">\n                                                <AvatarImage\n                                                    src={user.photoURL || \"\"}\n                                                />\n                                                <AvatarFallback className=\"bg-primary text-primary-foreground font-semibold\">\n                                                    {user.displayName\n                                                        .split(\" \")\n                                                        .map((n) => n[0])\n                                                        .join(\"\")\n                                                        .toUpperCase()}\n                                                </AvatarFallback>\n                                            </Avatar>\n                                            <div className=\"flex-1 min-w-0 space-y-1\">\n                                                <h4 className=\"font-semibold text-base truncate\">\n                                                    {user.displayName}\n                                                </h4>\n                                                <p className=\"text-xs text-muted-foreground truncate\">\n                                                    {user.email}\n                                                </p>\n                                                <div className=\"flex items-center gap-2 flex-wrap\">\n                                                    <Badge\n                                                        variant={\n                                                            user.role ===\n                                                                \"company_admin\" ||\n                                                            user.role ===\n                                                                \"team_leader\"\n                                                                ? \"default\"\n                                                                : \"secondary\"\n                                                        }\n                                                        className=\"text-xs mt-1\">\n                                                        {user.role.replace(\n                                                            \"_\",\n                                                            \" \"\n                                                        )}\n                                                    </Badge>\n                                                </div>\n                                            </div>\n                                            {user.role !== \"company_admin\" && (\n                                                <DropdownMenu>\n                                                    <DropdownMenuTrigger\n                                                        asChild>\n                                                        <Button\n                                                            variant=\"ghost\"\n                                                            size=\"icon\"\n                                                            className=\"h-8 w-8\"\n                                                            data-testid={`button-user-menu-${user.id}`}>\n                                                            <MoreVertical className=\"h-4 w-4\" />\n                                                        </Button>\n                                                    </DropdownMenuTrigger>\n                                                    <DropdownMenuContent align=\"end\">\n                                                        {user.role ===\n                                                            \"team_leader\" && (\n                                                            <>\n                                                                <DropdownMenuItem\n                                                                    onClick={() => {\n                                                                        setLocation(\n                                                                            `/admin/team-members/${user.id}`\n                                                                        );\n                                                                    }}\n                                                                    data-testid={`menu-view-team-members-${user.id}`}>\n                                                                    <Users2 className=\"h-4 w-4 mr-2\" />\n                                                                    View Team\n                                                                    Members\n                                                                </DropdownMenuItem>\n                                                                <DropdownMenuItem\n                                                                    onClick={() => {\n                                                                        setSelectedUserForDetails(\n                                                                            user\n                                                                        );\n                                                                        setUserDetailsDialogOpen(\n                                                                            true\n                                                                        );\n                                                                    }}\n                                                                    data-testid={`menu-view-details-${user.id}`}>\n                                                                    <UserCircle className=\"h-4 w-4 mr-2\" />\n                                                                    View Details\n                                                                </DropdownMenuItem>\n                                                                <DropdownMenuItem\n                                                                    onClick={() => demoteToMemberMutation.mutate({ userId: user.id })}\n                                                                    disabled={demoteToMemberMutation.isPending}\n                                                                    data-testid={`menu-demote-${user.id}`}>\n                                                                    <UserMinus className=\"h-4 w-4 mr-2\" />\n                                                                    Revoke Team Leader\n                                                                </DropdownMenuItem>\n                                                                <DropdownMenuSeparator />\n                                                            </>\n                                                        )}\n                                                        {user.role ===\n                                                            \"company_member\" && (\n                                                            <>\n                                                                <DropdownMenuItem\n                                                                    onClick={() => {\n                                                                        setSelectedUserForDetails(\n                                                                            user\n                                                                        );\n                                                                        setUserDetailsDialogOpen(\n                                                                            true\n                                                                        );\n                                                                    }}\n                                                                    data-testid={`menu-view-details-${user.id}`}>\n                                                                    <Eye className=\"h-4 w-4 mr-2\" />\n                                                                    View Details\n                                                                </DropdownMenuItem>\n                                                                <DropdownMenuItem\n                                                                    onClick={() => promoteToTeamLeaderMutation.mutate({ userId: user.id })}\n                                                                    disabled={promoteToTeamLeaderMutation.isPending}\n                                                                    data-testid={`menu-promote-${user.id}`}>\n                                                                    <Crown className=\"h-4 w-4 mr-2\" />\n                                                                    Promote to Team Leader\n                                                                </DropdownMenuItem>\n                                                                <DropdownMenuSeparator />\n                                                            </>\n                                                        )}\n                                                        <DropdownMenuItem\n                                                            className=\"text-destructive\"\n                                                            onClick={() =>\n                                                                toggleUserStatusMutation.mutate(\n                                                                    {\n                                                                        userId: user.id,\n                                                                        isActive:\n                                                                            false,\n                                                                    }\n                                                                )\n                                                            }\n                                                            disabled={\n                                                                toggleUserStatusMutation.isPending\n                                                            }\n                                                            data-testid={`menu-suspend-user-${user.id}`}>\n                                                            <Ban className=\"h-4 w-4 mr-2\" />\n                                                            Suspend\n                                                        </DropdownMenuItem>\n                                                    </DropdownMenuContent>\n                                                </DropdownMenu>\n                                            )}\n                                        </div>\n                                        {user.role === \"team_leader\" && (\n                                            <div className=\"space-y-2 mt-4 pt-3 border-t\">\n                                                <div className=\"text-center\">\n                                                    <p className=\"text-xs text-muted-foreground\">\n                                                        Team Members\n                                                    </p>\n                                                    <p\n                                                        className=\"text-lg font-bold\"\n                                                        data-testid={`text-member-count-${user.id}`}>\n                                                        {\n                                                            allTeamAssignments.filter(\n                                                                (ta) =>\n                                                                    ta.teamLeaderId ===\n                                                                    user.id\n                                                            ).length\n                                                        }\n                                                    </p>\n                                                </div>\n                                                <Button\n                                                    variant=\"outline\"\n                                                    size=\"sm\"\n                                                    className=\"w-full text-xs h-8\"\n                                                    data-testid={`button-manage-team-${user.id}`}\n                                                    onClick={() => {\n                                                        setSelectedTeamLeader(\n                                                            user\n                                                        );\n                                                        setTeamAssignmentDialogOpen(\n                                                            true\n                                                        );\n                                                    }}>\n                                                    <Users2 className=\"h-3 w-3 mr-1\" />\n                                                    Manage Team\n                                                </Button>\n                                            </div>\n                                        )}\n                                        {user.role === \"company_member\" && (\n                                            <div className=\"flex gap-2 mt-4 pt-3 border-t\">\n                                                <Button\n                                                    variant=\"ghost\"\n                                                    size=\"sm\"\n                                                    className=\"flex-1 text-destructive hover:text-destructive hover:bg-destructive/10 text-xs h-8\"\n                                                    data-testid={`button-suspend-user-${user.id}`}\n                                                    onClick={() =>\n                                                        toggleUserStatusMutation.mutate(\n                                                            {\n                                                                userId: user.id,\n                                                                isActive: false,\n                                                            }\n                                                        )\n                                                    }\n                                                    disabled={\n                                                        toggleUserStatusMutation.isPending\n                                                    }>\n                                                    {toggleUserStatusMutation.isPending\n                                                        ? \"...\"\n                                                        : \"Suspend\"}\n                                                </Button>\n                                            </div>\n                                        )}\n                                    </CardContent>\n                                </Card>\n                            ))}\n                        </div>\n                    ) : (\n                        <div className=\"text-center py-8 text-muted-foreground\">\n                            No active users found\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n\n            {suspendedUsers.length > 0 && (\n                <Card>\n                    <CardHeader>\n                        <CardTitle className=\"text-lg sm:text-xl\">\n                            Suspended Users ({suspendedUsers.length})\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4\">\n                            {suspendedUsers.map((user) => (\n                                <Card\n                                    key={user.id}\n                                    className=\"opacity-60\"\n                                    data-testid={`card-suspended-user-${user.id}`}>\n                                    <CardContent className=\"p-3 sm:p-4\">\n                                        <div className=\"flex items-center gap-3 mb-3\">\n                                            <Avatar className=\"h-10 w-10 sm:h-12 sm:w-12\">\n                                                <AvatarImage\n                                                    src={user.photoURL || \"\"}\n                                                />\n                                                <AvatarFallback className=\"bg-muted text-muted-foreground text-xs sm:text-sm\">\n                                                    {user.displayName\n                                                        .split(\" \")\n                                                        .map((n) => n[0])\n                                                        .join(\"\")\n                                                        .toUpperCase()}\n                                                </AvatarFallback>\n                                            </Avatar>\n                                            <div className=\"flex-1 min-w-0\">\n                                                <h4 className=\"font-semibold text-sm sm:text-base truncate\">\n                                                    {user.displayName}\n                                                </h4>\n                                                <p className=\"text-xs sm:text-sm text-muted-foreground truncate\">\n                                                    {user.email}\n                                                </p>\n                                            </div>\n                                        </div>\n                                        <div className=\"flex items-center justify-between gap-2\">\n                                            <Badge\n                                                variant=\"outline\"\n                                                className=\"text-xs\">\n                                                Suspended\n                                            </Badge>\n                                            <div className=\"flex gap-2\">\n                                                <Button\n                                                    variant=\"outline\"\n                                                    size=\"sm\"\n                                                    className=\"h-7 text-xs\"\n                                                    data-testid={`button-activate-user-${user.id}`}\n                                                    onClick={() =>\n                                                        toggleUserStatusMutation.mutate(\n                                                            {\n                                                                userId: user.id,\n                                                                isActive: true,\n                                                            }\n                                                        )\n                                                    }\n                                                    disabled={\n                                                        toggleUserStatusMutation.isPending\n                                                    }>\n                                                    <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                                                    Activate\n                                                </Button>\n                                                <Button\n                                                    variant=\"destructive\"\n                                                    size=\"sm\"\n                                                    className=\"h-7 text-xs\"\n                                                    data-testid={`button-permanently-delete-user-${user.id}`}\n                                                    onClick={() => {\n                                                        if (confirm(`Are you sure you want to permanently delete ${user.displayName}? This action cannot be undone and will remove all their data.`)) {\n                                                            permanentlyDeleteUserMutation.mutate({ userId: user.id });\n                                                        }\n                                                    }}\n                                                    disabled={\n                                                        permanentlyDeleteUserMutation.isPending\n                                                    }>\n                                                    <Trash2 className=\"h-3 w-3 mr-1\" />\n                                                    Delete\n                                                </Button>\n                                            </div>\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            ))}\n                        </div>\n                    </CardContent>\n                </Card>\n            )}\n\n            <Dialog\n                open={addUserDialogOpen}\n                onOpenChange={setAddUserDialogOpen}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>Add New User</DialogTitle>\n                        <DialogDescription>\n                            Create a new user account for your company\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"user-email\">Email</Label>\n                            <Input\n                                id=\"user-email\"\n                                type=\"email\"\n                                placeholder=\"user@example.com\"\n                                value={userForm.email}\n                                onChange={(e) =>\n                                    setUserForm({\n                                        ...userForm,\n                                        email: e.target.value,\n                                    })\n                                }\n                                data-testid=\"input-user-email\"\n                            />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"user-displayname\">\n                                Display Name\n                            </Label>\n                            <Input\n                                id=\"user-displayname\"\n                                placeholder=\"John Doe\"\n                                value={userForm.displayName}\n                                onChange={(e) =>\n                                    setUserForm({\n                                        ...userForm,\n                                        displayName: e.target.value,\n                                    })\n                                }\n                                data-testid=\"input-user-displayname\"\n                            />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"user-password\">Password</Label>\n                            <Input\n                                id=\"user-password\"\n                                type=\"password\"\n                                placeholder=\"********\"\n                                value={userForm.password}\n                                onChange={(e) =>\n                                    setUserForm({\n                                        ...userForm,\n                                        password: e.target.value,\n                                    })\n                                }\n                                data-testid=\"input-user-password\"\n                            />\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"user-role\">Role</Label>\n                            <Select\n                                value={userForm.role}\n                                onValueChange={(value) =>\n                                    setUserForm({ ...userForm, role: value })\n                                }>\n                                <SelectTrigger\n                                    id=\"user-role\"\n                                    data-testid=\"select-user-role\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem\n                                        value=\"company_admin\"\n                                        disabled={!canAddAdmin}>\n                                        Admin{\" \"}\n                                        {!canAddAdmin &&\n                                            `(${adminSlots?.available}/${adminSlots?.max} slots)`}\n                                    </SelectItem>\n                                    <SelectItem\n                                        value=\"team_leader\"\n                                        disabled={!canAddMember}>\n                                        Team Leader{\" \"}\n                                        {!canAddMember &&\n                                            `(${memberSlots?.available}/${memberSlots?.max} slots)`}\n                                    </SelectItem>\n                                    <SelectItem\n                                        value=\"company_member\"\n                                        disabled={!canAddMember}>\n                                        Member{\" \"}\n                                        {!canAddMember &&\n                                            `(${memberSlots?.available}/${memberSlots?.max} slots)`}\n                                    </SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        {(!canAddAdmin || !canAddMember) && (\n                            <p\n                                className=\"text-sm text-amber-600\"\n                                data-testid=\"text-slot-warning\">\n                                {!canAddAdmin && \"Admin slots are full. \"}\n                                {!canAddMember && \"Member slots are full. \"}\n                                Upgrade your plan to add more users.\n                            </p>\n                        )}\n                        <Button\n                            onClick={() => createUserMutation.mutate(userForm)}\n                            disabled={\n                                !userForm.email ||\n                                !userForm.displayName ||\n                                !userForm.password ||\n                                createUserMutation.isPending ||\n                                (userForm.role === \"company_admin\" &&\n                                    !canAddAdmin) ||\n                                (userForm.role === \"team_leader\" &&\n                                    !canAddMember) ||\n                                (userForm.role === \"company_member\" &&\n                                    !canAddMember)\n                            }\n                            data-testid=\"button-submit-add-user\"\n                            className=\"w-full\">\n                            {createUserMutation.isPending\n                                ? \"Adding...\"\n                                : \"Add User\"}\n                        </Button>\n                    </div>\n                </DialogContent>\n            </Dialog>\n\n            <Dialog\n                open={credentialsDialogOpen}\n                onOpenChange={setCredentialsDialogOpen}>\n                <DialogContent className=\"max-w-2xl\">\n                    <DialogHeader>\n                        <DialogTitle className=\"flex items-center gap-2\">\n                            <CheckCircle className=\"h-6 w-6 text-green-600\" />\n                            User Created Successfully\n                        </DialogTitle>\n                        <DialogDescription>\n                            Share these credentials with the user so they can\n                            log in. They will need all three pieces of\n                            information.\n                        </DialogDescription>\n                    </DialogHeader>\n\n                    {createdUserCredentials && (\n                        <div className=\"space-y-4\">\n                            <Alert data-testid=\"alert-user-credentials\">\n                                <AlertDescription className=\"space-y-4\">\n                                    <div>\n                                        <p className=\"text-sm font-medium mb-2\">\n                                            Login Instructions for User:\n                                        </p>\n                                        <ol className=\"text-sm space-y-1 list-decimal list-inside text-muted-foreground\">\n                                            <li>\n                                                Go to the login page and select\n                                                \"Company User\" tab\n                                            </li>\n                                            <li>\n                                                Enter the Username, User ID, and\n                                                Password provided below\n                                            </li>\n                                            <li>\n                                                Click \"Login\" to access the\n                                                company dashboard\n                                            </li>\n                                        </ol>\n                                    </div>\n                                </AlertDescription>\n                            </Alert>\n\n                            <div className=\"space-y-3\">\n                                <div className=\"bg-muted p-4 rounded-lg space-y-1\">\n                                    <Label className=\"text-sm text-muted-foreground\">\n                                        Username (Display Name)\n                                    </Label>\n                                    <div className=\"flex items-center justify-between gap-2\">\n                                        <p\n                                            className=\"font-mono font-semibold\"\n                                            data-testid=\"text-created-username\">\n                                            {createdUserCredentials.displayName}\n                                        </p>\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={() =>\n                                                copyToClipboard(\n                                                    createdUserCredentials.displayName,\n                                                    \"Username\"\n                                                )\n                                            }\n                                            data-testid=\"button-copy-username\">\n                                            {copiedField === \"Username\" ? (\n                                                <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                                            ) : (\n                                                <Copy className=\"h-4 w-4\" />\n                                            )}\n                                        </Button>\n                                    </div>\n                                </div>\n\n                                <div className=\"bg-muted p-4 rounded-lg space-y-1\">\n                                    <Label className=\"text-sm text-muted-foreground\">\n                                        User ID (Required for Login)\n                                    </Label>\n                                    <div className=\"flex items-center justify-between gap-2\">\n                                        <p\n                                            className=\"font-mono font-semibold\"\n                                            data-testid=\"text-created-userid\">\n                                            {\n                                                createdUserCredentials.uniqueUserId\n                                            }\n                                        </p>\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={() =>\n                                                copyToClipboard(\n                                                    createdUserCredentials.uniqueUserId,\n                                                    \"User ID\"\n                                                )\n                                            }\n                                            data-testid=\"button-copy-userid\">\n                                            {copiedField === \"User ID\" ? (\n                                                <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                                            ) : (\n                                                <Copy className=\"h-4 w-4\" />\n                                            )}\n                                        </Button>\n                                    </div>\n                                </div>\n\n                                <div className=\"bg-muted p-4 rounded-lg space-y-1\">\n                                    <Label className=\"text-sm text-muted-foreground\">\n                                        Email\n                                    </Label>\n                                    <div className=\"flex items-center justify-between gap-2\">\n                                        <p\n                                            className=\"font-mono font-semibold\"\n                                            data-testid=\"text-created-email\">\n                                            {createdUserCredentials.email}\n                                        </p>\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={() =>\n                                                copyToClipboard(\n                                                    createdUserCredentials.email,\n                                                    \"Email\"\n                                                )\n                                            }\n                                            data-testid=\"button-copy-email\">\n                                            {copiedField === \"Email\" ? (\n                                                <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                                            ) : (\n                                                <Copy className=\"h-4 w-4\" />\n                                            )}\n                                        </Button>\n                                    </div>\n                                </div>\n\n                                <div className=\"bg-muted p-4 rounded-lg space-y-1\">\n                                    <Label className=\"text-sm text-muted-foreground\">\n                                        Password (Set by Admin)\n                                    </Label>\n                                    <div className=\"flex items-center justify-between gap-2\">\n                                        <p\n                                            className=\"font-mono font-semibold\"\n                                            data-testid=\"text-created-password\">\n                                            {createdUserCredentials.password}\n                                        </p>\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={() =>\n                                                copyToClipboard(\n                                                    createdUserCredentials.password,\n                                                    \"Password\"\n                                                )\n                                            }\n                                            data-testid=\"button-copy-password\">\n                                            {copiedField === \"Password\" ? (\n                                                <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                                            ) : (\n                                                <Copy className=\"h-4 w-4\" />\n                                            )}\n                                        </Button>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <Alert\n                                variant=\"default\"\n                                className=\"border-amber-200 bg-amber-50\">\n                                <AlertDescription className=\"text-sm text-amber-800\">\n                                    ⚠️ Important: Save these credentials now.\n                                    The password will not be shown again for\n                                    security reasons.\n                                </AlertDescription>\n                            </Alert>\n\n                            <Button\n                                onClick={() => {\n                                    setCredentialsDialogOpen(false);\n                                    setCreatedUserCredentials(null);\n                                }}\n                                className=\"w-full\"\n                                data-testid=\"button-close-credentials\">\n                                I've Saved the Credentials\n                            </Button>\n                        </div>\n                    )}\n                </DialogContent>\n            </Dialog>\n\n            {/* Team Assignment Dialog */}\n            <Dialog\n                open={teamAssignmentDialogOpen}\n                onOpenChange={setTeamAssignmentDialogOpen}>\n                <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n                    <DialogHeader>\n                        <DialogTitle className=\"flex items-center gap-2\">\n                            <Users2 className=\"h-5 w-5\" />\n                            Manage Team for {selectedTeamLeader?.displayName}\n                        </DialogTitle>\n                        <DialogDescription>\n                            Assign team members to this team leader. Only\n                            company members can be assigned to a team.\n                        </DialogDescription>\n                    </DialogHeader>\n\n                    <div className=\"space-y-4\">\n                        {/* Currently Assigned Members */}\n                        {teamAssignments.length > 0 && (\n                            <div className=\"space-y-2\">\n                                <Label className=\"text-sm font-semibold\">\n                                    Currently Assigned Members\n                                </Label>\n                                <div className=\"space-y-2\">\n                                    {teamAssignments.map((member) => (\n                                        <div\n                                            key={member.id}\n                                            className=\"flex items-center justify-between p-3 bg-muted rounded-md\"\n                                            data-testid={`assigned-member-${member.id}`}>\n                                            <div className=\"flex items-center gap-3\">\n                                                <Avatar className=\"h-8 w-8\">\n                                                    <AvatarImage\n                                                        src={\n                                                            member.photoURL ||\n                                                            \"\"\n                                                        }\n                                                    />\n                                                    <AvatarFallback className=\"text-xs\">\n                                                        {member.displayName\n                                                            .split(\" \")\n                                                            .map((n) => n[0])\n                                                            .join(\"\")\n                                                            .toUpperCase()}\n                                                    </AvatarFallback>\n                                                </Avatar>\n                                                <div>\n                                                    <p className=\"text-sm font-medium\">\n                                                        {member.displayName}\n                                                    </p>\n                                                    <p className=\"text-xs text-muted-foreground\">\n                                                        {member.email}\n                                                    </p>\n                                                </div>\n                                            </div>\n                                            <Button\n                                                variant=\"ghost\"\n                                                size=\"sm\"\n                                                className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                                                onClick={() => {\n                                                    if (selectedTeamLeader) {\n                                                        removeTeamMemberMutation.mutate(\n                                                            {\n                                                                teamLeaderId:\n                                                                    selectedTeamLeader.id,\n                                                                memberId:\n                                                                    member.id,\n                                                            }\n                                                        );\n                                                    }\n                                                }}\n                                                disabled={\n                                                    removeTeamMemberMutation.isPending\n                                                }\n                                                data-testid={`button-remove-member-${member.id}`}>\n                                                Remove\n                                            </Button>\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Add New Members */}\n                        <div className=\"space-y-2\">\n                            <Label className=\"text-sm font-semibold\">\n                                Add Team Members\n                            </Label>\n\n                            {/* Search Input */}\n                            <div className=\"relative\">\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                                <Input\n                                    placeholder=\"Search members by name or email...\"\n                                    value={memberSearchQuery}\n                                    onChange={(e) =>\n                                        setMemberSearchQuery(e.target.value)\n                                    }\n                                    className=\"pl-9\"\n                                    data-testid=\"input-search-members\"\n                                />\n                            </div>\n\n                            {/* Member List */}\n                            {teamAssignmentsLoading ? (\n                                <div className=\"flex items-center justify-center py-8\">\n                                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                                </div>\n                            ) : filteredAssignableMembers.length > 0 ? (\n                                <div className=\"space-y-2 max-h-60 overflow-y-auto border rounded-md p-2\">\n                                    {filteredAssignableMembers.map((member) => {\n                                        const isAssigned =\n                                            assignedMemberIds.has(member.id);\n                                        const isSelected =\n                                            selectedMemberIds.has(member.id);\n\n                                        return (\n                                            <div\n                                                key={member.id}\n                                                className={`flex items-center gap-3 p-2 rounded-md transition-colors ${\n                                                    isAssigned\n                                                        ? \"opacity-50 cursor-not-allowed\"\n                                                        : \"hover:bg-muted cursor-pointer\"\n                                                }`}\n                                                onClick={() => {\n                                                    if (!isAssigned) {\n                                                        const newSet = new Set(\n                                                            selectedMemberIds\n                                                        );\n                                                        if (isSelected) {\n                                                            newSet.delete(\n                                                                member.id\n                                                            );\n                                                        } else {\n                                                            newSet.add(\n                                                                member.id\n                                                            );\n                                                        }\n                                                        setSelectedMemberIds(\n                                                            newSet\n                                                        );\n                                                    }\n                                                }}\n                                                data-testid={`member-option-${member.id}`}>\n                                                <Checkbox\n                                                    checked={isSelected}\n                                                    disabled={isAssigned}\n                                                    data-testid={`checkbox-member-${member.id}`}\n                                                />\n                                                <Avatar className=\"h-8 w-8\">\n                                                    <AvatarImage\n                                                        src={\n                                                            member.photoURL ||\n                                                            \"\"\n                                                        }\n                                                    />\n                                                    <AvatarFallback className=\"text-xs\">\n                                                        {member.displayName\n                                                            .split(\" \")\n                                                            .map((n) => n[0])\n                                                            .join(\"\")\n                                                            .toUpperCase()}\n                                                    </AvatarFallback>\n                                                </Avatar>\n                                                <div className=\"flex-1\">\n                                                    <p className=\"text-sm font-medium\">\n                                                        {member.displayName}\n                                                    </p>\n                                                    <p className=\"text-xs text-muted-foreground\">\n                                                        {member.email}\n                                                    </p>\n                                                </div>\n                                                {isAssigned && (\n                                                    <Badge\n                                                        variant=\"secondary\"\n                                                        className=\"text-xs\">\n                                                        Already Assigned\n                                                    </Badge>\n                                                )}\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n                            ) : (\n                                <div className=\"text-center py-8 text-muted-foreground text-sm\">\n                                    {memberSearchQuery.trim()\n                                        ? \"No members match your search\"\n                                        : \"No available members to assign\"}\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Action Buttons */}\n                        <div className=\"flex gap-2\">\n                            <Button\n                                onClick={() => {\n                                    if (\n                                        selectedTeamLeader &&\n                                        selectedMemberIds.size > 0\n                                    ) {\n                                        assignTeamMembersMutation.mutate({\n                                            teamLeaderId: selectedTeamLeader.id,\n                                            memberIds:\n                                                Array.from(selectedMemberIds),\n                                        });\n                                    }\n                                }}\n                                disabled={\n                                    !selectedTeamLeader ||\n                                    selectedMemberIds.size === 0 ||\n                                    assignTeamMembersMutation.isPending\n                                }\n                                className=\"flex-1\"\n                                data-testid=\"button-assign-members\">\n                                {assignTeamMembersMutation.isPending\n                                    ? \"Assigning...\"\n                                    : `Assign Selected (${selectedMemberIds.size})`}\n                            </Button>\n                            <Button\n                                variant=\"outline\"\n                                onClick={() => {\n                                    setTeamAssignmentDialogOpen(false);\n                                    setSelectedTeamLeader(null);\n                                    setSelectedMemberIds(new Set());\n                                    setMemberSearchQuery(\"\");\n                                }}\n                                data-testid=\"button-close-team-dialog\">\n                                Close\n                            </Button>\n                        </div>\n                    </div>\n                </DialogContent>\n            </Dialog>\n\n            {/* User Details Dialog */}\n            <Dialog\n                open={userDetailsDialogOpen}\n                onOpenChange={setUserDetailsDialogOpen}>\n                <DialogContent className=\"max-w-md select-none\">\n                    <DialogHeader>\n                        <DialogTitle>User Details</DialogTitle>\n                        <DialogDescription>\n                            View user information\n                        </DialogDescription>\n                    </DialogHeader>\n\n                    {selectedUserForDetails && (\n                        <div className=\"space-y-4\">\n                            <div className=\"flex items-center gap-4 pb-4 border-b\">\n                                <Avatar className=\"h-16 w-16 ring-2 ring-primary/20\">\n                                    <AvatarImage\n                                        src={\n                                            selectedUserForDetails.photoURL ||\n                                            \"\"\n                                        }\n                                    />\n                                    <AvatarFallback className=\"bg-primary text-primary-foreground text-lg font-semibold\">\n                                        {selectedUserForDetails.displayName\n                                            .split(\" \")\n                                            .map((n) => n[0])\n                                            .join(\"\")\n                                            .toUpperCase()}\n                                    </AvatarFallback>\n                                </Avatar>\n                                <div>\n                                    <h3 className=\"text-lg font-semibold\">\n                                        {selectedUserForDetails.displayName}\n                                    </h3>\n                                    <Badge\n                                        variant={\n                                            selectedUserForDetails.role ===\n                                                \"company_admin\" ||\n                                            selectedUserForDetails.role ===\n                                                \"team_leader\"\n                                                ? \"default\"\n                                                : \"secondary\"\n                                        }>\n                                        {selectedUserForDetails.role.replace(\n                                            \"_\",\n                                            \" \"\n                                        )}\n                                    </Badge>\n                                </div>\n                            </div>\n\n                            <div className=\"space-y-3\">\n                                <div className=\"space-y-1\">\n                                    <Label className=\"text-xs text-muted-foreground\">\n                                        Email\n                                    </Label>\n                                    <div className=\"flex items-center justify-between gap-2 p-2 bg-muted rounded-md\">\n                                        <p\n                                            className=\"text-sm font-mono\"\n                                            data-testid=\"text-detail-email\">\n                                            {selectedUserForDetails.email}\n                                        </p>\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={() =>\n                                                copyToClipboard(\n                                                    selectedUserForDetails.email,\n                                                    \"Email\"\n                                                )\n                                            }\n                                            className=\"h-7\">\n                                            {copiedField === \"Email\" ? (\n                                                <CheckCircle className=\"h-3.5 w-3.5 text-green-600\" />\n                                            ) : (\n                                                <Copy className=\"h-3.5 w-3.5\" />\n                                            )}\n                                        </Button>\n                                    </div>\n                                </div>\n\n                                <div className=\"space-y-1\">\n                                    <Label className=\"text-xs text-muted-foreground\">\n                                        User ID\n                                    </Label>\n                                    <div className=\"flex items-center justify-between gap-2 p-2 bg-muted rounded-md\">\n                                        <p\n                                            className=\"text-sm font-mono\"\n                                            data-testid=\"text-detail-userid\">\n                                            {\n                                                selectedUserForDetails.uniqueUserId\n                                            }\n                                        </p>\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={() =>\n                                                copyToClipboard(\n                                                    selectedUserForDetails.uniqueUserId,\n                                                    \"User ID\"\n                                                )\n                                            }\n                                            className=\"h-7\">\n                                            {copiedField === \"User ID\" ? (\n                                                <CheckCircle className=\"h-3.5 w-3.5 text-green-600\" />\n                                            ) : (\n                                                <Copy className=\"h-3.5 w-3.5\" />\n                                            )}\n                                        </Button>\n                                    </div>\n                                </div>\n\n                                <div className=\"space-y-1\">\n                                    <Label className=\"text-xs text-muted-foreground\">\n                                        Username\n                                    </Label>\n                                    <div className=\"flex items-center justify-between gap-2 p-2 bg-muted rounded-md\">\n                                        <p\n                                            className=\"text-sm font-mono\"\n                                            data-testid=\"text-detail-username\">\n                                            {selectedUserForDetails.displayName}\n                                        </p>\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={() =>\n                                                copyToClipboard(\n                                                    selectedUserForDetails.displayName,\n                                                    \"Username\"\n                                                )\n                                            }\n                                            className=\"h-7\">\n                                            {copiedField === \"Username\" ? (\n                                                <CheckCircle className=\"h-3.5 w-3.5 text-green-600\" />\n                                            ) : (\n                                                <Copy className=\"h-3.5 w-3.5\" />\n                                            )}\n                                        </Button>\n                                    </div>\n                                </div>\n\n                                <Alert className=\"bg-amber-50 dark:bg-amber-950/20 border-amber-200 dark:border-amber-800\">\n                                    <AlertDescription className=\"text-xs text-amber-800 dark:text-amber-200\">\n                                        <strong>Security Note:</strong>{\" \"}\n                                        Passwords are encrypted and cannot be\n                                        displayed for security reasons. Users\n                                        must use the password set during account\n                                        creation.\n                                    </AlertDescription>\n                                </Alert>\n                            </div>\n\n                            <div className=\"flex gap-2 pt-2\">\n                                <Button\n                                    variant=\"outline\"\n                                    onClick={() => {\n                                        setUserDetailsDialogOpen(false);\n                                        setSelectedUserForDetails(null);\n                                    }}\n                                    className=\"flex-1\"\n                                    data-testid=\"button-close-details\">\n                                    Close\n                                </Button>\n                            </div>\n                        </div>\n                    )}\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","path":null,"size_bytes":82403,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/contexts/AuthContext.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from \"react\";\nimport { API_BASE_URL } from \"@/lib/queryClient\";\n\ninterface User {\n  id: number;\n  email: string;\n  displayName: string;\n  photoURL?: string | null;\n  role: \"super_admin\" | \"company_admin\" | \"company_member\" | \"team_leader\";\n  companyId?: number | null;\n  teamMemberIds?: number[];\n}\n\ninterface AuthContextType {\n  user: User | null;\n  loading: boolean;\n  loggingOut: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  signup: (email: string, displayName: string, password: string) => Promise<void>;\n  signOut: () => Promise<void>;\n  userRole: \"super_admin\" | \"company_admin\" | \"company_member\" | \"team_leader\" | null;\n  dbUserId: number | null;\n  companyId: number | null;\n  setUser: (user: User | null) => void;\n  setUserRole: (role: \"super_admin\" | \"company_admin\" | \"company_member\" | \"team_leader\" | null) => void;\n  setDbUserId: (id: number | null) => void;\n  setCompanyId: (id: number | null) => void;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [loggingOut, setLoggingOut] = useState(false);\n  const [userRole, setUserRole] = useState<\"super_admin\" | \"company_admin\" | \"company_member\" | \"team_leader\" | null>(null);\n  const [dbUserId, setDbUserId] = useState<number | null>(null);\n  const [companyId, setCompanyId] = useState<number | null>(null);\n\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user');\n    if (storedUser) {\n      const userData = JSON.parse(storedUser);\n      setUser(userData);\n      setUserRole(userData.role);\n      setDbUserId(userData.id);\n      setCompanyId(userData.companyId || null);\n    }\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    if (!user) return;\n\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const ws = new WebSocket(`${protocol}//${window.location.host}/ws`);\n\n    ws.onmessage = (event) => {\n      try {\n        const message = JSON.parse(event.data);\n        if (message.type === 'USER_SUSPENDED' && message.userId === user.id) {\n          localStorage.clear();\n          window.location.href = \"/worklogix/\";\n        }\n      } catch (error) {\n        console.error('Failed to parse WebSocket message:', error);\n      }\n    };\n\n    return () => {\n      ws.close();\n    };\n  }, [user]);\n\n  const login = async (email: string, password: string) => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/auth/login`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email, password }),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Login failed');\n      }\n      \n      const userData = await response.json();\n      setUser(userData);\n      setUserRole(userData.role);\n      setDbUserId(userData.id);\n      setCompanyId(userData.companyId || null);\n      localStorage.setItem('user', JSON.stringify(userData));\n    } catch (error) {\n      console.error(\"Error logging in:\", error);\n      throw error;\n    }\n  };\n\n  const signup = async (email: string, displayName: string, password: string) => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/auth/signup`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email, displayName, password }),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Signup failed');\n      }\n      \n      const userData = await response.json();\n      setUser(userData);\n      setUserRole(userData.role);\n      setDbUserId(userData.id);\n      setCompanyId(userData.companyId || null);\n      localStorage.setItem('user', JSON.stringify(userData));\n    } catch (error) {\n      console.error(\"Error signing up:\", error);\n      throw error;\n    }\n  };\n\n  const signOut = async () => {\n    setLoggingOut(true);\n    \n    setUser(null);\n    setUserRole(null);\n    setDbUserId(null);\n    setCompanyId(null);\n    localStorage.removeItem('user');\n    setLoggingOut(false);\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, loading, loggingOut, login, signup, signOut, userRole, dbUserId, companyId, setUser, setUserRole, setDbUserId, setCompanyId }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":4775,"size_tokens":null},"client/src/pages/user/Tasks.tsx":{"content":"import { useAuth } from \"@/contexts/AuthContext\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest, API_BASE_URL } from \"@/lib/queryClient\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n    CardDescription,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, Play, Pause, CheckCircle2 } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTaskUpdates } from \"@/hooks/useTaskUpdates\";\nimport type { Task } from \"@shared/schema\";\n\nexport default function Tasks() {\n    const { dbUserId } = useAuth();\n    const { toast } = useToast();\n    const [timerStates, setTimerStates] = useState<\n        Record<number, { isRunning: boolean; elapsed: number }>\n    >({});\n    const [timerIntervals, setTimerIntervals] = useState<\n        Record<number, NodeJS.Timeout>\n    >({});\n    const [completedTaskIds, setCompletedTaskIds] = useState<Set<number>>(\n        new Set()\n    );\n\n    // Load timer state from localStorage on mount\n    useEffect(() => {\n        const savedTimers = localStorage.getItem(\"memberTaskTimers\");\n        if (savedTimers) {\n            try {\n                setTimerStates(JSON.parse(savedTimers));\n            } catch (e) {\n                console.error(\"Failed to load timer state:\", e);\n            }\n        }\n\n        const savedCompletedIds = localStorage.getItem(\n            \"memberCompletedTaskIds\"\n        );\n        if (savedCompletedIds) {\n            try {\n                setCompletedTaskIds(new Set(JSON.parse(savedCompletedIds)));\n            } catch (e) {\n                console.error(\"Failed to load completed task IDs:\", e);\n            }\n        }\n    }, []);\n\n    // Listen to WebSocket updates to handle status changes\n    useEffect(() => {\n        const ws = new WebSocket(\n            `${window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\"}//${\n                window.location.host\n            }/ws`\n        );\n\n        ws.onopen = () => {\n            console.log(\"[WebSocket] Connected for task updates\");\n        };\n\n        ws.onmessage = (event) => {\n            try {\n                const message = JSON.parse(event.data);\n\n                if (message.type === \"task_updated\") {\n                    console.log(\"[WebSocket] Task update received:\", message);\n                    // If task was reverted to pending, clear it from completed\n                    if (message.status === \"pending\") {\n                        setCompletedTaskIds((prev) => {\n                            const updated = new Set(prev);\n                            updated.delete(message.taskId);\n                            // Update localStorage immediately\n                            localStorage.setItem(\n                                \"memberCompletedTaskIds\",\n                                JSON.stringify(Array.from(updated))\n                            );\n                            return updated;\n                        });\n                        // Also reset timer for this task\n                        setTimerStates((prev) => ({\n                            ...prev,\n                            [message.taskId]: { isRunning: false, elapsed: 0 },\n                        }));\n                        // Clear from localStorage\n                        localStorage.setItem(\n                            \"memberTaskTimers\",\n                            JSON.stringify({\n                                ...JSON.parse(\n                                    localStorage.getItem(\"memberTaskTimers\") ||\n                                        \"{}\"\n                                ),\n                                [message.taskId]: {\n                                    isRunning: false,\n                                    elapsed: 0,\n                                },\n                            })\n                        );\n                    }\n                    // Invalidate queries to force refetch\n                    queryClient.invalidateQueries({\n                        queryKey: [\"/api/tasks\", dbUserId],\n                    });\n                    queryClient.invalidateQueries({\n                        queryKey: [\"/api/dashboard/stats\"],\n                    });\n                }\n            } catch (error) {\n                console.error(\"[WebSocket] Error parsing message:\", error);\n            }\n        };\n\n        ws.onerror = (error) => {\n            console.error(\"[WebSocket] Error:\", error);\n        };\n\n        return () => {\n            ws.close();\n        };\n    }, [dbUserId]);\n\n    // Save timer state to localStorage\n    useEffect(() => {\n        localStorage.setItem(\"memberTaskTimers\", JSON.stringify(timerStates));\n    }, [timerStates]);\n\n    // Save completed task IDs to localStorage\n    useEffect(() => {\n        localStorage.setItem(\n            \"memberCompletedTaskIds\",\n            JSON.stringify(Array.from(completedTaskIds))\n        );\n    }, [completedTaskIds]);\n\n    const { data: tasks = [], isLoading } = useQuery<Task[]>({\n        queryKey: [\"/api/tasks\", dbUserId],\n        queryFn: async () => {\n            const user = localStorage.getItem(\"user\");\n            const userId = user ? JSON.parse(user).id : null;\n            const headers: Record<string, string> = {};\n            if (userId) {\n                headers[\"x-user-id\"] = userId.toString();\n            }\n\n            const res = await fetch(\n                `${API_BASE_URL}/api/tasks?userId=${dbUserId}`,\n                { headers, credentials: \"include\" }\n            );\n            if (!res.ok) throw new Error(\"Failed to fetch tasks\");\n            return res.json();\n        },\n        enabled: !!dbUserId,\n    });\n\n    const startTimer = (taskId: number) => {\n        setTimerStates((prev) => ({\n            ...prev,\n            [taskId]: { isRunning: true, elapsed: prev[taskId]?.elapsed || 0 },\n        }));\n\n        const interval = setInterval(() => {\n            setTimerStates((prev) => ({\n                ...prev,\n                [taskId]: {\n                    isRunning: true,\n                    elapsed: (prev[taskId]?.elapsed || 0) + 1,\n                },\n            }));\n        }, 1000);\n\n        setTimerIntervals((prev) => ({\n            ...prev,\n            [taskId]: interval,\n        }));\n    };\n\n    const pauseTimer = (taskId: number) => {\n        setTimerStates((prev) => ({\n            ...prev,\n            [taskId]: { ...prev[taskId], isRunning: false },\n        }));\n        if (timerIntervals[taskId]) {\n            clearInterval(timerIntervals[taskId]);\n        }\n    };\n\n    const completeTask = async (taskId: number) => {\n        try {\n            pauseTimer(taskId);\n            const timer = timerStates[taskId];\n            console.log(\"Completing task:\", taskId);\n\n            await apiRequest(\n                `${API_BASE_URL}/api/tasks/${taskId}/timer/complete`,\n                \"POST\",\n                {\n                    userId: dbUserId,\n                    date: new Date().toISOString().split(\"T\")[0],\n                    duration: timer?.elapsed || 0,\n                }\n            );\n            console.log(\"Timer completed\");\n\n            // Use the status endpoint to update task status\n            console.log(\"Updating status for task:\", taskId);\n            await apiRequest(\n                `${API_BASE_URL}/api/tasks/${taskId}/status`,\n                \"PATCH\",\n                {\n                    status: \"completed\",\n                }\n            );\n            console.log(\"Status updated\");\n\n            // Invalidate queries to refresh data\n            await queryClient.invalidateQueries({\n                queryKey: [\"/api/tasks\", dbUserId],\n            });\n            await queryClient.invalidateQueries({\n                queryKey: [\"/api/dashboard/stats\"],\n            });\n            console.log(\"Queries invalidated\");\n\n            const newCompleted = new Set(completedTaskIds);\n            newCompleted.add(taskId);\n            setCompletedTaskIds(newCompleted);\n            toast({\n                title: \"Success\",\n                description: \"Task completed successfully\",\n            });\n        } catch (error: any) {\n            console.error(\"Error completing task:\", error);\n            toast({\n                title: \"Error\",\n                description: error.message || \"Failed to complete task\",\n                variant: \"destructive\",\n            });\n        }\n    };\n\n    const formatTime = (seconds: number) => {\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n        return `${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(\n            2,\n            \"0\"\n        )}:${String(secs).padStart(2, \"0\")}`;\n    };\n\n    const getPriorityColor = (priority: string) => {\n        switch (priority) {\n            case \"high\":\n                return \"destructive\";\n            case \"medium\":\n                return \"default\";\n            case \"low\":\n                return \"secondary\";\n            default:\n                return \"secondary\";\n        }\n    };\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case \"completed\":\n                return \"default\";\n            case \"in_progress\":\n                return \"default\";\n            case \"pending\":\n                return \"secondary\";\n            default:\n                return \"secondary\";\n        }\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4 sm:space-y-6\">\n            <div>\n                <h2 className=\"text-2xl sm:text-3xl font-bold\">\n                    Assigned Tasks\n                </h2>\n                <p className=\"text-sm sm:text-base text-muted-foreground mt-1\">\n                    {tasks.length} task{tasks.length !== 1 ? \"s\" : \"\"} assigned\n                </p>\n            </div>\n\n            {tasks.length > 0 ? (\n                <div className=\"space-y-4\">\n                    {tasks.map((task) => {\n                        const timer = timerStates[task.id] || {\n                            isRunning: false,\n                            elapsed: 0,\n                        };\n                        return (\n                            <Card\n                                key={task.id}\n                                data-testid={`card-task-${task.id}`}>\n                                <CardHeader>\n                                    <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                                        <div className=\"flex-1 min-w-0\">\n                                            <CardTitle className=\"text-lg\">\n                                                {task.title}\n                                            </CardTitle>\n                                            {task.description && (\n                                                <p className=\"text-sm text-muted-foreground mt-2\">\n                                                    {task.description}\n                                                </p>\n                                            )}\n                                            <CardDescription className=\"flex flex-wrap items-center gap-2 mt-2\">\n                                                <Calendar className=\"h-4 w-4\" />\n                                                <span>\n                                                    {task.deadline\n                                                        ? new Date(\n                                                              task.deadline\n                                                          ).toLocaleDateString()\n                                                        : \"No deadline\"}\n                                                </span>\n                                            </CardDescription>\n                                        </div>\n                                        <div className=\"flex flex-wrap gap-2\">\n                                            <Badge\n                                                variant={getPriorityColor(\n                                                    task.priority\n                                                )}>\n                                                {task.priority}\n                                            </Badge>\n                                            <Badge\n                                                variant={getStatusColor(\n                                                    task.status\n                                                )}>\n                                                {task.status.replace(\"_\", \" \")}\n                                            </Badge>\n                                        </div>\n                                    </div>\n                                </CardHeader>\n                                <CardContent>\n                                    <div className=\"flex flex-col gap-4\">\n                                        {completedTaskIds.has(task.id) ? (\n                                            <div className=\"flex items-center gap-2 p-3 bg-green-100 dark:bg-green-900 rounded-md\">\n                                                <CheckCircle2 className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                                                <span className=\"text-green-800 dark:text-green-200 font-semibold\">\n                                                    Task Completed\n                                                </span>\n                                            </div>\n                                        ) : (\n                                            <div className=\"flex items-center justify-between\">\n                                                <span className=\"text-2xl font-mono font-semibold\">\n                                                    {formatTime(timer.elapsed)}\n                                                </span>\n                                                <div className=\"flex gap-2\">\n                                                    {!timer.isRunning ? (\n                                                        <Button\n                                                            size=\"sm\"\n                                                            onClick={() =>\n                                                                startTimer(\n                                                                    task.id\n                                                                )\n                                                            }\n                                                            data-testid={`button-start-timer-${task.id}`}>\n                                                            <Play className=\"h-4 w-4 mr-2\" />\n                                                            Start\n                                                        </Button>\n                                                    ) : (\n                                                        <Button\n                                                            size=\"sm\"\n                                                            variant=\"secondary\"\n                                                            onClick={() =>\n                                                                pauseTimer(\n                                                                    task.id\n                                                                )\n                                                            }\n                                                            data-testid={`button-pause-timer-${task.id}`}>\n                                                            <Pause className=\"h-4 w-4 mr-2\" />\n                                                            Pause\n                                                        </Button>\n                                                    )}\n                                                    <Button\n                                                        size=\"sm\"\n                                                        onClick={() =>\n                                                            completeTask(\n                                                                task.id\n                                                            )\n                                                        }\n                                                        data-testid={`button-complete-task-${task.id}`}>\n                                                        <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                                                        Complete\n                                                    </Button>\n                                                </div>\n                                            </div>\n                                        )}\n                                    </div>\n                                </CardContent>\n                            </Card>\n                        );\n                    })}\n                </div>\n            ) : (\n                <Card>\n                    <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                        <p className=\"text-muted-foreground\">\n                            No tasks assigned yet\n                        </p>\n                        <p className=\"text-sm text-muted-foreground mt-2\">\n                            Check back later for new tasks\n                        </p>\n                    </CardContent>\n                </Card>\n            )}\n        </div>\n    );\n}\n","path":null,"size_bytes":17969,"size_tokens":null}},"version":2}